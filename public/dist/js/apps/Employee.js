import t from"../../../../../../index.ci.php/public/js/components/primevue/tabview/tabview.esm.min.js?2025111701";import e from"../../../../../../index.ci.php/public/js/components/primevue/tabpanel/tabpanel.esm.min.js?2025111701";import n from"../../../../../extensions/FHC-Core-Personalverwaltung/js/apps/vbform/presets/presets.js.php?2025111701";import a from"../../../../../../index.ci.php/public/js/components/primevue/config/config.esm.min.js?2025111701";import r from"../../../../../../index.ci.php/public/js/components/primevue/toast/toast.esm.min.js?2025111701";import s from"../../../../../../index.ci.php/public/js/components/primevue/confirmdialog/confirmdialog.esm.min.js?2025111701";import i from"../../../../../../index.ci.php/public/js/components/primevue/confirmationservice/confirmationservice.esm.min.js?2025111701";const l={emits:["dataFetched"],props:{refresh:{type:Boolean},apiFunction:{required:!0,type:Function},apiFunctionParameters:{}},watch:{refresh:function(t,e){this.fetchData()}},data:function(){return{loading:!1,error:!1,errorMessage:null}},created:function(){this.fetchData()},methods:{fetchData:function(){if(this.loading=!0,this.error=!1,this.errorMessage=null,"function"==typeof this.apiFunction){let t=this.apiFunction(this.apiFunctionParameters);t instanceof Promise?t.then(this.successHandler).catch(this.errorHandler).finally(this.finallyHandler):this.setError("The called apiFunction does not return a Promise")}else this.setError("Property apiFunction is not a function")},setError:function(t){this.loading=!1,this.error=!0,this.errorMessage=t},successHandler:function(t){this.$emit("dataFetched",t?t.data:void 0)},errorHandler:function(t){t.response?.data?.retval?this.setError(t.response.data.retval):t.data?.message?this.setError(t.data.message):this.setError(t.message)},finallyHandler:function(){this.loading=!1}},template:'\n\t\t<slot v-if="loading" name="loading">\n\t\t\t<div class="fetch-loader">Loading...</div>\n\t\t</slot>\n\t\t<slot v-else-if="error" name="error" :error-message="errorMessage">\n\t\t\t<div class="fetch-error">{{ errorMessage }}</div>\n\t\t</slot>\n\t\t<slot v-else></slot>\n\t'},o="Filter Component New Filter";var d={props:{filters:{type:Array,default:[]},columns:{type:Array,default:[]},fields:{type:Array,default:[]}},emits:{switchFilter:["filterId"],applyFilterConfig:["filterFields"],saveCustomFilter:["customFilterName"]},data:function(){return{currentFields:[]}},computed:{types(){return this.columns.reduce((t,e)=>{let n=e.type.toLowerCase();return n.indexOf("int")>=0?t[e.name]="Numeric":n.indexOf("varchar")>=0||n.indexOf("text")>=0||n.indexOf("bpchar")>=0?t[e.name]="Text":n.indexOf("timestamp")>=0||n.indexOf("date")>=0?t[e.name]="Date":t[e.name]="",t},{})}},watch:{fields(t){this.currentFields=t}},methods:{switchFilter(t){this.$emit("switchFilter",t.currentTarget.value)},applyFilterConfig(){const t=this.currentFields.filter(t=>t.name!=o);t.filter(t=>""==t.condition).length?alert("Please fill all the filter options"):this.$emit("applyFilterConfig",t)},addField(t){this.currentFields.push({name:o})},removeField(t){this.currentFields.splice(t,1)}},template:'\n\t<div class="filter-config">\n\t\t<div class="card">\n\t\t\t<div class="card-body">\n\t\t\t\t<div v-if="filters.length" class="mb-4">\n\t\t\t\t\t<select class="form-select" @change="switchFilter">\n\t\t\t\t\t\t<option value="">Bitte auswählen...</option>\n\t\t\t\t\t\t<option v-for="filter in filters" :value="filter.id">\n\t\t\t\t\t\t\t{{ filter.description }}\n\t\t\t\t\t\t</option>\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t\t<div>\n\t\t\t\t\t<button class="btn btn-outline-dark" type="button" @click=addField>\n\t\t\t\t\t\t<span class="fa-solid fa-plus" aria-hidden="true"></span> Neuer Filter\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t\t<div class="filter-config-fields my-3">\n\t\t\t\t\t<div v-for="(filterField, index) in currentFields" class="filter-config-field row">\n\n\t\t\t\t\t\t<div class="col-5">\n\t\t\t\t\t\t\t<div class="input-group">\n\t\t\t\t\t\t\t\t<span class="input-group-text">Filter {{ index + 1 }}</span>\n\t\t\t\t\t\t\t\t<select\n\t\t\t\t\t\t\t\t\tclass="form-select"\n\t\t\t\t\t\t\t\t\tv-model="filterField.name"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<option value="">Feld zum Filter hinzufügen...</option>\n\t\t\t\t\t\t\t\t\t<option v-for="col in columns" :value="col.name">\n\t\t\t\t\t\t\t\t\t\t{{ col.title }}\n\t\t\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\x3c!-- Numeric --\x3e\n\t\t\t\t\t\t<template v-if="types[filterField.name] == \'Numeric\'">\n\t\t\t\t\t\t\t<div class="col-2">\n\t\t\t\t\t\t\t\t<select class="form-select" v-model="filterField.operation">\n\t\t\t\t\t\t\t\t\t<option value="equal">Gleich</option>\n\t\t\t\t\t\t\t\t\t<option value="nequal">Nicht gleich</option>\n\t\t\t\t\t\t\t\t\t<option value="gt">Größer als</option>\n\t\t\t\t\t\t\t\t\t<option value="lt">Weniger als</option>\n\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="col-3">\n\t\t\t\t\t\t\t\t<input type="number" class="form-control" v-model="filterField.condition">\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\n\t\t\t\t\t\t\x3c!-- Text --\x3e\n\t\t\t\t\t\t<template v-if="types[filterField.name] == \'Text\'">\n\t\t\t\t\t\t\t<div class="col-2">\n\t\t\t\t\t\t\t\t<select class="form-select" v-model="filterField.operation">\n\t\t\t\t\t\t\t\t\t<option value="equal">Gleich</option>\n\t\t\t\t\t\t\t\t\t<option value="nequal">Nicht gleich</option>\n\t\t\t\t\t\t\t\t\t<option value="contains">Enthält</option>\n\t\t\t\t\t\t\t\t\t<option value="ncontains">Enthält nicht</option>\n\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="col-3">\n\t\t\t\t\t\t\t\t<input type="text" class="form-control" v-model="filterField.condition">\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\n\t\t\t\t\t\t\x3c!-- Timestamp and date --\x3e\n\t\t\t\t\t\t<template v-if="types[filterField.name] == \'Date\'">\n\t\t\t\t\t\t\t<div class="col-2">\n\t\t\t\t\t\t\t\t<select class="form-select" v-model="filterField.operation">\n\t\t\t\t\t\t\t\t\t<option value="gt">Größer als</option>\n\t\t\t\t\t\t\t\t\t<option value="lt">Weniger als</option>\n\t\t\t\t\t\t\t\t\t<option value="set">Eingestellt ist</option>\n\t\t\t\t\t\t\t\t\t<option value="nset">Eingestellt nicht ist</option>\n\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="col-1">\n\t\t\t\t\t\t\t\t<input type="number" class="form-control" v-model="filterField.condition">\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="col-2">\n\t\t\t\t\t\t\t\t<select class="form-select" v-model="filterField.option">\n\t\t\t\t\t\t\t\t\t<option value="minutes">Minuten</option>\n\t\t\t\t\t\t\t\t\t<option value="hours">Stunden</option>\n\t\t\t\t\t\t\t\t\t<option value="days">Tage</option>\n\t\t\t\t\t\t\t\t\t<option value="months">Monate</option>\n\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\n\t\t\t\t\t\t<div class="col text-end">\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass="btn btn-outline-dark"\n\t\t\t\t\t\t\t\ttype="button"\n\t\t\t\t\t\t\t\t@click="removeField(index)"\n\t\t\t\t\t\t\t\ttitle="Filter entfernen"\n\t\t\t\t\t\t\t\taria-title="Filter entfernen"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<span class="fa-solid fa-minus" aria-hidden="true"></span>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t\x3c!-- Filter save options --\x3e\n\t\t\t\t<div class="row">\n\t\t\t\t\t<div class="col-7">\n\t\t\t\t\t\t<div class="input-group">\n\t\t\t\t\t\t\t<input ref="filterName" type="text" class="form-control" placeholder="Filternamen eingeben...">\n\t\t\t\t\t\t\t<button type="button" class="btn btn-outline-secondary" @click="$emit(\'saveCustomFilter\', $refs.filterName.value)">Filter speichern</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="col">\n\t\t\t\t\t\t<button type="button" class="btn btn-outline-dark" @click="applyFilterConfig">Filter anwenden</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\t'},u={props:{fields:Array,selected:{type:Array,default:[]},names:{type:Object,default:{}}},emits:{hide:["fieldName"],show:["fieldName"]},data:function(){return{selectedFields:[]}},watch:{selected(t){this.selectedFields=t}},methods:{toggle(t){-1!=this.selectedFields.indexOf(t)?(this.selectedFields.splice(this.selectedFields.indexOf(t),1),this.$emit("hide",t)):(this.selectedFields.push(t),this.$emit("show",t))}},template:'\n\t<div class="filter-columns">\n\t\t<div class="card">\n\t\t\t<div class="d-flex flex-wrap gap-2 p-3 justify-content-center">\n\t\t\t\t<div\n\t\t\t\t\tv-for="fieldToDisplay in fields"\n\t\t\t\t\tclass="btn"\n\t\t\t\t\t:class="selectedFields.indexOf(fieldToDisplay) != -1 ? \'btn-dark\' : \'btn-outline-dark\' "\n\t\t\t\t\t@click="toggle(fieldToDisplay)"\n\t\t\t\t>\n\t\t\t\t\t{{ names[fieldToDisplay] || fieldToDisplay }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\t'};const c={jsonLines:"fa-file-lines",xlsx:"fa-file-excel",pdf:"fa-file-pdf",html:"fa-file-code",json:"fa-file",csv:"fa-file-csv"},p={jsonLines:"Download as JSONLINES",xlsx:"Download as XLSX",pdf:"Download as PDF",html:"Download as HTML",json:"Download as JSON",csv:"Download as CSV "};var h={props:{tabulator:Object,config:{type:[Boolean,String,Function,Array,Object],default:!1},iconClass:[String,Array,Object]},computed:{currentConfig(){if(!this.config)return!1;let t=this.config;if(t instanceof Function)return[t];if(null===t)return[];if(!0===this.config&&(t=["csv"]),"[object String]"===Object.prototype.toString.call(t)&&(t=t.split(",")),"object"==typeof t&&!Array.isArray(t)){let r=[];for(var e in t){var n,a=t[e];a&&("[object String]"===Object.prototype.toString.call(a)?null!==(n=this.stringToFileFormatter(a))?r.push({icon:"fa-solid "+c[n],label:a===e?p[n]:e,formatter:n}):null!==(n=this.stringToFileFormatter(e))?r.push({icon:"fa-solid "+c[n],label:a,formatter:n}):alert("neither "+e+" nor "+a+" are supported download file types"):"object"!=typeof a||Array.isArray(a)?null!==(n=this.stringToFileFormatter(e))?r.push({icon:"fa-solid "+c[n],label:p[n],formatter:n}):alert(e+" is not a supported download file type"):null!==(n=this.stringToFileFormatter(e))?(void 0===a.formatter&&(a.formatter=n),void 0===a.label&&(a.label=p[n]),void 0===a.icon&&(a.icon=c[n]),r.push(a)):(void 0===a.label&&(a.label=e),r.push(a)))}t=r}if(Array.isArray(t)){if(t=t.map(t=>{if("[object String]"===Object.prototype.toString.call(t)){let e=this.stringToFileFormatter(t);return null===e?null:{icon:"fa-solid "+c[e],label:p[e],formatter:e}}if(t instanceof Function)return{formatter:t};if("object"==typeof t&&!Array.isArray(t)&&null!==t){if(t.formatter instanceof Function)return t;if(this.validateFileFormatter(t.formatter))return t}return null}).filter(t=>null!==t),t.length<2)return t;if(t.filter(t=>t.label||t.icon).length==t.length)return t;alert("Config not valid")}return[]}},methods:{stringToFileFormatter(t){let e=t.toLowerCase();return"jsonlines"==e?"jsonLines":["xlsx","pdf","html","json","csv"].includes(e)?e:null},validateFileFormatter(t){let e=this.stringToFileFormatter(t);if(!e)return alert(t+" is not a supported file formatter"),!1;if("xlsx"==e&&!window.XLSX)return alert("XLSX Library not loaded"),!1;if("pdf"==e){if(!window.jspdf)return alert("jsPDF Library not loaded"),!1;if(!new jspdf.jsPDF({}).autoTable)return alert("jsPDF-AutoTable Plugin not loaded"),!1}return!0},download(t){this.tabulator.download(t.formatter,t.file,t.options)}},template:'\n\t<template v-if="currentConfig">\n\t\t<template v-if="currentConfig.length == 1">\n\t\t\t<a\n\t\t\t\thref="#"\n\t\t\t\tclass="table-download"\n\t\t\t\tv-bind="$attrs"\n\t\t\t\ttitle="Download"\n\t\t\t\taria-title="Download"\n\t\t\t\t@click.prevent="download(currentConfig[0])"\n\t\t\t>\n\t\t\t\t<span :class="iconClass || \'fa-solid fa-xl fa-download\'" aria-hidden="true"></span>\n\t\t\t</a>\n\t\t</template>\n\t\t<div v-else class="dropdown d-inline">\n\t\t\t<a\n\t\t\t\thref="#"\n\t\t\t\tclass="table-download"\n\t\t\t\tv-bind="$attrs"\n\t\t\t\ttitle="Download"\n\t\t\t\taria-title="Download"\n\t\t\t\trole="button"\n\t\t\t\tdata-bs-toggle="dropdown"\n\t\t\t\taria-expanded="false"\n\t\t\t>\n\t\t\t\t<span :class="iconClass || \'fa-solid fa-xl fa-download\'" aria-hidden="true"></span>\n\t\t\t</a>\n\t\t\t<ul class="dropdown-menu dropdown-menu-end">\n\t\t\t\t<li v-for="(conf, i) in currentConfig" :key="i">\n\t\t\t\t\t<a class="dropdown-item" href="#" @click.prevent="download(conf)">\n\t\t\t\t\t\t<span v-if="conf.icon" :class="conf.icon" aria-hidden="true"></span>\n\t\t\t\t\t\t{{conf.label}}\n\t\t\t\t\t</a>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t</div>\n\t</template>\n\t'};const f=new WeakMap;var v={mounted(t,e){let n=!1;f.set(t,e=>{if(!n)return;if(t.contains(e.target))return;const a=bootstrap.Collapse.getInstance(t);a&&a.hide()}),t.addEventListener("shown.bs.collapse",()=>{n=!0}),t.addEventListener("hide.bs.collapse",()=>{n=!1}),document.addEventListener("click",f.get(t),!0)},beforeUnmount(t,e){document.removeEventListener("click",f.get(t)),delete t.collapsibleAutoHideFunc}};window.Tabulator?.extendModule("layout","modes",{fitDataStretchFrozen(t,e){var n=0,a=this.table.rowManager.element.clientWidth,r=0,s=!1;t.forEach((t,e)=>{t.widthFixed||t.reinitializeWidth(),(this.table.options.responsiveLayout?t.modules.responsive.visible:t.visible&&!t.definition.frozen)&&(s=t),t.visible&&(n+=t.getWidth())}),s?(r=a-n+s.getWidth(),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&(s.setWidth(0),this.table.modules.responsiveLayout.update()),r>0?s.setWidth(r):s.reinitializeWidth()):this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}});var m={saveCustomFilter:t=>({method:"post",url:"/api/frontend/v1/filter/saveCustomFilter",params:{filterUniqueId:t.filterUniqueId,filterType:t.filterType,customFilterName:t.customFilterName}}),removeCustomFilter:t=>({method:"post",url:"/api/frontend/v1/filter/removeCustomFilter",params:{filterUniqueId:t.filterUniqueId,filterType:t.filterType,filterId:t.filterId}}),applyFilterFields:t=>({method:"post",url:"/api/frontend/v1/filter/applyFilterFields",params:{filterUniqueId:t.filterUniqueId,filterType:t.filterType,filterFields:t.filterFields}}),addFilterField:t=>({method:"post",url:"/api/frontend/v1/filter/addFilterField",params:{filterUniqueId:t.filterUniqueId,filterType:t.filterType,filterField:t.filterField}}),removeFilterField:t=>({method:"post",url:"/api/frontend/v1/filter/removeFilterField",params:{filterUniqueId:t.filterUniqueId,filterType:t.filterType,filterField:t.filterField}}),getFilterById:t=>({method:"get",url:"/api/frontend/v1/filter/getFilter",params:{filterUniqueId:t.filterUniqueId,filterType:t.filterType,filterId:t.filterId}}),getFilter:t=>({method:"get",url:"/api/frontend/v1/filter/getFilter",params:{filterUniqueId:t.filterUniqueId,filterType:t.filterType}})},g=0;const b={components:{CoreFetchCmpt:l,FilterConfig:d,FilterColumns:u,TableDownload:h},directives:{collapseAutoClose:v},emits:["nwNewEntry","click:new","tableBuilt","uuidDefined"],props:{onNwNewEntry:Function,title:String,description:String,sideMenu:{type:Boolean,default:!0},filterType:{type:String},tabulatorOptions:Object,tabulatorEvents:Array,tableOnly:Boolean,noColumnFilter:Boolean,reload:Boolean,reloadBtnInfotext:String,download:{type:[Boolean,String,Function,Array,Object],default:!1},newBtnShow:Boolean,newBtnClass:[String,Array,Object],newBtnDisabled:Boolean,newBtnLabel:String,uniqueId:String,idField:String,parentIdField:String,countOnly:Boolean,useSelectionSpan:{type:Boolean,default:!0}},data:function(){return{uuid:0,filterName:null,filterActive:!1,fields:null,dataset:null,datasetMetadata:null,selectedFields:null,filterFields:null,availableFilters:null,selectedFilter:null,fetchCmptRefresh:!1,fetchCmptApiFunction:null,fetchCmptApiFunctionParams:null,fetchCmptDataFetched:null,fetchResult:null,tabulator:null,tableBuilt:!1,tabulatorHasSelector:!1,selectedData:[],persistence:{sort:!0,columns:!0,filter:!1,headerFilter:!1,group:!1,page:!1}}},computed:{notSelectedFields(){return this.fields&&this.selectedFields?this.fields.filter(t=>-1===this.selectedFields.indexOf(t)):null},filteredData(){return this.dataset?JSON.parse(JSON.stringify(this.dataset)):[]},filteredColumns(){let t=JSON.parse(JSON.stringify(this.fields))||[],e=JSON.parse(JSON.stringify(this.selectedFields))||[],n=null;if(this.tabulatorOptions&&this.tabulatorOptions.hasOwnProperty("columns")&&(n=this.tabulatorOptions.columns),!Array.isArray(n)||Array.isArray(n)&&n.length<t.length){n=[];for(let a of t){let t={title:a,field:a};t.visible=e.indexOf(a)>=0,n.push(t)}}else for(let a of n)a.visible=e.indexOf(a.field)>=0||-1==t.indexOf(a.field),a.hasOwnProperty("resizable")&&(a.resizable=a.visible);return n},fieldIdsForVisibilty(){return this.tableBuilt?this.tabulator.getColumns().filter(t=>{let e=t.getDefinition();return!e.frozen&&e.title&&"responsiveCollapse"!=e.formatter}).map(t=>t.getField()):[]},fieldNames(){return this.tableBuilt?this.tabulator.getColumns().reduce((t,e)=>(t[e.getField()]=e.getDefinition().title,t),{}):{}},idExtra(){return this.uuid?"-"+this.uuid:""},columnsForFilter(){if(!this.filteredColumns||!this.datasetMetadata)return[];const t=this.filteredColumns.reduce((t,e)=>(t[e.field]=e.title,t),{});return this.datasetMetadata.map(e=>({...e,title:t[e.name]}))}},methods:{reloadTable(){this.tableOnly?this.tabulator.setData():this.getFilter()},async initTabulator(){let t="< Phrasen Plugin not loaded! >";this.$p&&(await this.$p.loadCategory("ui"),t=this.$p.t("ui/keineDatenVorhanden")),this.tableOnly||await new Promise(t=>{const e=window.location.hash?window.location.hash.slice(1):null,n=e=>{this.setRenderData(e),t()};null===e?this.startFetchCmpt(t=>this.$api.call(m.getFilter(t)),null,n):this.startFetchCmpt(t=>this.$api.call(m.getFilterById(t)),{filterId:e},n)});let e={layout:"fitDataStretchFrozen",movableColumns:!0,columnDefaults:{tooltip:!0},placeholder:t,persistence:this.persistence,...this.tabulatorOptions||{}};if(void 0===e.height&&void 0===e.minHeight&&void 0===e.maxHeight&&(e.height=500),this.tableOnly?e.columns.forEach(t=>{void 0===t.visible&&(t.visible=!0)}):(e.data=this.filteredData,e.columns=this.filteredColumns),(e.selectable||e.columns&&e.columns.filter(t=>"rowSelection"==t.formatter).length)&&(this.tabulatorHasSelector=!0),this.idField&&(this.parentIdField&&(e.dataTree=!0),e.index=this.idField),this.tabulator=new Tabulator(this.$refs.table,e),Array.isArray(this.tabulatorEvents)&&this.tabulatorEvents.length>0)for(let t of this.tabulatorEvents)this.tabulator.on(t.event,t.handler);this.tabulator.on("tableBuilt",()=>{this.tableBuilt=!0,this.$emit("tableBuilt")}),this.tabulator.on("rowSelectionChanged",t=>{this.selectedData=t}),this.parentIdField&&this.idField&&this.tabulator.on("dataLoading",t=>{let e=[];for(let n=0;n<t.length;n++){let a=t[n];a[this.parentIdField]&&this.appendChild(t,a)&&e.push(n)}for(let n=0;n<e.length;n++)t.splice(e[n]-n,1)}),this.tableOnly&&this.tabulator.on("tableBuilt",()=>{const t=this.tabulator.getColumns();this.fields=t.map(t=>t.getField()),this.selectedFields=t.filter(t=>t.isVisible()).map(t=>t.getField()),this.tabulator.options.persistence.headerFilter&&this._setHeaderFilter()}),this.tabulator.on("dataFiltered",t=>{this.filterActive=t.length>0})},updateTabulator(){this.tabulator&&(this.tableBuilt?this._updateTabulator():this.tabulator.on("tableBuilt",this._updateTabulator))},_updateTabulator(){this.tabulatorHasSelector=this.tabulatorOptions.selectable||this.filteredColumns.filter(t=>"rowSelection"==t.formatter).length,this.tabulator.setColumns(this.filteredColumns),this.tabulator.setData(this.filteredData),this._setHeaderFilter()},clearFilters(){this.tabulator.getHeaderFilters().forEach(t=>{this.tabulator.setHeaderFilterValue(t.field,"")}),this.tabulator.clearFilter(),this.filterActive=!1},_setHeaderFilter(){this.tabulator.getHeaderFilters().forEach(t=>{this.tabulator.setHeaderFilterValue(t.field,t.value)})},getFilter(){null===this.selectedFilter?this.startFetchCmpt(t=>this.$api.call(m.getFilter(t)),null,this.render):this.startFetchCmpt(t=>this.$api.call(m.getFilterById(t)),{filterId:this.selectedFilter},this.render)},setRenderData(t){this.fetchResult=t,this.filterName=t.filterName,this.dataset=t.dataset,this.datasetMetadata=t.datasetMetadata,this.fields=t.fields,this.selectedFields=t.selectedFields,this.filterFields=[];for(let e=0;e<t.datasetMetadata.length;e++)for(let n=0;n<t.filters.length;n++)if(t.datasetMetadata[e].name==t.filters[n].name){let a=t.filters[n];a.type=t.datasetMetadata[e].type,this.filterFields.push(a)}},render(t){let e=t;this.setRenderData(e),!0===this.sideMenu?this.setSideMenu(e):this.setDropDownMenu(e),this.updateTabulator()},setSideMenu(t){let e=t.sideMenu.filters,n=t.sideMenu.personalFilters,a=[];for(let t=0;t<e.length;t++){let n=e[t].link;null==n&&(n="#"),a[a.length]={id:e[t].filter_id,link:n+e[t].filter_id,description:e[t].desc,sort:t,onClickCall:this.handlerGetFilterById}}for(let t=0;t<n.length;t++){let e=n[t].link;null==e&&(e="#"),a[a.length]={id:n[t].filter_id,link:e+n[t].filter_id,description:n[t].desc,subscriptDescription:n[t].subscriptDescription,subscriptLinkClass:n[t].subscriptLinkClass,subscriptLinkValue:n[t].subscriptLinkValue,sort:t,onClickCall:this.handlerGetFilterById,onClickSubscriptCall:this.handlerRemoveCustomFilter}}this.availableFilters=a,this.$emit("nwNewEntry",{link:"#",description:"Filters",icon:"filter",children:a})},setDropDownMenu(t){let e=t.sideMenu.filters,n=t.sideMenu.personalFilters,a=[];for(let t=0;t<e.length;t++)e[t].link,a[a.length]={id:e[t].filter_id,option:e[t].filter_id,description:e[t].desc};for(let t=0;t<n.length;t++)n[t].link,a[a.length]={id:n[t].filter_id,option:n[t].filter_id,description:n[t].desc};this.availableFilters=a},startFetchCmpt(t,e,n){this.fetchCmptApiFunction=t,null==e&&(e={}),e.filterUniqueId=FHC_JS_DATA_STORAGE_OBJECT.called_path+"/"+FHC_JS_DATA_STORAGE_OBJECT.called_method,e.filterType=this.filterType,this.uniqueId&&(e.filterUniqueId+="_"+this.uniqueId),this.fetchCmptApiFunctionParams=e,this.fetchCmptDataFetched=n,!0===this.fetchCmptRefresh?this.fetchCmptRefresh=!1:this.fetchCmptRefresh=!0},handlerSaveCustomFilter(t){this.selectedFilter=null,this.startFetchCmpt(t=>this.$api.call(m.saveCustomFilter(t)),{customFilterName:t},this.getFilter)},handlerRemoveCustomFilter(t){let e=t.currentTarget.getAttribute("href").substring(1);e===this.selectedFilter&&(this.selectedFilter=null),this.startFetchCmpt(t=>this.$api.call(m.removeCustomFilter(t)),{filterId:e},this.getFilter)},handlerGetFilterById:function(t){let e=null,n=t.currentTarget.getAttribute("href");e=null==n?t.currentTarget.value:n.substring(1),this.switchFilter(e)},switchFilter(t){this.selectedFilter=t,this.getFilter()},applyFilterConfig(t){this.selectedFilter=null,this.startFetchCmpt(t=>this.$api.call(m.applyFilterFields(t)),{filterFields:t},this.getFilter)},appendChild(t,e){let n=e[this.parentIdField];for(let a=0;a<t.length;a++){let r=t[a];if(r[this.idField]==n)return r._children||(r._children=[]),r._children.includes(e)||r._children.push(e),!0;r._children&&this.appendChild(r._children,e)}return!1}},beforeCreate(){!this.tableOnly==!this.filterType&&alert("You can not have a filter-type in table-only mode!")},created(){!this.sideMenu||this.$props.onNwNewEntry&&this.$props.onNwNewEntry instanceof Function||alert('"nwNewEntry" listener is mandatory when sideMenu is true'),this.uuid=g++,this.$emit("uuidDefined",this.uuid)},mounted(){this.initTabulator().then(()=>{this.tableOnly||(this.selectedFilter=window.location.hash?window.location.hash.slice(1):null,this.render(this.fetchResult))})},template:'\n\t\t\x3c!-- Load filter data --\x3e\n\t\t<core-fetch-cmpt\n\t\t\tv-if="!tableOnly && fetchCmptApiFunction"\n\t\t\tv-bind:api-function="fetchCmptApiFunction"\n\t\t\tv-bind:api-function-parameters="fetchCmptApiFunctionParams"\n\t\t\tv-bind:refresh="fetchCmptRefresh"\n\t\t\t@data-fetched="fetchCmptDataFetched">\n\t\t</core-fetch-cmpt>\n\n\t\t<div class="row" v-if="title != null && title != \'\'">\n\t\t\t<div class="col-lg-12">\n\t\t\t\t<h3 class="page-header mt-1 mb-4">\n\t\t\t\t\t{{ title }}\n\t\t\t\t</h3>\n\t\t\t</div>\n\t\t</div>\n\t\t<div :id="\'filterCollapsables\' + idExtra">\n\n\t\t\t<div class="d-flex flex-row justify-content-between flex-wrap">\n\t\t\t\t<div v-if="newBtnShow || reload || $slots.search || $slots.actions" class="d-flex gap-2 align-items-baseline flex-wrap">\n\t\t\t\t\t<button v-if="newBtnShow" class="btn btn-primary" :class="newBtnClass" :title="newBtnLabel ? undefined : \'New\'" :aria-label="newBtnLabel ? undefined : \'New\'" @click="$emit(\'click:new\', $event)" :disabled="newBtnDisabled">\n\t\t\t\t\t\t<span class="fa-solid fa-plus" aria-hidden="true"></span>\n\t\t\t\t\t\t{{ newBtnLabel }}\n\t\t\t\t\t</button>\n\t\t\t\t\t<button v-if="reload" class="btn btn-outline-secondary" aria-label="Reload" @click="reloadTable">\n\t\t\t\t\t\t<span class="fa-solid fa-rotate-right" aria-hidden="true"  :title="reloadBtnInfotext ? reloadBtnInfotext : \'Reload\'" ></span>\n\t\t\t\t\t</button>\n\t\t\t\t\t<span v-if="$slots.actions && tabulatorHasSelector && useSelectionSpan">\n\t\t\t\t\t\t<span v-if="countOnly">{{ selectedData.length }} ausgewählt</span>\n\t\t\t\t\t\t<span v-else id="selected-info-text"> Mit {{ selectedData.length }} ausgewählten:</span>\n\t\t\t\t\t</span>\n\t\t\t\t\t<slot name="actions" v-bind="{selected: tabulatorHasSelector ? selectedData : []}"></slot>\n\t\t\t\t\t<slot name="search"></slot>\n\t\t\t\t</div>\n\t\t\t\t<div class="d-flex gap-1 align-items-baseline flex-grow-1 justify-content-end">\n\t\t\t\t\t<span v-if="!tableOnly">[ {{ filterName }} ]</span>\n\t\t\t\t\t<span v-else-if="description" v-html="description"></span>\n\t\t\t\t\t<a aria-label="filter" v-if="!tableOnly || $slots.filter" href="#" class="btn btn-link px-0 fhc-text" data-bs-toggle="collapse" :data-bs-target="\'#collapseFilters\' + idExtra">\n\t\t\t\t\t\t<span class="fa-solid fa-xl fa-filter"></span>\n\t\t\t\t\t</a>\n\t\t\t\t\t<a aria-label="filter" v-if="filterActive"  class="btn btn-link px-0 fhc-text" :title="$p.t(\'ui\',\'filterdelete\')" @click="clearFilters">\n\t\t\t\t\t\t<span class="fa-solid fa-xl fa-filter-circle-xmark"></span>\n\t\t\t\t\t</a>\n\t\t\t\t\t<a aria-label="filter" href="#" class="btn btn-link px-0 fhc-text" data-bs-toggle="collapse" :data-bs-target="\'#collapseColumns\' + idExtra">\n\t\t\t\t\t\t<span class="fa-solid fa-xl fa-table-columns"></span>\n\t\t\t\t\t</a>\n\t\t\t\t\t<table-download class="btn btn-link px-0 fhc-text" :tabulator="tabulator" :config="download"></table-download>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<filter-columns\n\t\t\t\t:id="\'collapseColumns\' + idExtra"\n\t\t\t\tclass="card-body collapse"\n\t\t\t\t:data-bs-parent="\'#filterCollapsables\' + idExtra"\n\t\t\t\t:fields="fieldIdsForVisibilty"\n\t\t\t\t:selected="selectedFields"\n\t\t\t\t:names="fieldNames"\n\t\t\t\t@hide="tabulator.hideColumn($event)"\n\t\t\t\t@show="tabulator.showColumn($event)"\n\t\t\t\tv-collapse-auto-close\n\t\t\t></filter-columns>\n\n\t\t\t<filter-config\n\t\t\t\tv-if="!tableOnly"\n\t\t\t\t:id="\'collapseFilters\' + idExtra"\n\t\t\t\tclass="card-body collapse"\n\t\t\t\t:data-bs-parent="\'#filterCollapsables\' + idExtra"\n\t\t\t\t:filters="!sideMenu ? (availableFilters || []) : []"\n\t\t\t\t:columns="columnsForFilter"\n\t\t\t\t:fields="filterFields || []"\n\t\t\t\t@switch-filter="switchFilter"\n\t\t\t\t@apply-filter-config="applyFilterConfig"\n\t\t\t\t@save-custom-filter="handlerSaveCustomFilter"\n\t\t\t\tv-collapse-auto-close\n\t\t\t></filter-config>\n\t\t\t<div\n\t\t\t\tv-else-if="$slots.filter"\n\t\t\t\t:id="\'collapseFilters\' + idExtra"\n\t\t\t\tclass="card-body collapse"\n\t\t\t\t:data-bs-parent="\'#filterCollapsables\' + idExtra"\n\t\t\t\tv-collapse-auto-close\n\t\t\t\t>\n\t\t\t\t<slot name="filter"></slot>\n\t\t\t</div>\n\t\t</div>\n\n\t\t\x3c!-- Tabulator --\x3e\n\t\t<div ref="table" :id="\'filterTableDataset\' + idExtra" class="filter-table-dataset"></div>\n\t'};var y={getHeader:t=>({method:"get",url:"/api/frontend/v1/navigation/header",params:{navigation_page:t}}),getMenu:t=>({method:"get",url:"/api/frontend/v1/navigation/menu",params:{navigation_page:t}})};const _={components:{CoreFetchCmpt:l},props:{addHeaderMenuEntries:Object,addSideMenuEntries:Object,hideTopMenu:Boolean,leftNavCssClasses:{type:String,default:"navbar navbar-left-side"}},data:()=>({headerMenu:{},sideMenu:{}}),computed:{headerMenuEntries(){let t=this.headerMenu?{...this.headerMenu}:{};return null!=this.headerMenu&&null!=this.addHeaderMenuEntries&&Object.keys(this.addHeaderMenuEntries).length>0&&(t[this.addHeaderMenuEntries.description]=this.addHeaderMenuEntries),t},sideMenuEntries(){let t=this.sideMenu?{...this.sideMenu}:{};return null!=this.sideMenu&&null!=this.addSideMenuEntries&&Object.keys(this.addSideMenuEntries).length>0&&(t[this.addSideMenuEntries.description]=this.addSideMenuEntries),t}},methods:{getNavigationPage:()=>FHC_JS_DATA_STORAGE_OBJECT.called_path+"/"+FHC_JS_DATA_STORAGE_OBJECT.called_method,fetchCmptApiFunctionHeader(){return this.$api.call(y.getHeader(this.getNavigationPage()))},fetchCmptApiFunctionSideMenu(){return this.$api.call(y.getMenu(this.getNavigationPage()))},fetchCmptDataFetchedHeader(t){this.headerMenu=t||{}},fetchCmptDataFetchedMenu(t){this.sideMenu=t||{}},getDataBsToggle:t=>t.children?"dropdown":null},template:'\n\t\t\x3c!-- Load head menu --\x3e\n\t\t<core-fetch-cmpt v-bind:api-function="fetchCmptApiFunctionHeader" @data-fetched="fetchCmptDataFetchedHeader"></core-fetch-cmpt>\n\t\t\x3c!-- Load side menu --\x3e\n\t\t<core-fetch-cmpt v-bind:api-function="fetchCmptApiFunctionSideMenu" @data-fetched="fetchCmptDataFetchedMenu"></core-fetch-cmpt>\n\n\t\t\x3c!-- Top menu --\x3e\n\t\t<nav class="navbar navbar-expand-lg navbar-header" v-if="!hideTopMenu">\n\t\t\t<ul class="navbar-nav">\n\t\t\t\t\x3c!-- 1st level --\x3e\n\t\t\t\t<template v-for="header in headerMenuEntries">\n\t\t\t\t\t<li class="nav-item dropdown">\n\t\t\t\t\t\t<a class="nav-link header-menu-link-entry"\n\t\t\t\t\t\t\tv-bind:data-bs-toggle="this.getDataBsToggle(header)"\n\t\t\t\t\t\t\tv-bind:class="{ \'dropdown-toggle\': header.children }"\n\t\t\t\t\t\t\tv-bind:href="header.link"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<i class="fa-solid fa-fw header-menu-icon" v-bind:class="\'fa-\' + header.icon" v-if="header.icon"></i> {{ header.description }}\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t<ul class="dropdown-menu" v-if="header.children">\n\t\t\t\t\t\t\t\x3c!-- 2nd level --\x3e\n\t\t\t\t\t\t\t<template v-for="child in header.children">\n\t\t\t\t\t\t\t\t<li><a class="dropdown-item" v-bind:href="child.link">{{ child.description }}</a></li>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t</li>\n\t\t\t\t</template>\n\t\t\t</ul>\n\t\t\t<slot></slot>\n\t\t</nav>\n\n\t\t\x3c!-- Left side menu --\x3e\n\t\t<nav :class="leftNavCssClasses">\n\t\t\t<ul class="navbar-nav">\n\t\t\t\t\x3c!-- 1st level --\x3e\n\t\t\t\t<template v-for="menu in sideMenuEntries">\n\t\t\t\t\t<li class="nav-item">\n\t\t\t\t\t\t<a class="nav-link left-side-menu-link-entry" v-bind:href="menu.link" @click=menu.onClickCall>\n\t\t\t\t\t\t\t<i class="fa fa-fw" v-bind:class="\'fa-\'+ menu.icon"></i> {{ menu.description }}\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t<ul class="nav-link left-side-menu-second-level" v-if="menu.children">\n\t\t\t\t\t\t\t\x3c!-- 2nd level --\x3e\n\t\t\t\t\t\t\t<template v-for="child in menu.children">\n\t\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t\t\t<a class="nav-link left-side-menu-link-entry" v-bind:href="child.link" @click=child.onClickCall>\n\t\t\t\t\t\t\t\t\t\t&emsp;&emsp;{{ child.description }}\n\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\t\tclass="nav-link left-side-menu-link-entry"\n\t\t\t\t\t\t\t\t\t\tv-bind:class="child.subscriptLinkClass"\n\t\t\t\t\t\t\t\t\t\tv-if="child.subscriptDescription"\n\t\t\t\t\t\t\t\t\t\tv-bind:href="child.link"\n\t\t\t\t\t\t\t\t\t\t@click=child.onClickSubscriptCall\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{{ child.subscriptDescription }}\n\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t</li>\n\t\t\t\t</template>\n\t\t\t</ul>\n\t\t</nav>\n\t'};var k={name:"VerticalSplit",data:function(){return{availHeight:0,topheight:0,bottomheight:0,mousePosY:0,resize:!1,vsplitter:null,vsplitterOffset:0,selfOffsetTop:0}},template:'\n    <div ref="verticalsplit">\n        <div ref="toppanel" class="verticalsplitted" \n             :style="{height: this.topheightcss}">\n            <slot name="top">\n                <p>Top Panel</p>\n            </slot>\n        </div>\n        <div ref="vsplitter" class="verticalsplitter" \n             :class="this.topOrBottomClass" @mousedown="this.dragStart">\n            <div class="splitactions" :class="this.topOrBottomClass">\n                <span @click="this.collapseTop" class="splitaction">\n                    <i class="fas fa-angle-up text-muted"></i>\n                </span>\n                <span @dblclick="this.showBoth" class="splitaction resize">\n                    <i class="fas fa-grip-lines text-muted"></i>\n                </span>\n                <span @click="this.collapseBottom" class="splitaction">\n                    <i class="fas fa-angle-down text-muted"></i>\n                </span>\n            </div>\n        </div>\n        <div ref="bottompanel" class="verticalsplitted"\n             :style="{height: this.bottomheightcss}">\n            <slot name="bottom">\n                <p/>\n            </slot>\n        </div>\n    </div>\n    ',mounted:function(){this.calcHeights(),this.trackVerticalSplitterOffsetTop(),window.addEventListener("resize",this.calcHeights)},updated:function(){this.trackVerticalSplitterOffsetTop()},methods:{calcHeights:function(){var t=window.innerHeight,e=this.availHeight;this.selfOffsetTop=this.$refs.verticalsplit.offsetTop,this.availHeight=t-this.selfOffsetTop-this.$refs.vsplitter.offsetHeight,0===this.topheight&&0===this.bottomheight||0===e?this.topheight=Math.floor(this.availHeight/2):this.topheight=Math.floor(100*this.topheight/e/100*this.availHeight),this.bottomheight=this.availHeight-this.topheight},collapseTop:function(){this.calcHeights(),this.topheight=0,this.bottomheight=this.availHeight},collapseBottom:function(){this.calcHeights(),this.topheight=this.availHeight,this.bottomheight=0},showBoth:function(){this.topheight=Math.floor(this.availHeight/2),this.bottomheight=Math.floor(this.availHeight/2)},isCollapsed:function(){return 0===this.topheight?"top":0===this.bottomheight&&"bottom"},dragStart:function(t){t.preventDefault(),t.stopPropagation(),window.addEventListener("mouseup",this.dragEnd),window.addEventListener("mousemove",this.drag),this.resize=!0,this.mousePosY=t.clientY},drag:function(t){if(this.resize){t.preventDefault(),t.stopPropagation();var e=t.clientY-this.mousePosY;this.topheight=this.topheight+e,this.topheight<0&&(this.topheight=0),this.topheight>this.availHeight&&(this.topheight=this.availHeight),this.bottomheight=this.availHeight-this.topheight,this.mousePosY=t.clientY}},dragEnd:function(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("mousemove",this.drag),window.removeEventListener("mouseup",this.dragEnd),this.resize=!1,this.mousePosY=t.clientY},trackVerticalSplitterOffsetTop:function(){this.vsplitterOffset=this.$refs.vsplitter.offsetTop}},computed:{topOrBottomClass:function(){return this.vsplitterOffset-this.selfOffsetTop<=Math.floor(this.availHeight/2)?"top":"bottom"},topheightcss:function(){return this.topheight+"px"},bottomheightcss:function(){return this.bottomheight+"px"}}},A={name:"SearchbarResultTemplateAction",emits:["actionexecuted"],props:{res:Object,action:Object},computed:{actionHref(){return"link"!==this.action.type?"javascript:void(0);":"function"==typeof this.action.action?this.action.action(this.res):this.action.action}},methods:{actionFunc(){"function"===this.action.type&&this.action.action(this.res),this.$emit("actionexecuted")},renderif:function(){return void 0===this.action?.renderif||this.action.renderif(this.res)}},template:'\n\t<template v-if="this.renderif()">\n\t<a class="searchbar-result-template-action" :href="actionHref" @click="actionFunc">\n\t\t<slot>{{ $p.t(\'search/action_default_label\') }}</slot>\n\t</a>\n\t</template>\n\t<template v-else>\n\t<div class="searchbar-result-template-action">\n\t\t<slot>{{ $p.t(\'search/action_default_label\') }}</slot>\n\t</div>\n\t</template>'},x={name:"SearchbarResultTemplateFrame",components:{ResultAction:A,ResultActions:{name:"SearchbarResultTemplateActions",components:{ResultAction:A},emits:["actionexecuted"],props:{res:Object,actions:Array},methods:{renderif:function(t){return void 0===t?.renderif||t.renderif(this.res)}},template:'\n\t<div v-if="actions.length" class="searchbar-result-template-actions">\n\t\t<template v-for="(action, index) in actions" :key="action.label">\n\t\t<result-action\n\t\t\t v-if="this.renderif(action)"\n\t\t\t:res="res"\n\t\t\t:action="action"\n\t\t\tclass="btn btn-primary btn-sm"\n\t\t\t@actionexecuted="$emit(\'actionexecuted\')"\n\t\t\t>\n\t\t\t<i v-if="action.icon" :class="action.icon"></i>\n\t\t\t<span class="p-2">{{ action.label }}</span>\n\t\t</result-action>\n\t\t</template>\n\t</div>'}},emits:["actionexecuted"],props:{res:Object,actions:Object,title:String,image:String,imageFallback:String},template:'\n\t<div class="searchbar-result-template-frame">\n\t\t<div class="searchbar_grid">\n\t\t\t<div class="searchbar_icon">\n\t\t\t\t<result-action\n\t\t\t\t\t:res="res"\n\t\t\t\t\t:action="actions.defaultaction"\n\t\t\t\t\t@actionexecuted="$emit(\'actionexecuted\')"\n\t\t\t\t\tclass="searchbar-rounded-image"\n\t\t\t\t\t>\n\t\t\t\t\t<img\n\t\t\t\t\t\tv-if="image"\n\t\t\t\t\t\t:src="image"\n\t\t\t\t\t\t/>\n\t\t\t\t\t<div v-else>\n\t\t\t\t\t\t<i :class="imageFallback"></i>\n\t\t\t\t\t</div>\n\t\t\t\t</result-action>\n\t\t\t</div>\n\n\t\t\t<div class="searchbar_data">\n\t\t\t\t<result-action\n\t\t\t\t\t:res="res"\n\t\t\t\t\t:action="actions.defaultaction"\n\t\t\t\t\t@actionexecuted="$emit(\'actionexecuted\')"\n\t\t\t\t\tclass="mb-3"\n\t\t\t\t\t>\n\t\t\t\t\t<span class="fw-bold">{{ title }}</span>\n\t\t\t\t</result-action>\n\n\t\t\t\t<slot></slot>\n\n\t\t\t\t<result-actions\n\t\t\t\t\t:res="res"\n\t\t\t\t\t:actions="actions.childactions"\n\t\t\t\t\t@actionexecuted="$emit(\'actionexecuted\')"\n\t\t\t\t\t>\n\t\t\t\t</result-actions>\n\t\t\t</div>\n\t\t</div>\n\t</div>'},w={name:"SearchbarResultPerson",components:{TemplateFrame:x},emits:["actionexecuted"],props:{res:Object,actions:Object},computed:{emails(){return new Set(this.res.email)}},template:'\n\t<template-frame\n\t\tclass="searchbar-result-student"\n\t\t:res="res"\n\t\t:actions="actions"\n\t\t:title="res.name"\n\t\t:image="res.photo_url"\n\t\timage-fallback="fas fa-user fa-4x"\n\t\t@actionexecuted="$emit(\'actionexecuted\')"\n\t\t>\n\t\t<div class="searchbar_table">\n\t\t\t<div class="searchbar_tablerow">\n\t\t\t\t<div class="searchbar_tablecell searchbar_label">{{ $p.t(\'person/person_id\') }}</div>\n\t\t\t\t<div class="searchbar_tablecell searchbar_value">\n\t\t\t\t\t{{ res.person_id }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="searchbar_tablerow">\n\t\t\t\t<div class="searchbar_tablecell searchbar_label">{{ $p.t(\'search/result_emails\') }}</div>\n\t\t\t\t<div class="searchbar_tablecell searchbar_value">\n\t\t\t\t\t<a v-for="email in emails" :key="email" :href="\'mailto:\' + email" class="d-block">\n\t\t\t\t\t\t{{ email }}\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</template-frame>'},z={name:"SearchbarResultRoom",components:{TemplateFrame:x},emits:["actionexecuted"],props:{mode:String,res:Object,actions:Object},computed:{equipment(){return this.res.equipment?this.res.equipment.replace(new RegExp("<br />","ig"),""):""},address(){let t=this.res.zip||"";return this.res.city&&(t+=(t?" ":"")+this.res.city),this.res.street&&(t+=(t?", ":"")+this.res.street),this.res.floor&&(t+=(t?" / ":"")+this.$p.t("search/result_address_floor",this.res)),t||this.$p.t("search/result_address_none")}},template:'\n\t<template-frame\n\t\tclass="searchbar-result-room"\n\t\t:res="res"\n\t\t:actions="actions"\n\t\t:title="res.ort_kurzbz"\n\t\timage-fallback="fas fa-door-open fa-4x"\n\t\t@actionexecuted="$emit(\'actionexecuted\')"\n\t\t>\n\t\t<div class="searchbar_table">\n\t\t\t<div class="searchbar_tablerow">\n\t\t\t\t<div class="searchbar_tablecell searchbar_label">{{ $p.t(\'search/result_room_address\') }}</div>\n\t\t\t\t<div class="searchbar_tablecell searchbar_value">\n\t\t\t\t\t{{ address }}\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="searchbar_tablerow">\n\t\t\t\t<div class="searchbar_tablecell searchbar_label">{{ $p.t(\'search/result_workplaces\') }}</div>\n\t\t\t\t<div v-if="mode == \'simple\'" class="searchbar_tablecell searchbar_value">\n\t\t\t\t\t{{ res.sitzplaetze }}\n\t\t\t\t</div>\n\t\t\t\t<div v-else class="searchbar_tablecell searchbar_value">\n\t\t\t\t\t<template v-if="res.max_person !== null && res.workplaces !== null">\n\t\t\t\t\t\t{{ $p.t(\'search/result_workplaces_pc\', res) }}\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t{{ $p.t(\'search/result_workplaces_none\') }}\n\t\t\t\t\t</template>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="searchbar_tablerow">\n\t\t\t\t<div class="searchbar_tablecell searchbar_label">{{ $p.t(\'search/result_building\') }}</div>\n\t\t\t\t<div class="searchbar_tablecell searchbar_value">\n\t\t\t\t\t{{ res.building }}\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="searchbar_tablerow">\n\t\t\t\t<div class="searchbar_tablecell searchbar_label">{{ $p.t(\'search/result_equipment\') }}</div>\n\t\t\t\t<div class="searchbar_tablecell searchbar_value">\n\t\t\t\t\t<div v-if="mode == \'simple\'" class="no-margin-paragraphs" v-html="res.austattung.replace(\'<br />\',\'\')"></div>\n\t\t\t\t\t<div v-else class="no-margin-paragraphs" v-html="equipment"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</template-frame>'},S={name:"SearchbarResultEmployee",components:{TemplateFrame:x},emits:["actionexecuted"],props:{res:Object,actions:Object},template:'\n\t<template-frame\n\t\tclass="searchbar-result-student"\n\t\t:res="res"\n\t\t:actions="actions"\n\t\t:title="res.name"\n\t\t:image="res.photo_url"\n\t\timage-fallback="fas fa-user fa-4x"\n\t\t@actionexecuted="$emit(\'actionexecuted\')"\n\t\t>\n\t\t<div class="searchbar_table">\n\t\t\t<div class="searchbar_tablerow">\n\t\t\t\t<div class="searchbar_tablecell searchbar_label">{{ $p.t(\'search/result_stdkst\') }}</div>\n\t\t\t\t<div class="searchbar_tablecell searchbar_value">\n\t\t\t\t\t<ul class="searchbar_inline_ul" v-if="res.standardkostenstelle.length > 0">\n\t\t\t\t\t\t<li v-for="(stdkst, idx) in res.standardkostenstelle" :key="idx">{{ stdkst }}</li>\n\t\t\t\t\t</ul>\n\t\t\t\t\t<span v-else="">{{ $p.t(\'search/result_stdkst_none\') }}</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="searchbar_tablerow">\n\t\t\t\t<div class="searchbar_tablecell searchbar_label">{{ $p.t(\'lehre/organisationseinheit\') }}</div>\n\t\t\t\t<div class="searchbar_tablecell searchbar_value">\n\t\t\t\t\t<ul class="searchbar_inline_ul" v-if="res.organisationunit_name.length > 0">\n\t\t\t\t\t\t<li v-for="(oe, idx) in res.organisationunit_name" :key="idx">{{ oe }}</li>\n\t\t\t\t\t</ul>\n\t\t\t\t\t<span v-else="">{{ $p.t(\'search/result_oe_none\') }}</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="searchbar_tablerow">\n\t\t\t\t<div class="searchbar_tablecell searchbar_label">{{ $p.t(\'search/result_emails\') }}</div>\n\t\t\t\t<div class="searchbar_tablecell searchbar_value">\n\t\t\t\t\t<a :href="\'mailto:\' + res.email" class="d-block">\n\t\t\t\t\t\t{{ res.email }}\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="searchbar_tablerow">\n\t\t\t\t<div class="searchbar_tablecell searchbar_label">{{ $p.t(\'person/telefon\') }}</div>\n\t\t\t\t<div class="searchbar_tablecell searchbar_value">\n\t\t\t\t\t<a :href="\'tel:\' + res.phone" class="d-block">\n\t\t\t\t\t\t{{ res.phone }}\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</template-frame>'},C={name:"SearchbarResultOrganistationunit",components:{TemplateFrame:x},emits:["actionexecuted"],props:{res:Object,actions:Object},template:'\n\t<template-frame\n\t\tclass="searchbar-result-organisationunit"\n\t\t:res="res"\n\t\t:actions="actions"\n\t\t:title="res.name"\n\t\timage-fallback="fas fa-sitemap fa-4x"\n\t\t@actionexecuted="$emit(\'actionexecuted\')"\n\t\t>\n\t\t<div class="searchbar_table">\n\t\t\t<div class="searchbar_tablerow">\n\t\t\t\t<div class="searchbar_tablecell searchbar_label">{{ $p.t(\'search/result_parent_oe\') }}</div>\n\t\t\t\t<div class="searchbar_tablecell searchbar_value">\n\t\t\t\t\t{{ res.parentoe_name }}\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="searchbar_tablerow">\n\t\t\t\t<div class="searchbar_tablecell searchbar_label">{{ $p.t(\'search/result_group_emails\') }}</div>\n\t\t\t\t<div class="searchbar_tablecell searchbar_value">\n\t\t\t\t\t<a v-if="res.mailgroup" :href="\'mailto:\' + res.mailgroup">\n\t\t\t\t\t\t{{ res.mailgroup }}\n\t\t\t\t\t</a>\n\t\t\t\t\t<template v-else>-</template>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="searchbar_tablerow">\n\t\t\t\t<div class="searchbar_tablecell searchbar_label">{{ $p.t(\'search/result_leader\') }}</div>\n\t\t\t\t<div class="searchbar_tablecell searchbar_value">\n\t\t\t\t\t<ul class="searchbar_inline_ul" v-if="res.leaders.length > 0">\n\t\t\t\t\t\t<li v-for="(leader, idx) in res.leaders" :key="idx">{{ leader.name }}</li>\n\t\t\t\t\t</ul>\n\t\t\t\t\t<span v-else="">{{ $p.t(\'search/result_leader_none\') }}</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="searchbar_tablerow">\n\t\t\t\t<div class="searchbar_tablecell searchbar_label">{{ $p.t(\'search/result_number_of_employees\') }}</div>\n\t\t\t\t<div class="searchbar_tablecell searchbar_value">\n\t\t\t\t\t{{ res.number_of_people }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</template-frame>'},D={name:"SearchbarResultStudent",components:{TemplateFrame:x},emits:["actionexecuted"],props:{mode:String,res:Object,actions:Object},computed:{photo_url(){return"simple"!=this.mode?this.res.photo_url:this.res.foto?"data:image/jpeg;base64,"+this.res.foto:null},emails(){return"simple"==this.mode?new Set([this.res.email]):new Set(this.res.email)}},template:'\n\t<template-frame\n\t\tclass="searchbar-result-student"\n\t\t:res="res"\n\t\t:actions="actions"\n\t\t:title="res.name"\n\t\t:image="photo_url"\n\t\timage-fallback="fas fa-user fa-4x"\n\t\t@actionexecuted="$emit(\'actionexecuted\')"\n\t\t>\n\t\t<div class="searchbar_table">\n\t\t\t<div class="searchbar_tablerow">\n\t\t\t\t<div class="searchbar_tablecell searchbar_label">{{ $p.t(\'search/result_student_uid\') }}</div>\n\t\t\t\t<div class="searchbar_tablecell searchbar_value">\n\t\t\t\t\t{{ res.uid }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="searchbar_tablerow">\n\t\t\t\t<div class="searchbar_tablecell searchbar_label">{{ $p.t(\'person/person_id\') }}</div>\n\t\t\t\t<div class="searchbar_tablecell searchbar_value">\n\t\t\t\t\t{{ res.person_id }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="searchbar_tablerow">\n\t\t\t\t<div class="searchbar_tablecell searchbar_label">{{ $p.t(\'person/matrikelnummer\') }}</div>\n\t\t\t\t<div class="searchbar_tablecell searchbar_value">\n\t\t\t\t\t{{ res.matrikelnr }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="searchbar_tablerow">\n\t\t\t\t<div class="searchbar_tablecell searchbar_label">{{ $p.t(\'search/result_emails\') }}</div>\n\t\t\t\t<div class="searchbar_tablecell searchbar_value">\n\t\t\t\t\t<a v-for="email in emails" :key="email" :href="\'mailto:\' + email" class="d-block">\n\t\t\t\t\t\t{{ email }}\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</template-frame>'},F={name:"SearchbarResultPrestudent",components:{TemplateFrame:x},emits:["actionexecuted"],props:{mode:String,res:Object,actions:Object},computed:{title(){return"simple"==this.mode?this.res.name:this.res.name+" ("+this.res.status+" "+this.res.stg_kuerzel+")"},photo_url(){return"simple"!=this.mode?this.res.photo_url:this.res.foto?"data:image/jpeg;base64,"+this.res.foto:null},emails(){return"simple"==this.mode?new Set([this.res.email]):new Set(this.res.email)}},template:'\n\t<template-frame\n\t\tclass="searchbar-result-prestudent"\n\t\t:res="res"\n\t\t:actions="actions"\n\t\t:title="title"\n\t\t:image="photo_url"\n\t\timage-fallback="fas fa-user fa-4x"\n\t\t@actionexecuted="$emit(\'actionexecuted\')"\n\t\t>\n\t\t<div class="searchbar_table">\n\t\t\t<div class="searchbar_tablerow">\n\t\t\t\t<div class="searchbar_tablecell searchbar_label">{{ $p.t(\'person/person_id\') }}</div>\n\t\t\t\t<div class="searchbar_tablecell searchbar_value">\n\t\t\t\t\t{{ res.person_id }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="searchbar_tablerow">\n\t\t\t\t<div class="searchbar_tablecell searchbar_label">{{ $p.t(\'search/result_emails\') }}</div>\n\t\t\t\t<div class="searchbar_tablecell searchbar_value">\n\t\t\t\t\t<a v-for="email in emails" :key="email" :href="\'mailto:\' + email" class="d-block">\n\t\t\t\t\t\t{{ email }}\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div v-if="res.uid" class="searchbar_tablerow">\n\t\t\t\t<div class="searchbar_tablecell searchbar_label">{{ $p.t(\'search/result_student_uid\') }}</div>\n\t\t\t\t<div class="searchbar_tablecell searchbar_value">\n\t\t\t\t\t{{ res.uid }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div v-if="res.matrikelnr" class="searchbar_tablerow">\n\t\t\t\t<div class="searchbar_tablecell searchbar_label">{{ $p.t(\'person/matrikelnummer\') }}</div>\n\t\t\t\t<div class="searchbar_tablecell searchbar_value">\n\t\t\t\t\t{{ res.matrikelnr }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="searchbar_tablerow">\n\t\t\t\t<div class="searchbar_tablecell searchbar_label">{{ $p.t(\'search/result_prestudent_id\') }}</div>\n\t\t\t\t<div class="searchbar_tablecell searchbar_value">\n\t\t\t\t\t{{ res.prestudent_id }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="searchbar_tablerow">\n\t\t\t\t<div class="searchbar_tablecell searchbar_label">{{ $p.t(\'lehre/studiengang\') }}</div>\n\t\t\t\t<div class="searchbar_tablecell searchbar_value">\n\t\t\t\t\t{{ res.bezeichnung }} {{ res.orgform ? \'(\' + res.orgform + \')\' : \'\' }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</template-frame>'},V={name:"SearchbarResultDms",components:{TemplateFrame:x},emits:["actionexecuted"],props:{res:Object,actions:Object},computed:{icon(){switch(this.res.mimetype){case"application/pdf":return"file-pdf";case"application/vnd.openxmlformats-officedocument.wordprocessingml.document":case"application/msword":return"file-word";case"application/vnd.openxmlformats-officedocument.presentationml.presentation":case"application/mspowerpoint":return"file-powerpoint";case"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":case"application/vnd.ms-excel":return"file-excel";case"application/x-zip":case"application/zip":return"file-zipper";case"image/jpeg":case"image/gif":case"image/png":return"file-image";default:return"file"}}},template:'\n\t<template-frame\n\t\tclass="searchbar-result-dms"\n\t\t:res="res"\n\t\t:actions="actions"\n\t\t:title="res.name"\n\t\t:image-fallback="\'fas fa-\' + icon + \' fa-4x\'"\n\t\t@actionexecuted="$emit(\'actionexecuted\')"\n\t\t>\n\t\t<div class="searchbar_table">\n\t\t\t<div class="searchbar_tablerow">\n\t\t\t\t<div class="searchbar_tablecell searchbar_label">{{ $p.t(\'search/result_dms_id\') }}</div>\n\t\t\t\t<div class="searchbar_tablecell searchbar_value">\n\t\t\t\t\t{{ res.dms_id }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="searchbar_tablerow">\n\t\t\t\t<div class="searchbar_tablecell searchbar_label">{{ $p.t(\'search/result_version\') }}</div>\n\t\t\t\t<div class="searchbar_tablecell searchbar_value">\n\t\t\t\t\t{{ res.version }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="searchbar_tablerow">\n\t\t\t\t<div class="searchbar_tablecell searchbar_label">{{ $p.t(\'search/result_keywords\') }}</div>\n\t\t\t\t<div class="searchbar_tablecell searchbar_value">\n\t\t\t\t\t{{ res.keywords }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="searchbar_tablerow">\n\t\t\t\t<div class="searchbar_tablecell searchbar_label">{{ $p.t(\'global/beschreibung\') }}</div>\n\t\t\t\t<div class="searchbar_tablecell searchbar_value">\n\t\t\t\t\t{{ res.description }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</template-frame>'},P={name:"SearchbarResultCms",components:{TemplateFrame:x},emits:["actionexecuted"],props:{res:Object,actions:Object},inject:["query"],computed:{preview(){if("redirect"!=this.res.template_kurzbz){let t=this.res.content.replace(/<!\[CDATA\[|\]\]>/gi,"").replace(/<[^>]+>/gi,"").replace(/^\s+|\s+$/g,"");if(t.length>1e3){let e=t.toLowerCase(),n=Math.min(this.query.split(" ").reduce((t,n)=>{if("or"==n)return t;let a=n.indexOf(":");if(a<0||a>0&&["content","inhalt"].includes(n.split(":")[0])){let a=e.indexOf(n);a>=0&&t.push(a)}return t},[]));if(n){if(!(n+997>=t.length))return"..."+t.substr(n,994)+"...";if(n=t.length-997,n>0)return"..."+t.substr(n,997)}t=t.substr(0,997)+"..."}return t}let t=this.res.content_url;return"../index.ci.php/"==t.substr(0,16)?t=this.$fhcApi.getUri(t.substr(16)):"../"==t.substr(0,3)&&(t=FHC_JS_DATA_STORAGE_OBJECT.app_root.replace(/\/+$/,"")+t.substr(2)),'<a href="'+t+'">'+t+"</a>"}},template:'\n\t<template-frame\n\t\tclass="searchbar-result-cms"\n\t\t:res="res"\n\t\t:actions="actions"\n\t\t:title="res.title"\n\t\timage-fallback="fas fa-newspaper fa-4x"\n\t\t@actionexecuted="$emit(\'actionexecuted\')"\n\t\t>\n\t\t<div v-if="preview" class="searchbar_table" v-html="preview"></div>\n\t\t<div v-else class="searchbar_table text-muted">\n\t\t\t{{ $p.t(\'search/result_content_none\') }}\n\t\t</div>\n\t</template-frame>'},E={name:"SearchbarResultMergedstudent",components:{ResultPrestudent:F,ResultStudent:D},emits:["actionexecuted"],props:{mode:String,res:Object,actions:Object},computed:{prestudent(){return this.res.list.filter(t=>"prestudent"==t.type).pop()}},template:'\n\t<result-prestudent\n\t\tv-if="prestudent"\n\t\t:mode="mode"\n\t\t:res="prestudent"\n\t\t:actions="actions"\n\t\t@actionexecuted="$emit(\'actionexecuted\')"\n\t\tclass="searchbar-result-mergedstudent"\n\t></result-prestudent>\n\t<result-student\n\t\tv-else\n\t\t:mode="mode"\n\t\t:res="res.list[0]"\n\t\t:actions="actions"\n\t\t@actionexecuted="$emit(\'actionexecuted\')"\n\t\tclass="searchbar-result-mergedstudent"\n\t></result-student>'},T={name:"SearchbarResultMergedperson",components:{TemplateFrame:x,TemplateAction:A},emits:["actionexecuted"],props:{mode:String,res:Object,actions:Object},computed:{person(){const t=this.res.list.reduce((t,e)=>[...t,...Array.isArray(e.email)?e.email:[e.email]],[]),e=this.res.list.find(t=>"person"==t.type);if(e)return{...e,email:t};const{person_id:n,name:a}=this.res.list[0];let r;if("simple"==this.mode){let t=(this.students?this.students.find(t=>t.foto):null)?.foto;t&&(t="data:image/jpeg;base64,"+t),r=t||this.employee?.photo_url}else r=((this.students?this.students.find(t=>t.photo_url):null)||this.employee)?.photo_url;return{person_id:n,name:a,photo_url:r,email:t}},employee(){return this.res.list.find(t=>["employee","unassigned_employee","mitarbeiter","mitarbeiter_ohne_zuordnung"].includes(t.type))||null},students(){const t=this.res.list.filter(t=>["student","prestudent","studentcis","studentStv"].includes(t.type)).filter((t,e,n)=>{if("prestudent"===t.type)return!0;return!n.some(e=>e.uid===t.uid&&"prestudent"===e.type)}).sort((t,e)=>(t.sort||0)-(e.sort||0));return t.length?t:null},emails(){return new Set(this.person.email)},telurl(){return"tel:"+this.employee?.phone},inaktiv(){return this.res.list.some(t=>!1===t?.aktiv)}},template:'\n\t<template-frame\n\t\tclass="searchbar-result-mergedperson"\n\t\t:class="(inaktiv) ? \'searchbar_inaktiv\' : \'\'"\n\t\t:res="person"\n\t\t:actions="actions"\n\t\t:title="person.name"\n\t\t:image="person.photo_url"\n\t\timage-fallback="fas fa-user fa-4x"\n\t\t@actionexecuted="$emit(\'actionexecuted\')"\n\t\t>\n\t\t<div class="searchbar_table">\n\t\t\t<div class="searchbar_tablerow">\n\t\t\t\t<div class="searchbar_tablecell searchbar_label">{{ $p.t(\'person/person_id\') }}</div>\n\t\t\t\t<div class="searchbar_tablecell searchbar_value">\n\t\t\t\t\t{{ person.person_id }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="searchbar_tablerow">\n\t\t\t\t<div class="searchbar_tablecell searchbar_label">{{ $p.t(\'search/result_emails\') }}</div>\n\t\t\t\t<div class="searchbar_tablecell searchbar_value">\n\t\t\t\t\t<a v-for="email in emails" :key="email" :href="\'mailto:\' + email" class="d-block">\n\t\t\t\t\t\t{{ email }}\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<template v-if="employee">\n\t\t\t\t<div class="searchbar_tablerow">\n\t\t\t\t\t<div class="searchbar_tablecell">\n\t\t\t\t\t\t<template-action\n\t\t\t\t\t\t\t:res="employee"\n\t\t\t\t\t\t\t:action="actions.defaultactionemployee || actions.defaultaction"\n\t\t\t\t\t\t\t@actionexecuted="$emit(\'actionexecuted\')"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{ $p.t(\'search/result_employee\') }}\n\t\t\t\t\t\t</template-action>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="searchbar_tablerow">\n\t\t\t\t\t<div class="searchbar_tablecell searchbar_label ps-3">{{ $p.t(\'search/result_stdkst\') }}</div>\n\t\t\t\t\t<div class="searchbar_tablecell searchbar_value">\n\t\t\t\t\t\t<ul class="searchbar_inline_ul" v-if="employee.standardkostenstelle.length > 0">\n\t\t\t\t\t\t\t<li\n\t\t\t\t\t\t\t\tv-for="(stdkst, idx) in employee.standardkostenstelle"\n\t\t\t\t\t\t\t\t:key="idx"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{{ stdkst }}\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t<span v-else="">{{ $p.t(\'search/result_stdkst_none\') }}</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="searchbar_tablerow">\n\t\t\t\t\t<div class="searchbar_tablecell searchbar_label ps-3">{{ $p.t(\'lehre/organisationseinheit\') }}</div>\n\t\t\t\t\t<div class="searchbar_tablecell searchbar_value">\n\t\t\t\t\t\t<ul class="searchbar_inline_ul" v-if="employee.organisationunit_name.length > 0">\n\t\t\t\t\t\t\t<li\n\t\t\t\t\t\t\t\tv-for="(oe, idx) in employee.organisationunit_name"\n\t\t\t\t\t\t\t\t:key="idx"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{{ oe }}\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t<span v-else="">{{ $p.t(\'search/result_oe_none\') }}</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="searchbar_tablerow">\n\t\t\t\t\t<div class="searchbar_tablecell searchbar_label ps-3">{{ $p.t(\'person/telefon\') }}</div>\n\t\t\t\t\t<div class="searchbar_tablecell searchbar_value">\n\t\t\t\t\t\t<a :href="telurl">\n\t\t\t\t\t\t\t{{ employee.phone }}\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\n\t\t\t<template v-if="students">\n\t\t\t\t<template v-for="student in students">\n\t\t\t\t\t<div class="searchbar_tablerow">\n\t\t\t\t\t\t<div class="searchbar_tablecell">\n\t\t\t\t\t\t\t<template-action\n\t\t\t\t\t\t\t\tv-if="actions.defaultaction"\n\t\t\t\t\t\t\t\t:res="student"\n\t\t\t\t\t\t\t\t:action="actions.defaultactionstudent || actions.defaultaction"\n\t\t\t\t\t\t\t\t@actionexecuted="$emit(\'actionexecuted\')"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<template v-if="mode == \'simple\'">\n\t\t\t\t\t\t\t\t\t{{ student.studiengang_kz }}\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t<template v-else-if="student.status && student.stg_kuerzel">\n\t\t\t\t\t\t\t\t\t{{ student.status }} ({{ student.stg_kuerzel }})\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t\t{{ $p.t(\'person/student\') }}\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t</template-action>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-if="student.bezeichnung" class="searchbar_tablerow">\n\t\t\t\t\t\t<div class="searchbar_tablecell searchbar_label ps-3">{{ $p.t(\'lehre/studiengang\') }}</div>\n\t\t\t\t\t\t<div class="searchbar_tablecell searchbar_value">\n\t\t\t\t\t\t\t{{ student.bezeichnung }} {{ student.orgform ? \'(\' + student.orgform + \')\' : \'\' }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-if="student.prestudent_id" class="searchbar_tablerow">\n\t\t\t\t\t\t<div class="searchbar_tablecell searchbar_label ps-3">{{ $p.t(\'search/result_prestudent_id\') }}</div>\n\t\t\t\t\t\t<div class="searchbar_tablecell searchbar_value">\n\t\t\t\t\t\t\t{{ student.prestudent_id }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-if="student.uid" class="searchbar_tablerow">\n\t\t\t\t\t\t<div class="searchbar_tablecell searchbar_label ps-3">{{ $p.t(\'search/result_student_uid\') }}</div>\n\t\t\t\t\t\t<div class="searchbar_tablecell searchbar_value">\n\t\t\t\t\t\t\t{{ student.uid }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-if="student.matrikelnr" class="searchbar_tablerow">\n\t\t\t\t\t\t<div class="searchbar_tablecell searchbar_label ps-3">{{ $p.t(\'person/matrikelnummer\') }}</div>\n\t\t\t\t\t\t<div class="searchbar_tablecell searchbar_value">\n\t\t\t\t\t\t\t{{ student.matrikelnr }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</template>\n\t\t</div>\n\t</template-frame>'},$={name:"FhcSearchbar",components:{person:w,room:z,employee:S,organisationunit:C,student:D,prestudent:F,dms:V,cms:P,mergedStudent:E,mergedPerson:T},props:["searchoptions","searchfunction"],provide(){return{query:Vue.computed(()=>this.lastQuery)}},data:function(){return{searchtimer:null,hidetimer:null,searchsettings:{searchstr:this.getSearchStr(),types:this.getInitiallySelectedTypes()},searchresult:[],searchmode:"",showresult:!1,searching:!1,error:null,abortController:null,settingsDropdown:null,lastQuery:""}},computed:{searchTypesPlaceholder(){return this.searchsettings.types.length?this.searchsettings.types.map(t=>this.typeLabels[t]).join(" / "):Object.values(this.typeLabels).join(" / ")},types(){return this.searchoptions.types?Array.isArray(this.searchoptions.types)?this.searchoptions.types:Object.keys(this.searchoptions.types):[]},typeLabels(){return this.searchoptions.types?Array.isArray(this.searchoptions.types)?this.searchoptions.types.reduce((t,e)=>(t[e]=e,t),{}):this.searchoptions.types:{}}},template:'\n\t\t<form\n\t\t\tref="searchform"\n\t\t\tclass="d-flex me-3"\n\t\t\t:class="searchoptions.cssclass"\n\t\t\taction="javascript:void(0);"\n\t\t\t@focusin="searchfocusin"\n\t\t\t@focusout="searchfocusout"\n\t\t>\n\t\t\t<div\n\t\t\t\tref="searchbox"\n\t\t\t\tclass="h-100 input-group me-2 searchbar_searchbox"\n\t\t\t\t:class="showresult ? \'open\' : \'closed\'"\n\t\t\t>\n\t\t\t\t<span class="input-group-text">\n\t\t\t\t\t<i class="fa-solid fa-magnifying-glass"></i>\n\t\t\t\t</span>\n                <input\n                \tref="input"\n                    @keyup="search"\n                    @focus="showsearchresult"\n                    v-model="searchsettings.searchstr"\n                    class="form-control searchbar_input"\n                    type="search"\n                    :placeholder="$p.t(\'search/input_search_label\', { types: searchTypesPlaceholder })"\n                    :aria-label="$p.t(\'search/input_search_label\', { types: searchTypesPlaceholder })"\n                >\n\t\t\t\t<button\n\t\t\t\t\tv-if="searchsettings.searchstr"\n\t\t\t\t\tclass="searchbar_input_clear btn btn-outline-secondary"\n\t\t\t\t\t@click="clearInput"\n\t\t\t\t>\n\t\t\t\t\t<i class="fas fa-close"></i>\n\t\t\t\t</button>\n                <button\n                    data-bs-toggle="collapse"\n                    data-bs-target="#searchSettings"\n                    aria-expanded="false"\n                    aria-controls="searchSettings"\n                    ref="settingsbutton"\n                    class="searchbar_setting_btn btn btn-secondary"\n                    type="button"\n                    :title="$p.t(\'search/button_filter_label\')"\n                    :aria-label="$p.t(\'search/button_filter_label\')"\n                >\n                    <i class="fas fa-cog"></i>\n                </button>\n            </div>\n\n            <div v-show="showresult"\n                 class="searchbar_results" tabindex="-1">\n              <div class="searchbar_results_scroller" ref="result">\n                <div class="searchbar_results_wrapper" ref="results">\n                  <div v-if="searching">\n                    <i class="fas fa-spinner fa-spin fa-2x"></i>\n                  </div>\n                  <div v-else-if="this.error !== null">{{ error }}</div>\n                  <div v-else-if="searchresult.length < 1">{{  $p.t(\'search/error_no_results\') }}</div>\n                  <template v-else v-for="res in searchresult">\n                    <component\n                        v-if="isValidRenderer(res.renderer)"\n                        :is="res.renderer"\n                        :mode="searchmode"\n                        :res="res"\n                        :actions="getActions(res)"\n                        @actionexecuted="hideresult"\n                    ></component>\n                    <div v-else class="searchbar-result text-danger fw-bold">{{ $p.t(\'search/error_unknown_type\', res) }}</div>\n                  </template>\n                </div>\n              </div>\n            </div>\n\n\t\t\t<div\n\t\t\t\tid="searchSettings"\n\t\t\t\tref="settings"\n\t\t\t\t@[`shown.bs.collapse`]="handleShowSettings"\n\t\t\t\t@[`hide.bs.collapse`]="handleHideSettings"\n\t\t\t\tclass="top-100 end-0 searchbar_settings text-white collapse"\n\t\t\t\ttabindex="-1"\n\t\t\t>\n\t\t\t\t<div\n\t\t\t\t\tv-if="types.length > 0"\n\t\t\t\t\tclass="d-flex flex-column m-3"\n\t\t\t\t>\n\t\t\t\t\t<span class="fw-light mb-2">\n\t\t\t\t\t\t{{ $p.t(\'search/applyfilter_label\') }}\n\t\t\t\t\t</span>\n\t\t\t\t\t<template\n\t\t\t\t\t\tv-for="(label, value) in typeLabels"\n\t\t\t\t\t\t:key="value"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class="form-check form-switch">\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\tclass="fhc-switches form-check-input"\n\t\t\t\t\t\t\t\ttype="checkbox"\n\t\t\t\t\t\t\t\trole="switch"\n\t\t\t\t\t\t\t\t:id="$.uid + \'search_type_\' + value"\n\t\t\t\t\t\t\t\t:value="value"\n\t\t\t\t\t\t\t\tv-model="searchsettings.types"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<label\n\t\t\t\t\t\t\t\tclass="ps-2 form-check-label non-selectable"\n\t\t\t\t\t\t\t\t:for="$.uid + \'search_type_\' + value"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{{ label }}\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\t\t\t\t</div>\n            </div>\n\t\t</form>\n    ',watch:{"searchsettings.searchstr":function(t){this.searchoptions.origin&&sessionStorage.setItem(`${this.searchoptions.origin}_searchstr`,t)},"searchsettings.types"(t){Array.isArray(t)&&0===t.length&&(this.searchsettings.types=[...this.types]),Array.isArray(t)&&this.searchoptions.origin&&localStorage.setItem(`${this.searchoptions.origin}_searchtypes`,JSON.stringify(t)),this.search()}},mounted(){this.settingsDropdown=new bootstrap.Collapse(this.$refs.settings,{toggle:!1}),this.searchoptions.origin||console.warn("No origin defined in the searchoptions for the searchbar, please define the origin property in the searchbaroptions to allow reliable storage of searchstr and searchtypes accross applications.")},updated(){this.showresult&&Vue.nextTick(()=>{this.calcSearchResultHeight()})},methods:{clearInput(){this.searchsettings.searchstr="",this.hideresult(),this.$refs.input.focus()},getInitiallySelectedTypes(){let t=!1;if(this.searchoptions.origin){let e=localStorage.getItem(`${this.searchoptions.origin}_searchtypes`);e&&(t=JSON.parse(e))}return t||(this.searchoptions.types?Array.isArray(this.searchoptions.types)?[...this.searchoptions.types]:Object.keys(this.searchoptions.types):[])},getSearchStr:function(){return this.searchoptions.origin?sessionStorage.getItem(`${this.searchoptions.origin}_searchstr`)??"":""},checkSettingsVisibility:function(t){this.$refs.settings.contains(t.target)||this.settingsDropdown.hide()},handleShowSettings:function(){document.addEventListener("click",this.checkSettingsVisibility)},handleHideSettings:function(){document.removeEventListener("click",this.checkSettingsVisibility)},calcSearchResultHeight:function(){const t=this.$refs.results.getBoundingClientRect();t.height>0&&t.height<.8*window.innerHeight?this.$refs.result.style.height=Math.ceil(t.height+16)+"px":this.$refs.result.style.height=Math.floor(.8*window.innerHeight)+"px"},calcSearchResultExtent:function(){if(this.showresult){if(void 0===this.searchoptions?.calcheightonly||!1===this.searchoptions.calcheightonly){var t=this.$refs.searchbox.getBoundingClientRect();this.$refs.result.style.top=Math.floor(t.bottom+3)+"px",this.$refs.result.style.right=Math.floor(t.right)+"px",this.$refs.result.style.width=Math.floor(t.width)+"px"}this.calcSearchResultHeight()}},search:function(){null!==this.searchtimer&&clearTimeout(this.searchtimer),this.abortController&&(this.abortController.abort(),this.abortController=null),this.searchsettings.searchstr.length>=2?(this.calcSearchResultExtent(),this.searchtimer=setTimeout(this.callsearchapi,500)):this.showresult=!1},callsearchapi:function(){if(this.error=null,this.searchresult.splice(0,this.searchresult.length),this.searching=!0,this.showsearchresult(),0===this.searchsettings.types.length)return this.error=this.$p.t("search/error_missing_type"),void(this.searching=!1);this.abortController&&this.abortController.abort(),this.abortController=new AbortController,this.searchfunction(this.searchsettings,{timeout:5e4,signal:this.abortController.signal}).then(t=>{if(t.data){let e=t.data.map(t=>t.data?{...t,...JSON.parse(t.data)}:t);if(this.lastQuery=t.meta.searchstring,this.searchoptions.mergeResults){let t=0,n=[],a="merged-",r="";switch(this.searchoptions.mergeResults){case"student":n=["student","prestudent"],a+=this.searchoptions.mergeResults,r="uid";break;case"person":n=["person","employee","student","prestudent"],a+=this.searchoptions.mergeResults,r="person_id"}n.length&&(e=Object.values(e.reduce((e,s)=>(n.includes(s.renderer)?null===s[r]?e["nomerge"+t++]=s:void 0===e[s[r]]?e[s[r]]={rank:s.rank,renderer:a,type:a,list:[s]}:(e[s[r]].list.push(s),s.rank>e[s[r]].rank&&(e[s[r]].rank=s.rank)):e["nomerge"+t++]=s,e),{})).sort((t,e)=>e.rank-t.rank))}this.searchresult=e,this.searchmode=t.meta.mode}else this.error=this.$p.t("search/error_general");this.searching=!1,this.retry=0}).catch(t=>"ERR_CANCELED"==t.code?this.retry=0:"ECONNABORTED"==t.code&&this.retry?(this.retry--,this.callsearchapi()):(this.error=this.$p.t("search/error_general",t),this.searching=!1,void(this.retry=0)))},refreshsearch:function(){this.search(),this.togglesettings()},hideresult:function(){this.showresult=!1,window.removeEventListener("resize",this.calcSearchResultExtent)},showsearchresult:function(){this.searchsettings.searchstr.length>=2&&(this.showresult=!0,window.addEventListener("resize",this.calcSearchResultExtent),this.calcSearchResultExtent())},searchfocusin:function(t){t.preventDefault(),t.stopPropagation(),null!==this.hidetimer&&clearTimeout(this.hidetimer),this.searchsettings.searchstr.length>=2&&0===this.searchresult.length&&this.search()},searchfocusout:function(t){t.preventDefault(),t.stopPropagation(),this.hidetimer=setTimeout(this.hideresult,100)},dash2camelCase:t=>t.replace(/-([a-z])/g,t=>t[1].toUpperCase()),isValidRenderer(t){const e=this.dash2camelCase(t);return Object.keys(this.$.components).includes(e)},getActions(t){let e=this.searchoptions.actions[this.dash2camelCase(t.renderer)];return e||this.searchoptions.actions[t.type]}}},B={search:t=>({method:"post",url:"/api/frontend/v1/searchbar/search",params:t}),searchCis:t=>({method:"post",url:"/api/frontend/v1/searchbar/searchCis",params:t}),searchStv:t=>({method:"post",url:"/api/frontend/v1/searchbar/searchStv",params:t})};const O={},M={};function H(t,e){return t.filter(t=>t.category==e).reduce((t,e)=>(t[e.phrase]||(t[e.phrase]=e.text),t),{})}function I(t){for(;M[t].length;){var e=M[t].pop();e[0].value=R(t,e[1],e[2]),Vue.triggerRef(e[0])}}function R(t,e,n){let a=O[t][e];return a?(n&&(a=a.replace(/\{([^}]*)\}/g,(t,e)=>void 0===n[e]?t:n[e])),a):"<< PHRASE "+e+">>"}const L={t_ref(t,e,n){if(void 0===n&&(Array.isArray(t)&&2==t.length||t.split&&2==t.split("/").length)&&(n=e,[t,e]=t.split?t.split("/"):t),void 0===e)return console.error("invalid input"),"";if(!O[t]){var a="";if(void 0!==window.FHC_JS_PHRASES_STORAGE_OBJECT){var r=H(FHC_JS_PHRASES_STORAGE_OBJECT,t);void 0!==r[e]&&(a=r[e])}if(!O[t]||0===Object.keys(O[t]).length){O[t]=void 0;let r=Vue.ref(a);return function(t,e,n,a){if(M[t])return M[t].push([e,n,a]),void(O[t]&&I(t));M[t]=[[e,n,a]],axios.get(FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+"/components/Phrasen/loadModule/"+t).then(e=>{e.data.retval?O[t]=H(e.data.retval,t):O[t]={},I(t)}).catch(t=>console.error(t))}(t,r,e,n),r}}var s=R(t,e,n);return Vue.ref(s)},t(t,e,n){return Vue.unref(this.t_ref(t,e,n))}};var j={data:()=>({p:L})};function J(){return{t:function(t,e,n){return L.t(t,e,n)}}}const G="error",N="retval",U={get:function(t,e,n=null){return U._axiosCall(t,e,"get",n)},post:function(t,e,n=null){return U._axiosCall(t,e,"post",n)},isSuccess:function(t){return!("object"!=typeof t||!t.hasOwnProperty(G)||!t.hasOwnProperty(N)||0!=t.error)},isError:function(t){return!U.isSuccess(t)},hasData:function(t){return!(!U.isSuccess(t)||!("object"==typeof t[N]&&Object.keys(t[N]).length>0||"array"==typeof t[N]&&t[N].length>0||"string"==typeof t[N]&&""!=t[N].trim()||"number"==typeof t[N]))},getData:function(t){return U.hasData(t)?t[N]:null},getError:function(t){return"object"==typeof t&&Object.keys(t).length>0&&t.hasOwnProperty(N)?t[N]:"Generic error"},getErrorCode:function(t){return"object"==typeof t&&t.hasOwnProperty(G)?t[G]:1},_generateRouterURI:function(t){var e=null;return"undefined"!=typeof FHC_JS_DATA_STORAGE_OBJECT&&(e=FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+"/"+t),e},_printDebug:function(t,e,n){},_axiosCall:function(t,e,n,a){let r={method:n,url:U._generateRouterURI(t),timeout:5e3};if("get"==n?r.params=e:r.data=e,"object"==typeof a)for(var s in a)r[s]=a[s];return axios(r)}};let q=FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router;const K={cssclass:"position-relative",origin:"pv21",types:["person","raum","mitarbeiter","mitarbeiter_ohne_zuordnung","organisationunit"],actions:{person:{defaultaction:{type:"link",action:function(t){return t.profil}},childactions:[{label:"testchildaction1",icon:"fas fa-check-circle",type:"function",action:function(t){alert("person testchildaction 01 "+JSON.stringify(t))}},{label:"testchildaction2",icon:"fas fa-file-csv",type:"function",action:function(t){alert("person testchildaction 02 "+JSON.stringify(t))}}]},raum:{defaultaction:{type:"link",renderif:function(t){return"N/A"!==t.content_id},action:function(t){return FHC_JS_DATA_STORAGE_OBJECT.app_root+"cms/content.php?content_id="+t.content_id}},childactions:[{label:"LV-Plan",icon:"fas fa-bookmark",type:"link",action:function(t){return FHC_JS_DATA_STORAGE_OBJECT.app_root+"cis/private/lvplan/stpl_week.php?type=ort&ort_kurzbz="+t.ort_kurzbz}},{label:"Rauminformation",icon:"fas fa-info-circle",type:"link",renderif:function(t){return"N/A"!==t.content_id},action:function(t){return FHC_JS_DATA_STORAGE_OBJECT.app_root+"cms/content.php?content_id="+t.content_id}}]},employee:{defaultaction:{type:"link",action:t=>`${q}/extensions/FHC-Core-Personalverwaltung/Employees/${t.person_id}/${t.uid}/summary`},childactions:[{label:"Dienstverhältnis",icon:"fas fa-address-book",type:"link",action:function(t){return`${q}/extensions/FHC-Core-Personalverwaltung/Employees/${t.person_id}/${t.uid}/contract`}},{label:"Stammdaten",icon:"fas fa-address-card",type:"link",action:function(t){return`${q}/extensions/FHC-Core-Personalverwaltung/Employees/${t.person_id}/${t.uid}`}},{label:"Vertragshistorie",icon:"fas fa-address-book",type:"link",action:function(t){return`${q}/extensions/FHC-Core-Personalverwaltung/Employees/${t.person_id}/${t.uid}/contract#dvhistory`}}]},organisationunit:{defaultaction:{type:"function",action:function(t){const e={filterUniqueId:"extensions/FHC-Core-Personalverwaltung/Employees/index",filterType:"EmployeeViewer",filterFields:[{name:"OE Key",operation:"equal",condition:t.oe_kurzbz}]};let n=FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router;axios.post(n+"/api/frontend/v1/filter/applyFilterFields",e).then(function(){window.location.href=`${n}/extensions/FHC-Core-Personalverwaltung/Employees`})}},childactions:[]}}},W={name:"ModalDialog",props:{type:String,title:String},expose:["show","hide"],setup(t,{emit:e}){let n,a,r=Vue.ref(null);const{t:s}=J();Vue.onMounted(()=>{n=new bootstrap.Modal(r.value)});return{modalConfirmEle:r,show:async()=>(n.show(),new Promise(function(t,e){a=t})),hide:function(){n.hide()},ok:()=>{a(!0)},cancel:()=>{a(!1)},t:s}},template:'\n    <div class="modal fade " id="customModalDialog" tabindex="-1" aria-labelledby=""\n        aria-hidden="true" ref="modalConfirmEle">\n        <div class="modal-dialog modal-lg">\n            <div class="modal-content">\n                <div class="modal-header">\n                    <h5 class="modal-title" id="customModalDialogLabel">{{ title }}</h5>\n                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n                </div>\n                <div class="modal-body">\n                    <slot name="body" />\n                </div>\n                <div class="modal-footer">\n                    <slot name="footer"></slot>\n                    <button type="button" class="btn btn-secondary" @click="cancel" data-bs-dismiss="modal">\n                      {{ t(\'ui\',\'abbrechen\') }}\n                    </button>\n                    <button type="button" class="btn btn-primary" @click="ok" data-bs-dismiss="modal">\n                        {{ t(\'ui\',\'ok\') }}\n                    </button>\n                </div>\n            </div>\n        </div>\n    </div>'};var Z={filterPerson:t=>({method:"post",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/PersonAPI/filterPerson",params:{searchVal:t}}),personBaseData:t=>({method:"get",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/PersonAPI/personBaseData",params:{person_id:t}}),updatePersonBaseData:t=>({method:"post",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/PersonAPI/updatePersonBaseData",params:t}),personEmployeeData:t=>({method:"get",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/PersonAPI/personEmployeeData",params:{person_id:t}}),updatePersonEmployeeData:t=>({method:"post",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/PersonAPI/updatePersonEmployeeData",params:t}),personEmployeeKurzbzExists:(t,e)=>({method:"get",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/PersonAPI/personEmployeeKurzbzExists",params:{uid:t,kurzbz:e}}),deletePersonBankData:t=>({method:"post",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/PersonAPI/deletePersonBankData",params:{bankverbindung_id:t}}),upsertPersonBankData:t=>({method:"post",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/PersonAPI/upsertPersonBankData",params:t}),personBankData:t=>({method:"get",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/PersonAPI/personBankData",params:{person_id:t}}),personAddressData:t=>({method:"get",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/PersonAPI/personAddressData",params:{person_id:t}}),deletePersonAddressData:t=>({method:"post",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/PersonAPI/deletePersonAddressData",params:{adresse_id:t}}),upsertPersonAddressData:t=>({method:"post",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/PersonAPI/upsertPersonAddressData",params:t}),personContactData:t=>({method:"get",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/PersonAPI/personContactData",params:{person_id:t}}),deletePersonContactData:t=>({method:"post",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/PersonAPI/deletePersonContactData",params:{kontakt_id:t}}),upsertPersonContactData:t=>({method:"post",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/PersonAPI/upsertPersonContactData",params:t}),uidByPerson:(t,e)=>({method:"get",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/uidByPerson",params:{person_id:t,person_uid:e}}),personMaterialExpenses:(t,e)=>({method:"get",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/PersonAPI/personMaterialExpenses",params:{person_id:t,person_uid:e}}),deletePersonMaterialExpenses:t=>({method:"post",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/PersonAPI/deletePersonMaterialExpenses",params:{sachaufwand_id:t}}),upsertPersonMaterialExpenses:t=>({method:"post",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/PersonAPI/upsertPersonMaterialExpenses",params:t}),deletePersonJobFunction:t=>({method:"post",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/PersonAPI/deletePersonJobFunction",params:{benutzerfunktion_id:t}}),upsertPersonJobFunction:t=>({method:"post",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/PersonAPI/upsertPersonJobFunction",params:t}),updatePersonUnruly:t=>({method:"post",url:"/api/frontend/v1/checkperson/CheckPerson/updatePersonUnrulyStatus",params:t})};const Y={name:"BaseData",components:{ModalDialog:W,datepicker:VueDatePicker},props:{modelValue:{type:Object,default:()=>({}),required:!1},config:{type:Object,default:()=>({}),required:!1},personID:{type:Number,required:!1},personUID:{type:String,required:!1},writePermission:{type:Boolean,required:!1}},emits:["updateHeader"],setup(t,{emit:e}){const n=Vue.inject("$api"),a=Vue.inject("$fhcAlert"),{t:r}=J(),s=Vue.ref(!0),{personID:i}=Vue.toRefs(t),l=Vue.computed({get:()=>t.modelValue,set:t=>e("update:modelValue",t)});Vue.ref("");const o=Vue.ref(!1),d=Vue.ref(),u=Vue.inject("sprache"),c=Vue.inject("nations"),p=async()=>{if(null!=l.value.personID||null!=t.personID){o.value=!0;try{const t=await n.call(Z.personBaseData(l.value.personID||i.value));h.value=t.data[0]}catch(t){a.handleSystemError(t)}finally{o.value=!1}}},h=Vue.ref({uid:"",person_id:0,kurzbz:"",aktiv:!1,telefonklappe:"",alias:"",anrede:"",titelpre:"",titelpost:"",nachname:"",vorname:"",vornamen:"",geschlecht:"",staatsbuergerschaft:"A",geburtsnation:"A",sprache:"",anmerkung:"",homepage:""}),f=Vue.ref({uid:"",person_id:0,kurzbz:"",aktiv:!1,telefonklappe:"",alias:"",anrede:"",titelpre:"",titelpost:"",nachname:"",vorname:"",vornamen:"",geschlecht:"",staatsbuergerschaft:"A",geburtsnation:"A",sprache:"",anmerkung:"",homepage:""});Vue.watch(i,(t,e)=>{p()}),Vue.watch(l,(t,e)=>{console.log("BaseData: theModel changed: ",t)});const v=async()=>{if(s.value)f.value={...h.value};else if(b.value){if(!1===await a.confirm({message:r("person","stammdatenNochNichtGespeichert"),acceptLabel:"OK",acceptClass:"p-button-danger"}))return;h.value=f.value}s.value=!s.value};Vue.onMounted(()=>{console.log("BaseData mounted",t.personID,l),h.value={uid:"",person_id:0,kurzbz:"",aktiv:!1,telefonklappe:"",alias:"",anrede:"",titelpre:"",titelpost:"",nachname:"",vorname:"",vornamen:"",geschlecht:"",staatsbuergerschaft:"A",geburtsnation:"A",sprache:"",anmerkung:"",homepage:""},(l.value?.personID||t.personID)&&p()});const m=Vue.ref(),g=Vue.reactive({nachnameBlured:!1,geburtsdatumBlured:!1,svnrBlured:!1,wasValidated:!1}),b=Vue.computed(()=>Object.keys(h.value).some(t=>h.value[t]!==f.value[t])),y=()=>{a.alertSuccess(r("person","stammdatenGespeichert"))};return{currentValue:h,readonly:s,frmState:g,dialogRef:d,baseDataFrm:m,sprache:u,GESCHLECHT:{w:"weiblich",m:"männlich",x:"divers",u:"unbekannt"},nations:c,theModel:l,t:r,readonlyBlocker:t=>{s.value&&t.preventDefault()},save:async()=>{if(m.value.checkValidity())if(b.value)try{const t=await n.call(Z.updatePersonBaseData(h.value));y(),h.value=t.data[0],f.value=h.value,l.value.updateHeader(),v()}catch(t){a.handleSystemError(t)}finally{o.value=!1}else console.log("no changes detected. nothing to save.");else console.log("form invalid");g.wasValidated=!0},toggleMode:v,validNachname:t=>!!t&&""!=t.trim(),validGeburtsdatum:t=>!!t&&""!=t.trim(),validSVNR:t=>{const e=[3,7,9,5,8,4,2,1,6];if(null==t||""==t)return!0;if(10!=t.length)return!1;var n=t.substring(4),a=t.substring(0,3),r=t.substring(3,4);{let t=0,i=a+n;for(var s=0;s<9;s++){t+=parseInt(i.charAt(s))*e[s]}if(t%11==r)return!0}return!1},printNation:t=>{if(!t)return"";let e=c.value?.filter(e=>e.nation_code==t);return e?.length>0?e[0].nation_text:""},printLanguage:t=>{if(!t)return"";let e=["German","English","Espanol","Magyar"].findIndex(t=>t==FHC_JS_DATA_STORAGE_OBJECT.user_language),n=u.value?.filter(e=>e.sprache==t);return n?.length>0?n[0].bezeichnung[e]:"?"}}},template:'\n    <div class="row pt-md-4">      \n         <div class="col">\n             <div class="card">\n                <div class="card-header">\n                    <div class="h5 mb-0"><h5>{{ t(\'global\', \'stammdaten\') }}</h5></div>        \n                </div>\n                <div class="card-body">\n                <div class="d-grid gap-2 d-md-flex justify-content-end " v-if="!theModel.restricted">\n                    <button v-if="readonly" type="button" class="btn btn-sm btn-outline-secondary" @click="toggleMode()">\n                        <i class="fa fa-pen"></i>\n                    </button>\n                    <button v-if="!readonly" type="button" class="btn btn-sm btn-outline-secondary" @click="save()"><i class="fa fa-floppy-disk"></i></button>\n                    <button v-if="!readonly" type="button" class="btn btn-sm btn-outline-secondary" @click="toggleMode()"><i class="fa fa-xmark"></i></button>\n               </div>\n               <form class="row g-3  col-lg-12" ref="baseDataFrm">\n                \n                \x3c!-- Anrede --\x3e\n                <div class="col-lg-2 col-md-4">\n                    <label for="anrede" class="form-label">{{ t(\'person\',\'anrede\') }}</label>\n                    <input type="text" :readonly="readonly" class="form-control-sm" :class="{ \'form-control-plaintext\': readonly, \'form-control\': !readonly }" id="anrede" v-model="currentValue.anrede">\n                </div>\n                <div class="col-lg-2 col-md-4">\n                    <label for="titelPre" class="form-label">{{ t(\'person\', \'titelpre\') }}</label>\n                    <input type="text" :readonly="readonly" class="form-control-sm" :class="{ \'form-control-plaintext\': readonly, \'form-control\': !readonly }" id="titelPre" v-model="currentValue.titelpre">\n                </div>\n                <div class="col-lg-2 col-md-4">\n                    <label for="titelPost" class="form-label">{{ t(\'person\', \'titelpost\' )}}</label>\n                    <input type="text" :readonly="readonly" class="form-control-sm" :class="{ \'form-control-plaintext\': readonly, \'form-control\': !readonly }" id="titelPost" v-model="currentValue.titelpost">\n                </div>\n                <div class="col-lg-4"></div>\n                \x3c!--Name --\x3e\n                <div class="col-lg-3 col-md-4">\n                    <label for="nachname" class="required form-label">{{ t(\'person\',\'nachname\') }}</label>\n                    <input type="text" required  @blur="frmState.nachnameBlured = true"  :readonly="readonly" class="form-control-sm" :class="{ \'form-control-plaintext\': readonly, \'form-control\': !readonly, \'is-invalid\': !validNachname(currentValue.nachname) && frmState.nachnameBlured}" id="nachname" v-model="currentValue.nachname">\n                    <div class="invalid-feedback" v-if="frmState.nachnameBlured && validNachname(currentValue.nachname)">\n                      Bitte geben Sie den Nachnamen an.\n                    </div>\n                </div>\n                <div class="col-lg-3 col-md-4">\n                    <label for="vorname" class="form-label">{{ t(\'person\',\'vorname\') }}</label>\n                    <input type="text" :readonly="readonly" class="form-control-sm" :class="{ \'form-control-plaintext\': readonly, \'form-control\': !readonly }" id="vorname" v-model="currentValue.vorname">\n                </div>\n                <div class="col-lg-2 col-md-4">\n                    <label for="vornamen" class="form-label">{{ t(\'person\',\'vornamen\') }}</label>\n                    <input type="text" :readonly="readonly" class="form-control-sm" :class="{ \'form-control-plaintext\': readonly, \'form-control\': !readonly }" id="vornamen" v-model="currentValue.vornamen">\n                </div>\n                <div class="col-lg-4"></div>\n    \n                \x3c!-- Staatsbürgerschaft, etc. --\x3e\n                <div class="col-lg-2 col-md-3">\n                    <label for="staatsbuergerschaft" class="form-label">{{ t(\'person\',\'staatsbuergerschaft\') }}</label>                \n                    <select v-if="!readonly" id="staatsbuergerschaft" class="form-select form-select-sm" aria-label=".form-select-sm "  v-model="currentValue.staatsbuergerschaft" >\n                        <option v-for="(item, index) in nations" :value="item.nation_code">\n                            {{ item.nation_text }}\n                        </option>\n                    </select>\n                    <input v-else type="text"  :readonly="readonly" class="form-control-sm form-control-plaintext" id="staatsbuergerschaft" :value="printNation(currentValue.staatsbuergerschaft)">\n                </div>\n                <div class="col-lg-2 col-md-3">\n                        <label for="geburtsnation" class="form-label">{{ t(\'person\',\'geburtsnation\') }}</label>\n                        <select v-if="!readonly" id="geburtsnation" class="form-select form-select-sm" aria-label=".form-select-sm "  v-model="currentValue.geburtsnation" >\n                            <option v-for="(item, index) in nations" :value="item.nation_code">\n                                {{ item.nation_text }}\n                            </option>\n                        </select>\n                        <input v-else type="text" readonly class="form-control-sm form-control-plaintext"  id="geburtsnation" :value="printNation(currentValue.geburtsnation)" >\n                </div>\n                <div class="col-lg-2 col-md-3">\n                    <label for="sprache" class="form-label">{{ t(\'person\',\'sprache\') }}</label><br>\n                    <select v-if="!readonly" id="sprache" :readonly="readonly"  v-model="currentValue.sprache" class="form-select form-select-sm" aria-label=".form-select-sm " >\n                        <option value="">-- {{ t(\'fehlermonitoring\', \'keineAuswahl\') }} --</option>\n                        <option v-for="(item, index) in sprache" :value="item.sprache">\n                            {{ item.bezeichnung[0] }}\n                        </option>         \n                    </select>\n                    <input v-else type="text" readonly class="form-control-sm form-control-plaintext" id="sprache" :value="printLanguage(currentValue.sprache)">\n    \n                </div>\n                <div class="col-lg-6 col-md-3"></div>\n                \n                \x3c!-- Geschlecht --\x3e\n                <div class="col-lg-2 col-md-3">\n                    <label for="geschlecht" class="form-label">{{ t(\'person\', \'geschlecht\') }}</label><br>\n                    <select v-if="!readonly" id="geschlecht" v-model="currentValue.geschlecht" class="form-select form-select-sm" aria-label=".form-select-sm " >\n                        <option value="w">weiblich</option>\n                        <option value="m">männlich</option>\n                        <option value="x">divers</option>\n                        <option value="u">unbekannt</option>\n                    </select>\n                    <input v-else type="text" readonly class="form-control-sm form-control-plaintext" id="geschlecht" :value="GESCHLECHT[currentValue.geschlecht]">\n                </div>\n    \n                <div class="col-lg-2 col-md-3">\n                    <label for="geburtsdatum" class="required form-label">{{ t(\'person\', \'geburtsdatum\') }}</label>\n                    <template v-if="readonly">\n                        <input type="date" readonly class="form-control-sm form-control-plaintext" v-model="currentValue.gebdatum" id="geburtsdatum" >\n                    </template>\n                    <template v-else>\n                        <datepicker id="geburtsdatum"\n                            @blur="frmState.geburtsdatumBlured = true" \n                            :input-class-name="(!validGeburtsdatum(currentValue.gebdatum) && frmState.geburtsdatumBlured) ? \'dp-invalid-input\' : \'\'" \n                            v-model="currentValue.gebdatum"\n                            v-bind:enable-time-picker="false"\n                            text-input \n                            locale="de"\n                            format="dd.MM.yyyy"\n                            auto-apply \n                            model-type="yyyy-MM-dd"></datepicker>\n                    </template>\n                </div>\n    \n                <div class="col-lg-2 col-md-3">\n                    <label for="svnr" class="form-label">{{ t(\'person\', \'svnr\') }}</label>\n                    <input type="text" :readonly="readonly" @blur="frmState.svnrBlured = true" class="form-control-sm" :class="{ \'form-control-plaintext\': readonly, \'form-control\': !readonly, \'is-invalid\': !validSVNR(currentValue.svnr) && frmState.svnrBlured}" id="svnr" v-model="currentValue.svnr">\n                </div>\n    \n                <div class="col-lg-2 col-md-3">\n                        <label for="ersatzkennzeichen" class="form-label">{{ t(\'person\', \'ersatzkennzeichen\') }}</label>\n                        <input type="text" :readonly="readonly" class="form-control-sm" :class="{ \'form-control-plaintext\': readonly, \'form-control\': !readonly }" id="ersatzkennzeichen" v-model="currentValue.ersatzkennzeichen">\n                </div>\n    \n                <div class="col-lg-4">\n                    \n                </div>\n                \n                \n                \n                \x3c!-- --\x3e\n                <div class="col-lg-6">\n                    <label for="inputAddress" class="form-label">{{ t(\'global\', \'anmerkung\') }}</label>\n                    <textarea type="text" :readonly="readonly" class="form-control-sm" :class="{ \'form-control-plaintext\': readonly, \'form-control\': !readonly }" id="anmerkungen" v-model="currentValue.anmerkung">\n                    </textarea>\n                </div>\n    \n                \n                \n                \x3c!-- changes --\x3e\n                <div class="col-8">\n                    <div class="modificationdate">{{ currentValue.insertamum }}/{{ currentValue.insertvon }}, {{ currentValue.updateamum }}/{{ currentValue.updatevon }}</div>\n                </div>\n                \n    \n            </form>\n            </div>\n             </div>\n        </div>   \n    </div>\n\n    '},X={name:"EmployeeData",components:{ModalDialog:W},props:{modelValue:{type:Object,default:()=>({}),required:!1},config:{type:Object,default:()=>({}),required:!1},personID:{type:Number,required:!1},personUID:{type:String,required:!1},writePermission:{type:Boolean,required:!1}},emits:["updateHeader"],setup(t,{emit:e}){const n=Vue.inject("$api"),a=Vue.inject("$fhcAlert"),r=Vue.ref(!0),{t:s}=J(),{personID:i}=Vue.toRefs(t),l=Vue.computed({get:()=>t.modelValue,set:t=>e("update:modelValue",t)});Vue.ref("");const o=Vue.ref(!1),d=Vue.ref(),u=Vue.inject("ausbildung"),c=Vue.inject("standorte"),p=Vue.inject("orte"),h=Vue.ref(!0),f=async()=>{if(null!=l.value.personID||null!=t.personID){o.value=!0;try{const t=await n.call(Z.personEmployeeData(l.value.personID||i.value));v.value=t.data[0]}catch(t){a.handleSystemError(t)}finally{o.value=!1}}},v=Vue.ref({mitarbeiter_uid:"",personalnummer:0,telefonklappe:"",kurzbz:"",lektor:!1,fixangestellt:!1,stundensatz:"0.00",ausbildungcode:null,ort_kurzbz:"",ext_id:0,anmerkung:null,bismelden:!0,standort_id:null,kleriker:!1,aktiv:!1,habilitation:!1,insertamum:"",insertvon:"",updatevon:"",updateamum:""}),m=Vue.ref({mitarbeiter_uid:"",personalnummer:0,telefonklappe:"",kurzbz:"",lektor:!1,fixangestellt:!1,stundensatz:"0.00",ausbildungcode:null,ort_kurzbz:"",ext_id:0,anmerkung:null,bismelden:!0,standort_id:null,kleriker:!1,aktiv:!1,habilitation:!1,insertamum:"",insertvon:"",updatevon:"",updateamum:""});Vue.watch(i,(t,e)=>{f()});const g=async()=>{if(r.value)m.value={...v.value};else if(_.value){if(!1===await a.confirm({message:"t('person','mitarbeiterdatenGeandert')",acceptLabel:"OK",acceptClass:"p-button-danger"}))return;v.value=m.value}r.value=!r.value};Vue.onMounted(()=>{v.value={mitarbeiter_uid:"",personalnummer:0,telefonklappe:"",kurzbz:"",lektor:!1,fixangestellt:!1,stundensatz:"0.00",ausbildungcode:null,ort_kurzbz:"",ext_id:0,anmerkung:null,bismelden:!0,standort_id:null,kleriker:!1,aktiv:!1,habilitation:!1,insertamum:"",insertvon:"",updatevon:"",updateamum:""},(l.value?.personID||t.personID)&&f()});const b=Vue.ref(),y=Vue.reactive({nachnameBlured:!1,kurzbzBlured:!1,wasValidated:!1}),_=Vue.computed(()=>Object.keys(v.value).some(t=>v.value[t]!==m.value[t])),k=()=>{a.alertSuccess(s("person","mitarbeiterdatenGespeichert"))};return{currentValue:v,readonly:r,frmState:y,dialogRef:d,employeeDataFrm:b,ausbildung:u,standorte:c,orte:p,validKurzbz:h,theModel:l,save:async()=>{if(console.log("haschanged: ",_),console.log("frmState: ",y),b.value.checkValidity())if(_.value)try{const t=await n.call(Z.updatePersonEmployeeData(v.value));k(),v.value=t.data[0],m.value=v.value,l.value.updateHeader(),g()}catch(t){a.handleSystemError(t)}finally{o.value=!1}else console.log("no changes detected. nothing to save.");else console.log("form invalid");y.wasValidated=!0},toggleMode:g,validNachname:t=>!!t&&""!=t.trim(),validateKurzbz:()=>{if(v.value.kurzbz&&""!=v.value.kurzbz.trim()){console.log("validateKurzbz: ",v.value.mitarbeiter_uid,v.value.kurzbz),o.value=!0;try{n.call(Z.personEmployeeKurzbzExists(v.value.mitarbeiter_uid,v.value.kurzbz)).then(t=>{1==t.error?console.error("error checking kurzbz",t.msg):h.value=!t.data})}catch(t){a.handleSystemError(t)}finally{o.value=!1}}},getAusbildungbez:t=>{if(!t)return"";let e=u.value?.filter(e=>e.ausbildungcode==t);return e?.length>0?e[0].ausbildungbez:""},getStandortbez:t=>{if(!t)return"";let e=c.value?.filter(e=>e.standort_id==t);return e?.length>0?e[0].bezeichnung:""},readonlyBlocker:t=>{r.value&&t.preventDefault()},t:s}},template:'\n   <div class="row pt-md-4">      \n             <div class="col">\n                 <div class="card">\n                    <div class="card-header">\n                        <div class="h5"><h5>{{ t(\'person\',\'mitarbeiterdaten\') }}</h5></div>        \n                    </div>\n                    <div class="card-body">\n                        <div class="d-grid gap-2 d-md-flex justify-content-end " v-if="!theModel.restricted">\n                                <button v-if="readonly" type="button" class="btn btn-sm btn-outline-secondary" @click="toggleMode()">\n                                    <i class="fa fa-pen"></i>\n                                </button>\n                                <button v-if="!readonly" type="button" class="btn btn-sm btn-outline-secondary" @click="save()"><i class="fa fa-floppy-disk"></i></button>\n                                <button v-if="!readonly" type="button" class="btn btn-sm btn-outline-secondary" @click="toggleMode()"><i class="fa fa-xmark"></i></button>\n                        </div>\n                        <form class="row g-3" ref="employeeDataFrm">\n                            <div class="col-md-2">\n                                <label for="personalnummer" class="form-label">{{ t(\'global\',\'personalnummer\') }}</label>\n                                <input type="text" readonly class="form-control-sm" :class="{ \'form-control-plaintext\': readonly, \'form-control\': !readonly }" id="personalnummer" v-model="currentValue.personalnummer">\n                            </div>            \n                            <div class="col-md-2">\n                                <label for="kurzbezeichnung" class="form-label">{{ t(\'gruppenmanagement\',\'kurzbezeichnung\') }}</label>\n                                <input type="text" :readonly="readonly" @blur="frmState.kurzbzBlured = true" @input="validateKurzbz()" class="form-control-sm" maxlength="8" :class="{ \'form-control-plaintext\': readonly, \'form-control\': !readonly, \'is-invalid\': !validKurzbz && frmState.kurzbzBlured }" id="kurzbezeichnung" v-model="currentValue.kurzbz">\n                                <div class="invalid-feedback" v-if="!validKurzbz">\n                                    Kurzbezeichnung existiert bereits. \n                                </div>\n                            </div>\n                            <div class="col-md-4">\n                                <label for="alias" class="form-label">{{ t(\'person\',\'alias\') }}</label>\n                                <input type="text" :readonly="readonly" class="form-control-sm" :class="{ \'form-control-plaintext\': readonly, \'form-control\': !readonly }" id="alias" v-model="currentValue.alias">\n                            </div>\n                            <div class="col-md-4"></div>\n                            \x3c!--  --\x3e\n                            <div class="col-md-2">\n                                <label for="office" class="form-label">{{ t(\'person\',\'buero\') }}</label>\n                                <select v-if="!readonly" id="office" :readonly="readonly"  v-model="currentValue.ort_kurzbz" class="form-select form-select-sm" aria-label=".form-select-sm " >\n                                    <option value="">-- {{ t(\'fehlermonitoring\', \'keineAuswahl\') }} --</option>\n                                    <option v-for="(item, index) in orte" :value="item.ort_kurzbz">\n                                        {{ item.ort_kurzbz }}\n                                    </option>         \n                                </select>\n                            <input v-else type="text" readonly class="form-control-sm form-control-plaintext" id="office" :value="currentValue.ort_kurzbz">\n                            </div>\n                            <div class="col-md-2">\n                                <label for="telefonklappe" class="form-label">{{ t(\'person\',\'telefonklappe\') }}</label>\n                                <input type="text" :readonly="readonly" class="form-control-sm" maxlength="8" :class="{ \'form-control-plaintext\': readonly, \'form-control\': !readonly }" id="telefonklappe" v-model="currentValue.telefonklappe">\n                            </div>\n                            <div class="col-md-4">\n                                <label for="ausbildung" class="form-label">{{ t(\'person\',\'ausbildung\') }}</label>\n                                <select v-if="!readonly" id="ausbildung" :readonly="readonly"  v-model="currentValue.ausbildungcode" class="form-select form-select-sm" aria-label=".form-select-sm " >\n                                    <option value="">-- {{ t(\'fehlermonitoring\', \'keineAuswahl\') }} --</option>\n                                    <option v-for="(item, index) in ausbildung" :value="item.ausbildungcode">\n                                        {{ item.ausbildungbez }}\n                                    </option>         \n                                </select>\n                                <input v-else type="text" readonly class="form-control-sm form-control-plaintext" id="ausbildung" :value="getAusbildungbez(currentValue.ausbildungcode) ">\n                            </div>\n                            <div class="col-md-4"></div>\n                            \x3c!--Location --\x3e       \n                            \n                            <div class="col-md-4">\n                                <div class="row gy-3">    \n                                    <div class="col-12">                 \n                                        <label for="standort" class="form-label">{{ t(\'person\',\'standort\') }}</label>\n                                        <select v-if="!readonly" id="standort" :readonly="readonly"  v-model="currentValue.standort_id" class="form-select form-select-sm" aria-label=".form-select-sm " >\n                                            <option value="0">-- {{ t(\'fehlermonitoring\', \'keineAuswahl\') }} --</option>\n                                            <option v-for="(item, index) in standorte" :value="item.standort_id">\n                                                {{ item.bezeichnung }}\n                                            </option>         \n                                        </select>\n                                        <input v-else type="text" readonly class="form-control-sm form-control-plaintext" id="standort" :value="getStandortbez(currentValue.standort_id) ">\n                                    </div>\n                                    <div class="col-12">\n                                        <label for="anmerkung" class="form-label">{{ t(\'global\', \'anmerkung\') }}</label>\n                                        <textarea type="text" :readonly="readonly" class="form-control-sm" :class="{ \'form-control-plaintext\': readonly, \'form-control\': !readonly }" v-model="currentValue.anmerkung">\n                                        </textarea>\n                                    </div>\n                                </div>\n                            </div>\n                            <div class="col-md-8">\n\n                                <label for="status" class="form-label">{{ t(\'global\',\'status\') }}</label>\n                                <div class="form-check">\n                                    <label for="aktiv" class="form-check-label">{{ t(\'global\',\'aktiv\') }}</label>\n                                    <input class="form-check-input" :readonly="readonly" @click="readonlyBlocker" type="checkbox" id="aktiv" v-model="currentValue.aktiv">\n                                </div>\n                                <div class="form-check">\n                                    <label for="lektor" class="form-check-label">{{ t(\'lehre\',\'lektor\') }}</label>\n                                    <input class="form-check-input" :readonly="readonly" @click="readonlyBlocker" type="checkbox" id="lektor" v-model="currentValue.lektor">\n                                </div>\n                                <div class="form-check">\n                                    <label for="habilitation" class="form-check-label" >{{ t(\'person\',\'habilitation\') }}</label>\n                                    <input class="form-check-input"  :readonly="readonly"  @click="readonlyBlocker" type="checkbox" id="habilitation" v-model="currentValue.habilitation">\n                                </div>\n                                <div class="form-check">\n                                    <label for="fixangestellt" class="form-check-label">{{ t(\'person\',\'fixangestellt\') }}</label>\n                                    <input class="form-check-input"  :readonly="readonly" @click="readonlyBlocker" type="checkbox" id="fixangestellt" v-model="currentValue.fixangestellt">\n                                </div>\n                                <div class="form-check">\n                                    <label for="bismelden" class="form-check-label" >{{ t(\'person\',\'bismelden\') }}</label>\n                                    <input class="form-check-input"  :readonly="readonly"  @click="readonlyBlocker" type="checkbox" id="bismelden" v-model="currentValue.bismelden">\n                                </div>\n                                \n\n                            </div>\n                            \x3c!-- --\x3e\n                            \n                            <div class="col-4">\n                                \n                            </div>\n                            <div class="col-4"></div>\n                            \x3c!-- changes --\x3e\n                            <div class="col-8">\n                                <div class="modificationdate">{{ currentValue.insertamum }}/{{ currentValue.insertvon }}, {{ currentValue.updateamum }}/{{ currentValue.updatevon }}</div>\n                            </div>\n                        </form>\n                    </div>\n                </div>\n            </div>\n        </div>\n    '},Q={name:"Modal",props:{type:String,title:String,noscroll:Boolean},expose:["show","hide"],setup(t,{emit:e}){let n,a=Vue.ref(null);Vue.onMounted(()=>{n=new bootstrap.Modal(a.value)});return{modalEle:a,show:()=>{n.show()},hide:function(){n.hide()}}},template:'\n    <div class="modal fade " id="customModal" tabindex="-1" aria-labelledby=""\n        aria-hidden="true" ref="modalEle">\n        <div class="modal-dialog modal-lg" :class="(!noscroll) ? \'modal-dialog-scrollable\' : \'\'">\n            <div class="modal-content">\n                <div class="modal-header">\n                    <h5 class="modal-title" id="customModalLabel">{{ title }}</h5>\n                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n                </div>\n                <div class="modal-body">\n                    <slot name="body" />\n                </div>\n                <div class="modal-footer">\n                    <slot name="footer"></slot>\n                    \x3c!-- button type="button" class="btn btn-secondary" data-bs-dismiss="modal">\n                        OK\n                    </button--\x3e\n                </div>\n            </div>\n        </div>\n    </div>'},tt={name:"BankData",components:{Modal:Q,ModalDialog:W},props:{modelValue:{type:Object,default:()=>({}),required:!1},config:{type:Object,default:()=>({}),required:!1},personID:{type:[Number,null],required:!1},writePermission:{type:Boolean,required:!1}},setup(t){const e=Vue.inject("$api"),n=Vue.inject("$fhcAlert"),a=Vue.ref(!1),{personID:r}=Vue.toRefs(t),{t:s}=J(),i=Vue.ref(),l=Vue.ref(!1),o=Vue.ref([]),d=Vue.computed({get:()=>t.modelValue,set:t=>emit("update:modelValue",t)}),u=t=>({bankverbindung_id:0,anschrift:"",person_id:t,name:"",iban:"",bic:"",blz:"",kontonr:"",typ:"p",verrechnung:!0}),c=Vue.ref(u(d.value.personID||r.value)),p=Vue.ref(u(d.value.personID||r.value));Vue.onMounted(()=>{c.value=u(d.value.personID||r.value),(async()=>{if(null!=d.value.personID||null!=t.personID){l.value=!0;try{const t=await e.call(Z.personBankData(d.value.personID||r.value));o.value=t.data}catch(t){n.handleSystemError(t)}finally{l.value=!1}}else o.value=[]})()});const h=Vue.computed(()=>o.value?Object.values(o.value):[]),f=Vue.ref(),v=Vue.ref(),m=()=>{f.value.hide()},g=Vue.ref(),b=Vue.reactive({ibanBlured:!1,wasValidated:!1}),y=t=>!!t&&""!=t.trim()&&_(t.replace(/\s/g,"")),_=t=>{if(t.length<5)return!1;if(!t.match(/[A-Z]{2}[0-9]{2}[A-Z0-9]+/))return!1;var e="0".charCodeAt(0),n="A".charCodeAt(0),a=0;function r(t){a>1e6&&(a%=97),a=t<n?10*a+t-e:100*a+t-n+10}for(var s=4;s<t.length;++s)r(t.charCodeAt(s));for(s=0;s<4;++s)r(t.charCodeAt(s));return 1==(a%=97)},k=()=>(b.ibanBlured=!0,!!y(c.value.iban));Vue.computed(()=>Object.keys(c.value).some(t=>c.value[t]!==p.value[t]));const A=()=>{n.alertSuccess(s("person","bankdatenGespeichert"))},x=()=>{n.alertSuccess(s("person","bankdatenGeloescht"))};return{bankdataList:o,bankdataListArray:h,currentValue:c,readonly:a,frmState:b,dialogRef:i,bankDataFrm:g,modalRef:f,validIban:y,showToast:A,showDeletedToast:x,showAddModal:()=>{c.value=u(d.value.personID||r.value),b.ibanBlured=!1,b.bankBlured=!1,f.value.show()},hideModal:m,okHandler:async()=>{if(k()){try{const t=await e.call(Z.upsertPersonBankData(c.value));"success"==t.meta.status&&(o.value[t.data[0].bankverbindung_id]=t.data[0],p.value=c.value,A())}catch(t){n.handleSystemError(t)}finally{l.value=!1}m()}else console.log("form invalid")},t:s,showDeleteModal:async t=>{if(c.value={...o.value[t]},!1!==await n.confirm({message:s("person","bankdaten")+" "+c.value?.iban+" "+c.value?.bic+" "+c.value?.name+" "+s("person","wirklichLoeschen"),acceptLabel:"Löschen",acceptClass:"p-button-danger"})){l.value=!0;try{"success"==(await e.call(Z.deletePersonBankData(t))).meta.status&&(delete o.value[t],x())}catch(t){n.handleSystemError(t)}finally{l.value=!1}}},showEditModal:t=>{c.value={...o.value[t]},f.value.show()},confirmDeleteRef:v}},template:'\n    <div class="row">\n    </div>\n\n   <div class="row pt-md-4">      \n         <div class="col">\n             <div class="card">\n                <div class="card-header">\n                    <div class="h5"><h5>{{ t(\'person\',\'bankdaten\') }}</h5></div>        \n                </div>\n        \n                <div class="card-body">\n                    <div class="d-grid gap-2 d-md-flex justify-content-start py-2">\n                        <button type="button" class="btn btn-sm btn-primary" @click="showAddModal()">\n                            <i class="fa fa-plus"></i> {{ t(\'person\',\'bankdaten\') }}\n                        </button>            \n                    </div>\n                    <div class="table-responsive">\n                <table class="table table-hover table-sm">\n                    <thead>                \n                    <tr>\n                        <th scope="col">{{ t(\'person\',\'bank\') }}</th>\n                        <th scope="col">{{ t(\'person\',\'anschrift\') }}</th>\n                        <th scope="col">{{ t(\'person\',\'bic\') }}</th>\n                        <th scope="col">{{ t(\'person\',\'iban\') }}</th>\n                        <th scope="col">{{ t(\'person\',\'kontonr\') }}</th>\n                        <th scope="col">{{ t(\'person\',\'verrechnung\') }}</th>\n                        <th scope="col">{{ t(\'ui\',\'aktion\') }}</th>\n                    </tr>\n                    </thead>\n                    <tbody>\n                    <tr v-for="bankdata in bankdataListArray" :key="bankdata.bankverbindung_id">\n                        <td class="align-middle">{{ bankdata.name }}</td>\n                        <td class="align-middle">{{ bankdata.anschrift }}</td>\n                        <td class="align-middle">{{ bankdata.bic }}</td>\n                        <td class="align-middle">{{ bankdata.iban }}</td>\n                        <td class="align-middle">{{ bankdata.kontonr }}</td>\n                        <td class="align-middle">{{ bankdata.verrechnung == true ? "X" : "" }}</td>\n                        <td class="align-middle" width="5%">\n                            <div class="d-grid gap-2 d-md-flex align-middle">\n                                <button type="button" class="btn btn-outline-secondary btn-sm" @click="showEditModal(bankdata.bankverbindung_id)">\n                                    <i class="fa fa-pen"></i>\n                                </button>\n                                <button type="button" class="btn btn-outline-secondary btn-sm" @click="showDeleteModal(bankdata.bankverbindung_id)">\n                                    <i class="fa fa-xmark"></i>\n                                </button>\n                            </div>\n                        </td>\n                    </tr>\n        \n                    </tbody>\n                </table>            \n            </div>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    \x3c!-- detail modal --\x3e\n    <Modal :title="t(\'person\',\'bankverbindung\')" ref="modalRef">\n        <template #body>\n            <form class="row g-3" ref="bankDataFrm">\n                            \n                <div class="col-md-8">\n                    <label for="receiver" class="form-label">{{ t(\'global\',\'empfaenger\') }}</label>\n                    <input type="text" :readonly="readonly" class="form-control-sm" :class="{ \'form-control-plaintext\': readonly, \'form-control\': !readonly }" id="receiver" v-model="currentValue.anschrift" maxlength="128">\n                </div>\n                <div class="col-md-4"></div>\n                \x3c!--  --\x3e\n                <div class="col-md-4">\n                    <label for="iban" class="required form-label" >{{ t(\'person\',\'iban\') }}</label>\n                    <input type="text" required  @blur="frmState.ibanBlured = true" :readonly="readonly" class="form-control-sm" :class="{ \'form-control-plaintext\': readonly, \'form-control\': !readonly, \'is-invalid\': !validIban(currentValue.iban) && frmState.ibanBlured}" id="iban" v-model="currentValue.iban"  maxlength="34"  >\n                </div>\n                <div class="col-md-4">\n                    <label for="bic" class="form-label">{{ t(\'person\',\'bic\') }}</label>\n                    <input type="text" :readonly="readonly" class="form-control-sm" :class="{ \'form-control-plaintext\': readonly, \'form-control\': !readonly }" id="bic" maxlength="11" v-model="currentValue.bic">\n                </div>\n                <div class="col-md-4">\n                </div>\n                \x3c!-- --\x3e\n                <div class="col-md-8">\n                    <label for="uid" class="form-label">{{ t(\'person\',\'bank\') }}</label>\n                    <input type="text"  :readonly="readonly" class="form-control-sm" :class="{ \'form-control-plaintext\': readonly, \'form-control\': !readonly}" id="bank" maxlength="64"  v-model="currentValue.name">\n                </div>\n                <div class="col-md-4">\n                </div>\n                \x3c!-- --\x3e\n                <div class="col-md-2">\n                    <label for="blz" class="form-label">{{ t(\'person\',\'blz\') }}</label>\n                    <input type="text" :readonly="readonly" class="form-control-sm" :class="{ \'form-control-plaintext\': readonly, \'form-control\': !readonly }" id="blz" maxlength="16"  v-model="currentValue.blz">\n                </div>\n                <div class="col-md-4">\n                    <label for="kontonr" class="form-label">{{ t(\'person\',\'kontonr\') }}</label>\n                    <input type="text" :readonly="readonly" class="form-control-sm" :class="{ \'form-control-plaintext\': readonly, \'form-control\': !readonly }" id="kontonr" maxlength="16"  v-model="currentValue.kontonr">\n                </div>\n                <div class="col-md-2">\n                    <label for="verrechnung" class="form-label">{{ t(\'person\',\'verrechnung\') }}</label>\n                    <div>\n                        <input class="form-check-input" type="checkbox" id="verrechnung" v-model="currentValue.verrechnung">\n                    </div>     \n                </div>\n\n                \x3c!-- changes --\x3e\n                <div class="col-8">\n                    <div class="modificationdate">{{ currentValue.insertamum }}/{{ currentValue.insertvon }}, {{ currentValue.updateamum }}/{{ currentValue.updatevon }}</div>\n                </div>\n                \n            </form>\n        </template>\n        <template #footer>\n            <button type="button" class="btn btn-primary" @click="okHandler()" >\n            {{ t(\'ui\',\'speichern\') }}\n            </button>\n        </template>\n\n    </Modal>\n\n    <ModalDialog :title="t(\'global\',\'warnung\')" ref="dialogRef">\n      <template #body>\n        {{ t(\'person\',\'bankdatenGeaendert\') }}\n      </template>\n    </ModalDialog>\n\n    <ModalDialog :title="t(\'global\',\'warnung\')" ref="confirmDeleteRef">\n        <template #body>\n            {{ t(\'person\',\'bankdaten\') }} \'{{ currentValue?.iban }} {{ currentValue?.bic }}, {{ currentValue?.name }}\' {{ t(\'person\',\'wirklichLoeschen\') }}?\n        </template>\n    </ModalDialog>\n    '};var et={getGemeinden:t=>({method:"get",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/CommonsAPI/getGemeinden",params:{plz:t}}),getOrtschaften:t=>({method:"get",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/CommonsAPI/getOrtschaften",params:{plz:t}}),getContractExpire:(t,e)=>({method:"get",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/CommonsAPI/getContractExpire",params:{year:t,month:e}}),getContractNew:(t,e)=>({method:"get",url:"extensions/FHC-Core-Personalverwaltung/api/frontend/v1/CommonsAPI/getContractNew",params:{year:t,month:e}}),getBirthdays:t=>({method:"get",url:"extensions/FHC-Core-Personalverwaltung/api/frontend/v1/CommonsAPI/getBirthdays",params:{date:t}}),getCovidState:(t,e)=>({method:"get",url:"extensions/FHC-Core-Personalverwaltung/api/frontend/v1/CommonsAPI/getCovidState",params:{person_id:t,d:e}}),getAllCourseHours:t=>({method:"get",url:`extensions/FHC-Core-Personalverwaltung/api/frontend/v1/CommonsAPI/getAllCourseHours?uid=${t}`}),getAllSupportHours:t=>({method:"get",url:`extensions/FHC-Core-Personalverwaltung/api/frontend/v1/CommonsAPI/getAllSupportHours?uid=${t}`}),getNations:()=>({method:"get",url:"extensions/FHC-Core-Personalverwaltung/api/frontend/v1/CommonsAPI/getNations"}),getSachaufwandTyp:()=>({method:"get",url:"extensions/FHC-Core-Personalverwaltung/api/frontend/v1/CommonsAPI/getSachaufwandtyp"}),getKontakttyp:()=>({method:"get",url:"extensions/FHC-Core-Personalverwaltung/api/frontend/v1/CommonsAPI/getKontakttyp"}),getAdressentyp:()=>({method:"get",url:"extensions/FHC-Core-Personalverwaltung/api/frontend/v1/CommonsAPI/getAdressentyp"}),getSprache:()=>({method:"get",url:"extensions/FHC-Core-Personalverwaltung/api/frontend/v1/CommonsAPI/getSprache"}),getAusbildung:()=>({method:"get",url:"extensions/FHC-Core-Personalverwaltung/api/frontend/v1/CommonsAPI/getAusbildung"}),getStandorteIntern:()=>({method:"get",url:"extensions/FHC-Core-Personalverwaltung/api/frontend/v1/CommonsAPI/getStandorteIntern"}),getOrte:()=>({method:"get",url:"extensions/FHC-Core-Personalverwaltung/api/frontend/v1/CommonsAPI/getOrte"}),getKarenztypen:()=>({method:"get",url:"extensions/FHC-Core-Personalverwaltung/api/frontend/v1/CommonsAPI/getKarenztypen"}),getGehaltstypen:()=>({method:"get",url:"extensions/FHC-Core-Personalverwaltung/api/frontend/v1/CommonsAPI/getGehaltstypen"}),getVertragsarten:()=>({method:"get",url:"extensions/FHC-Core-Personalverwaltung/api/frontend/v1/CommonsAPI/getVertragsarten"}),getVertragsbestandteiltypen:()=>({method:"get",url:"extensions/FHC-Core-Personalverwaltung/api/frontend/v1/CommonsAPI/getVertragsbestandteiltypen"}),getTeilzeittypen:()=>({method:"get",url:"extensions/FHC-Core-Personalverwaltung/api/frontend/v1/CommonsAPI/getTeilzeittypen"}),getFreitexttypen:()=>({method:"get",url:"extensions/FHC-Core-Personalverwaltung/api/frontend/v1/CommonsAPI/getFreitexttypen"}),getStundensatztypen:()=>({method:"get",url:"extensions/FHC-Core-Personalverwaltung/api/frontend/v1/CommonsAPI/getStundensatztypen"})};const nt={name:"AddressData",components:{Modal:Q,ModalDialog:W},props:{personID:{type:Number,required:!0},writePermission:{type:Boolean,required:!1}},setup(t){const{personID:e}=Vue.toRefs(t),n=Vue.inject("$api"),a=Vue.inject("$fhcAlert"),{t:r}=J();Vue.ref("");const s=Vue.ref([]),i=Vue.ref(!1),l=Vue.ref(!1),o=Vue.ref(),d=Vue.inject("nations"),u=Vue.inject("adressentyp"),c=Vue.ref([]),p=Vue.ref([]),h=Vue.ref(!1);Vue.watch(e,(t,e)=>{console.log("AddressData watch",t),f()});const f=async()=>{if(null!=e.value){i.value=!0;try{const t=await n.call(Z.personAddressData(e.value));s.value=t.data}catch(t){console.log(t)}finally{i.value=!1}}else s.value=[]};Vue.watchEffect(async()=>{if("A"==o?.value?.nation&&""!=o.value.plz)try{i.value=!0;const t=await n.call(et.getGemeinden(o.value.plz));c.value=t.data}catch(t){console.log(t)}finally{i.value=!1}}),Vue.watchEffect(async()=>{if("A"==o?.value?.nation&&""!=o.value.plz)try{i.value=!0;const t=await n.call(et.getOrtschaften(o.value.plz));p.value=t.data}catch(t){console.log(t)}finally{i.value=!1}}),Vue.onMounted(()=>{f()});const v=Vue.computed(()=>Object.values(s.value));let m=Vue.ref();const g=()=>{m.value.hide()},b=Vue.ref(),y=Vue.reactive({plzBlured:!1,ortBlured:!1,typBlured:!1,wasValidated:!1}),_=t=>!!t&&""!=t.trim(),k=t=>!!t&&""!=t.trim(),A=t=>!!t&&""!=t.trim(),x=()=>(y.plzBlured=!0,y.ortBlured=!0,y.typBlured=!0,!!(k(o.value.ort)&&_(o.value.plz)&&A(o.value.typ))),w=()=>{a.alertSuccess(r("person","adresseGespeichert"))},z=()=>{a.alertSuccess(r("person","adresseGeloescht"))};return{addressList:s,addressListArray:v,isEditActive:l,showAddModal:()=>{o.value={adresse_id:0,person_id:e,name:"",strasse:"",plz:"",ort:"",gemeinde:"",nation:"A",typ:"h",heimatadresse:!1,zustelladresse:!0,firma_id:null,updateamum:"",updatevon:"",insertamum:"",insertvon:"",ext_id:null,rechnungsadresse:"",anmerkung:"",co_name:""},y.plzBlured=!1,y.ortBlured=!1,y.typBlured=!1,m.value.show()},showDeleteModal:async t=>{if(o.value={...s.value[t]},!1!==await a.confirm({message:`${o.value?.plz} ${o.value?.ort}, ${o.value?.strasse} wirklich löschen?`,acceptLabel:"Löschen",acceptClass:"p-button-danger"}))if(o.value.heimatadresse)a.alertInfo(r("person","heimatadresse")+" "+r("person","kannNichtGeloeschtWerden"));else try{const e=await n.call(Z.deletePersonAddressData(t));"success"==e?.meta?.status&&(delete s.value[t],z())}catch(t){console.log(t)}finally{i.value=!1}},showEditModal:t=>{o.value={...s.value[t]},m.value.show()},currentAddress:o,modalRef:m,hideModal:g,okHandler:async()=>{if(x()){try{const t=await n.call(Z.upsertPersonAddressData(o.value));"success"==t?.meta?.status&&(s.value[t.data[0].adresse_id]=t.data[0],console.log("address successfully saved"),w())}catch(t){console.log(t)}finally{i.value=!1}g()}else console.log("form invalid")},nations:d,gemeinden:c,ortschaften:p,adressentyp:u,t:r,validOrt:k,validPLZ:_,validTyp:A,frmState:y,addressDataFrm:b,readonly:h}},template:' \n        <div class="row">\n\n            <div class="d-flex bd-highlight">\n                <div class="py-2 bd-highlight">                   \n                    <button type="button" class="btn btn-primary btn-sm"  @click="showAddModal()" style="margin-right:1.85rem;">\n                        <i class="fa fa-plus"></i> {{ t(\'person\',\'adresse\') }}\n                    </button>\n                </div>\n            </div>\n        </div>\n        <div class="table-responsive">\n            <table class="table table-hover table-sm">\n                <thead>                \n                <tr>\n                    <th scope="col">{{ t(\'global\',\'typ\') }}</th>\n                    <th scope="col">{{ t(\'person\',\'strasse\') }}</th>\n                    <th scope="col">{{ t(\'person\',\'plz\') }}</th>\n                    <th scope="col">{{ t(\'person\',\'ort\') }}</th>\n                    <th scope="col">{{ t(\'person\',\'gemeinde\') }}</th>\n                    <th scope="col">{{ t(\'person\',\'nation\') }}</th>\n                    <th scope="col">{{ t(\'person\',\'heimatadresse\') }}</th>\n                    <th scope="col">{{ t(\'person\',\'zustelladresse\') }}</th>\n                    <th scope="col">{{ t(\'person\',\'abweichenderEmpfaenger\') }}</th>\n                    <th scope="col">{{ t(\'ui\',\'aktion\') }}</th>\n                </tr>\n                </thead>\n                <tbody>\n                <tr v-for="address in addressListArray" :key="address.adresse_id">\n                    <td class="align-middle">{{ address.typ }}</td>\n                    <td class="align-middle">{{ address.strasse }}</td>\n                    <td class="align-middle">{{ address.plz }}</td>\n                    <td class="align-middle">{{ address.ort }}</td>\n                    <td class="align-middle">{{ address.gemeinde }}</td>\n                    <td class="align-middle">{{ address.nation }}</td>\n                    <td class="align-middle">{{ address.heimatadresse == true ? "X" : "" }}</td>\n                    <td class="align-middle">{{ address.zustelladresse == true ? "X" : "" }}</td>\n                    <td class="align-middle">{{ address.co_name }}</td>\n                    <td class="align-middle" width="5%">\n                        <div class="d-grid gap-2 d-md-flex align-middle">                \n                            <button type="button" class="btn btn-outline-secondary btn-sm" @click="showEditModal(address.adresse_id)">\n                                <i class="fa fa-pen"></i>\n                            </button>\n                            <button type="button" class="btn btn-outline-secondary btn-sm" @click="showDeleteModal(address.adresse_id)">\n                                <i class="fa fa-xmark"></i>\n                            </button>\n                        </div>\n                    </td>\n                </tr>\n\n                </tbody>\n            </table>            \n        </div>\n\n        \x3c!-- Detail Modal --\x3e\n        <Modal :title="t(\'person\',\'adresse\')" ref="modalRef">\n            <template #body>\n                <form class="row g-3" v-if="currentAddress != null"  ref="addressDataFrm" >\n                               \n                    <div class="col-md-6">\n                        <label for="strasse" class="form-label">{{ t(\'person\',\'strasse\') }}</label>\n                        <input type="text" :readonly="readonly" class="form-control-sm" :class="{ \'form-control-plaintext\': readonly, \'form-control\': !readonly }" id="strasse" v-model="currentAddress.strasse" maxlength="256">\n                    </div>\n                    <div class="col-md-6">\n                        <label for="nation" class="form-label">Nation</label>\n                        <select  id="nation" class="form-select form-select-sm" aria-label=".form-select-sm "  v-model="currentAddress.nation" >\n                            <option v-for="(item, index) in nations" :value="item.nation_code" :class="{ \'grayout\': item.sperre}"  :disabled="item.sperre">\n                                {{ item.nation_text }}\n                            </option>\n                        </select>\n                        \n                    </div>\n                    <div class="col-md-2">\n                        <label for="plz" class="required form-label" >{{ t(\'person\',\'plz\') }}</label>\n                        <input type="text" required :readonly="readonly" @blur="frmState.plzBlured = true" class="form-control-sm" :class="{ \'form-control-plaintext\': readonly, \'form-control\': !readonly, \'is-invalid\': !validPLZ(currentAddress.plz) && frmState.plzBlured}" id="plz" maxlength="16" v-model="currentAddress.plz" >\n                    </div>\n                    <div class="col-md-4">\n                        <label for="ort" class="required form-label">{{ t(\'person\',\'ort\') }}</label>\n                        <input v-if="currentAddress.nation!=\'A\'" type="text" required :readonly="readonly" @blur="frmState.ortBlured = true" class="form-control-sm" :class="{ \'form-control-plaintext\': readonly, \'form-control\': !readonly, \'is-invalid\': !validOrt(currentAddress.ort) && frmState.ortBlured}" id="ort" maxlength="256" v-model="currentAddress.ort" >\n                        <select  v-if="currentAddress.nation==\'A\'" id="nation" class="form-select form-select-sm" aria-label=".form-select-sm "  v-model="currentAddress.ort" >\n                            <option v-for="(item, index) in ortschaften" :value="item.ortschaftsname">\n                                {{ item.ortschaftsname }}\n                            </option>\n                        </select>\n                    </div>\n                    \x3c!-- Gemeinde --\x3e\n                    <div class="col-md-6">\n                        <label for="gemeinde" class="form-label">{{ t(\'person\',\'gemeinde\') }}</label>\n                        <input v-if="currentAddress.nation!=\'A\'" type="text" :readonly="readonly" class="form-control-sm" :class="{ \'form-control-plaintext\': readonly, \'form-control\': !readonly }" id="gemeinde" maxlength="256" v-model="currentAddress.gemeinde">\n                        <select  v-if="currentAddress.nation==\'A\'" id="gemeinde" class="form-select form-select-sm" aria-label=".form-select-sm "  v-model="currentAddress.gemeinde" >\n                            <option v-for="(item, index) in gemeinden" :value="item.name">\n                                {{ item.name }}\n                            </option>\n                        </select>\n                    </div>\n\n                    \x3c!-- c/o --\x3e\n                    <div class="col-md-6">\n                        <label for="co_name" class="form-label">{{ t(\'person\',\'abweichenderEmpfaenger\') }}</label>\n                        <input type="text" :readonly="readonly" class="form-control-sm" :class="{ \'form-control-plaintext\': readonly, \'form-control\': !readonly }" id="co_name" maxlength="256" v-model="currentAddress.co_name">\n                    </div>\n\n                    \x3c!-- Adresstyp (Hauptwohnsitz, Nebenwohnsitz, etc.) --\x3e\n                    <div class="col-md-3">\n                        <label for="typ" class="required form-label">{{ t(\'global\',\'typ\') }}</label>\n                        <select  id="typ" class="form-select form-select-sm" aria-label=".form-select-sm " @blur="frmState.typBlured = true" v-model="currentAddress.typ" :class="{\'is-invalid\': !validTyp(currentAddress.typ) && frmState.typBlured}">\n                            <option v-for="(item, index) in adressentyp" :value="item.adressentyp_kurzbz">\n                                {{ item.bezeichnung }}\n                            </option>\n                        </select>\n                    </div>\n                    \n                    <div class="col-md-1">                                             \n                        <label for="heimatadresse" class="form-label">{{ t(\'person\',\'heimatadresse\') }}</label>\n                        <div>\n                            <input class="form-check-input" type="checkbox" id="heimatadresse" v-model="currentAddress.heimatadresse">\n                        </div>\n                    </div>\n                    <div class="col-md-1">\n                        <label for="zustelladresse" class="form-label">{{ t(\'person\',\'zustelladresse\') }}</label>\n                        <div>\n                            <input class="form-check-input" type="checkbox" id="zustelladresse" v-model="currentAddress.zustelladresse">\n                        </div>                        \n                    </div>\n                    \n                    \n                    <div class="col-8" v-if="currentAddress.adresse_id != 0">\n                        <div class="modificationdate">{{ currentAddress.insertamum }}/{{ currentAddress.insertvon }}, {{ currentAddress.updateamum }}/{{ currentAddress.updatevon }}</div>\n                    </div>\n                </form>        \n\n            </template>\n            <template #footer>\n                <button type="button" class="btn btn-primary" @click="okHandler()" >\n                    {{ t(\'ui\',\'speichern\') }}\n                </button>\n            </template>\n        </Modal>\n\n        \n        '},at={name:"EmailTelData",components:{Modal:Q,ModalDialog:W},props:{personID:{type:Number,required:!0},writePermission:{type:Boolean,required:!1}},setup(t){const e=Vue.inject("$api"),n=Vue.inject("$fhcAlert"),{personID:a}=Vue.toRefs(t),{t:r}=J();Vue.ref("");const s=Vue.ref([]),i=Vue.ref(!1),l=Vue.ref(),o=Vue.ref(),d=Vue.inject("kontakttyp"),u=Vue.ref(!1);Vue.watch(a,(t,e)=>{console.log("ContactData watch",t),c()});const c=async()=>{if(null!=a.value)try{const t=await e.call(Z.personContactData(a.value));s.value=t.data}catch(t){console.log(t)}finally{i.value=!1}else s.value=[]};Vue.onMounted(()=>{console.log("ContactData mounted",t.personID),c()});const p=Vue.computed(()=>Object.values(s.value));let h=Vue.ref();const f=()=>{h.value.hide()},v=Vue.ref(),m=Vue.reactive({kontaktBlured:!1,wasValidated:!1}),g=t=>!!t&&""!=t.trim(),b=()=>(m.kontaktBlured=!0,!!g(l.value.kontakt)),y=()=>{n.alertSuccess(r("person","kontaktdatenGespeichert"))},_=()=>{n.alertSuccess(r("person","kontaktdatenGeloescht"))};return{contactList:s,contactListArray:p,currentContact:l,showEditModal:t=>{l.value={...s.value[t]},h.value.show()},showAddModal:()=>{l.value={kontakt_id:0,person_id:a,kontakttyp:"email",anmerkung:"",kontakt:"",zustellung:!0,updateamum:"",updatevon:"",insertamum:"",insertvon:"",ext_id:null,standort_id:null},m.kontaktBlured=!1,h.value.show()},showDeleteModal:async t=>{if(l.value={...s.value[t]},!1!==await n.confirm({message:r("person","kontaktinformation")+" "+l.value?.kontakt+" "+r("person","wirklichLoeschen"),acceptLabel:"Löschen",acceptClass:"p-button-danger"}))try{const n=await e.call(Z.deletePersonContactData(t));"success"==n?.meta?.status&&(delete s.value[t],_())}catch(t){console.log(t)}finally{i.value=!1}},hideModal:f,modalRef:h,kontakttyp:d,confirmDeleteRef:o,okHandler:async()=>{if(b()){try{const t=await e.call(Z.upsertPersonContactData(l.value));"success"==t?.meta?.status&&(s.value[t.data[0].kontakt_id]=t.data[0],y())}catch(t){console.log(t)}finally{i.value=!1}f()}else console.log("form invalid")},t:r,getKontakttyp:t=>d.value.find(e=>e.kontakttyp==t),validKontakt:g,frmState:m,contactDataFrm:v,readonly:u}},template:'\n            <div class="row">\n\n                \x3c!--div class="d-flex bd-highlight">\n                    <div class="flex-grow-1 bd-highlight"></div>        \n                    <div class="p-2 bd-highlight">                   \n                        <button type="button" class="btn btn-outline-dark btn-sm"  @click="showAddModal()" style="margin-right:1.85rem;">\n                            <i class="fa fa-plus"></i>\n                        </button>\n                    </div>\n                </div--\x3e\n            </div>\n         \n             \n        <button type="button" class="btn btn-primary btn-sm my-2"  @click="showAddModal()">\n                <i class="fa fa-plus"></i> {{ t(\'global\',\'kontakt\') }}\n        </button>\n        <div class="table-responsive">\n            <table class="table table-hover table-sm">\n                <thead>\n                <tr>\n                    <th scope="col">{{ t(\'global\',\'typ\') }}</th>\n                    <th scope="col">{{ t(\'global\',\'kontakt\') }}</th>\n                    <th scope="col">{{ t(\'person\', \'zustellung\') }}</th>\n                    <th scope="col">{{ t(\'global\', \'anmerkung\') }}</th>\n                    <th scope="col">{{ t(\'ui\',\'aktion\') }}</th>\n                </tr>\n                </thead>\n                <tbody>               \n                    <tr v-for="contact in contactListArray" :key="contact.kontakt_id">\n                        <td class="align-middle">{{ getKontakttyp(contact.kontakttyp).beschreibung }}</td>\n                        <td class="align-middle" v-if="contact.kontakttyp == \'email\'"><a v-bind:href="[\'mailto:\' + contact.kontakt]">{{ contact.kontakt }}</a></td>\n                        <td class="align-middle" v-else-if="contact.kontakttyp == \'mobil\' || contact.kontakttyp == \'telefon\' || contact.kontakttyp == \'firmenhandy\'"><a v-bind:href="[\'tel:\' + contact.kontakt]">{{ contact.kontakt }}</a></td>\n                        <td class="align-middle" v-else >{{ contact.kontakt }}</td>\n                        <td class="align-middle">{{ contact.zustellung == true ? "X" : "" }}</td>\n                        <td class="align-middle">{{ contact.anmerkung }}</td>\n                        <td class="align-middle" width="5%">\n                            <div class="d-grid gap-2 d-md-flex align-middle">           \n                                <button type="button" class="btn btn-outline-secondary btn-sm" @click="showEditModal(contact.kontakt_id)">\n                                    <i class="fa fa-pen"></i>\n                                </button>\n                                <button type="button" class="btn btn-outline-secondary btn-sm" @click="showDeleteModal(contact.kontakt_id)">\n                                    <i class="fa fa-xmark"></i>\n                                </button>\n                            </div>\n                        </td>\n                    </tr>\n                </tbody>\n            </table>\n        </div>\n\n        \x3c!-- Detail Modal --\x3e\n        <Modal :title="t(\'global\',\'kontakt\')" ref="modalRef">\n            <template #body>\n                <form class="row g-3" v-if="currentContact != null"  ref="contactDataFrm" >\n                                \n                    <div class="col-md-4">\n                        <label for="kontakttyp" class="form-label">{{ t(\'global\',\'typ\') }}</label>\n                        <select  id="kontakttyp" class="form-select form-select-sm" aria-label=".form-select-sm "  v-model="currentContact.kontakttyp" >\n                            <option v-for="(item, index) in kontakttyp" :value="item.kontakttyp">\n                                {{ item.beschreibung }}\n                            </option>\n                        </select>\n                    </div>\n                    <div class="col-md-4">\n                        <label for="kontakt" class="required form-label">{{ t(\'global\',\'kontakt\') }}</label>\n                        <input type="text" @blur="frmState.kontaktBlured = true" :readonly="readonly" class="form-control-sm" :class="{ \'form-control-plaintext\': readonly, \'form-control\': !readonly, \'is-invalid\': !validKontakt(currentContact.kontakt) && frmState.kontaktBlured}" id="kontakt" maxlength="128" v-model="currentContact.kontakt">\n                    </div>\n                    \n                    <div class="col-md-2">                                             \n                        <label for="zustellung" class="form-label">{{ t(\'person\',\'zustellung\') }}</label>\n                        <div>\n                            <input class="form-check-input" type="checkbox" id="zustellung" v-model="currentContact.zustellung">\n                        </div>\n                    </div>      \n                    \n                    <div class="col-md-8">\n                        <label for="anmerkung" class="form-label">{{ t(\'global\',\'anmerkung\') }}</label>\n                        <input type="text" :readonly="readonly" class="form-control-sm" :class="{ \'form-control-plaintext\': readonly, \'form-control\': !readonly }" id="anmerkung" maxlength="64" v-model="currentContact.anmerkung">\n                    </div>                                                            \n\n                </form>        \n\n            </template>\n            <template #footer>\n                <button type="button" class="btn btn-primary" @click="okHandler()" >\n                {{ t(\'ui\',\'speichern\') }}\n                </button>\n            </template>\n        </Modal>\n\n    '},rt={name:"ContactData",components:{AddressData:nt,EmailTelData:at},props:{modelValue:{type:Object,default:()=>({}),required:!1},config:{type:Object,default:()=>({}),required:!1},editMode:{type:Boolean,required:!1},personID:{type:Number,required:!1},personUID:{type:String,required:!1},writePermission:{type:Boolean,required:!1}},setup(t){const{t:e}=J(),n=Vue.computed({get:()=>t.modelValue,set:t=>emit("update:modelValue",t)}),a=Vue.ref("address");return{items:["address","contact"],isActive:t=>a.value===t,setActive:t=>{a.value=t,console.log("activeItem: ",t)},t:e,theModel:n}},template:'\n        <div class="row pt-md-4">\n            <div class="col">\n                <div class="card">\n                    <div class="card-header">\n                        <div class="h5"><h5>{{ t(\'person\', \'kontaktdaten\') }}</h5></div>        \n                    </div>\n                    <div class="card-body">\n                        <div class="col-md-12 d-flex flex-column align-items-start pt-3 pb-2 mb-3">\n                            <ul class="nav nav-tabs" style="width: 100%">\n                                <li class="nav-item">\n                                    <a\n                                    class="nav-link"\n                                    :class="{ active: isActive(items[0]) }"\n                                    @click.prevent="setActive(items[0])"\n                                    href="#"\n                                    >{{ t(\'person\',\'adressen\') }}</a\n                                    >\n                                </li>\n                                <li class="nav-item">\n                                    <a\n                                    class="nav-link"\n                                    :class="{ active: isActive(items[1]) }"\n                                    @click.prevent="setActive(items[1])"\n                                    href="#"\n                                    >{{ t(\'global\',\'kontakt\') }}</a\n                                    >\n                                </li>\n                            </ul>\n                \n                            <div class="tab-content py-3" style="width: 100%" id="nav-tabContent">\n                            <div\n                                class="tab-pane fade"\n                                :class="{ \'active show\': isActive(\'address\') }"\n                                id="nav-address"\n                                role="tabpanel"\n                                aria-labelledby="nav-home-tab"\n                            >\n                                \x3c!-- --\x3e\n                                <address-data :personID="theModel.personID" ></address-data>\n                                \x3c!-- --\x3e\n                            </div>\n                            <div\n                                class="tab-pane fade"\n                                :class="{ \'active show\': isActive(\'contact\') }"\n                                id="nav-contact"\n                                role="tabpanel"\n                                aria-labelledby="nav-profile-tab"\n                            >\n                                \x3c!-- --\x3e\n                                <email-tel-data :personID="theModel.personID" ></email-tel-data>\n                                \x3c!-- --\x3e\n                            </div>\n                        </div>\n                        </div>\n                    </div> \x3c!--.card-body--\x3e\n                </div>\n            </div>\n        </div>\n\n\n'},st={name:"MaterialExpensesData",components:{Modal:Q,ModalDialog:W,datepicker:VueDatePicker},props:{modelValue:{type:Object,default:()=>({}),required:!1},config:{type:Object,default:()=>({}),required:!1},writePermission:{type:Boolean,required:!1}},setup(t){const e=Vue.inject("$api"),n=Vue.inject("$fhcAlert"),a=Vue.ref(!1),{t:r}=J(),s=new Intl.NumberFormat("de-AT",{minimumFractionDigits:2}),i=Vue.computed({get:()=>t.modelValue,set:t=>emit("update:modelValue",t)});Vue.ref("");const l=Vue.ref();Vue.ref("");const o=Vue.ref(!1),d=Vue.ref([]),u=Vue.inject("sachaufwandtyp");FHC_JS_DATA_STORAGE_OBJECT.app_root,FHC_JS_DATA_STORAGE_OBJECT.ci_router;const c=async()=>{if(null!=i.value.personID||null!=t.personID){o.value=!0;try{const t=await e.call(Z.personMaterialExpenses(i.value.personID,i.value.personUID));d.value=t.data}catch(t){n.handleSystemError(t)}finally{o.value=!1}}else d.value=[]},p=()=>({sachaufwand_id:0,mitarbeiter_uid:i.value.personUID,sachaufwandtyp_kurzbz:"",beginn:"",ende:"",anmerkung:"",betrag:""}),h=Vue.ref(p()),f=Vue.ref(p());Vue.watch([i],([t,e])=>{c()});Vue.onMounted(()=>{h.value=p(),c()});const v=Vue.computed(()=>d.value?Object.values(d.value):[]),m=Vue.ref(),g=Vue.ref(),b=()=>{m.value.hide()},y=Vue.ref(),_=Vue.reactive({beginnBlurred:!1,wasValidated:!1}),k=t=>!!t&&""!=t.trim(),A=t=>null===t||""===t||!!t.match(/^[0-9]{1,7}(,[0-9]{0,2})?$/),x=()=>{let t=!0;return _.beginnBlurred=!0,k(h.value.beginn)||(t=!1),_.betragBlurred=!0,A(h.value.betrag)||(t=!1),t},w=Vue.computed(()=>Object.keys(h.value).some(t=>h.value[t]!==f.value[t])),z=t=>{let e=u.value.filter(e=>e.sachaufwandtyp_kurzbz==t);return e.length>0?e[0].bezeichnung:""},S=()=>{n.alertSuccess(r("person","sachaufwandGespeichert"))},C=()=>{n.alertSuccess(r("person","sachaufwandGeloescht"))};return{materialdataList:d,materialdataListArray:v,currentValue:h,readonly:a,frmState:_,dialogRef:l,materialDataFrm:y,modalRef:m,types:u,toggleMode:async()=>{if(a.value)f.value={...h.value};else if(w.value){const t=await l.value.show();if(!t)return;console.log("ok=",t),h.value=f.value}a.value=!a.value},validBeginn:k,validBetrag:A,formatDate:t=>null!=t&&""!=t?t.substring(8,10)+"."+t.substring(5,7)+"."+t.substring(0,4):"",showToast:S,showDeletedToast:C,showAddModal:()=>{h.value=p(),_.beginnBlurred=!1,_.betragBlurred=!1,m.value.show()},hideModal:b,okHandler:async()=>{if(x()){try{null!==h.value.betrag&&(h.value.betrag=String(h.value.betrag).replace(",","."));const t=await e.call(Z.upsertPersonMaterialExpenses(h.value));"success"==t.meta.status&&(d.value[t.data[0].sachaufwand_id]=t.data[0],console.log("materialdata successfully saved"),S())}catch(t){n.handleSystemError(t)}finally{o.value=!1}b()}else console.log("form invalid")},showDeleteModal:async t=>{if(h.value={...d.value[t]},null!==h.value.betrag&&(h.value.betrag=String(h.value.betrag).replace(".",",")),!1!==await n.confirm({message:r("person","sachaufwand")+" "+z(h.value?.sachaufwandtyp_kurzbz)+" "+r("person","wirklichLoeschen"),acceptLabel:"Löschen",acceptClass:"p-button-danger"}))try{"success"==(await e.call(Z.deletePersonMaterialExpenses(t))).meta.status&&(delete d.value[t],C())}catch(t){n.handleSystemError(t)}finally{o.value=!1}},showEditModal:t=>{h.value={...d.value[t]},delete h.value.bezeichnung,null!==h.value.betrag&&(h.value.betrag=String(h.value.betrag).replace(".",",")),m.value.show()},confirmDeleteRef:g,t:r,getType:z,formatNumber:t=>{let e=parseFloat(t);return isNaN(e)?"":s.format(parseFloat(t))}}},template:'\n    <div class="row">        \n    </div>\n    <div class="row pt-md-4">      \n         <div class="col">\n             <div class="card">\n                <div class="card-header">\n                    <div class="h5"><h5>{{ t(\'person\',\'sachaufwand\') }}</h5></div>        \n                </div>\n\n                <div class="card-body">\n                    <div class="d-grid d-md-flex justify-content-start py-2">\n                        <button type="button" class="btn btn-sm btn-primary" @click="showAddModal()">\n                        <i class="fa fa-plus"></i> {{ t(\'person\',\'sachaufwand\') }}\n                        </button>            \n                    </div>\n                    <div class="table-responsive">\n                        <table class="table table-hover table-sm">\n                            <thead>                \n                            <tr>\n                                <th scope="col">{{ t(\'global\',\'typ\') }}</th>\n                                <th scope="col">{{ t(\'ui\',\'from\') }}</th>\n                                <th scope="col">{{ t(\'global\',\'bis\') }}</th>\n                                <th scope="col">{{ t(\'ui\',\'betrag\') }}</th>\n                                <th scope="col">{{ t(\'global\',\'anmerkung\') }}</th>\n                            </tr>\n                            </thead>\n                            <tbody>\n                            <tr v-for="materialdata in materialdataListArray" :key="materialdata.sachaufwand_id">\n                                <td class="align-middle">{{ getType(materialdata.sachaufwandtyp_kurzbz) }}</td>\n                                <td class="align-middle">{{ formatDate(materialdata.beginn) }}</td>\n                                <td class="align-middle">{{ formatDate(materialdata.ende) }}</td>\n                                <td class="align-middle">{{ formatNumber(materialdata.betrag) }}</td>\n                                <td class="align-middle">{{ materialdata.anmerkung }}</td>\n                                <td class="align-middle" width="5%">\n                                    <div class="d-grid gap-2 d-md-flex align-middle">\n                                        <button type="button" class="btn btn-outline-secondary btn-sm" @click="showEditModal(materialdata.sachaufwand_id)">\n                                            <i class="fa fa-pen"></i>\n                                        </button>\n                                        <button type="button" class="btn btn-outline-secondary btn-sm" @click="showDeleteModal(materialdata.sachaufwand_id)">\n                                            <i class="fa fa-xmark"></i>\n                                        </button>\n                                    </div>\n                                </td>\n                            </tr>\n                \n                            </tbody>\n                        </table>            \n                    </div>\n                </div>\n             </div>\n         </div>\n    </div>\n            \n\n    \x3c!-- detail modal --\x3e\n    <Modal :title="t(\'person\',\'sachaufwand\')" ref="modalRef">\n        <template #body>\n            <form class="row g-3" ref="materialDataFrm">\n                            \n                <div class="col-md-4">\n                    <label for="sachaufwandtyp_kurzbz" class="form-label">{{ t(\'global\',\'typ\') }}</label><br>\n                    <select v-if="!readonly" id="sachaufwandtyp_kurzbz" v-model="currentValue.sachaufwandtyp_kurzbz" class="form-select form-select-sm" aria-label=".form-select-sm " >\n                        <option v-for="(item, index) in types" :value="item.sachaufwandtyp_kurzbz">\n                            {{ item.bezeichnung }}\n                        </option>                       \n                    </select>\n                    <input v-else type="text" readonly class="form-control-sm form-control-plaintext" id="sachaufwandtyp_kurzbz" :value="currentValue.sachaufwandtyp_kurzbz">\n                </div>\n                \x3c!--  --\x3e\n                <div class="col-md-3">\n                    <label for="beginn" class="required form-label">{{ t(\'ui\',\'from\') }}</label>\n                    <datepicker id="beginn" \n                        :teleport="true" \n                        @blur="frmState.beginnBlurred = true" \n                        :input-class-name="(!validBeginn(currentValue.beginn) && frmState.beginnBlurred) ? \'dp-invalid-input\' : \'\'"  \n                        v-model="currentValue.beginn"\n                        v-bind:enable-time-picker="false"\n                        text-input \n                        locale="de"\n                        format="dd.MM.yyyy"\n                        auto-apply \n                        model-type="yyyy-MM-dd"></datepicker>\n                </div>\n                <div class="col-md-3">\n                    <label for="ende" class="form-label">{{ t(\'global\',\'bis\') }}</label>\n                    <datepicker id="ende" \n                        :teleport="true" \n                        v-model="currentValue.ende"\n                        v-bind:enable-time-picker="false"\n                        text-input \n                        locale="de"\n                        format="dd.MM.yyyy"\n                        auto-apply \n                        model-type="yyyy-MM-dd"></datepicker>\n                </div>\n                <div class="col-md-2">\n                </div>\n                \x3c!-- --\x3e\n                <div class="col-md-3">\n                    <label for="betrag" class="form-label">{{ t(\'ui\',\'betrag\') }}</label>\n\t\t\t\t\t<input type="text" :readonly="readonly" @blur="frmState.betragBlurred = true" class="form-control-sm" :class="{ \'form-control-plaintext\': readonly, \'form-control\': !readonly, \'dp-invalid-input\': (!validBetrag(currentValue.betrag) && frmState.betragBlurred)}" id="betrag" v-model="currentValue.betrag">\n                </div>\n                <div class="col-md-7">\n                    <label for="uid" class="form-label">{{ t(\'global\',\'anmerkung\') }}</label>\n                    <input type="text"  :readonly="readonly" class="form-control-sm" :class="{ \'form-control-plaintext\': readonly, \'form-control\': !readonly}" id="bank" v-model="currentValue.anmerkung">\n                </div>\n                <div class="col-md-2">\n                </div>\n                \n                \x3c!-- changes --\x3e\n                <div class="col-8">\n                    <div class="modificationdate">{{ currentValue.insertamum }}/{{ currentValue.insertvon }}, {{ currentValue.updateamum }}/{{ currentValue.updatevon }}</div>\n                </div>\n                \n            </form>\n        </template>\n        <template #footer>\n            <button type="button" class="btn btn-primary" @click="okHandler()" >\n                {{ t(\'ui\',\'speichern\') }}\n            </button>\n        </template>\n\n    </Modal>\n\n    <ModalDialog :title="t(\'global\',\'warnung\')" ref="dialogRef">\n      <template #body>\n        {{ t(\'person\',\'sachaufwandNochNichtGespeichert\') }}\n      </template>\n    </ModalDialog>\n\n    <ModalDialog :title="t(\'global\',\'warnung\')" ref="confirmDeleteRef">\n        <template #body>\n            {{ t(\'person\',\'sachaufwand\') }} \'{{ getType(currentValue?.sachaufwandtyp_kurzbz) }} ({{ currentValue?.beginn }}-{{ currentValue?.ende }})\' {{ t(\'person\', \'wirklichLoeschen\') }}?\n        </template>\n    </ModalDialog>\n    '},it={name:"Toast",props:{title:{text:String,default:"<<Text goes here>>"},type:{text:String,default:"success"}},expose:["show","hide"],setup(t){let e,n=Vue.ref(null);Vue.onMounted(()=>{e=new bootstrap.Toast(n.value)});const a=Vue.computed(()=>"success"==t.type?"bg-primary":"bg-danger");return{show:()=>{e.show()},hide:()=>{e.hide()},toastEle:n,backgroundColor:a}},template:'\n    <div class="toast align-items-center text-white border-0 " :class="backgroundColor" role="alert" aria-live="assertive" aria-atomic="true" ref="toastEle">\n        <div class="d-flex">\n            <div class="toast-body">\n            <slot name="body"></slot>\n            </div>\n            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>\n        </div>\n    </div>'};var lt={getStundensaetze:t=>({method:"post",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/PersonAPI/getStundensaetze/"+t,params:t}),deleteStundensatz:t=>({method:"post",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/PersonAPI/deleteStundensatz",params:{stundensatz_id:t}}),updateStundensatz:t=>({method:"post",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/PersonAPI/updateStundensatz",params:t})};const ot={name:"HourlyRateData",components:{Modal:Q,ModalDialog:W,Toast:it,datepicker:VueDatePicker},props:{modelValue:{type:Object,default:()=>({}),required:!1},config:{type:Object,default:()=>({}),required:!1},writePermission:{type:Boolean,required:!1}},setup(t){const e=Vue.inject("$api"),n=Vue.inject("$fhcAlert"),{t:a}=J(),r=Vue.computed({get:()=>t.modelValue,set:t=>emit("update:modelValue",t)}),s=Vue.ref(!1),i=Vue.ref(!1),l=Vue.ref([]),o=Vue.ref(),d=Vue.inject("hourlyratetypes"),u=Vue.inject("unternehmen"),c=async()=>{if(null!=r.value.personUID){i.value=!0;try{const t=await e.call(lt.getStundensaetze(r.value.personUID));l.value=t.data}catch(t){n.handleSystemError(t)}finally{i.value=!1}}else l.value=[]},p=()=>({stundensatz_id:0,uid:r.value.personUID,stundensatztyp:"",stundensatz:"",oe_kurzbz:"",gueltig_von:"",gueltig_bis:""}),h=Vue.ref(p()),f=Vue.ref(p());Vue.watch(r,(t,e)=>{c()}),Vue.onMounted(()=>{h.value=p(),c()});const v=Vue.computed(()=>l.value?Object.values(l.value):[]),m=Vue.ref(),g=Vue.ref(),b=()=>{m.value.hide()},y=Vue.ref(),_=Vue.reactive({beginnBlurred:!1,typBlurred:!1,bisBlurred:!1,satzBlurred:!1,unternehmenBlurred:!1,wasValidated:!1}),k=t=>!!t&&""!=t.trim(),A=t=>void 0!==t&&""!==t,x=(t,e)=>""!==t&&""!==e&&null!==e&&null!==t?(t=new Date(t),(e=new Date(e))>=t?(_.bisBlurred=!1,!0):(_.bisBlurred=!0,!1)):(_.bisBlurred=!1,!0),w=()=>(_.beginnBlurred=!0,_.typBlurred=!0,_.satzBlurred=!0,_.unternehmenBlurred=!0,!!(k(h.value.gueltig_von)&&A(h.value.stundensatz)&&A(h.value.stundensatztyp)&&A(h.value.oe_kurzbz)&&x(h.value.gueltig_von,h.value.gueltig_bis))),z=()=>{n.alertSuccess(a("person","stundensatzGespeichert"))},S=()=>{n.alertSuccess(a("person","stundensatzGeloescht"))};return{hourlyRatedataList:l,houryratedataListArray:v,currentValue:h,readonly:s,frmState:_,dialogRef:o,houryrateDataFrm:y,modalRef:m,types:d,unternehmen:u,validBeginn:k,validInput:A,checkDates:x,formatDate:t=>null!=t&&""!=t?t.substring(8,10)+"."+t.substring(5,7)+"."+t.substring(0,4):"",showToast:z,showDeletedToast:S,showAddModal:()=>{h.value=p(),_.beginnBlurred=!1,_.bisBlurred=!1,_.typBlurred=!1,_.satzBlurred=!1,_.unternehmenBlurred=!1,m.value.show()},hideModal:b,okHandler:async()=>{if(w()){try{const t=await e.call(lt.updateStundensatz(h.value));"success"===t.meta.status&&(l.value[t.data[0].stundensatz_id]=t.data[0],f.value=h.value,z())}catch(t){n.handleSystemError(t)}finally{i.value=!1}b()}else console.log("form invalid")},showDeleteModal:async t=>{if(h.value={...l.value[t]},!1!==await n.confirm({message:a("person","stundensatzWirklichLoeschen")+" "+h.value?.stundensatztyp+" "+a("person","wirklichLoeschen"),acceptLabel:"Löschen",acceptClass:"p-button-danger"}))try{"success"===(await e.call(lt.deleteStundensatz(t))).meta.status&&(delete l.value[t],S())}catch(t){n.handleSystemError(t)}finally{i.value=!1}},showEditModal:t=>{h.value={...l.value[t]},m.value.show()},confirmDeleteRef:g,t:a}},template:'\n\t<div class="row">\n\t</div>\n\t<div class="row pt-md-4">\n\t\t <div class="col">\n\t\t\t <div class="card">\n\t\t\t\t<div class="card-header">\n\t\t\t\t\t<div class="h5"><h5>{{ t(\'person\',\'stundensaetze\') }}</h5></div>        \n\t\t\t\t</div>\n\n\t\t\t\t<div class="card-body">\n\t\t\t\t\t<div class="d-grid d-md-flex justify-content-start py-2">\n\t\t\t\t\t\t<button type="button" class="btn btn-sm btn-primary" @click="showAddModal()">\n\t\t\t\t\t\t<i class="fa fa-plus"></i> {{ t(\'ui\',\'stundensatz\') }}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="table-responsive">\n\t\t\t\t\t\t<table class="table table-hover table-sm">\n\t\t\t\t\t\t\t<thead>                \n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<th scope="col">{{ t(\'global\',\'typ\') }}</th>\n\t\t\t\t\t\t\t\t<th scope="col">{{ t(\'ui\',\'from\') }}</th>\n\t\t\t\t\t\t\t\t<th scope="col">{{ t(\'global\',\'bis\') }}</th>\n\t\t\t\t\t\t\t\t<th scope="col">{{ t(\'core\',\'unternehmen\') }}</th>\n\t\t\t\t\t\t\t\t<th scope="col">{{ t(\'ui\',\'stundensatz\') }}</th>\n\t\t\t\t\t\t\t\t<th scope="col"></th>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t</thead>\n\t\t\t\t\t\t\t<tbody>\n\t\t\t\t\t\t\t<tr v-for="hourlyratedata in houryratedataListArray" :key="hourlyratedata.stundensatz_id">\n\t\t\t\t\t\t\t\t<td class="align-middle">{{ hourlyratedata.stundensatztyp }}</td>\n\t\t\t\t\t\t\t\t<td class="align-middle">{{ formatDate(hourlyratedata.gueltig_von) }}</td>\n\t\t\t\t\t\t\t\t<td class="align-middle">{{ formatDate(hourlyratedata.gueltig_bis) }}</td>\n\t\t\t\t\t\t\t\t<td class="align-middle">{{ hourlyratedata.oe_kurzbz }}</td>\n\t\t\t\t\t\t\t\t<td class="align-middle">{{ hourlyratedata.stundensatz }}</td>\n\t\t\t\t\t\t\t\t<td class="align-middle" width="5%">\n\t\t\t\t\t\t\t\t\t<div class="d-grid gap-2 d-md-flex align-middle">\n\t\t\t\t\t\t\t\t\t\t<button type="button" class="btn btn-outline-secondary btn-sm" @click="showEditModal(hourlyratedata.stundensatz_id)">\n\t\t\t\t\t\t\t\t\t\t\t<i class="fa fa-pen"></i>\n\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t<button type="button" class="btn btn-outline-secondary btn-sm" @click="showDeleteModal(hourlyratedata.stundensatz_id)">\n\t\t\t\t\t\t\t\t\t\t\t<i class="fa fa-xmark"></i>\n\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t</tbody>\n\t\t\t\t\t\t</table>            \n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t </div>\n\t\t </div>\n\t</div>\n\n\t\x3c!-- detail modal --\x3e\n\t<Modal :title="t(\'ui\',\'stundensatz\')" ref="modalRef" class="stundensatzModal">\n\t\t<template #body>\n\t\t\t<form class="row g-3" ref="houryrateDataFrm">\n\t\t\t\t\t\t\t\n\t\t\t\t<div class="col-md-4">\n\t\t\t\t\t<label for="stundensatztyp" class="required form-label">{{ t(\'global\',\'typ\') }}</label><br>\n\t\t\t\t\t<select v-if="!readonly" id="stundensatztyp" @blur="frmState.typBlurred = true"  :class="{ \'form-control-plaintext\': readonly, \'form-control\': !readonly, \'is-invalid\': !validInput(currentValue.stundensatztyp) && frmState.typBlurred}" v-model="currentValue.stundensatztyp" class="form-select form-select-sm" aria-label=".form-select-sm " >\n\t\t\t\t\t\t<option v-for="(item, index) in types" :value="item.stundensatztyp">\n\t\t\t\t\t\t\t{{ item.bezeichnung }}\n\t\t\t\t\t\t</option>                       \n\t\t\t\t\t</select>\n\t\t\t\t\t<input v-else type="text" readonly class="form-control-sm form-control-plaintext" id="stundensatztyp" :value="currentValue.stundensatztyp">\n\t\t\t\t</div>\n\t\t\t\t<div class="col-md-3">\n\t\t\t\t\t<label for="beginn" class="required form-label">{{ t(\'ui\',\'from\') }}</label>\n\t\t\t\t\t<datepicker id="beginn"\n\t\t\t\t\t\t@blur="frmState.beginnBlurred = true"\n\t\t\t\t\t\tv-bind:enable-time-picker="false"\n\t\t\t\t\t\t:input-class-name="(!validBeginn(currentValue.gueltig_von) && frmState.beginnBlurred) ? \'dp-invalid-input\' : \'\'"\t\t\t\t\t\t\n\t\t\t\t\t\tv-model="currentValue.gueltig_von"\n\t\t\t\t\t\ttext-input \n\t\t\t\t\t\tlocale="de"\n\t\t\t\t\t\tformat="dd.MM.yyyy"\n\t\t\t\t\t\tauto-apply \n\t\t\t\t\t\tmodel-type="yyyy-MM-dd"\n\t\t\t\t\t></datepicker>\n\t\t\t\t</div>\n\t\t\t\t<div class="col-md-3">\n\t\t\t\t\t<label for="ende" class="form-label">{{ t(\'global\',\'bis\') }}</label>\n\t\t\t\t\t<datepicker id="ende"\n\t\t\t\t\t\t@blur="frmState.bisBlurred = true"\n\t\t\t\t\t\tv-bind:enable-time-picker="false"\n\t\t\t\t\t\tv-model="currentValue.gueltig_bis"\n\t\t\t\t\t\ttext-input \n\t\t\t\t\t\tlocale="de"\n\t\t\t\t\t\tformat="dd.MM.yyyy"\n\t\t\t\t\t\tauto-apply \n\t\t\t\t\t\tmodel-type="yyyy-MM-dd"\n\t\t\t\t\t></datepicker>\n\t\t\t\t</div>\n\t\t\t\t<div class="col-md-2">\n\t\t\t\t</div>\n\t\t\t\t\x3c!-- --\x3e\n\t\t\t   <div class="col-md-4">\n\t\t\t\t\t<label for="stundensatz" class="required form-label">{{ t(\'ui\',\'stundensatz\') }}</label>\n\t\t\t\t\t<input type="number" :readonly="readonly" @blur="frmState.satzBlurred = true" class="form-control-sm" :class="{ \'form-control-plaintext\': readonly, \'form-control\': !readonly, \'is-invalid\': !validInput(currentValue.stundensatz) && frmState.satzBlurred}" id="stundensatz" v-model="currentValue.stundensatz">\n\t\t\t\t</div>\n\t\t\t  \n\t\t\t   <div class="col-md-4">\n\t\t\t\t\t<label for="unternehmen" class="required form-label">{{ t(\'core\',\'unternehmen\') }}</label><br>\n\t\t\t\t\t<select v-if="!readonly" id="unternehmen" @blur="frmState.unternehmenBlurred = true"  :class="{ \'form-control-plaintext\': readonly, \'form-control\': !readonly, \'is-invalid\': !validInput(currentValue.oe_kurzbz) && frmState.unternehmenBlurred}" v-model="currentValue.oe_kurzbz" class="form-select form-select-sm" aria-label=".form-select-sm " >\n\t\t\t\t\t\t<option v-for="(item, index) in unternehmen" :value="item.value">\n\t\t\t\t\t\t\t{{ item.label }}\n\t\t\t\t\t\t</option>                       \n\t\t\t\t\t</select>\n\t\t\t\t\t<input v-else type="text" readonly class="form-control-sm form-control-plaintext" id="unternehmen" :value="currentValue.oe_kurzbz">\n\t\t\t\t</div>\n\t\t\t   \n\t\t\t\t\n\t\t\t\t\x3c!-- changes --\x3e\n\t\t\t\t<div class="col-8">\n\t\t\t\t\t<div class="modificationdate">{{ currentValue.insertamum }}/{{ currentValue.insertvon }}, {{ currentValue.updateamum }}/{{ currentValue.updatevon }}</div>\n\t\t\t\t</div>\n\t\t\t\t\n\t\t\t</form>\n\t\t</template>\n\t\t<template #footer>\n\t\t\t<button type="button" class="btn btn-primary" @click="okHandler()" >\n\t\t\t\t{{ t(\'ui\',\'speichern\') }}\n\t\t\t</button>\n\t\t</template>\n\n\t</Modal>\n\n\t<ModalDialog :title="t(\'global\',\'warnung\')" ref="dialogRef">\n\t  <template #body>\n\t  \t{{ t(\'person\',\'stundensatzNochNichtGespeichert\') }}\n\t  </template>\n\t</ModalDialog>\n\n\t'};var dt={getOrgStructure:t=>({method:"get",url:`/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/OrgAPI/getOrgStructure?oe=${t}`}),getOrgPersonen:t=>({method:"get",url:`/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/OrgAPI/getOrgPersonen?oe=${t}`}),getOrgHeads:()=>({method:"get",url:"extensions/FHC-Core-Personalverwaltung/api/frontend/v1/OrgAPI/getOrgHeads"})};const ut={name:"OrgChooser",props:{placeholder:String,customClass:String,oe:String},emits:["orgSelected"],setup(t,{emit:e}){const n=Vue.ref([]),a=Vue.ref(!1),r=Vue.toRefs(t).oe,s=Vue.ref(),i=Vue.inject("$api");Vue.onMounted(()=>{(async()=>{a.value=!0;try{const r=await i.call(dt.getOrgHeads());n.value=r.data,n.value.length>0&&((null==t.oe||null!=t.oe&&""==t.oe)&&(s.value=n.value[0].oe_kurzbz),e("orgSelected",s.value)),a.value=!1}catch(t){console.log(t),a.value=!1}})()});return Vue.watch(r,(t,e)=>{console.log("prop value changed",t),s.value=t}),{orgList:n,selected:s,orgSelected:t=>{e("orgSelected",t.target.value)}}},template:'\n    <select  id="orgHeadChooser" v-model="selected" @change="orgSelected" class="form-control-sm" aria-label=".form-select-sm " >\n        <option v-for="(item, index) in orgList" :value="item.oe_kurzbz"  :key="item.oe_kurzbz">\n            {{ item.bezeichnung }}\n        </option>         \n    </select>\n    '};var ct={getContractFunctions(t){var e="/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/FunctionsAPI/getContractFunctions";return null!=t&&(e=e+"/"+t),{method:"get",url:e}},getOrgetsForCompany:t=>({method:"get",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/OrgAPI/getOrgetsForCompany/"+t}),getCompanyByOrget:t=>({method:"get",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/OrgAPI/getCompanyByOrget/"+t}),getCurrentFunctions:(t,e)=>({method:"get",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/FunctionsAPI/getCurrentFunctions/"+t+"/"+e}),getAllUserFunctions:t=>({method:"get",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/FunctionsAPI/getAllUserFunctions/"+t}),getAllFunctions:()=>({method:"get",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/FunctionsAPI/getAllFunctions"})};const pt={name:"JobFunction",components:{Modal:Q,ModalDialog:W,OrgChooser:ut,datepicker:VueDatePicker},props:{modelValue:{type:Object,default:()=>({}),required:!1},config:{type:Object,default:()=>({}),required:!1},readonlyMode:{type:Boolean,required:!1,default:!1},personID:{type:Number,required:!1},personUID:{type:String,required:!1},writePermission:{type:Boolean,required:!1}},emits:["updateHeader"],setup(t,{emit:e}){const n=Vue.inject("$api"),a=Vue.inject("$fhcAlert"),r=Vue.ref(!1),{t:s}=J(),i=Vue.computed(()=>t.personID),l=Vue.computed(()=>t.personUID),o=Vue.ref(),d=Vue.ref(!1),u=Vue.computed({get:()=>t.modelValue,set:t=>e("update:modelValue",t)}),c=Vue.ref(),p=Vue.ref([]),h=Vue.ref([]),f=Vue.ref([{value:"",label:"-"}]),v=Vue.ref(!0),m=Vue.ref(null),g=Vue.ref(null),b=Vue.reactive([]);FHC_JS_DATA_STORAGE_OBJECT.app_root,FHC_JS_DATA_STORAGE_OBJECT.ci_router;const y=!0!==t.readonlyMode?VueRouter.useRoute():null,_=(t,e)=>t.reduce((t,n)=>({...t,[n[e]]:n}),{}),k=async()=>{if(null!=i.value||null!=u.value.personID){d.value=!0;try{const t=await n.call(ct.getAllUserFunctions(u.value.personUID||l.value));if("success"!=t.meta.status){let t=[];b.value=[],p.value=_(t,"benutzerfunktion_id")}else{let e=t.data;b.value=t.data,p.value=_(e,"benutzerfunktion_id")}}catch(t){console.log(t)}finally{d.value=!1}}else p.value=[]},A=()=>({benutzerfunktion_id:0,uid:u.value.personUID||l.value,oe_kurzbz:"",funktion_kurzbz:"",datum_von:"",datum_bis:"",bezeichnung:"",wochenstunden:0}),x=Vue.ref(A()),w=Vue.ref(A());Vue.watch([i,l],([t,e])=>{k()}),Vue.watch(c,t=>{I(t),R()});Vue.onMounted(async()=>{x.value=A(),await k();const e=t=>t.getValue()?.replace(/(.*)-(.*)-(.*)/,"$3.$2.$1"),n=(t,e)=>{const n=document.createElement("button"),a=document.createAttribute("class");a.value="btn btn-outline-secondary btn-sm",n.setAttributeNode(a),n.addEventListener("click",e);const r=document.createElement("i"),s=document.createAttribute("class");return s.value=t,r.setAttributeNode(s),n.appendChild(r),n},a=t=>{const e=document.createElement("div"),a=document.createAttribute("class");a.value="d-grid gap-2 d-md-flex justify-content-end align-middle",e.setAttributeNode(a);const r=n("fa fa-xmark",()=>{V(t.getValue())}),s=n("fa fa-pen",()=>{F(t.getValue())});return null===t.getRow().getData().dienstverhaeltnis_unternehmen&&(e.appendChild(s),e.appendChild(r)),e},r=[{title:s("person","dv_unternehmen"),field:"dienstverhaeltnis_unternehmen",formatter:e=>{if(!0===t.readonlyMode)return null!=e.getValue()?e.getValue():"";const n=L+y.params.id+"/"+y.params.uid+"/contract/"+e.getRow().getData().dienstverhaeltnis_id;return null!=e.getValue()?`<a href="${n}">`+e.getValue()+"</a>":""},sorter:"string",headerFilter:"list",headerFilterParams:{valuesLookup:!0,autocomplete:!0,sort:"asc"}},{title:s("person","zuordnung_taetigkeit"),field:"funktion_beschreibung",hozAlign:"left",headerFilter:"list",headerFilterParams:{valuesLookup:!0,autocomplete:!0,sort:"asc"}},{title:s("lehre","organisationseinheit"),field:"funktion_oebezeichnung",headerFilter:"list",headerFilterParams:{valuesLookup:!0,autocomplete:!0,sort:"asc"}},{title:s("person","wochenstunden"),field:"wochenstunden",hozAlign:"right",width:140,headerFilter:!0},{title:s("ui","from"),field:"datum_von",hozAlign:"center",formatter:e,width:140,sorter:"string",headerFilter:!0,headerFilterFunc:l},{title:s("global","bis"),field:"datum_bis",hozAlign:"center",formatter:e,width:140,sorter:"string",headerFilter:!0,headerFilterFunc:l},{title:s("ui","bezeichnung"),field:"bezeichnung",hozAlign:"left",headerFilter:"list",headerFilterParams:{valuesLookup:!0,autocomplete:!0,sort:"asc"}}];!1===t.readonlyMode&&r.push({title:"",field:"benutzerfunktion_id",formatter:a,hozAlign:"right",width:100,headerSort:!1,frozen:!0});let i={height:"100%",layout:"fitColumns",movableColumns:!0,reactiveData:!0,columns:r,data:z.value};function l(t,e,n,a){const r=new Date(e);r.setHours(0,0,0,0);let[s,i,l]=t.split(".");if(l<1e3)return!0;const o=new Date(+l,+i-1,+s);return!(d=o,d instanceof Date&&isFinite(d)&&o-r!=0);var d}g.value=new Tabulator(m.value,i),g.value.on("tableBuilt",()=>{})});const z=Vue.computed(()=>(p.value?Object.values(p.value):[]).filter(t=>!v.value||v.value&&t.aktiv)),S=t=>{let e=z.value.filter(e=>e.funktion_kurzbz==t);return e.length>0?e[0].bezeichnung:""};Vue.watch(z,(t,e)=>{g.value?.setData(z.value)},{deep:!0});const C=Vue.ref(),D=()=>{C.value.hide()},F=async t=>{x.value={...p.value[t]},d.value=!0;try{const t=await n.call(ct.getCompanyByOrget(x.value.oe_kurzbz));"success"==t.meta.status?c.value=t.data[0].oe_kurzbz:console.log("company not found for orget!")}catch(t){a.handleSystemError(t)}finally{d.value=!1}C.value.show()},V=async t=>{if(x.value={...p.value[t]},!1!==await a.confirm({message:s("person","funktion")+" "+S(x.value?.funktion_kurzbz)+"  ("+O(x.value?.datum_von)+"-"+(null!=x.value.datum_bis?O(x.value.datum_bis):"?")+") "+s("person","wirklichLoeschen"),acceptLabel:"Löschen",acceptClass:"p-button-danger"}))try{"success"==(await n.call(Z.deletePersonJobFunction(t))).meta.status&&(delete p.value[t],H(),u.value.updateHeader())}catch(t){a.handleSystemError(t)}finally{d.value=!1}},P=Vue.ref(),E=Vue.reactive({beginnBlurred:!1,orgetBlurred:!1,funktionBlurred:!1,wasValidated:!1}),T=t=>!!t&&""!=t.trim(),$=()=>(E.orgetBlurred=!0,E.funktionBlurred=!0,E.beginnBlurred=!0,T(x.value.datum_von)&&T(x.value.oe_kurzbz)&&T(x.value.funktion_kurzbz)),B=Vue.computed(()=>Object.keys(x.value).some(t=>x.value[t]!==w.value[t])),O=t=>null!=t&&""!=t?t.substring(8,10)+"."+t.substring(5,7)+"."+t.substring(0,4):"",M=()=>{a.alertSuccess(s("person","funktionGespeichert"))},H=()=>{a.alertSuccess(s("person","funktionGeloescht"))},I=async t=>{if(""===t)return;const e=(await n.call(ct.getOrgetsForCompany(t))).data;e.unshift({value:"",label:s("ui","bitteWaehlen")}),f.value=await e},R=async(t,e)=>{const a=(await n.call(ct.getAllFunctions())).data;a.unshift({value:"",label:s("ui","bitteWaehlen")}),h.value=a},L=`/${FHC_JS_DATA_STORAGE_OBJECT.app_root.replace(/(https:|)(^|\/\/)(.*?\/)/g,"")+FHC_JS_DATA_STORAGE_OBJECT.ci_router}/extensions/FHC-Core-Personalverwaltung/Employees/`;return{jobfunctionList:p,orgUnitList:f,jobfunctionListArray:z,jobfunctionDefList:h,currentValue:x,readonly:r,frmState:E,dialogRef:o,jobFunctionFrm:P,modalRef:C,fullPath:L,route:y,aktivChecked:v,unternehmen:c,tabulator:g,table:m,toggleMode:async()=>{if(r.value)w.value={...x.value};else if(B.value){const t=await o.value.show();if(!t)return;console.log("ok=",t),x.value=w.value}r.value=!r.value},formatDate:O,notEmpty:T,showAddModal:()=>{x.value=A(),E.orgetBlurred=!1,E.funktionBlurred=!1,E.beginnBlurred=!1,C.value.show()},hideModal:D,okHandler:async()=>{if($()){try{let t={...x.value};delete t.dienstverhaeltnis_id,delete t.dienstverhaeltnis_unternehmen,delete t.fachbereich_bezeichnung,delete t.funktion_oebezeichnung,delete t.aktiv,delete t.funktion_beschreibung;"success"==(await n.call(Z.upsertPersonJobFunction(t))).meta.status&&(await k(),console.log("job function successfully saved"),u.value.updateHeader(),M())}catch(t){a.handleSystemError(t)}finally{d.value=!1}D()}else console.log("form invalid")},showEditModal:F,t:s,unternehmenSelectedHandler:t=>{c.value=t}}},template:'\n    <div class="row" v-if="readonlyMode === false">\n        \n    </div>\n    <div class="row pt-md-4">      \n         <div class="col">\n             <div class="card">\n                <div class="card-header">\n                    <div class="h5"><h5>{{ t(\'person\',\'funktionen\') }}</h5></div>        \n                </div>\n\n                <div class="card-body">\n                    <div class="d-grid d-md-flex justify-content-between pt-2 pb-3" v-if="readonlyMode === false">\n                        <button type="button" class="btn btn-sm btn-primary me-3" @click="showAddModal()">\n                            <i class="fa fa-plus"></i> {{ t(\'person\',\'funktion\') }}\n                        </button>\n                        <div class="form-check">\n                            <input class="form-check-input" type="checkbox" role="switch" id="aktivChecked" v-model="aktivChecked">\n                            <label class="form-check-label" for="aktivChecked">Nur aktive anzeigen</label>\n                        </div>\n                    </div>\n\n                    \x3c!-- TABULATOR --\x3e\n                    <div ref="table" class="fhc-tabulator"></div>\n                \n                </div>\n             </div>\n         </div>\n    </div>\n            \n\n    \x3c!-- detail modal --\x3e\n    <Modal :title="t(\'person\',\'funktion\')" ref="modalRef" v-if="readonlyMode === false">\n        <template #body>\n            <form class="row g-3" ref="jobFunctionFrm">\n                            \n                <div class="col-md-8">\n                    <label class="form-label">{{ t(\'core\',\'unternehmen\') }}</label><br>\n                    <org-chooser  @org-selected="unternehmenSelectedHandler" :oe="unternehmen" class="form-select form-select-sm"></org-chooser>\n                </div>\n                <div class="col-md-4">\n                </div>\n                \x3c!--  --\x3e\n                <div class="col-md-8">\n                    <label class="required form-label">{{ t(\'lehre\',\'organisationseinheit\') }}</label><br>\n                    <select id="oe_kurzbz" v-model="currentValue.oe_kurzbz" \n                        @blur="frmState.orgetBlurred = true"\n                        class="form-select form-select-sm" aria-label=".form-select-sm " \n                        :class="{ \'form-control-plaintext\': readonly, \'form-control\': !readonly, \'is-invalid\': !notEmpty(currentValue.oe_kurzbz) && frmState.orgetBlurred}"\n                        >\n                        <option v-for="(item, index) in orgUnitList" :value="item.value">\n                            {{ item.label }}\n                        </option>                       \n                    </select>\n                </div>\n                <div class="col-md-4">\n                </div>\n                \x3c!--  --\x3e\n                <div class="col-md-8">\n                    <label for="funktion_kurzbz" class="required form-label">{{ t(\'person\',\'funktion\') }}</label><br>\n                    <select id="_kurzbz" v-model="currentValue.funktion_kurzbz" \n                        @blur="frmState.funktionBlurred = true"\n                        class="form-select form-select-sm" aria-label=".form-select-sm " \n                        :class="{ \'form-control-plaintext\': readonly, \'form-control\': !readonly, \'is-invalid\': !notEmpty(currentValue.funktion_kurzbz) && frmState.funktionBlurred}"\n                        >\n                        <option v-for="(item, index) in jobfunctionDefList" :value="item.value">\n                            {{ item.label }}\n                        </option>                       \n                    </select>\n                </div>\n                <div class="col-md-4"></div>\n                \x3c!-- --\x3e\n                <div class="col-md-2">\n                    <label for="uid" class="form-label">{{ t(\'person\',\'wochenstunden\') }}</label>\n                    <input type="number"  :readonly="readonly" class="form-control-sm" :class="{ \'form-control-plaintext\': readonly, \'form-control\': !readonly}" id="bank" v-model="currentValue.wochenstunden">\n                </div>\n                \x3c!--  --\x3e\n                <div class="col-md-3">\n                    <label for="beginn" class="required form-label">{{ t(\'ui\',\'from\') }}</label>\n                    <datepicker id="beginn"\n                        :teleport="true" \n                        @blur="frmState.beginnBlurred = true" \n                        :input-class-name="(!notEmpty(currentValue.datum_von) && frmState.beginnBlurred) ? \'dp-invalid-input\' : \'\'" \n                        v-model="currentValue.datum_von"\n                        v-bind:enable-time-picker="false"\n                        text-input \n                        locale="de"\n                        format="dd.MM.yyyy"\n                        auto-apply \n                        model-type="yyyy-MM-dd"></datepicker>\n                </div>\n                <div class="col-md-3">\n                    <label for="ende" class="form-label">{{ t(\'global\',\'bis\') }}</label>\n                    <datepicker id="ende"\n                        :teleport="true" \n                        v-model="currentValue.datum_bis"\n                        v-bind:enable-time-picker="false"\n                        text-input \n                        locale="de"\n                        format="dd.MM.yyyy"\n                        auto-apply \n                        model-type="yyyy-MM-dd"></datepicker>                   \n                </div>\n                <div class="col-md-3">\n                </div>\n                \x3c!-- --\x3e\n                <div class="col-md-8">\n                    <label for="bezeichnung" class="form-label">{{ t(\'ui\',\'bezeichnung\') }}</label>\n                    <input type="text"  :readonly="readonly" class="form-control-sm" :class="{ \'form-control-plaintext\': readonly, \'form-control\': !readonly}" id="bezeichnung" v-model="currentValue.bezeichnung">\n                </div>\n                <div class="col-md-4">\n                </div>\n                \n                \n                \x3c!-- changes --\x3e\n                <div class="col-8">\n                    <div class="modificationdate">{{ currentValue.insertamum }}/{{ currentValue.insertvon }}, {{ currentValue.updateamum }}/{{ currentValue.updatevon }} [id={{ currentValue.benutzerfunktion_id }}]</div>\n                </div>\n                \n            </form>\n        </template>\n        <template #footer>\n            <button type="button" class="btn btn-primary" @click="okHandler()" >\n                {{ t(\'ui\',\'speichern\') }}\n            </button>\n        </template>\n\n    </Modal>\n\n    <ModalDialog :title="t(\'global\',\'warnung\')" ref="dialogRef" v-if="readonlyMode === false">\n      <template #body>\n        {{ t(\'person\',\'funktionNochNichtGespeichert\') }}\n      </template>\n    </ModalDialog>\n\n    '};var ht={components:{tabview:t,tabpanel:e},directives:{accessibility:{created(t,e){if("tab"===e.arg){t.style.cursor="pointer";const[n,a]=e.modifiers.vertical?["ArrowUp","ArrowDown"]:["ArrowLeft","ArrowRight"];t.addEventListener("click",()=>{let e=t.parentNode.querySelector('[tabindex="0"]');e&&(e.tabIndex=-1),t.tabIndex=0}),t.addEventListener("focus",()=>{t.ariaSelected="true"}),t.addEventListener("blur",()=>{t.ariaSelected="false"}),t.addEventListener("keydown",e=>{switch(e.code){case n:void 0!==t.previousSibling?.tabIndex&&(t.previousSibling.tabIndex=0,t.tabIndex=-1,t.previousSibling.focus());break;case a:void 0!==t.nextSibling?.tabIndex&&(t.nextSibling.tabIndex=0,t.tabIndex=-1,t.nextSibling.focus());break;case"Enter":t.click()}})}},mounted(t,e){if("tab"===e.arg){let e=-1;Array.from(t.parentNode.children).forEach((n,a)=>{n.ariaSetSize=t.parentNode.children.length,n.ariaPosInSet=a,0===n.tabIndex&&(e=a)}),-1==e?t.tabIndex=0:t.classList.contains("active")?(t.parentNode.children[e].tabIndex=-1,t.tabIndex=0):t.tabIndex=-1}},beforeUnmount(t,e){if("tab"===e.arg){0===t.tabIndex&&(void 0!==t.previousSibling?.tabIndex?t.previousSibling.tabIndex=0:void 0!==t.nextSibling?.tabIndex&&(t.nextSibling.tabIndex=0));const e=parseInt(t.ariaPosInSet);Array.from(t.parentNode.children).forEach((n,a)=>{n.ariaSetSize=t.parentNode.children.length,a>e&&(n.ariaPosInSet=a-1)})}}}},emits:["update:modelValue","change","changed"],props:{config:{type:[String,Array,Object,Promise],required:!0},default:String,modelValue:[String,Number,Boolean,Array,Object,Date,Function,Symbol],vertical:Boolean,border:Boolean,useprimevue:{type:Boolean,default:!1}},data:()=>({current:null,tabs:{}}),computed:{currentTab(){return this.tabs[this.current]?this.tabs[this.current]:{component:"div"}},value:{get(){return this.modelValue},set(t){this.$emit("update:modelValue",t)}},calcActiveIndex:function(){let t=Object.keys(this.tabs).indexOf(this.default);return-1===t?0:t}},watch:{config(t){this.initConfig(t)}},methods:{handleTabClick:function(t){let e=Object.keys(this.tabs);this.change(e[t.index])},change(t){this.$emit("change",t),this.current=t,this.$nextTick(()=>this.$emit("changed",t))},initConfig(t){if(!t)return;if(t instanceof Promise)return t.then(t=>t.data).then(this.initConfig).catch(this.$fhcAlert.handleSystemError);if("string"==typeof t||t instanceof String)return this.$api.get(t).then(t=>t.data).then(this.initConfig).catch(this.$fhcAlert.handleSystemError);const e={};function n(t,n){if(!n.component)return console.error("Component missing for "+t);const a=Vue.reactive({suffix:"",showSuffix:n.showSuffix||!1});e[t]={component:Vue.markRaw(Vue.defineAsyncComponent(()=>import(n.component))),title:Vue.computed(()=>n.title||t),config:n.config,key:t,value:a,suffixhelper:n.suffixhelper??null}}Array.isArray(t)?t.forEach((t,e)=>n(e,t)):Object.entries(t).forEach(([t,e])=>n(t,e)),null!==this.current&&e[this.current]||(e[this.default]?this.current=this.default:this.current=Object.keys(e)[0]),this.tabs=e},updateSuffix(){this.getTabSuffix(this.currentTab)},async getTabSuffix(t){if(t.value.showSuffix)if(null!==t.suffixhelper){const e=await import(t.suffixhelper),n=await e.getSuffix(this.$api,this.modelValue);t.value.suffix=n}else t.value.suffix=""},getTabSuffixes(){Object.entries(this.tabs).forEach(([t,e])=>this.getTabSuffix(e))}},created(){this.initConfig(this.config)},mounted(){this.getTabSuffixes()},updated(){this.getTabSuffixes()},template:'\n\t<template v-if="useprimevue">\n\n\t\t<tabview\n\t\t\tclass="d-flex flex-column"\n\t\t\t:scrollable="true"\n\t\t\t:lazy="true"\n\t\t\t:activeIndex="calcActiveIndex"\n\t\t\t:pt="{navContainer:{style: \'flex: 0 0 auto;\'}, panelContainer:{class: \'overflow-y-scroll\', style: \'flex: 1 1 auto;\'}}"\n\t\t\t@tab-click="handleTabClick"\n\t\t>\n\t\t\t<tabpanel\n\t\t\t\tv-for="tab in tabs"\n\t\t\t\t:key="tab.key"\n\t\t\t\t:header="tab.title + ((tab.value.showSuffix && tab.value.suffix !== \'\') ? \' \' + tab.value.suffix : \'\')"\n\t\t\t>\n\t\t\t\t<keep-alive>\n\t\t\t\t\t<component\n\t\t\t\t\t\t:is="tab.component"\n\t\t\t\t\t\tv-model="value"\n\t\t\t\t\t\t:config="tab.config"\n\t\t\t\t\t\t@update:suffix="updateSuffix($event)"\n\t\t\t\t\t\t></component>\n\t\t\t\t</keep-alive>\n\t\t\t</tabpanel>\n\t\t</tabview>\n\n\t</template>\n\t<template v-else="">\n\n\t<div class="fhc-tabs d-flex" :class="vertical ? \'align-items-stretch gap-3\' : (border ? \'flex-column\' : \'flex-column gap-3\')" v-if="Object.keys(tabs).length">\n\t\t<div class="nav" :class="vertical ? \'nav-pills flex-column\' : \'nav-tabs\'">\n\n\t\t\t<div\n\t\t\t\tv-for="tab in tabs"\n\t\t\t\t:key="tab.key"\n\t\t\t\tclass="nav-item nav-link"\n\t\t\t\t:class="{active: tab.key == current}"\n\t\t\t\t@click="change(tab.key)"\n\t\t\t\t:aria-current="tab.key == current ? \'page\' : \'\'"\n\t\t\t\tv-accessibility:tab.[vertical]\n\t\t\t\t>\n\t\t\t\t{{tab.title}} <span v-if="tab.value.showSuffix && tab.value.suffix"> {{ tab.value.suffix }}</span>\n\t\t\t</div>\n\t\t</div>\n\t\t<div :style="vertical ? \'\' : \'flex: 1 1 0%; height: 0%\'" class="overflow-auto flex-grow-1" :class="vertical || !border ? \'\' : \'p-3 border-bottom border-start border-end\'">\n\t\t\t<keep-alive>\n\t\t\t\t<component\n\t\t\t\t\tref="current"\n\t\t\t\t\t:is="currentTab.component"\n\t\t\t\t\tv-model="value"\n\t\t\t\t\t:config="currentTab.config"\n\t\t\t\t\t@update:suffix="updateSuffix($event)"\n\t\t\t\t\t></component>\n\t\t\t</keep-alive>\n\t\t</div>\n\t</div>\n\n\t</template>'};const ft={name:"EmployeePerson",components:{BaseData:Y,EmployeeData:X,BankData:tt,ContactData:rt,MaterialExpensesData:st,HourlyRateData:ot,JobFunction:pt,FhcTabs:ht},props:{id:Number,uid:String},emits:["updateHeader"],setup(t,{emit:e}){const{t:n}=J(),a=Vue.reactive({personID:null,personUID:null,editmode:!0,updateHeader:()=>e("updateHeader")}),r=Vue.ref("/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/TabsConfigAPI/Stammdaten");return a.personID=t.id,a.personUID=t.uid,a.restricted=t.restricted,{t:n,theModel:a,path:r}},template:'\n    <div class="d-flex justify-content-between align-items-center ms-sm-auto col-lg-12 p-md-2">\n      <div class="container-fluid">\n    \n        <fhc-tabs \n            :config="path" \n            style="flex: 1 1 0%; height: 0%"\n            :vertical="true"\n            v-model="theModel">\n        </fhc-tabs>\n\n      </div>\n    </div>\n    '};var vt={getCurrentVBs:t=>({method:"get",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/DVAPI/getCurrentVBs/"+t}),getCurrentAndFutureVBs(t,e){var n="/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/DVAPI/getCurrentAndFutureVBs/"+t;if(void 0!==e){n=n+"?"+new URLSearchParams(e).toString()}return{method:"get",url:n}},getAllVBs:t=>({method:"get",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/DVAPI/getAllVBs/"+t}),getVB:t=>({method:"get",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/DVAPI/getVB/"+t})},mt={filterPerson:t=>({method:"post",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/PersonAPI/filterPerson",params:t}),createEmployee:t=>({method:"post",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/PersonAPI/createEmployee",params:t}),personAbteilung:t=>({method:"get",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/PersonAPI/personAbteilung",params:{uid:t}}),personHeaderData:(t,e)=>({method:"get",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/PersonAPI/headerData",params:{person_id:t,uid:e}}),dvByPerson:t=>({method:"get",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/DVAPI/dvByPerson",params:{uid:t}}),getCurrentDV:(t,e)=>({method:"get",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/DVAPI/getCurrentDV",params:{uid:t,d:e}}),deleteDV:t=>({method:"post",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/DVAPI/deleteDV",params:{dv_id:t}}),uploadPersonEmployeeFoto:(t,e)=>({method:"post",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/PersonAPI/uploadPersonEmployeeFoto",params:{person_id:t,imagedata:e}}),deletePersonEmployeeFoto:t=>({method:"post",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/PersonAPI/deletePersonEmployeeFoto",params:{person_id:t}}),getEmployeesWithoutContract:()=>({method:"post",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/DVAPI/getEmployeesWithoutContract"}),dvInfoByPerson:t=>({method:"get",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/DVAPI/dvInfoByPerson",params:{uid:t}})};const gt={name:"EmployeeStatus",props:{tags:{default:[],type:Array}},expose:["refresh"],setup(t){const{watch:e,ref:n,reactive:a,computed:r,onMounted:s,inject:i}=Vue,l=VueRouter.useRoute(),o=VueRouter.useRouter(),d=n(),u=n(),c=n([]),p=n([]),h=n(new Date),f=n(!1),v=i("vertragsarten"),m=i("karenztypen"),g=i("teilzeittypen"),b=i("$api"),y=t=>{let e=v.value.find(e=>e.value==t);return null!=e?e.label:t},_=t=>{let e=m.value.find(e=>e.value==t);return null!=e?e.label:t},k=t=>{let e=g.value.find(e=>e.value==t);return null!=e?e.label:t};let A=Vue.ref([]);const x=Vue.ref(t.tags),w=async t=>{if(null==t)return c.value=[],void(p.value=[]);f.value=!0;try{const e=await b.call(mt.dvByPerson(t));c.value=e.data||[],f.value=!1,(()=>{let t=0,e=[];A.value=[],c.value.forEach(n=>{let a=new Date(n.von),r=null!=n.bis?new Date(n.bis):null;h.value>=a&&(null==r||r>=h.value)&&(t++,A.value.find(t=>t.text==y(n.vertragsart_kurzbz))||A.value.push({text:y(n.vertragsart_kurzbz),description:"",css:"bg-dv rounded-0"}),e.push(n.dienstverhaeltnis_id))}),t>1?A.value.unshift({text:"parallele DVs",description:"",css:"bg-dv rounded-0"}):0==t&&A.value.unshift({text:"derzeit kein aktives DV",description:"",css:"bg-dv rounded-0"}),console.log("dvIDs",e),Promise.all(e.map(t=>b.call(vt.getCurrentVBs(t)))).then(t=>{t.map(t=>{t.data.map(t=>{switch(t.vertragsbestandteiltyp_kurzbz){case"freitext":"befristung"==t.freitexttyp_kurzbz?A.value.push({text:"Befristung",description:"",css:"bg-dv rounded-0"}):"allin"==t.freitexttyp_kurzbz?A.value.push({text:"All-In",description:"",css:"bg-allin rounded-0"}):"ersatzarbeitskraft"==t.freitexttyp_kurzbz&&A.value.push({text:"Ersatzarbeitskraft",description:"",css:"bg-dv rounded-0"});break;case"karenz":A.value.push({text:_(t.karenztyp_kurzbz),description:"",css:"bg-karenz rounded-0"});break;case"stunden":null!=t.teilzeittyp_kurzbz&&A.value.push({text:k(t.teilzeittyp_kurzbz),description:"",css:"bg-teilzeit rounded-0"})}})})})})()}catch(t){console.log(t),f.value=!1}};s(async()=>{await o.isReady(),console.log("route.path",l.path),d.value=l.params.id,u.value=l.params.uid,h.value=new Date,w(u.value)}),e(()=>l.params.uid,t=>{d.value=l.params.id,u.value=t,h.value=new Date,w(u.value)}),e(()=>t.tags,t=>{x.value=t},{deep:!0});return{statusList:A,statusTags:x,refresh:()=>{w(u.value)}}},template:'\n    <div class="d-flex align-items-start ms-sm-auto col-lg-12  gap-2 mt-auto" >\n        <template v-for="item in statusTags">\n            <span class="badge" :class="(item?.css != undefined) ? item.css : \'bg-secondary rounded-0\'" >{{ item.text }}</span>\n        </template>\n        <template v-for="item in statusList">\n            <span class="badge" :class="(item?.css != undefined) ? item.css : \'bg-secondary rounded-0\'" >{{ item.text }}</span>\n        </template>\n    </div>   \n   '};var bt={byPerson:t=>({method:"get",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/issue/byPerson",params:{person_id:t}}),countPersonOpenIssues:t=>({method:"get",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/IssueChecker/countPersonOpenIssues/"+t}),checkPerson:t=>({method:"post",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/IssueChecker/checkPerson/"+t}),openIssuesPersons:()=>({method:"get",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/issue/PersonenMitOffenenIssues"})};const yt={name:"EmployeeHeader",components:{Modal:Q,ModalDialog:W,"p-skeleton":primevue.skeleton,EmployeeStatus:gt},props:{personID:Number,personUID:String,restricted:Boolean},expose:["refresh"],emits:["personSelected"],setup(t,{emit:e}){const{watch:n,ref:a,onMounted:r,inject:s}=Vue,i=Vue.computed(()=>t.personID),l=Vue.computed(()=>t.personUID),o=a(),d=a(),u=a(),c=a(),{t:p}=J(),h=a(!1),f=a(!1),v=a(!1),m=s("$api"),g=Vue.inject("$fhcAlert"),b=a(),y=async(t,e)=>{h.value=!0,f.value=!0;try{const n=await m.call(mt.personHeaderData(t,e));o.value=n.data[0],f.value=!1;const a=await m.call(mt.personAbteilung(o.value.uid));o.value={...o.value,abteilung:a.data}}catch(t){console.log(t)}finally{h.value=!1,f.value=!1}},_=async t=>{v.value=!0;try{const e=await m.call(bt.countPersonOpenIssues(t));b.value=e.data.openissues}catch(t){console.log(t)}finally{v.value=!1}},k=async()=>{v.value=!0;try{const e=await m.call(bt.checkPerson(t.personID));b.value=e.data.openissues}catch(t){console.log(t)}finally{v.value=!1}};Vue.watch([i,l],([t,e])=>{null!=i.value?(y(t,e),_(t)):(u.value=null,d.value.value=null)}),r(()=>{t.personID,t.personUID&&(y(t.personID,t.personUID),_(t.personID)),A.value&&A.value.$el.addEventListener("hidden.bs.modal",()=>{w()})});let A=a();const x=()=>{A.value.hide()},w=()=>{u.value=null,d.value.value=null};return{showModal:()=>{A.value.show()},hideModal:x,resetPreview:w,modalRef:A,showDeleteModal:async()=>{!1!==await g.confirm({message:"Foto wirklich löschen?",acceptLabel:"Löschen",acceptClass:"p-button-danger"})&&(async()=>{try{h.value=!0,await m.call(mt.deletePersonEmployeeFoto(t.personID)),y(t.personID,t.personUID),g.alertSuccess(p("person","Foto gelöscht"))}catch(t){g.handleSystemError(t)}finally{h.value=!1}})()},pickFile:()=>{let t=d.value.files;if(t&&t[0]){let e=new FileReader;e.onload=t=>{u.value=t.target.result},e.readAsDataURL(t[0])}},okHandler:()=>{(async()=>{try{h.value=!0;const e=await m.call(mt.uploadPersonEmployeeFoto(t.personID,u.value));"success"!=e?.meta?.status?g.alertError(p("person",e.data)):g.alertSuccess(p("person","Foto gespeichert.")),y(t.personID,t.personUID)}catch(t){g.handleSystemError(t)}finally{h.value=!1}})(),x()},statusRef:c,redirect:(t,n)=>{e("personSelected",{person_id:t,uid:n})},FHC_JS_CONFIG:FHC_JS_CONFIG,getStatusTags:()=>{const t=[];return o?.value?.unruly&&t.push({text:"Unruly",css:"bg-unruly rounded-0"}),t},employee:o,fileInput:d,previewImage:u,isFetching:h,isFetchingName:f,isFetchingIssues:v,currentPersonID:i,currentPersonUID:l,formatDate:t=>{if(null==t)return"";var e=new Date(t);return e?.toISOString().substring(0,10)},checkPerson:k,refresh:()=>{y(t.personID,t.personUID),k(t.personID),c.value.refresh()},openissuescount:b}},template:'\n\n        <div class="d-flex justify-content-between ms-sm-auto col-lg-12 p-md-2" >\n            <div class="d-flex align-items-top flex-fill" >\n\n                <div class="fotocontainer" v-if="!isFetchingName">\n                    <img v-if="employee?.foto" class="rounded" style="max-width:101px" :src="\'data:image/jpeg;charset=utf-8;base64,\' + employee?.foto" />\n                    <div v-if="employee?.foto && !restricted" class="fotobutton" >\n                        <div class="d-grid gap-2 d-md-flex ">\n                                <button type="button" class="btn btn-outline-dark btn-sm" @click="showDeleteModal">\n                                    <i class="fa fa-xmark"></i>\n                                </button>\n                                <button type="button" class="btn btn-outline-dark btn-sm" @click="showModal">\n                                    <i class="fa fa-pen"></i>\n                                </button>\n                        </div>\n                    </div>\n                </div>\n\n                <div v-if="employee?.foto==undefined  || isFetchingName" style="position:relative">\n                    <svg  class="bd-placeholder-img rounded" width="100" height="131" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="A generic square placeholder image with a white border around it, making it resemble a photograph taken with an old instant camera: 200x200" preserveAspectRatio="xMidYMid slice" focusable="false"><title>A generic square placeholder image with a white border around it, making it resemble a photograph taken with an old instant camera</title><rect width="100%" height="100%" fill="#868e96"></rect><text x="50%" y="50%" fill="#dee2e6" dy=".3em"></text></svg>\n                    <div class="fotobutton-visible" v-if="!restricted && !isFetchingName">\n                        <div class="d-grid gap-2 d-md-flex ">\n                            <button type="button" class="btn btn-outline-dark btn-sm" @click="showModal" >\n                                <i class="fa fa-pen"></i>\n                            </button>\n                        </div>\n                    </div>\n                </div>\n\n                <div class="ms-3 flex-fill d-flex flex-column" >\n                    <div class="align-items-top">\n                        <h2 class="h4" v-if="!isFetchingName">{{ employee?.titelpre }} {{ employee?.vorname }} {{ employee?.nachname }}<span v-if="employee?.titelpost != null && employee?.titelpost != \'\'">, {{ employee?.titelpost }}</span></h2>\n                        <h2 class="h4" v-else><p-skeleton style="width:30%"></p-skeleton></h2>\n\n                        <div v-if="employee?.abteilung && !isFetching" class="mb-1">\n                            <template v-for="(item, index) in employee?.abteilung">\n                                <strong class="text-muted">{{ item?.organisationseinheittyp_kurzbz }}</strong> {{ item?.bezeichnung }} |\n                                <strong class="text-muted">Vorgesetzte*r </strong>\n                                <a href="#" @click.prevent="redirect(item?.supervisor?.person_id, item?.supervisor?.uid)" v-if="!restricted">{{ item?.supervisor?.titelpre }} {{ item?.supervisor?.vorname }} {{ item?.supervisor?.nachname }}</a>\n                                <span v-else>{{ item?.supervisor?.titelpre }} {{ item?.supervisor?.vorname }} {{ item?.supervisor?.nachname }}</span>\n                                <br v-if="index < employee?.abteilung?.length - 1" />\n                            </template>\n                            </div>\n                        <div v-else class="mb-1"><p-skeleton v-if="isFetching" style="width:45%"></p-skeleton></div>\n                        <div v-if="!isFetchingName" class="mb-1">\n                            <strong class="text-muted">Email</strong>&nbsp;\n                            <span v-if="!employee?.alias">\n                                <a :href="\'mailto:\'+employee?.uid+\'@\'+FHC_JS_CONFIG.domain">{{  employee?.uid }}@{{ FHC_JS_CONFIG.domain }}</a>\n                            </span>\n                            <span v-if="employee?.alias">\n                                <a :href="\'mailto:\'+employee?.alias+\'@\'+FHC_JS_CONFIG.domain">{{  employee?.alias }}@{{ FHC_JS_CONFIG.domain }}</a>\n                            </span>\n                            <span v-if="employee?.telefonklappe" class="mb-2"> | <strong class="text-muted">DW</strong> {{  employee?.telefonklappe }}</span>\n                        </div>\n                        <div v-else class="mb-1"><p-skeleton  style="width:35%"></p-skeleton></div>\n                    </div>\n                    <EmployeeStatus v-if="!restricted" ref="statusRef" :tags="getStatusTags()"></EmployeeStatus>\n                </div>\n\n            </div>\n\n            <div class="d-flex flex-column">\n                <div class="d-flex py-1">\n                    <div class="px-2" v-if="!restricted">\n                        <h4 class="mb-1">Issues<a class="refresh-issues" title="erneut prüfen" href="javascript:void(0);" @click="checkPerson"><i class="fas fa-sync"></i></a></h4>\n                        <h6 v-if="!isFetchingIssues" class="text-muted">{{ openissuescount }}</h6>\n                        <h6 v-else class="mb-2"><p-skeleton v-if="isFetchingIssues" style="width:45%"></p-skeleton></h6>\n                    </div>\n                    <div class="px-2">\n                        <h4 class="mb-1">PNr</h4>\n                        <h6 v-if="!isFetchingName" class="text-muted">{{ employee?.personalnummer }}</h6>\n                        <h6 v-else class="mb-2"><p-skeleton v-if="isFetching" style="width:45%"></p-skeleton></h6>\n                    </div>\n                    <div class="px-2" style="border-left: 1px solid #EEE">\n                        <h4 class="mb-1">UID</h4>\n                        <h6 v-if="!isFetchingName" class="text-muted">{{ employee?.uid }}</h6>\n                        <h6 v-else class="mb-2"><p-skeleton v-if="isFetching" style="width:45%"></p-skeleton></h6>\n                    </div>\n                </div>\n            </div>\n\n        </div>\n\n\n        \x3c!-- FotoModal --\x3e\n        <Modal title="Foto" ref="modalRef">\n            <template #body>\n                <div class="mb-3">\n                    <label for="formFile" class="form-label">Foto upload</label>\n                    <input class="form-control" type="file" id="formFile" ref="fileInput" @input="pickFile" accept="image/*">\n                </div>\n                <div class="mb-3">\n                    <div class="imagePreviewWrapper" >\n                        <img class="preview" :src="previewImage" />\n                    </div>\n                </div>\n\n            </template>\n            <template #footer>\n                <button class="btn btn-secondary"  @click="hideModal()">Abbrechen</button>\n                <button class="btn btn-primary"  @click="okHandler()">OK</button>\n            </template>\n        </Modal>\n\n        '},_t={name:"EmployeeNav",props:{},setup(t,{emit:e}){const n=VueRouter.useRoute(),a=Vue.ref(null);Vue.onMounted(()=>{a.value=n.query.d}),Vue.watch(()=>n.query.d,t=>{a.value=t});const r=FHC_JS_DATA_STORAGE_OBJECT.app_root.replace(/(https:|)(^|\/\/)(.*?\/)/g,"")+FHC_JS_DATA_STORAGE_OBJECT.ci_router;return{close:()=>{console.log("close",n.params.id),e("close-editor",n.params.id)},route:n,fullPath:`/${r}/extensions/FHC-Core-Personalverwaltung/Employees/`,currentDate:a,maybeAddDate:()=>null!=a.value?"?d="+a.value:""}},template:"    \n    <nav\n        class=\"nav nav-tabs nav-justified flex-column flex-sm-row ms-sm-auto mt-3 col-lg-12 subnav\"\n    >\n    \n        <router-link :to=\"fullPath + route.params.id + '/' + route.params.uid + '/summary' + maybeAddDate()\" \n            class=\"flex-sm-fill text-sm-center nav-link\"\n            :class=\"[{'router-link-active active': route?.name === 'summary'}]\" >\n            Überblick\n        </router-link>\n        <router-link :to=\"fullPath + route.params.id + '/' + route.params.uid + maybeAddDate()\" \n            class=\"flex-sm-fill text-sm-center nav-link\"\n            :class=\"[{'router-link-active active': route?.name === 'person'}]\" >\n            Person\n        </router-link>\n        <router-link :to=\"fullPath + route.params.id + '/' + route.params.uid + '/contract' + maybeAddDate()\" \n            class=\"flex-sm-fill text-sm-center nav-link\"\n            :class=\"[{'router-link-active active': route.path.indexOf('contract') > -1 }]\" >\n            Dienstverhältnis\n        </router-link>        \n        <router-link :to=\"fullPath + route.params.id + '/' + route.params.uid + '/time' + maybeAddDate()\" \n        class=\"flex-sm-fill text-sm-center nav-link\"\n        :class=\"[{'router-link-active active': route?.name === 'time'}]\"\n        >Zeiten</router-link\n        >\n        <router-link :to=\"fullPath + route.params.id + '/' + route.params.uid + '/lifecycle' + maybeAddDate()\" \n        class=\"flex-sm-fill text-sm-center nav-link\"\n        :class=\"[{'router-link-active active': route?.name === 'lifecycle'}]\"\n        >Life Cycle</router-link\n        >\n        <router-link :to=\"fullPath + route.params.id + '/' + route.params.uid + '/document' + maybeAddDate()\" \n        class=\"flex-sm-fill text-sm-center nav-link\"\n        :class=\"[{'router-link-active active': route?.name === 'document'}]\"\n        >Dokumente</router-link\n        >\n    </nav>\n    \n    "};var kt={name:"EmployeeEditor",components:{EmployeePerson:ft,EmployeeHeader:yt,EmployeeNav:_t},props:{personid:Number,personuid:String,open:Boolean,isNew:Boolean},emits:["personSelected"],setup(t,{emit:e}){VueRouter.useRouter();const n=VueRouter.useRoute(),a=Vue.ref(null),r=Vue.ref(null),s=Vue.ref(null),i=Vue.ref();return Vue.onMounted(()=>{console.log("EmployeeEditor mounted",n.path),s.value=n.query.d}),Vue.watch(()=>n.params,t=>{a.value=t.id,r.value=t.uid}),Vue.watch(()=>n.query.d,t=>{console.log("watch route.query.d",t),s.value=t}),{redirect:t=>{e("personSelected",t)},dateChanged:t=>{console.log("-> date changed: ",t)},currentPersonID:a,currentPersonUID:r,currentDate:s,employeeHeaderRef:i,updateHeaderHandler:()=>{i.value.refresh()}}},template:'    \n        <EmployeeHeader ref="employeeHeaderRef"  :personID="personid" :personUID="personuid" @person-selected="redirect"   ></EmployeeHeader> \n        <EmployeeNav   :personID="currentPersonID" :personUID="currentPersonUID"  ></EmployeeNav> \n        <router-view @updateHeader="updateHeaderHandler"></router-view>       \n    '};const At=FHC_JS_DATA_STORAGE_OBJECT.app_root.replace(/(https:|)(^|\/\/)(.*?\/)/g,"")+FHC_JS_DATA_STORAGE_OBJECT.ci_router,xt={name:"SearchExistingDialog",components:{datepicker:VueDatePicker},props:{},emits:["change","select","take"],setup(t,{emit:e}){const n=VueRouter.useRouter();VueRouter.useRoute();const a=Vue.inject("$api"),r=Vue.reactive({surname:"",birthdate:""}),s=Vue.ref([]),i=Vue.ref(!1),l=Vue.ref(null),o=async()=>{if(e("change",r),r.surname.length<2||null==r.birthdate||""==r.birthdate)s.value=[];else try{i.value=!0;const t=await a.call(mt.filterPerson(r));i.value=!1,s.value=t.data.retval}catch(t){console.log(t),i.value=!1}},d=(t,a,r)=>{console.log("personSelected: ",t);let s=`/${At}/extensions/FHC-Core-Personalverwaltung/Employees/${t}/${a}/summary`;n.push(s),e(r,a)};return Vue.onMounted(()=>{l.value.focus()}),{currentValue:r,filterPerson:o,personSelectedHandler:d,personList:s,surnameRef:l,take:async(t,e,n,r)=>{try{i.value=!0;const s=await a.call(mt.createEmployee({action:"take",payload:{person_id:t,uid:e,vorname:n,nachname:r}}));i.value=!1,"success"==s?.meta?.status?(d(t,s.data.uid,"take"),o()):(console.log("Fehler beim Anlegen: ",s),$fhcAlert.handleSystemError("Fehler beim Anlegen."))}catch(t){$fhcAlert.handleSystemError(t)}finally{i.value=!1}},reset:()=>{r.surname=null,r.birthdate=null,s.value=[]},formatDate:t=>{if(null==t||""==t)return"";var e=new Date(t);return e.getDate()+"."+(e.getMonth()+1)+"."+e.getFullYear()},isFetching:i}},template:'\n    <form class="row g-3 pb-4" ref="searchExistingFrm" id="searchExistingFrm" >\n\n        <div class="col-md-3">\n            <label for="birthdate" class="form-label required">Geburtsdatum</label>\n            <datepicker id="birthdate" \n                :teleport="true"\n                v-model="currentValue.birthdate"\n                v-bind:enable-time-picker="false"\n                text-input \n                locale="de"\n                format="d.M.yyyy"\n                auto-apply \n                model-type="yyyy-MM-dd" \n                @change="filterPerson" ></datepicker>\n        </div>\n\n        <div class="col-md-3">\n            <label for="surname" class="required form-label">Nachname</label>\n            <input id="surname" \n                ref="surnameRef"\n                v-model="currentValue.surname" \n                @keyup="filterPerson"\n                type="text" \n                class="form-control form-control-sm" \n                aria-label="nachname"\n                autofocus >\n        </div>\n        \n        <div v-if="personList.length !== 0" class="col-md-12 py-3">\n            <span class="text-primary fw-semibold"><i class="fa fa-circle-info text-primary"></i>&nbsp;{{ personList.length }} Personen gefunden</span>\n            <table class="table table-sm table-striped table-hover mt-2">\n                <thead>\n                    <tr><th>UID</th><th>Name</th><th>Geb.Dat.</th><th>SVNr</th><th>Email</th><th>Status</th><th>Unruly</th><th>Aktion</th></tr>\n                </thead>\n                <tbody>\n                    <tr v-for="person in personList" >\n                        <td>{{ person.uid }}</td>\n                        <td>{{ person.nachname }}, {{ person.vorname }}</td>\n                        <td>{{ formatDate(person.gebdatum) }}</td>\n                        <td>{{ person.svnr }}</td>                        \n                        <td><span v-if="person.emails.length > 0">{{ person.emails.join(", ") }}</span></td>\n                        <td>{{ person.status }}</td>\n                        <td>\n                            <span v-if="person.unruly" class="badge bg-unruly rounded-0">Unruly</span>\n                            <span v-else>-</span>\n                        </td>\n                        <td @click.stop>\n                            <div class="d-grid gap-2 d-md-flex justify-content-start">\n                                <button type="button" class="btn btn-secondary btn-sm" \n                                    @click="take(person.person_id, person.uid, person.vorname, person.nachname)"\n                                    style="white-space: nowrap"\n                                    :disabled="isFetching"\n                                    v-if="!person.taken">\n                                    Person als MA anlegen\n                                </button>\n                                <button type="button" class="btn btn-secondary btn-sm" \n                                    @click="personSelectedHandler(person.person_id, person.uid, \'select\')"\n                                    style="white-space: nowrap"\n                                    :disabled="isFetching"\n                                    v-if="person.taken">\n                                    MA auswählen\n                                </button>\n                            </div>\n                        </td>\n                    </tr>\n                </tbody>\n            </table>\n        </div>\n\n    </form>\n    '},wt=t=>{const e=[3,7,9,5,8,4,2,1,6];if(null==t||""==t)return!0;if(10!=t.length)return!1;var n=t.substring(4);console.log("datum = ",n);var a=t.substring(0,3);console.log("nummer:",a);var r=t.substring(3,4);console.log("pruefzahl:",r);{let t=0,i=a+n;for(var s=0;s<9;s++){t+=parseInt(i.charAt(s))*e[s]}let l=t%11;if(console.log("rest:",l),l==r)return!0}return!1};var zt={updatePersonUnrulyStatus:(t,e)=>({method:"post",url:"/api/frontend/v1/checkperson/CheckPerson/updatePersonUnrulyStatus",params:{person_id:t,unruly:e}}),filterPerson:(t,e="")=>({method:"post",url:e+"/api/frontend/v1/checkperson/CheckPerson/filterPerson",params:t})};const St=FHC_JS_DATA_STORAGE_OBJECT.app_root.replace(/(https:|)(^|\/\/)(.*?\/)/g,"")+FHC_JS_DATA_STORAGE_OBJECT.ci_router,Ct={name:"CreateEmployeeFrm",components:{datepicker:VueDatePicker},props:{defaultval:{type:Object,required:!1}},expose:["save","reset"],setup(t){const e=VueRouter.useRouter();VueRouter.useRoute();const n=Vue.inject("$api"),a=Vue.inject("$fhcAlert"),r=Vue.toRef(t,"defaultval"),s=Vue.inject("sprache"),i=Vue.inject("nations"),l=Vue.ref({vorname:"",vornamen:"",nachname:"",gebdatum:"",email:"",svnr:"",geschlecht:"",staatsbuergerschaft:"A",anmerkung:""});Vue.ref({vorname:"",vornamen:"",nachname:"",gebdatum:"",email:"",svnr:"",geschlecht:"",staatsbuergerschaft:"A",anmerkung:""}),Vue.watch(t,()=>{l.value.nachname=null!==t.defaultval.surname?t.defaultval.surname.charAt(0).toUpperCase()+t.defaultval.surname.slice(1):"",l.value.gebdatum=t.defaultval.birthdate});const o=Vue.ref(),d=Vue.ref([]),u=Vue.ref(!1),c=Vue.reactive({nachnameBlured:!1,vornameBlured:!1,emailBlured:!1,geburtsdatumBlured:!1,geschlechtBlured:!1,svnrBlured:!1,wasValidated:!1}),p=async()=>{if(!(l.value.nachname.length<2&&l.value.vorname.length<2))try{u.value=!0;const t=await n.call(zt.filterPerson({...l.value,unruly:!0},FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router));if(u.value=!1,!t.data.retval)return;d.value=t.data.retval}catch(t){console.log(t),u.value=!1}};Vue.watch(()=>l.value.nachname,()=>{p()},{deep:!0}),Vue.watch(()=>l.value.vorname,()=>{p()}),Vue.watch(()=>l.value.gebdatum,()=>{p()});const h=t=>!!t&&""!=t.trim(),f=t=>!!t&&""!=t.trim(),v=t=>!!t&&""!=t.trim(),m=t=>!!t&&""!=t.trim(),g=t=>!!t&&""!=t.trim(),b=(t,n)=>{console.log("redirect: ",t,n);let a=`/${St}/extensions/FHC-Core-Personalverwaltung/Employees/${t}/${n}/summary`;e.push(a)};return{createEmployeeFrm:o,currentValue:l,nations:i,sprache:s,isFetching:u,filterPerson:p,validNachname:h,validVorname:f,validGeburtsdatum:g,validEmail:m,validGeschlecht:v,validSVNR:wt,frmState:c,defaultvalRef:r,unrulyPersonList:d,reset:()=>{l.value={vorname:"",vornamen:"",nachname:"",gebdatum:"",email:"",svnr:"",geschlecht:"",staatsbuergerschaft:"A",anmerkung:""},Object.keys(c).forEach(t=>{c[t]=!1})},save:async()=>{if(c.geburtsdatumBlured||(c.geburtsdatumBlured=!0),!(o.value.checkValidity()&&(Object.keys(c).forEach(t=>{c[t]=!0}),h(l.value.nachname)&&f(l.value.vorname)&&m(l.value.email)&&g(l.value.gebdatum)&&v(l.value.geschlecht)&&wt(l.value.svnr))))throw console.log("form invalid"),new Error("form invalid");u.value=!0;try{const t=await n.call(mt.createEmployee({action:"quick",payload:{...l.value}}));b(t.data.person_id,t.data.uid)}catch(t){a.handleSystemError(t)}finally{u.value=!1}c.wasValidated=!0}}},template:'\n    <form class="row g-3" ref="createEmployeeFrm" xmlns="http://www.w3.org/1999/html">\n        <div class="col-md-8">\n            <h6>Stammdaten Mindestanforderung</h6>\n            <div class="row">\n                <div class="col-md-5">\n                    <label for="surname" class="required form-label">Nachname</label>\n                    <input id="surname" \n                        @blur="frmState.nachnameBlured = true"\n                        v-model="currentValue.nachname"\n                        type="text" \n                        class="form-control form-control-sm" \n                        :class="{ \'is-invalid\': !validNachname(currentValue.nachname) && frmState.nachnameBlured}"\n                        placeholder="Nachname" aria-label="nachname">\n                    <div class="invalid-feedback" v-if="frmState.nachnameBlured && !validNachname(currentValue.nachname)">\n                        Pflichtfeld\n                    </div>\n                </div>  \n                <div class="col-md-3">\n                    <label for="firstname" class="required form-label">Vorname</label>\n                    <input id="firstname" \n                        v-model="currentValue.vorname" \n                        @blur="frmState.vornameBlured = true"\n                        :class="{ \'is-invalid\': !validNachname(currentValue.vorname) && frmState.vornameBlured}"\n                        type="text" \n                        class="form-control form-control-sm" \n                        aria-label="vorname">\n                    <div class="invalid-feedback" v-if="frmState.vornameBlured && !validVorname(currentValue.vorname)">\n                        Pflichtfeld\n                    </div>\n                </div>\n               \n                <div class="col-md-3">\n                    <label for="firstnames" class="form-label">Vornamen</label>\n                    <input id="firstnames" \n                        v-model="currentValue.vornamen" \n                        type="text" \n                        class="form-control form-control-sm" \n                        aria-label="vornamen">\n                </div>\n            </div>\n            \n            <div class="row">\n                \x3c!-- Geschlecht --\x3e\n                <div class="col-md-5">\n                    <label for="geschlecht" class="required form-label">Geschlecht</label><br>\n                    <select id="geschlecht" v-model="currentValue.geschlecht" \n                        class="form-select form-select-sm" \n                        :class="{ \'is-invalid\': !validGeschlecht(currentValue.geschlecht) && frmState.geschlechtBlured}"\n                        @blur="frmState.geschlechtBlured = true"\n                        aria-label=".form-select-sm " >\n                        <option value="w">weiblich</option>\n                        <option value="m">männlich</option>\n                        <option value="x">divers</option>\n                        <option value="u">unbekannt</option>\n                    </select>\n                    <div class="invalid-feedback" v-if="frmState.geschlechtBlured && !validGeschlecht(currentValue.geschlecht)">\n                    Pflichtfeld\n                    </div>\n                </div>\n                <div class="col-md-3">\n                    <label for="birthdate" class="required form-label">Geburtsdatum</label>\n                    <datepicker id="birthdate"\n                        :teleport="true"\n                        :class="{ \'is-invalid\': !validGeburtsdatum(currentValue.gebdatum) && frmState.geburtsdatumBlured}"\n                        @blur="frmState.geburtsdatumBlured = true"             \n                        v-model="currentValue.gebdatum"\n                        v-bind:enable-time-picker="false"\n                        text-input \n                        locale="de"\n                        format="dd.MM.yyyy"\n                        auto-apply \n                        model-type="yyyy-MM-dd"></datepicker>\n                        <div class="invalid-feedback" v-if="frmState.geburtsdatumBlured && !validGeburtsdatum(currentValue.gebdatum)">\n                        Pflichtfeld\n                        </div>\n                </div>\n                <div class="col-md-3">\n                    <label for="svnr" class="form-label">SVNR</label>\n                    <input id="svnr" \n                        v-model="currentValue.svnr" \n                        @blur="frmState.svnrBlured = true"\n                        type="text" \n                        class="form-control form-control-sm"\n                        :class="{ \'is-invalid\': !validSVNR(currentValue.svnr) && frmState.svnrBlured}" \n                        aria-label="svnr">\n                </div>\n            </div>        \n                \n            <div class="row">\n                \x3c!-- Staatsbürgerschaft, etc. --\x3e\n                <div class="col-md-6">\n                    <label for="staatsbuergerschaft" class="required form-label">Staatsbürgerschaft</label>                \n                    <select id="staatsbuergerschaft" class="form-select form-select-sm" aria-label=".form-select-sm "  v-model="currentValue.staatsbuergerschaft" >\n                        <option v-for="(item, index) in nations" :value="item.nation_code">\n                            {{ item.nation_text }}\n                        </option>\n                    </select>\n                </div>\n                \x3c!-- Email --\x3e\n                <div class="col-md-5">\n                    <label for="email" class="required form-label">Email</label>\n                    <input id="email" \n                        v-model="currentValue.email" \n                        @blur="frmState.emailBlured = true"\n                        type="text" \n                        class="form-control form-control-sm" \n                        :class="{ \'is-invalid\': !validEmail(currentValue.email) && frmState.emailBlured}"\n                        aria-label="email">\n                    <div class="invalid-feedback" v-if="frmState.emailBlured && !validEmail(currentValue.email)">\n                        Pflichtfeld\n                    </div>\n                </div>\n            </div>\n            \n            <div class="row">\n                <div class="col-md-11">\n                    <label for="inputAddress" class="form-label">Anmerkung</label>\n                    <textarea type="text" class="form-control form-control-sm"  id="anmerkungen" v-model="currentValue.anmerkung"/>\n                </div>\n            </div>\n            \n        </div>\n        <div class="col-md-4">\n        <template v-if="unrulyPersonList.length">\n            <h6><span class="badge" :class="\'bg-unruly rounded-0\'" >Unruly</span> Personen mit ähnlichen Daten:</h6>\n            <p v-for="unruly in unrulyPersonList">\n                {{unruly.vorname}} {{unruly.nachname}} PID: {{unruly.person_id}}\n            </p>\n        </template>\n        </div>\n    </form>\n    '};var Dt={name:"Step",props:{title:{type:String,default:"Step"}},setup:()=>({selectedTitle:Vue.inject("selectedTitle")}),template:'\n        <div class="step-content" v-show="title == selectedTitle">\n            <slot/>\n        </div>\n      '};const Ft={name:"CreateWizard",components:{Modal:Q,Steps:{name:"Steps",expose:["selectedTitle","selectStep","reset"],setup(t,{slots:e}){const n=Vue.ref(e.default().map(t=>t.props.title)),a=Vue.ref(n.value[0]);return Vue.provide("selectedTitle",a),{selectedTitle:a,stepTitles:n,selectStep:t=>{a.value=t},reset:()=>a.value=n.value[0]}},template:'\n     <div class="steps">\n        <slot></slot>\n     </div>\n     '},Step:Dt,SearchExistingDialog:xt,CreateEmployeeFrm:Ct},props:{},expose:["showModal"],setup(t){const{watch:e,ref:n}=Vue,a=n(),r=n(),s=n(),i=n(),l=n();let o,d;const u=()=>{a.value.hide({type:"CANCEL"})};return{modalRef:a,stepsRef:r,searchExistingRef:s,schnellanlageRef:i,showModal:()=>(a.value.show(),new Promise((t,e)=>{o=t,d=e})),hideModal:u,okHandler:()=>{i.value.save().then(()=>{console.log("employee successfully created"),r.value.reset(),l.value={surname:"",birthdate:null},s.value.reset(),i.value.reset(),u(),o({type:"CREATED",payload:{uid:"dummy"}})}).catch(t=>{console.log(t.message),d(!1)})},cancelHandler:()=>{u(),o({type:"CANCELED",payload:{uid:"dummy"}})},currentValue:l,showCreateHandler:()=>{r.value.selectStep("Schnellanlage")},getSelectedTitle:()=>null!=r.value?r.value.selectedTitle:"-",searchCriteriaHandler:t=>{l.value=t},takeHandler:()=>{u(),o({type:"CREATED",payload:{uid:"dummy"}})}}},template:'\n        <Modal :title="\'Mitarbeiter anlegen\'" ref="modalRef" id="createWizardModal">\n            <template #body>\n            \n                <Steps  ref="stepsRef">\n                    <Step title="Suche">\n                        <search-existing-dialog ref="searchExistingRef" @change="searchCriteriaHandler" @take="takeHandler" @select="cancelHandler" />\n                    </Step>\n                    <Step title="Schnellanlage" >\n                        <create-employee-frm ref="schnellanlageRef" :defaultval="currentValue" />\n                    </Step>                    \n                </Steps>\n\n            </template>\n            <template #footer>\n                <div class="float-start">\n                    <button type="button" class="btn btn-outline-secondary" @click="stepsRef.selectStep(\'Suche\')" v-if="getSelectedTitle() != \'Suche\'" >\n                        <i class="fa fa-chevron-left"></i> Zurück\n                    </button>\n                </div>\n                <div class="float-start">\n                    <button type="button" class="btn btn-primary" @click="okHandler()" v-if="getSelectedTitle() != \'Suche\'" >\n                        Mitarbeiter anlegen\n                    </button>\n                    <button type="button" class="btn btn-primary"  :disabled="currentValue==null || currentValue.surname == \'\' || currentValue.birthdate==null || currentValue.birthdate==\'\'"  @click="showCreateHandler()" v-if="getSelectedTitle() != \'Schnellanlage\'">\n                        Neue Person anlegen <i class="fa fa-chevron-right"></i>\n                    </button>\n                </div>\n            </template>\n\n        </Modal>'},Vt=FHC_JS_DATA_STORAGE_OBJECT.app_root.replace(/(https:|)(^|\/\/)(.*?\/)/g,"")+FHC_JS_DATA_STORAGE_OBJECT.ci_router;var Pt={name:"EmployeeHome",components:{Sidebar:Sidebar,CoreNavigationCmpt:_,CoreFilterCmpt:b,EmployeeEditor:kt,verticalsplit:k,searchbar:$,CreateWizard:Ft},setup(){const{watch:t,ref:e,inject:n}=Vue,a=VueRouter.useRouter(),r=VueRouter.useRoute(),s=e(!1),i=e(null),l=e(null),o=e({}),d=e(null),u=e(),c=n("$api"),p=Vue.inject("$fhcAlert");t(()=>r.params,t=>{i.value=parseInt(t.id),l.value=t.uid,"bottom"==d.value.isCollapsed()&&(s.value=!0,d.value.collapseTop())});const h=(t,e,n)=>{"bottom"==d.value.isCollapsed()&&d.value.showBoth();let r=`/${Vt}/extensions/FHC-Core-Personalverwaltung/Employees/${t}/${e}/summary`+(null!=n?`?d=${n}`:"");a.push(r)},f=(t,e)=>{h(e.getData().PersonId,e.getData().UID,null)},v=[{event:"rowClick",handler:f},{event:"dataFiltered",handler:function(t,e){document.getElementById("search_count").innerHTML=e.length}},{event:"dataLoaded",handler:function(t){document.getElementById("total_count").innerHTML=t.length}}],m={height:"100%",layout:"fitColumns",footerElement:'<div>&sum; <span id="search_count"></span> / <span id="total_count"></span></div>',columns:[{title:"UID",field:"UID",headerFilter:!0},{title:"Person ID",field:"PersonId",headerFilter:!0},{title:"Personalnummer",field:"Personalnummer",headerFilter:!0},{title:"Vorname",field:"Vorname",headerFilter:!0},{title:"Nachname",field:"Nachname",headerFilter:!0},{title:"TitelPre",field:"TitelPre",headerFilter:!0},{title:"TitelPost",field:"TitelPost",headerFilter:!0},{title:"Alias",field:"Alias",headerFilter:!0},{title:"Geburtsdatum",field:"Geburtsdatum",headerFilter:!0},{title:"Aktiv",field:"Aktiv",hozAlign:"center",formatter:"tickCross",formatterParams:{tickElement:'<i class="fas fa-check text-success"></i>',crossElement:'<i class="fas fa-times text-danger"></i>'},headerFilter:"tickCross",headerFilterParams:{tristate:!0,elementAttributes:{value:"true"}},headerFilterEmptyCheck:function(t){return null===t}},{title:"Fixangestellt",field:"Fixangestellt",headerFilter:!0},{title:"SVNR",field:"SVNR",headerFilter:!0},{title:"Raum",field:"Raum",headerFilter:"list",headerFilterParams:{valuesLookup:!0,autocomplete:!0,sort:"asc"}},{title:"Geschlecht",field:"Geschlecht",formatter:function(t,e,n){var a=t.getValue();return"m"===a?"männlich":"w"===a?"weiblich":"x"===a?"divers":"u"===a?"unbekannt":a},headerFilter:"list",headerFilterParams:{values:{m:"männlich",w:"weiblich",x:"divers",u:"unbekannt"},autocomplete:!0,sort:"asc"}},{title:"Durchwahl",field:"Durchwahl",headerFilter:!0},{title:"Standardkostenstelle",field:"Standardkostenstelle",headerFilter:"list",headerFilterFunc:"=",headerFilterParams:{valuesLookup:!0,autocomplete:!0,sort:"asc"}},{title:"Disziplinäre Zuordnung",field:"Disziplinäre Zuordnung",headerFilter:"list",headerFilterFunc:"=",headerFilterParams:{valuesLookup:!0,autocomplete:!0,sort:"asc"}},{title:"OE Key",field:"OE Key",headerFilter:!0}]};Vue.onMounted(()=>{let t=r.params.id,e=r.params.uid;console.log("EMPLOYEE APP CREATED; person_id=",t),null!=t?(i.value=parseInt(t),l.value=e,s.value=!0,d.value.collapseTop()):d.value.collapseBottom()}),VueRouter.onBeforeRouteUpdate((t,e)=>{}),K.actions.employee.defaultaction={type:"function",action:t=>h(t.person_id,t.uid)};return{personSelectedHandler:h,newSideMenuEntryHandler:t=>{o.value=t},searchfunction:t=>c.call(B.search(t)),selectRecordHandler:f,openCreateWizard:()=>{u.value.showModal().then(t=>{!1!==t&&"CANCELED"!=t.type?p.alertSuccess("Mitarbeiter erstellt."):!1===t&&p.alertError("Mitarbeiter anlegen fehlgeschlagen!")})},createWizardRef:u,isEditorOpen:s,currentPersonID:i,currentPersonUID:l,appSideMenuEntries:o,searchbaroptions:K,employeesTabulatorEvents:v,employeesTabulatorOptions:m,verticalsplitRef:d,route:r}},template:`\n\n        <header class="navbar navbar-expand-lg navbar-dark sticky-top bg-dark flex-md-nowrap p-0 border-bottom">\n            <a class="navbar-brand col-md-3 col-lg-2 me-0 px-3" href="${FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router}">FHComplete [PV21]</a>\n            <button class="navbar-toggler position-absolute d-md-none collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#sidebarMenu" aria-controls="sidebarMenu" aria-expanded="false" aria-label="Toggle navigation">\n            <span class="navbar-toggler-icon"></span>\n            </button>\n            <div id="chooser" class="w-100">\n            <searchbar :searchoptions="searchbaroptions" :searchfunction="searchfunction"></searchbar>\n            </div>\n            <div class="navbar-nav">\n            <div class="nav-item dropdown">\n                <a class="nav-link dropdown-toggle px-3" data-bs-toggle="dropdown" href="#" id="navbarDropdownMenuLink">Häufige Funktionen</a>\n                <ul class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">\n                    <li><a class="dropdown-item" href="#">Action</a></li>\n                    <li><a class="dropdown-item" href="#">Another action</a></li>\n                    <li><a class="dropdown-item" href="#">Something else here</a></li>\n                </ul>\n            </div>\n            </div>\n        </header>\n\n        <div class="container-fluid">\n            <div class="row">\n                \n            <core-navigation-cmpt :add-side-menu-entries="appSideMenuEntries" hide-top-menu  left-nav-css-classes="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse"></core-navigation-cmpt>\n\n            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-3">\n                        \n                <verticalsplit id="macombined" ref="verticalsplitRef" >\n                    <template #top>\n                        <div class="d-flex  flex-column" style="height:100%"  >\n                        <div id="master" class="flex-shrink-0 d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3">\n                                    \n                            <div class="flex-fill align-self-center">\n                            <h1 class="h2" style="margin-bottom:0" > Mitarbeiter </h1>\n                            </div>\t\t\t\t\t\t\t\n                        </div>\n                            \x3c!-- Filter component --\x3e\n                            <core-filter-cmpt\n                            filter-type="EmployeeViewer"\n                            :sideMenu="false"\n                            :tabulator-options="employeesTabulatorOptions"\n                            :tabulator-events="employeesTabulatorEvents"\n                            :new-btn-label="'Mitarbeiter'"\n                            :new-btn-show="true"\n                            @nw-new-entry="newSideMenuEntryHandler"\n\t\t\t\t\t\t\t@click:new="openCreateWizard()">\n                            </core-filter-cmpt>\n                        </div>\n                    </template>\n                    <template #bottom>\n                        <employee-editor  v-if="currentPersonID!=null" :personid="currentPersonID" :personuid="currentPersonUID" :open="isEditorOpen" @person-selected="(e) => personSelectedHandler(e.person_id, e.uid, e.date)" ></employee-editor>\n                    </template>\n                </verticalsplit> \n                            \n            </main>\n            </div>\n        </div>      \t\t\n\t\t\n\t\t<CreateWizard id="createWizard" ref="createWizardRef" ></CreateWizard>\n    \n    `},Et={name:"DebugViewer",template:'\n  <div>\n    <pre style="background-color: #000; color: #0f0; padding: .5em; height: 90vh;">\n{{text}}\n    </pre>\n  </div>\n  ',props:["text"]},Tt=Vue.reactive({mode:"",unternehmen:"",mitarbeiter_uid:"",tmpstoreid:null,showmsgs:!0,gueltigkeit:{gueltig_ab:"",gueltig_bis:""},dv:{},vbs:{},getDV:function(){return this.dv},setDV:function(t){this.dv=JSON.parse(JSON.stringify(t))},getDVPayload:function(){return JSON.parse(JSON.stringify(this.dv))},addVB:function(t,e){this.vbs[t]=e},removeVB:function(t){delete this.vbs[t]},getVB:function(t){return void 0!==this.vbs[t]?this.vbs[t]:null},getVBsPayload:function(){return JSON.parse(JSON.stringify(this.vbs))},getMode:function(){return this.mode},setMode:function(t){this.mode=t},getTmpStoreId:function(){return this.tmpstoreid},setTmpStoreId:function(t){this.tmpstoreid=t},reset:function(){this.gueltigkeit={gueltig_ab:"",gueltig_bis:""},this.dv={data:{vertragsart_kurzbz:""}},this.vbs={}}}),$t={props:["preset"],data:function(){return{children:[],store:Tt}},created:function(){this.children=this.getSortedChildrenFromPreset()},watch:{preset:function(){this.children=[],this.$nextTick(function(){this.children=this.getSortedChildrenFromPreset()})}},methods:{getSortedChildrenFromPreset:function(){var t=JSON.parse(JSON.stringify(this.preset.children)),e=this.store;if(t.length>0&&"string"==typeof t[0]&&(t=t.filter(function(t){return null!==e.getVB(t)})),t.length<2)return t;const n=function(t,e){const n=void 0!==t?.data?.gueltigkeit?.data?.gueltig_ab?t.data.gueltigkeit.data.gueltig_ab:null,a=void 0!==e?.data?.gueltigkeit?.data?.gueltig_ab?e.data.gueltigkeit.data.gueltig_ab:null;return(null!==n&&n.match(/[0-9]{4}-[0-9]{2}-[0-9]{2}/)?new Date(n).getTime():1/0)-(null!==a&&a.match(/[0-9]{4}-[0-9]{2}-[0-9]{2}/)?new Date(a).getTime():1/0)};return"object"==typeof t[0]&&void 0===t[0]?.type&&console.log("Child Type undefined: "+JSON.stringify(t[0])),"object"==typeof t[0]&&void 0!==t[0]?.type&&"gehaltsbestandteil"===t[0].type?(t.sort((t,e)=>n(t,e)),t.reverse()):"string"==typeof t[0]&&(t.sort((t,e)=>{const a=this.store.getVB(t),r=this.store.getVB(e);return n(a,r)}),t.reverse()),t}}},Bt={props:["config"],methods:{isinputdisabled:function(t){return void 0!==this.config?.guioptions?.disabled&&this.config.guioptions.disabled.includes(t)},showinput:function(t){return void 0===this.config?.guioptions?.hidden||!this.config.guioptions.hidden.includes(t)},markGBsEnded:function(){void 0!==this.$refs?.gbh&&this.$refs.gbh.markGBsEnded()},toggledelete:function(){this.db_delete=!this.db_delete,void 0!==this.$refs?.gbh&&this.$refs.gbh.setGBsDelete(this.db_delete)},setDelete:function(t){this.db_delete=t}},computed:{isendable:function(){return void 0!==this.config?.guioptions?.endable&&this.config.guioptions.endable},isdeleteable:function(){return void 0!==this.config?.guioptions?.deleteable&&this.config.guioptions.deleteable},isremoveable:function(){return void 0!==this.config?.guioptions?.removeable&&this.config.guioptions.removeable},canhavegehaltsbestandteile:function(){return void 0===this.config?.guioptions?.canhavegehaltsbestandteile||this.config.guioptions.canhavegehaltsbestandteile},getgehaltsbestandteile:function(){return{children:void 0!==this.config?.gbs?this.config.gbs:[]}},getgueltigkeit:function(){return void 0!==this.config?.gueltigkeit?this.config.gueltigkeit:void 0!==this.config?.data?.gueltigkeit?this.config.data.gueltigkeit:{}},vbcssclasses:function(){var t=[];return(void 0===this.config?.guioptions?.nobottomborder||void 0!==this.config?.guioptions?.nobottomborder&&!1===this.config.guioptions.nobottomborder)&&t.push("border-bottom"),(void 0===this.config?.guioptions?.nobottommargin||void 0!==this.config?.guioptions?.nobottommargin&&!1===this.config.guioptions.nobottommargin)&&t.push("mb-3"),t}}},Ot={name:"Gueltigkeit",template:'\n  <div class="col-4 vbform_gueltigkeit">\n    <div class="input-group input-group-sm">\n      <datepicker ref="dpvon" v-model="gueltig_ab" :disabled="isdisabled || isinputdisabled(\'gueltig_ab\')"\n        @update:model-value="gueltigkeitchanged"\n        v-bind:enable-time-picker="false"\n        v-bind:placeholder="\'gültig ab\'"\n        v-bind:teleport="true"\n        six-weeks\n        auto-apply \n        text-input \n        locale="de"\n        format="dd.MM.yyyy"\n        model-type="yyyy-MM-dd"></datepicker>\n      <span class="input-group-text">&dash;</span>\n      <datepicker ref="dpbis" v-model="gueltig_bis" :disabled="isdisabled || isinputdisabled(\'gueltig_bis\')"\n        @update:model-value="gueltigkeitchanged"\n        v-bind:enable-time-picker="false"\n        v-bind:placeholder="\'gültig bis\'"\n        v-bind:min-date="minDateBis"\n        v-bind:start-date="minDateBis"\n        v-bind:teleport="true"\n        six-weeks\n        auto-apply \n        text-input\n        locale="de"\n        format="dd.MM.yyyy"\n        model-type="yyyy-MM-dd"></datepicker>\n      <span class="input-group-text" v-if="(this.sharedstatemode === \'reflect\')">\n        <i @click="changesharedstatemode(\'custom\')" class="fas fa-link"></i>\n      </span>\n      <span class="input-group-text" v-else-if="(this.sharedstatemode === \'custom\')">\n        <i @click="changesharedstatemode(\'reflect\')" class="fas fa-unlink"></i>\n      </span>\n      <span class="input-group-text" v-else-if="(this.isendable)">\n        <i @click="markended()" class="fas fa-calendar-times"></i>\n      </span>\n      <span class="input-group-text bg-white border-0 opacity-0" v-else>\n        <i class="fas fa-square text-white"></i>\n      </span>\n    </div>\n  </div>\n  ',props:{initialsharedstatemode:{type:String,default:"reflect",validator:function(t){return["reflect","set","custom","ignore"].includes(t)}}},data:function(){return{sharedstate:Tt,sharedstatemode:"",gueltig_ab:"",gueltig_bis:""}},components:{datepicker:VueDatePicker},mixins:[Bt],emits:["markended","gueltigkeitchanged"],created:function(){this.sharedstatemode=this.initialsharedstatemode,this.setDataFromSharedSate(),this.setGUIOptionsFromConfig(),this.setDataFromConfig()},mounted:function(){this.gueltigkeitchanged()},watch:{"sharedstate.gueltigkeit.gueltig_ab":function(){"reflect"===this.sharedstatemode&&(this.gueltig_ab=this.sharedstate.gueltigkeit.gueltig_ab)},"sharedstate.gueltigkeit.gueltig_bis":function(){"reflect"===this.sharedstatemode&&(this.gueltig_bis=this.sharedstate.gueltigkeit.gueltig_bis)},config:function(){this.setGUIOptionsFromConfig(),this.setDataFromConfig()}},methods:{setDataFromConfig:function(){void 0!==this?.config?.data?.gueltig_ab&&(this.gueltig_ab=this.config.data.gueltig_ab),void 0!==this?.config?.data?.gueltig_bis&&(this.gueltig_bis=this.config.data.gueltig_bis)},setDataFromSharedSate:function(){"reflect"===this.sharedstatemode&&(this.gueltig_ab=this.sharedstate.gueltigkeit.gueltig_ab,this.gueltig_bis=this.sharedstate.gueltigkeit.gueltig_bis)},setGUIOptionsFromConfig:function(){void 0!==this?.config?.guioptions?.sharedstatemode&&(this.sharedstatemode=this.config.guioptions.sharedstatemode)},getPayload:function(){var t=void 0!==this?.config?.guioptions?JSON.parse(JSON.stringify(this.config.guioptions)):{};return t.sharedstatemode=this.sharedstatemode,{guioptions:t,data:{gueltig_ab:this.gueltig_ab,gueltig_bis:this.gueltig_bis}}},gueltigkeitchanged:function(){"set"===this.sharedstatemode&&(this.sharedstate.gueltigkeit.gueltig_ab=this.gueltig_ab,this.sharedstate.gueltigkeit.gueltig_bis=this.gueltig_bis),this.$emit("gueltigkeitchanged",{gueltig_ab:this.gueltig_ab,gueltig_bis:this.gueltig_bis})},changesharedstatemode:function(t){this.sharedstatemode=t,this.setDataFromSharedSate()},markended:function(){if(""!==this.sharedstate.gueltigkeit.gueltig_ab){var t=!1,e=new Date(this.sharedstate.gueltigkeit.gueltig_ab);if(e.setDate(e.getDate()-1),null===this.gueltig_bis||""===this.gueltig_bis)t=!0;else{new Date(this.gueltig_bis)>e&&(t=!0)}t&&(this.gueltig_bis=e.toISOString().split("T")[0],this.$emit("markended"))}else alert("Bitte zuerst das Gültigkeitsdatum der Änderung festlegen.")}},computed:{isdisabled:function(){return"reflect"===this.sharedstatemode},minDateBis:function(){return""!==this.gueltig_ab?this.gueltig_ab:new Date}}},Mt={name:"Errors",template:'\n  <div v-if="errors.length > 0" class="row g-2">\n    <div v-if="padleft" class="col-1">&nbsp;</div>    \n    <div :class="getColumnClass">\n        <div class="alert py-1 alert-danger" v-for="(error, idx) in errors" :key="idx">{{ error }}</div>\n    </div>\n    <div v-if="padright" class="col-1">&nbsp;</div>\n  </div>\n  ',props:{errors:{type:Array,default:[]},padleft:{type:Boolean,default:!1},padright:{type:Boolean,default:!1}},computed:{getColumnClass:function(){var t=12;return this.padleft&&t--,this.padright&&t--,"col-"+t}}},Ht={name:"Infos",template:'\n  <div v-if="infos.length > 0" class="row g-2">\n    <div v-if="padleft" class="col-1">&nbsp;</div>\n    <div :class="getColumnClass">\n        <div class="alert py-1 alert-info" v-for="(error, idx) in infos" :key="idx">{{ error }}</div>\n    </div>\n    <div v-if="padright" class="col-1">&nbsp;</div>\n  </div>\n  ',props:{infos:{type:Array,default:[]},padleft:{type:Boolean,default:!1},padright:{type:Boolean,default:!1}},computed:{getColumnClass:function(){var t=12;return this.padleft&&t--,this.padright&&t--,"col-"+t}}},It={name:"Gehaltsbestandteil",template:'\n  <div class="card card-body border-0 bg-primary my-2 px-0" style="--bs-bg-opacity: .1;">\n    <infos :infos="(config?.guioptions?.infos !== undefined) ? config?.guioptions?.infos : []"></infos>\n    <errors :errors="(config?.guioptions?.errors !== undefined) ? config?.guioptions?.errors : []"></errors>\n    <div class="row g-2 mb-1">\n      <div class="col-2 ps-3">\n        <select v-model="gehaltstyp" :disabled="isinputdisabled(\'gehaltstyp\')" class="form-select form-select-sm" aria-label=".form-select-sm example">\n          <option\n            v-for="gt in gehaltstypen"\n            :value="gt.value"\n            :selected="isselected(gt.value, this.gehaltstyp)"\n            :disabled="gt.disabled">\n            {{ gt.label }}\n          </option>\n        </select>\n      </div>\n      <div class="col-2">\n        <div class="input-group input-group-sm">\n          <input v-model="betrag" :disabled="isinputdisabled(\'betrag\')" type="text" class="form-control form-control-sm" placeholder="Betrag" aria-label="betrag">\n          <span class="input-group-text">&euro;</span>\n        </div>\n      </div>\n      <div class="col-2">\n        <div class="input-group input-group-sm">\n          <input v-model="betrag_valorisiert" disabled="" type="text" class="form-control form-control-sm" placeholder="Betrag valorisiert" aria-label="betrag">\n          <span class="input-group-text">&euro; (valorisiert)</span>\n        </div>\n      </div>\n      <div class="col-1">&nbsp;</div>\n      <gueltigkeit ref="gueltigkeit" :config="getgueltigkeit"></gueltigkeit>\n      <div class="col-1 pe-3">\n        <span v-if="db_delete" class="badge bg-danger">wird gelöscht</span>        \n        <button v-if="isremoveable" type="button" class="btn-close btn-sm p-2 float-end" @click="removeGB" aria-label="Close"></button>\n        <button v-if="isdeleteable" type="button" class="btn btn-sm p-2 float-end" @click="toggledelete" aria-label="Delete"><i v-if="db_delete" class="fas fa-trash-restore"></i><i v-else="" class="fas fa-trash"></i></button>\n      </div>\n    </div>\n    <div class="row g-2 mb-3">\n      <div class="col-2 ps-3">\n        <select v-model="auszahlungen" :disabled="isinputdisabled(\'auszahlungen\')" class="form-select form-select-sm" aria-label=".form-select-sm example">\n          <option value="14" selected>14 Auszahlungen</option>\n          <option value="12">12 Auszahlungen</option>\n        </select>\n      </div>\n      <div class="col-2">\n        <div class="input-group input-group-sm">\n            <datepicker v-model="valorisierungssperre" :disabled="isinputdisabled(\'valorisierungssperre\')"\n              v-bind:enable-time-picker="false"\n              v-bind:placeholder="\'Valorisierungssperre bis\'"\n              v-bind:teleport="true"\n              six-weeks\n              auto-apply \n              text-input \n              locale="de"\n              format="dd.MM.yyyy"\n              model-type="yyyy-MM-dd"></datepicker>\n        </div>\n      </div>\n      <div class="col-2">\n        <div class="form-check form-control-sm">\n          <input v-model="valorisierung" :disabled="isinputdisabled(\'valorisierung\')" class="form-check-input" type="checkbox" value="" :id="\'valorisierung_\' + config.guioptions.id">\n          <label class="form-check-label" :for="\'valorisierung_\' + config.guioptions.id">\n            Valorisierung\n          </label>\n        </div>\n      </div>\n      <div class="col-6">&nbsp;</div>\n    </div>\n  </div>\n  ',data:function(){return{id:null,gehaltstyp:"",betrag:"",betrag_valorisiert:"",gueltig_ab:"",gueltig_bis:"",valorisierung:!0,valorisierungssperre:null,auszahlungen:14,db_delete:!1}},inject:["gehaltstypen"],components:{gueltigkeit:Ot,infos:Ht,errors:Mt,datepicker:VueDatePicker},mixins:[Bt],emits:["removeGB"],created:function(){this.setDataFromConfig()},methods:{isselected:function(t,e){return t===e},setDataFromConfig:function(){void 0!==this.config?.data?.id&&(this.id=this.config.data.id),void 0!==this.config?.data?.gehaltstyp&&(this.gehaltstyp=this.config.data.gehaltstyp),void 0!==this.config?.data?.betrag&&(isNaN(this.config.data.betrag)||(this.config.data.betrag=this.config.data.betrag.toString()),this.betrag=this.config.data.betrag.replace(".",",")),void 0!==this.config?.data?.betrag_valorisiert&&(isNaN(this.config.data.betrag_valorisiert)||(this.config.data.betrag_valorisiert=this.config.data.betrag_valorisiert.toString()),this.betrag_valorisiert=this.config.data.betrag_valorisiert.replace(".",",")),void 0!==this.config?.data?.valorisierung&&(this.valorisierung=this.config.data.valorisierung),void 0!==this.config?.data?.valorisierungssperre&&(this.valorisierungssperre=this.config.data.valorisierungssperre),void 0!==this.config?.data?.auszahlungen&&(this.auszahlungen=this.config.data.auszahlungen),void 0!==this.config?.data?.db_delete&&(this.db_delete=this.config.data.db_delete)},removeGB:function(){this.$emit("removeGB",{id:this.config.guioptions.id})},getPayload:function(){return{type:this.config.type,guioptions:JSON.parse(JSON.stringify(this.config.guioptions)),data:{id:this.id,gehaltstyp:this.gehaltstyp,betrag:this.betrag.replace(",","."),betrag_valorisiert:this.betrag.replace(",","."),db_delete:this.db_delete,gueltigkeit:this.$refs.gueltigkeit.getPayload(),valorisierung:Boolean(this.valorisierung),valorisierungssperre:this.valorisierungssperre,auszahlungen:this.auszahlungen}}},markGBEnded:function(){this.$refs.gueltigkeit.markended()}}},Rt=function(){var t,e,n="";for(t=0;t<32;t++)e=16*Math.random()|0,8!=t&&12!=t&&16!=t&&20!=t||(n+="-"),n+=(12==t?4:16==t?3&e|8:e).toString(16);return n},Lt={name:"GehaltsbestandteilHelper",template:'\n  <div class="row pt-3 pb-1">\n    <div class="col-12">\n      <div class="position-relative">\n        <a class="btn btn-sm btn-primary" href="javascript:void(0);" @click="addGB">\n          <i class="fas fa-plus"></i>&nbsp;Gehaltsbestandteil{{ childcount }}\n        </a>\n      </div>\n    </div>\n  </div>\n  <gehaltsbestandteil ref="parts" v-for="config in children"\n    v-bind:config="config" :key="config.guioptions.id" @removeGB="removeGB"></gehaltsbestandteil>\n  ',data:function(){return{payload:[]}},components:{gehaltsbestandteil:It},mixins:[$t],methods:{addGB:function(t){t.preventDefault(),t.stopPropagation(),this.children.unshift({type:"gehaltsbestandteil",guioptions:{id:Rt(),removeable:!0}})},removeGB:function(t){var e=this.children.filter(function(e){return e.guioptions.id!==t.id});this.children=e},getPayload:function(){var t=[];for(var e in this.$refs.parts)t.push(this.$refs.parts[e].getPayload());return t},markGBsEnded:function(){for(var t in this.$refs.parts)this.$refs.parts[t].markGBEnded()},setGBsDelete:function(t){for(var e in this.$refs.parts)this.$refs.parts[e].setDelete(t)}},computed:{childcount:function(){return this.children.length>0?" ("+this.children.length+")":""}}},jt={getTeilzeittypen:()=>({method:"post",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/CommonsAPI/getTeilzeittypen"})},Jt={name:"VertragsbestandteilStunden",template:'\n  <div class="card card-body my-2">\n    <div class="py-0">\n      <infos :infos="(config?.guioptions?.infos !== undefined) ? config?.guioptions?.infos : []"></infos>\n      <errors :errors="(config?.guioptions?.errors !== undefined) ? config?.guioptions?.errors : []"></errors>\n      <div class="row g-2">\n        <div class="col-3">\n          <div class="input-group input-group-sm mb-3">\n            <input v-model="stunden" :disabled="isinputdisabled(\'stunden\')" type="text" class="form-control form-control-sm" placeholder="Stunden" aria-label="stunden">\n            <span class="input-group-text">Std/Woche</span>\n          </div>\n        </div>\n        <div class="col-3">\n          <select v-model="teilzeittyp_kurzbz" :disabled="isinputdisabled(\'teilzeittyp_kurzbz\')" class="form-select form-select-sm" aria-label=".form-select-sm example">\n            <option\n              v-for="f in lists.teilzeittypen"\n              :value="f.value"\n              :selected="isselected(f.value, this.teilzeittyp_kurzbz)"\n              :disabled="f.disabled">\n              {{ f.label }}\n            </option>\n          </select>\n        </div>\n        <div class="col-1">&nbsp;</div>\n        <gueltigkeit ref="gueltigkeit" :config="getgueltigkeit" @markended="markGBsEnded" @gueltigkeitchanged="gueltigkeitchanged"></gueltigkeit>\n        <div class="col-1 pe-3">\n          <span v-if="db_delete" class="badge bg-danger">wird gelöscht</span>\n          <button v-if="isremoveable" type="button" class="btn-close btn-sm p-2 float-end" @click="removeVB" aria-label="Close"></button>\n          <button v-if="isdeleteable" type="button" class="btn btn-sm p-2 float-end" @click="toggledelete" aria-label="Delete"><i v-if="db_delete" class="fas fa-trash-restore"></i><i v-else="" class="fas fa-trash"></i></button>\n        </div>\n      </div>\n    </div>\n    <gehaltsbestandteilhelper ref="gbh" v-bind:preset="getgehaltsbestandteile"></gehaltsbestandteilhelper>\n  </div>\n  ',components:{gehaltsbestandteilhelper:Lt,gueltigkeit:Ot,infos:Ht,errors:Mt},mixins:[Bt],emits:{removeVB:null},data:function(){return{id:null,stunden:"",teilzeittyp_kurzbz:"",lists:{teilzeittypen:[]},db_delete:!1}},created:function(){this.getTeilzeittypen(),this.setDataFromConfig()},inject:["$api"],methods:{gueltigkeitchanged:function(t){console.log(JSON.stringify(t))},isselected:function(t,e){return t===e},setDataFromConfig:function(){void 0!==this.config?.data?.id&&(this.id=this.config.data.id),void 0!==this.config?.data?.stunden&&(isNaN(this.config.data.stunden)||(this.config.data.stunden=this.config.data.stunden.toString()),this.stunden=this.config.data.stunden.replace(".",",")),void 0!==this.config?.data?.teilzeittyp_kurzbz&&(this.teilzeittyp_kurzbz=null!=this.config.data.teilzeittyp_kurzbz?this.config.data.teilzeittyp_kurzbz:""),void 0!==this.config?.data?.db_delete&&(this.db_delete=this.config.data.db_delete)},getTeilzeittypen:async function(){const t=(await this.$api.call(jt.getTeilzeittypen())).data;t.unshift({value:"",label:"Teilzeittyp wählen",disabled:!1}),this.lists.teilzeittypen=t},removeVB:function(){this.$emit("removeVB",{id:this.config.guioptions.id})},getPayload:function(){return{type:this.config.type,guioptions:this.config.guioptions,data:{id:this.id,stunden:this.stunden.replace(",","."),teilzeittyp_kurzbz:this.teilzeittyp_kurzbz,db_delete:this.db_delete,gueltigkeit:this.$refs.gueltigkeit.getPayload()},gbs:this.$refs.gbh.getPayload()}}}},Gt={name:"VertragsbestandteilZeitaufzeichnung",template:'\n  <div class="py-0 my-2">\n   <div class="py-0">\n    <infos :infos="(config?.guioptions?.infos !== undefined) ? config?.guioptions?.infos : []"></infos>\n    <errors :errors="(config?.guioptions?.errors !== undefined) ? config?.guioptions?.errors : []"></errors>\n    <div class="row g-2" style="padding-right: 1rem;">\n      <div class="col-2">\n        <div class="form-check form-control-sm">\n            <input v-model="zeitaufzeichnung" :disabled="isinputdisabled(\'zeitaufzeichnung\')" class="form-check-input" type="checkbox" value="" :id="\'zeitaufzeichnung_\' + config.guioptions.id">\n            <label class="form-check-label" :for="\'zeitaufzeichnung_\' + config.guioptions.id">\n              Zeitaufzeichnung\n            </label>\n        </div>\n      </div>\n      <div class="col-2">\n        <div class="form-check form-control-sm">\n            <input v-model="azgrelevant" :disabled="isinputdisabled(\'azgrelevant\')" class="form-check-input" type="checkbox" value="" :id="\'azgrelevant_\' + config.guioptions.id">\n            <label class="form-check-label" :for="\'azgrelevant_\' + config.guioptions.id">\n              AZG-relevant\n            </label>\n        </div>\n      </div>\n      <div class="col-2">\n        <div class="form-check form-control-sm">\n            <input v-model="homeoffice" :disabled="isinputdisabled(\'homeoffice\')" class="form-check-input" type="checkbox" value="" :id="\'homeoffice_\' + config.guioptions.id">\n            <label class="form-check-label" :for="\'homeoffice_\' + config.guioptions.id">\n              Home-Office\n            </label>\n        </div>\n      </div>\n      <div class="col-1 form-check form-control-sm">&nbsp;</div>\n      <gueltigkeit ref="gueltigkeit" :config="getgueltigkeit" @markended="markGBsEnded"></gueltigkeit>\n      <div class="col-1 pe-3">\n        <span v-if="db_delete" class="badge bg-danger">wird gelöscht</span>\n        <button v-if="isremoveable" type="button" class="btn-close btn-sm p-2 float-end" @click="removeVB" aria-label="Close"></button>\n        <button v-if="isdeleteable" type="button" class="btn btn-sm p-2 float-end" @click="toggledelete" aria-label="Delete"><i v-if="db_delete" class="fas fa-trash-restore"></i><i v-else="" class="fas fa-trash"></i></button>\n      </div>\n    </div>\n   </div>\n  </div>\n  ',components:{gueltigkeit:Ot,infos:Ht,errors:Mt},mixins:[Bt],emits:{removeVB:null},data:function(){return{id:null,zeitaufzeichnung:!0,azgrelevant:!0,homeoffice:!0,db_delete:!1}},created:function(){this.setDataFromConfig()},methods:{setDataFromConfig:function(){void 0!==this.config?.data?.id&&(this.id=this.config.data.id),void 0!==this.config?.data?.zeitaufzeichnung&&(this.zeitaufzeichnung=this.config.data.zeitaufzeichnung),void 0!==this.config?.data?.azgrelevant&&(this.azgrelevant=this.config.data.azgrelevant),void 0!==this.config?.data?.homeoffice&&(this.homeoffice=this.config.data.homeoffice),void 0!==this.config?.data?.db_delete&&(this.db_delete=this.config.data.db_delete)},removeVB:function(){this.$emit("removeVB",{id:this.config.guioptions.id})},getPayload:function(){return{type:this.config.type,guioptions:this.config.guioptions,data:{id:this.id,zeitaufzeichnung:Boolean(this.zeitaufzeichnung),azgrelevant:Boolean(this.azgrelevant),homeoffice:Boolean(this.homeoffice),db_delete:this.db_delete,gueltigkeit:this.$refs.gueltigkeit.getPayload()}}}}},Nt={name:"VertragsbestandteilFunktion",template:'\n  <div class="card card-body my-2" :class="canhavegehaltsbestandteile ? \'\' : \'border-white py-0\'">\n    <div class="py-0">\n    <infos :infos="(config?.guioptions?.infos !== undefined) ? config.guioptions.infos : []"></infos>\n    <errors :errors="(config?.guioptions?.errors !== undefined) ? config.guioptions.errors : []"></errors>\n    <div class="row g-2 py-2">\n      <div class="col-5">\n        <div class="form-check form-check-inline">\n          <input v-model="mode" :disabled="isinputdisabled(\'mode\')" class="form-check-input form-check-input-sm" type="radio"\n            @change="resetDropdowns"\n            :name="\'vbfunktionmode_\' + config.guioptions.id" :id="\'vbfunktionmode1_\' + config.guioptions.id" value="neu">\n          <label class="form-check-label" :for="\'vbfunktionmode1_\' + config.guioptions.id">Neue Funktion</label>\n        </div>\n        <div class="form-check form-check-inline">\n          <input v-model="mode" class="form-check-input form-check-input-sm" type="radio"\n            @change="resetDropdowns"\n            :name="\'vbfunktionmode_\' + config.guioptions.id" :id="\'vbfunktionmode2_\' + config.guioptions.id" value="bestehende">\n          <label class="form-check-label" :for="\'vbfunktionmode2_\' + config.guioptions.id">Bestehende Funktion</label>\n        </div>\n      </div>\n      <div class="col-7">&nbsp;</div>\n    </div>\n    <div class="row g-2">\n    <template v-if="mode === \'neu\'">\n      <div class="col-3">\n        <div class="fhc_autocomplete_wrapper">\n            <p-autocomplete \n                v-model="autocomplete.selectedfunktion" \n                dropdown\n                dropdownMode="current" \n                :suggestions="autocomplete.funktionen" \n                @complete="searchFunktionen"\n                optionLabel="label"\n                optionDisabled="disabled"\n                forceSelection\n                :disabled="isinputdisabled(\'funktion\')"\n                :placeholder="getFunktionDropdownPlaceholder"\n            ></p-autocomplete>\n        </div>\n\x3c!--        \n        <select v-model="funktion" :disabled="isinputdisabled(\'funktion\')" class="form-select form-select-sm" aria-label=".form-select-sm example">\n          <option\n            v-for="f in lists.funktionen"\n            :value="f.value"\n            :selected="isselected(f.value, this.funktion)"\n            :disabled="f.disabled">\n            {{ f.label }}\n          </option>\n        </select>\n--\x3e\n      </div>\n      <div class="col-3">\n        <div class="fhc_autocomplete_wrapper">\n            <p-autocomplete \n                v-model="autocomplete.selectedorget" \n                dropdown \n                dropdownMode="current" \n                :suggestions="autocomplete.orgets" \n                @complete="searchOrgets"\n                optionLabel="label"\n                optionDisabled="disabled"\n                forceSelection\n                :disabled="isinputdisabled(\'orget\')"\n                :placeholder="getOrgetDropdownPlaceholder"\n            ></p-autocomplete>\n        </div>\n\x3c!--\n        <select v-model="orget" :disabled="isinputdisabled(\'orget\')" class="form-select form-select-sm" aria-label=".form-select-sm example">\n          <option\n            v-for="oe in lists.orgets"\n            :value="oe.value"\n            :selected="isselected(oe.value, this.orget)"\n            :disabled="oe.disabled">\n            {{ oe.label }}\n          </option>\n        </select>        \n--\x3e\n      </div>\n      <div class="col-1">&nbsp;</div>\n    </template>\n    <template v-else-if="mode === \'bestehende\'">\n      <div class="col-6">\n        <select v-model="benutzerfunktionid" :disabled="isinputdisabled(\'benutzerfunktionid\')" class="form-select form-select-sm">\n          <option\n            v-for="bf in lists.benutzerfunktionen"\n            :value="bf.value"\n            :selected="isselected(bf.value, this.benutzerfunktionid)"\n            :disabled="bf.disabled">\n            {{ bf.label }}\n          </option>\n        </select>\n      </div>\n      <div class="col-1">&nbsp;</div>\n    </template>\n      <gueltigkeit ref="gueltigkeit" :config="getgueltigkeit" @markended="markGBsEnded"></gueltigkeit>\n      <div class="col-1 pe-3">\n        <span v-if="db_delete" class="badge bg-danger">wird gelöscht</span>\n        <button v-if="isremoveable" type="button" class="btn-close btn-sm p-2 float-end" @click="removeVB" aria-label="Close"></button>\n        <button v-if="isdeleteable" type="button" class="btn btn-sm p-2 float-end" @click="toggledelete" aria-label="Delete"><i v-if="db_delete" class="fas fa-trash-restore"></i><i v-else="" class="fas fa-trash"></i></button>        \n      </div>\n    </div>\n    </div>\n    <gehaltsbestandteilhelper v-if="canhavegehaltsbestandteile" ref="gbh" v-bind:preset="getgehaltsbestandteile"></gehaltsbestandteilhelper>\n  </div>\n  ',inject:["$api","$fhcAlert"],components:{gehaltsbestandteilhelper:Lt,gueltigkeit:Ot,infos:Ht,errors:Mt,"p-autocomplete":primevue.autocomplete},mixins:[Bt],emits:{removeVB:null},data:function(){return{id:null,funktion:"",orget:"",benutzerfunktionid:"",db_delete:!1,mode:"neu",lists:{funktionen:[],orgets:[{value:"",label:"Bitte zuerst ein Unternehmen auswählen",disabled:!0}],benutzerfunktionen:[{value:"",label:"Bitte zuerst ein Unternehmen auswählen",disabled:!0}]},autocomplete:{funktionen:[],orgets:[],selectedfunktion:"",selectedorget:""},store:Tt}},created:function(){this.getFunktionen(),this.getOrgetsForCompany(),this.getCurrentFunctions(),this.setDataFromConfig()},watch:{"store.unternehmen":function(){this.getOrgetsForCompany(),this.getCurrentFunctions()},"store.mitarbeiter_uid":function(){this.getCurrentFunctions()},"autocomplete.selectedfunktion":function(){void 0!==this.autocomplete.selectedfunktion?.value?this.funktion=this.autocomplete.selectedfunktion.value:this.funktion=""},"autocomplete.selectedorget":function(){void 0!==this.autocomplete.selectedorget?.value?this.orget=this.autocomplete.selectedorget.value:this.orget=""}},methods:{isselected:function(t,e){return t===e},resetDropdowns:function(){this.isinputdisabled("funktion")||(this.autocomplete.selectedfunktion=""),this.isinputdisabled("orget")||(this.autocomplete.selectedorget=""),this.benutzerfunktionid=""},setDataFromConfig:function(){void 0!==this.config?.data?.id&&(this.id=this.config.data.id),void 0!==this.config?.data?.funktion&&(this.funktion=this.config.data.funktion),void 0!==this.config?.data?.orget&&(this.orget=this.config.data.orget),void 0!==this.config?.data?.benutzerfunktionid&&(this.benutzerfunktionid=this.config.data.benutzerfunktionid),void 0!==this.config?.data?.mode&&(this.mode=this.config.data.mode),void 0!==this.config?.data?.db_delete&&(this.db_delete=this.config.data.db_delete)},getFunktionen:async function(){const t=this.config.guioptions?.filter?this.config.guioptions?.filter:"all",e=(await this.$api.call(ct.getContractFunctions(t))).data;e.unshift({value:"",label:"Funktion wählen",disabled:!0}),this.lists.funktionen=e,this.autocomplete.funktionen=[...this.lists.funktionen],this.setAutocompleteFunktion()},getOrgetsForCompany:async function(){if(""===this.store.unternehmen)return;const t=(await this.$api.call(ct.getOrgetsForCompany(this.store.unternehmen))).data;t.unshift({value:"",label:"OrgEinheit wählen",disabled:!0}),this.lists.orgets=t,this.autocomplete.orgets=[...this.lists.orgets],this.setAutocompleteOrget()},getCurrentFunctions:async function(){if(""===this.store.unternehmen||""===this.store.mitarbeiter_uid)return;const t=await this.$api.call(ct.getCurrentFunctions(this.store.mitarbeiter_uid,this.store.unternehmen)),e=1===t.error?[]:t.data;e.unshift({value:"",label:"Benutzerfunktion wählen",disabled:!0}),this.lists.benutzerfunktionen=e},removeVB:function(){this.$emit("removeVB",{id:this.config.guioptions.id})},getGehaltsbestandteilePayload:function(){return void 0!==this.$refs?.gbh?this.$refs.gbh.getPayload():[]},getPayload:function(){return{type:this.config.type,guioptions:this.config.guioptions,data:{id:this.id,funktion:this.funktion,orget:this.orget,benutzerfunktionid:this.benutzerfunktionid,mitarbeiter_uid:this.store.mitarbeiter_uid,mode:this.mode,db_delete:this.db_delete,gueltigkeit:this.$refs.gueltigkeit.getPayload()},gbs:this.getGehaltsbestandteilePayload()}},searchFunktionen:function(t){var e=this;setTimeout(function(){t.query.trim().length?e.autocomplete.funktionen=e.lists.funktionen.filter(e=>e.label.toLowerCase().includes(t.query.toLowerCase())):e.autocomplete.funktionen=[...e.lists.funktionen]},250)},searchOrgets:function(t){var e=this;setTimeout(function(){t.query.trim().length?e.autocomplete.orgets=e.lists.orgets.filter(e=>e.label.toLowerCase().includes(t.query.toLowerCase())):e.autocomplete.orgets=[...e.lists.orgets]},250)},setAutocompleteFunktion:function(){if(this.funktion.length>0&&this.autocomplete.funktionen.length>0){var t=this;this.autocomplete.selectedfunktion=this.autocomplete.funktionen.find(e=>t.funktion===e.value)}},setAutocompleteOrget:function(){if(this.orget.length>0&&this.autocomplete.orgets.length>0){var t=this;this.autocomplete.selectedorget=this.autocomplete.orgets.find(e=>t.orget===e.value)}}},computed:{getFunktionDropdownPlaceholder:function(){return""===this.store.unternehmen?"Bitte zuerst ein Unternehmen auswählen":"Funktion wählen"},getOrgetDropdownPlaceholder:function(){return""===this.store.unternehmen?"Bitte zuerst ein Unternehmen auswählen":"OrgEinheit wählen"}}},Ut={getKarenztypen:()=>({method:"get",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/CommonsAPI/getKarenztypen"}),saveKarenz:t=>({method:"post",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/KarenzAPI/saveKarenz",params:t})},qt={name:"VertragsbestandteilKarenz",template:'\n  <div class="py-0 my-2">\n   <div class="py-0">\n    <infos :infos="(config?.guioptions?.infos !== undefined) ? config.guioptions.infos : []"></infos>\n    <errors :errors="(config?.guioptions?.errors !== undefined) ? config.guioptions.errors : []"></errors>\n    <div class="row g-2 py-2">\n      <div class="col-4">\n        <select v-model="karenztyp_kurzbz" :disabled="isinputdisabled(\'karenztyp_kurzbz\')" class="form-select form-select-sm" aria-label=".form-select-sm example">\n          <option\n            v-for="f in lists.karenztypen"\n            :value="f.value"\n            :selected="isselected(f.value, this.karenztyp_kurzbz)"\n            :disabled="f.disabled">\n            {{ f.label }}\n          </option>\n        </select>\n      </div>\n      <div class="col-3">\n        &nbsp;\n      </div>\n      <gueltigkeit ref="gueltigkeit" :config="getgueltigkeit" @markended="markGBsEnded"></gueltigkeit>\n      <div class="col-1 pe-3">\n        <span v-if="db_delete" class="badge bg-danger">wird gelöscht</span>\n        <button v-if="isremoveable" type="button" class="btn-close btn-sm p-2 float-end" @click="removeVB" aria-label="Close"></button>\n        <button v-if="isdeleteable" type="button" class="btn btn-sm p-2 float-end" @click="toggledelete" aria-label="Delete"><i v-if="db_delete" class="fas fa-trash-restore"></i><i v-else="" class="fas fa-trash"></i></button>        \n      </div>\n    </div>\n    <div class="row g-2 py2">\n      <div class="col-3">\n        <div class="input-group input-group-sm">\n            <datepicker v-model="geplanter_geburtstermin" \n              :disabled="isinputdisabled(\'geplanter_geburtstermin\') || karenztyp_kurzbz !== \'elternkarenz\'"\n              v-bind:enable-time-picker="false"\n              v-bind:placeholder="\'geplanter Geburtstermin\'"\n              v-bind:teleport="true"\n              six-weeks\n              auto-apply \n              text-input \n              locale="de"\n              format="dd.MM.yyyy"\n              model-type="yyyy-MM-dd"\n              class="me-2"></datepicker>\n        </div>\n      </div>\n      <div class="col-3">\n          <div class="input-group input-group-sm">\n            <datepicker v-model="tatsaechlicher_geburtstermin" \n              :disabled="isinputdisabled(\'tatsaechlicher_geburtstermin\') || karenztyp_kurzbz !== \'elternkarenz\'"\n              v-bind:enable-time-picker="false"\n              v-bind:placeholder="\'tatsaechlicher Geburtstermin\'"\n              v-bind:teleport="true"\n              six-weeks\n              auto-apply \n              text-input \n              locale="de"\n              format="dd.MM.yyyy"\n              model-type="yyyy-MM-dd"></datepicker>\n          </div>\n      </div>\n      <div class="col-6">\n        &nbsp;\n      </div>\n    </div>\n   </div>\n  </div>\n  ',components:{gueltigkeit:Ot,infos:Ht,errors:Mt,datepicker:VueDatePicker},mixins:[Bt],emits:{removeVB:null},data:function(){return{id:null,karenztyp_kurzbz:"",geplanter_geburtstermin:"",tatsaechlicher_geburtstermin:"",db_delete:!1,lists:{karenztypen:[]},store:Tt}},created:function(){this.getKarenztypen(),this.setDataFromConfig()},inject:["$api"],methods:{isselected:function(t,e){return t===e},resetDropdowns:function(){this.isinputdisabled("karenztyp")||(this.karenztyp="")},setDataFromConfig:function(){void 0!==this.config?.data?.id&&(this.id=this.config.data.id),void 0!==this.config?.data?.karenztyp_kurzbz&&(this.karenztyp_kurzbz=this.config.data.karenztyp_kurzbz),void 0!==this.config?.data?.geplanter_geburtstermin&&(this.geplanter_geburtstermin=this.config.data.geplanter_geburtstermin),void 0!==this.config?.data?.tatsaechlicher_geburtstermin&&(this.tatsaechlicher_geburtstermin=this.config.data.tatsaechlicher_geburtstermin),void 0!==this.config?.data?.db_delete&&(this.db_delete=this.config.data.db_delete)},getKarenztypen:async function(){const t=(await this.$api.call(Ut.getKarenztypen())).data;t.unshift({value:"",label:"Karenztyp wählen",disabled:!0}),this.lists.karenztypen=t},removeVB:function(){this.$emit("removeVB",{id:this.config.guioptions.id})},getPayload:function(){return{type:this.config.type,guioptions:this.config.guioptions,data:{id:this.id,karenztyp_kurzbz:this.karenztyp_kurzbz,geplanter_geburtstermin:this.geplanter_geburtstermin,tatsaechlicher_geburtstermin:this.tatsaechlicher_geburtstermin,db_delete:this.db_delete,gueltigkeit:this.$refs.gueltigkeit.getPayload()},gbs:[]}}}},Kt={name:"VertragsbestandteilList",template:'\n      <div class="card card-body mb-3">\n        <div class="row g-2 py-1">\n          <div class="col">\n            <div class="position-relative">\n              <a class="btn btn-sm btn-primary mb-1" href="javascript:void(0);" @click="addVB"><i class="fas fa-plus"></i>\n                &nbsp;\n                {{ title }}{{ childcount }}\n                &nbsp;\n              </a>\n            </div>\n          </div>\n        </div>\n        <infos :infos="(preset?.guioptions?.infos !== undefined) ? preset?.guioptions?.infos : []"></infos>\n        <errors :errors="(preset?.guioptions?.errors !== undefined) ? preset?.guioptions?.errors : []"></errors>\n        <component ref="parts" v-bind:is="config.type" v-for="config in getChildren()"\n          v-bind:config="config" :key="config.guioptions.id" @removeVB="removeVB"></component>\n      </div>\n  ',props:["data"],data:function(){return{title:"",vertragsbestandteiltyp:"",payload:{type:"vertragsbestandteillist",guioptions:{title:"",vertragsbestandteiltyp:""},children:[]}}},components:{vertragsbestandteilstunden:Jt,vertragsbestandteilzeitaufzeichnung:Gt,vertragsbestandteilfunktion:Nt,vertragsbestandteilfreitext:{name:"VertragsbestandteilFreitext",template:'\n  <div class="my-2" :class="canhavegehaltsbestandteile ? \'card card-body\' : \'py-0\'">\n    <div class="py-0">\n    <infos :infos="(config?.guioptions?.infos !== undefined) ? config?.guioptions?.infos : []"></infos>\n    <errors :errors="(config?.guioptions?.errors !== undefined) ? config?.guioptions?.errors : []"></errors>\n    <div class="row g-2 py-2">\n      <div class="col-6">\n        <select v-model="freitexttyp" :disabled="isinputdisabled(\'freitexttyp\')" class="form-select form-select-sm" aria-label=".form-select-sm example">\n          <option value="" selected>Freitexttyp wählen</option>\n          <option value="allin">AllIn</option>\n          <option value="ersatzarbeitskraft">Ersatzarbeitskraft</option>\n          <option value="zusatzvereinbarung">Zusatzvereinbarung</option>\n          <option value="befristung">Befristung</option>\n          <option value="sonstiges">Sonstiges</option>\n        </select>\n      </div>\n      <div class="col-1">&nbsp;</div>\n      <gueltigkeit ref="gueltigkeit" :config="getgueltigkeit" @markended="markGBsEnded"></gueltigkeit>\n      <div class="col-1 pe-3">\n        <span v-if="db_delete" class="badge bg-danger">wird gelöscht</span>\n        <button v-if="isremoveable" type="button" class="btn-close btn-sm p-2 float-end" @click="removeVB" aria-label="Close"></button>        \n        <button v-if="isdeleteable" type="button" class="btn btn-sm p-2 float-end" @click="toggledelete" aria-label="Delete"><i v-if="db_delete" class="fas fa-trash-restore"></i><i v-else="" class="fas fa-trash"></i></button>\n      </div>\n    </div>\n    <div class="row g-2 py-2" v-show="showinput(\'titel\')">\n      <div class="col-6">\n        <input v-model="titel" type="text" class="form-control form-control-sm" placeholder="Titel" aria-label="Titel">\n      </div>\n      <div class="col-5">&nbsp;</div>\n      <div class="col-1">&nbsp;</div>\n    </div>\n    <div class="row g-2 py-2" v-show="showinput(\'freitext\')">\n      <div class="col-6">\n        <textarea v-model="freitext" rows="5" class="form-control form-control-sm" placeholder="Freitext" aria-label="Freitext"></textarea>\n      </div>\n      <div class="col-5">&nbsp;</div>\n      <div class="col-1">&nbsp;</div>\n    </div>\n    </div>\n    <gehaltsbestandteilhelper ref="gbh" v-if="canhavegehaltsbestandteile" v-bind:preset="getgehaltsbestandteile"></gehaltsbestandteilhelper>\n  </div>\n  ',components:{gehaltsbestandteilhelper:Lt,gueltigkeit:Ot,infos:Ht,errors:Mt},mixins:[Bt],emits:{removeVB:null},data:function(){return{id:null,freitexttyp:"",titel:"",freitext:"",kuendigungsrelevant:"",db_delete:!1}},created:function(){this.setDataFromConfig()},methods:{setDataFromConfig:function(){void 0!==this.config?.data?.id&&(this.id=this.config.data.id),void 0!==this.config?.data?.freitexttyp&&(this.freitexttyp=this.config.data.freitexttyp),void 0!==this.config?.data?.titel&&(this.titel=this.config.data.titel),void 0!==typeof this.config?.data?.freitexttyp&&(this.freitext=this.config.data.freitext),void 0!==this.config?.data?.db_delete&&(this.db_delete=this.config.data.db_delete)},removeVB:function(){this.$emit("removeVB",{id:this.config.guioptions.id})},getGehaltsbestandteilePayload:function(){return void 0!==this.$refs?.gbh?this.$refs.gbh.getPayload():[]},getPayload:function(){return{type:"vertragsbestandteilfreitext",guioptions:this.config.guioptions,data:{id:this.id,freitexttyp:this.freitexttyp,titel:this.titel,freitext:this.freitext,kuendigungsrelevant:this.kuendigungsrelevant,db_delete:this.db_delete,gueltigkeit:this.$refs.gueltigkeit.getPayload()},gbs:this.getGehaltsbestandteilePayload()}}}},vertragsbestandteilkuendigungsfrist:{name:"VertragsbestandteilKuendigungsfrist",template:'\n  <div class="py-0 my-2">\n   <div class="py-0">\n    <infos :infos="(config?.guioptions?.infos !== undefined) ? config?.guioptions?.infos : []"></infos>\n    <errors :errors="(config?.guioptions?.errors !== undefined) ? config?.guioptions?.errors : []"></errors>\n    <div class="row g-2">\n      <div class="col-3">\n        <div class="input-group input-group-sm mb-3">\n          <input v-model="arbeitgeber_frist" :disabled="isinputdisabled(\'arbeitgeber_frist\')" type="text" class="form-control form-control-sm" placeholder="Arbeitgeber Frist" aria-label="arbeitgeber_frist">\n          <span class="input-group-text">Wochen</span>\n        </div>\n      </div>\n      <div class="col-3">\n        <div class="input-group input-group-sm mb-3">\n          <input v-model="arbeitnehmer_frist" :disabled="isinputdisabled(\'arbeitnehmer_frist\')" type="text" class="form-control form-control-sm" placeholder="Arbeitnehmer Frist" aria-label="arbeitnehmer_frist">\n          <span class="input-group-text">Wochen</span>\n        </div>\n      </div>\n      <div class="col-1">&nbsp;</div>\n      <gueltigkeit ref="gueltigkeit" :config="getgueltigkeit" @markended="markGBsEnded"></gueltigkeit>\n      <div class="col-1 pe-3">\n        <span v-if="db_delete" class="badge bg-danger">wird gelöscht</span>\n        <button v-if="isremoveable" type="button" class="btn-close btn-sm p-2 float-end" @click="removeVB" aria-label="Close"></button>\n        <button v-if="isdeleteable" type="button" class="btn btn-sm p-2 float-end" @click="toggledelete" aria-label="Delete"><i v-if="db_delete" class="fas fa-trash-restore"></i><i v-else="" class="fas fa-trash"></i></button>\n      </div>\n    </div>\n   </div>\n  </div>\n  ',components:{gueltigkeit:Ot,infos:Ht,errors:Mt},mixins:[Bt],emits:{removeVB:null},data:function(){return{id:null,arbeitgeber_frist:"",arbeitnehmer_frist:"",db_delete:!1}},created:function(){this.setDataFromConfig()},methods:{setDataFromConfig:function(){void 0!==this.config?.data?.id&&(this.id=this.config.data.id),void 0!==this.config?.data?.arbeitgeber_frist&&(this.arbeitgeber_frist=this.config.data.arbeitgeber_frist),void 0!==this.config?.data?.arbeitnehmer_frist&&(this.arbeitnehmer_frist=this.config.data.arbeitnehmer_frist),void 0!==this.config?.data?.db_delete&&(this.db_delete=this.config.data.db_delete)},removeVB:function(){this.$emit("removeVB",{id:this.config.guioptions.id})},getPayload:function(){return{type:this.config.type,guioptions:this.config.guioptions,data:{id:this.id,arbeitgeber_frist:this.arbeitgeber_frist,arbeitnehmer_frist:this.arbeitnehmer_frist,db_delete:this.db_delete,gueltigkeit:this.$refs.gueltigkeit.getPayload()}}}}},vertragsbestandteilurlaubsanspruch:{name:"VertragsbestandteilUrlaubsanspruch",template:'\n  <div class="py-0 my-2">\n   <div class="py-0">\n    <infos :infos="(config?.guioptions?.infos !== undefined) ? config?.guioptions?.infos : []"></infos>\n    <errors :errors="(config?.guioptions?.errors !== undefined) ? config?.guioptions?.errors : []"></errors>\n    <div class="row g-2">\n      <div class="col-3">\n        <div class="input-group input-group-sm mb-3">\n          <input v-model="tage" :disabled="isinputdisabled(\'tage\')" type="text" class="form-control form-control-sm" placeholder="Tage" aria-label="tage">\n          <span class="input-group-text">Urlaubstage</span>\n        </div>\n      </div>\n      <div class="col-4">&nbsp;</div>\n      <gueltigkeit ref="gueltigkeit" :config="getgueltigkeit" @markended="markGBsEnded"></gueltigkeit>\n      <div class="col-1 pe-3">\n        <span v-if="db_delete" class="badge bg-danger">wird gelöscht</span>\n        <button v-if="isremoveable" type="button" class="btn-close btn-sm p-2 float-end" @click="removeVB" aria-label="Close"></button>\n        <button v-if="isdeleteable" type="button" class="btn btn-sm p-2 float-end" @click="toggledelete" aria-label="Delete"><i v-if="db_delete" class="fas fa-trash-restore"></i><i v-else="" class="fas fa-trash"></i></button>\n      </div>\n    </div>\n   </div>\n  </div>\n  ',components:{gueltigkeit:Ot,infos:Ht,errors:Mt},mixins:[Bt],emits:{removeVB:null},data:function(){return{id:null,tage:"",db_delete:!1}},created:function(){this.setDataFromConfig()},methods:{setDataFromConfig:function(){void 0!==this.config?.data?.id&&(this.id=this.config.data.id),void 0!==this.config?.data?.tage&&(this.tage=this.config.data.tage),void 0!==this.config?.data?.db_delete&&(this.db_delete=this.config.data.db_delete)},removeVB:function(){this.$emit("removeVB",{id:this.config.guioptions.id})},getPayload:function(){return{type:this.config.type,guioptions:this.config.guioptions,data:{id:this.id,tage:this.tage,db_delete:this.db_delete,gueltigkeit:this.$refs.gueltigkeit.getPayload()}}}}},vertragsbestandteilkarenz:qt,infos:Ht,errors:Mt},mixins:[$t],created:function(){this.title=this.preset.guioptions.title,this.vertragsbestandteiltyp=this.preset.guioptions.vertragsbestandteiltyp},methods:{addVB:function(t){if(t.preventDefault(),t.stopPropagation(),""!==this.vertragsbestandteiltyp){var e=Rt(),n=void 0!==this.preset.guioptions?.childdefaults?.guioptions?JSON.parse(JSON.stringify(this.preset.guioptions.childdefaults.guioptions)):{};void 0!==this.preset.guioptions?.filter&&(n.filter=this.preset.guioptions.filter),n.id=e,n.removeable=!0;var a=void 0!==this.preset.guioptions?.childdefaults?.data?JSON.parse(JSON.stringify(this.preset.guioptions.childdefaults.data)):{};this.store.addVB(e,{type:this.vertragsbestandteiltyp,guioptions:n,data:a}),this.children.unshift(e)}},removeVB:function(t){this.store.removeVB(t.id);var e=this.children.filter(function(e){return e!==t.id});this.children=e},getPayload:function(){return this.payload={type:"vertragsbestandteillist",guioptions:JSON.parse(JSON.stringify(this.preset.guioptions)),children:JSON.parse(JSON.stringify(this.children))},this.updateVBsInStore(),this.payload},updateVBsInStore:function(){for(var t in this.$refs.parts){var e=this.$refs.parts[t].getPayload();this.store.addVB(this.$refs.parts[t].config.guioptions.id,e)}},getChildren:function(){var t=[];for(var e in this.children){var n=this.children[e],a=this.store.getVB(n);null!==a?t.push(a):delete this.children[e]}return t}},computed:{childcount:function(){return this.children.length>0?" ("+this.children.length+")":""}}},Wt={getUnternehmen:()=>({method:"get",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/OrgAPI/getUnternehmen"}),getVertragsarten:()=>({method:"get",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/CommonsAPI/getVertragsarten"}),getDVByID:t=>({method:"get",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/DVAPI/dvByID/"+t}),endDV:t=>({method:"post",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/DVAPI/endDV",params:t}),deactivateDV:t=>({method:"post",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/DVAPI/deactivateDV",params:t}),getDvEndeGruende:()=>({method:"get",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/DVAPI/getDvEndeGruende"})},Zt={name:"Dienstverhaeltnis",template:'\n  <div class="col-3">\n    <select v-model="store.unternehmen" :disabled="isaenderung && isconfigured(\'unternehmen\')" class="form-select form-select-sm" aria-label=".form-select-sm example">\n      <option\n        v-for="u in lists.unternehmen"\n        :value="u.value"\n        :selected="isselected(u.value, this.store.unternehmen)"\n        :disabled="u.disabled">\n        {{ u.label }}\n      </option>\n    </select>\n  </div>\n  <div class="col-3">\n    <select v-model="vertragsart_kurzbz" :disabled="isaenderung || isconfigured(\'vertragsart_kurzbz\')" class="form-select form-select-sm" aria-label=".form-select-sm example">\n      <option\n        v-for="v in lists.vertragsarten"\n        :value="v.value"\n        :selected="isselected(v.value, this.vertragsart_kurzbz)"\n        :disabled="v.disabled">\n        {{ v.label}}\n      </option>\n    </select>\n  </div>\n  <div class="col-1">&nbsp;</div>\n  <gueltigkeit ref="gueltigkeit" :initialsharedstatemode="\'set\'" :config="getgueltigkeit"></gueltigkeit>\n  <div class="col-1">\n    <div v-if="this.store.mode === \'korrektur\' && showdvcheckoverlap === true" class="form-check">\n      <input v-model="checkoverlap" class="form-check-input" type="checkbox" id="dvcheckoverlap">\n      <label class="form-check-label" for="dvcheckoverlap">\n        parallele DVs prüfen\n      </label>\n    </div>\n    <span v-else>&nbsp;</span>\n  </div>\n  \n  <template v-if="this.store.mode === \'korrektur\'">\n  <div class="col-3">\n    <select v-model="dvendegrund_kurzbz" class="form-select form-select-sm" aria-label=".form-select-sm example">\n      <option\n        v-for="v in lists.dvendegruende"\n        :value="v.value"\n        :selected="isselected(v.value, this.dvendegrund_kurzbz)"\n        :disabled="v.disabled">\n        {{ v.label}}\n      </option>\n    </select>\n  </div>\n  <div class="col-3">\n    <textarea v-model="dvendegrund_anmerkung" \n        class="form-control form-control-sm w-100"\n        placeholder="Anmerkung zum Beendigungsgrund..."\n    ></textarea>\n  </div>\n  <div class="col-6">&nbsp;</div>\n  </template>\n  ',props:{showdvcheckoverlap:{type:Boolean,default:!0,required:!1}},inject:["$api","$fhcAlert"],data:function(){return{vertragsart_kurzbz:"",checkoverlap:!0,dvendegrund_kurzbz:"",dvendegrund_anmerkung:"",lists:{unternehmen:[],vertragsarten:[],dvendegruende:[]},store:Tt}},components:{gueltigkeit:Ot},mixins:[Bt],watch:{config:function(){this.setDataFromConfig()}},created:function(){this.getUnternehmen(),this.getVertragsarten(),this.getDvEndeGruende(),this.setDataFromConfig()},methods:{isselected:function(t,e){return t===e},getUnternehmen:async function(){const t=(await this.$api.call(Wt.getUnternehmen())).data;t.unshift({value:"",label:"Unternehmen wählen",disabled:!0}),this.lists.unternehmen=t},getVertragsarten:async function(){const t=(await this.$api.call(Wt.getVertragsarten())).data;return t.unshift({value:"",label:"Vertragsart wählen",disabled:!0}),this.lists.vertragsarten=t},getDvEndeGruende:async function(){const t=(await this.$api.call(Wt.getDvEndeGruende())).data;return t.unshift({value:"",label:"Beendigungsgrund wählen",disabled:!1}),this.lists.dvendegruende=t},isconfigured:function(t){return null!==this.config&&(void 0!==this.config[t]&&""!==this.config[t])},setDataFromConfig:function(){void 0!==this.config?.unternehmen&&(this.store.unternehmen=this.config.unternehmen),void 0!==this.config?.vertragsart_kurzbz&&(this.vertragsart_kurzbz=this.config.vertragsart_kurzbz),void 0!==this.config?.dvendegrund_kurzbz&&(this.dvendegrund_kurzbz=null===this.config.dvendegrund_kurzbz?"":this.config.dvendegrund_kurzbz),void 0!==this.config?.dvendegrund_anmerkung&&(this.dvendegrund_anmerkung=null===this.config.dvendegrund_anmerkung?"":this.config.dvendegrund_anmerkung),void 0!==this.config?.checkoverlap&&(this.checkoverlap=this.config.checkoverlap)},getPayload:function(){return{dienstverhaeltnisid:this.config.dienstverhaeltnisid,unternehmen:this.store.unternehmen,vertragsart_kurzbz:this.vertragsart_kurzbz,dvendegrund_kurzbz:""===this.dvendegrund_kurzbz?null:this.dvendegrund_kurzbz,dvendegrund_anmerkung:""===this.dvendegrund_anmerkung?null:this.dvendegrund_anmerkung,gueltigkeit:this.$refs.gueltigkeit.getPayload(),checkoverlap:this.checkoverlap}}},computed:{isaenderung:function(){return void 0!==this.config?.dienstverhaeltnisid&&!isNaN(parseInt(this.config.dienstverhaeltnisid))&&parseInt(this.config.dienstverhaeltnisid)>0}}},Yt={name:"Dv",template:'\n    <div class="py-0">\n      <div class="py-0">\n        <infos :infos="(dv?.guioptions?.infos !== undefined) ? dv?.guioptions?.infos : []"></infos>\n        <errors :errors="(dv?.guioptions?.errors !== undefined) ? dv?.guioptions?.errors : []"></errors>\n        <div v-if="store.mode == \'aenderung\'" class="row g-2 mt-2 flex-shrink-0 flex-grow-0">\n          <div class="col-2 text-primary"><strong>ÄNDERUNGSMODUS</strong></div>\n          <div class="col-4 text-end"><strong>Änderungen gelten</strong></div>\n          <div class="col-1">&nbsp;</div>\n          <gueltigkeit ref="gueltigkeitaenderung" :initialsharedstatemode="\'set\'" :config="getGueltigkeitsAenderung"></gueltigkeit>\n        </div>\n        <div v-if="store.mode == \'korrektur\'" class="row g-2 mt-2 flex-shrink-0 flex-grow-0">\n          <div class="col-12 text-danger"><strong>KORREKTURMODUS</strong></div>\n        </div>\n        <div class="row g-2 py-1 mb-1 flex-shrink-0 flex-grow-0 mt-2">\n          <dienstverhaeltnis ref="formheader" :config="dv.data"></dienstverhaeltnis>\n        </div>\n      </div>\n    </div>\n  ',components:{dienstverhaeltnis:Zt,infos:Ht,errors:Mt,gueltigkeit:Ot},mixins:[$t],data:function(){return{store:Tt,dv:{}}},created:function(){this.dv=this.store.getDV()},methods:{getPayload:function(){this.$refs.gueltigkeitaenderung&&(this.dv.guioptions.gueltigkeitaenderung=this.$refs.gueltigkeitaenderung.getPayload());var t={type:"dienstverhaeltnis",data:this.$refs.formheader.getPayload(),guioptions:JSON.parse(JSON.stringify(this.dv.guioptions))};return this.store.setDV(t),JSON.parse(JSON.stringify(this.preset))}},computed:{getGueltigkeitsAenderung:function(){var t={};return void 0!==this.dv?.guioptions?.gueltigkeitaenderung&&(t=this.dv.guioptions.gueltigkeitaenderung),t}}},Xt={getFreitexttypen:()=>({method:"get",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/CommonsAPI/getFreitexttypen"})},Qt={gbtByDV:(t,e)=>({method:"get",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/DVAPI/gbtByDV",params:{dv_id:t,d:e}}),gbtChartDataByDV:(t,e)=>({method:"get",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/DVAPI/gbtChartDataByDV",params:{dv_id:t}}),getGB:t=>({method:"get",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/DVAPI/getGB/"+t}),getGehaltstypen:()=>({method:"post",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/CommonsAPI/getGehaltstypen"})},te={name:"VbFormHelper",template:'\n    <div class="vbformhelper flex-shrink-1 flex-grow-1 d-flex flex-column overflow-hidden">\n      <div class="py-1 mb-1">\n        <infos v-show="store.showmsgs" :infos="(preset?.guioptions?.infos !== undefined) ? preset?.guioptions?.infos : []" :padright="false"></infos>\n        <errors v-show="store.showmsgs" :errors="(preset?.guioptions?.errors !== undefined) ? preset?.guioptions?.errors : []" :padright="false"></errors>\n      </div>\n      <component ref="parts" v-for="(child, idx) in children" :key="idx" :is="child.type" :preset="child"></component>\n    </div>\n  ',components:{tabs:{name:"Tabs",template:'\n    <div class="row h-100 overflow-hidden">\n      <div class="col-2 h-100">  \n        <ul class="nav w-100 position-relative flex-column subsubnav col-2" id="v-menubar" role="menubar" aria-orientation="vertical">\n          <li class="nav-item position-relative" v-for="(child, idx) in children" :key="idx">    \n              <a\n                v-if="child.type === \'tab\'"\n                class="nav-link"\n                :class="(this.activetab === child.guioptions.id) ? \'active\' : \'\'"\n                :id="\'v-menuitem-\' + child.guioptions.id + \'tab\'"\n                :href="\'#v-menuitem-\' + child.guioptions.id"\n                role="menuitem"\n                :aria-controls="\'v-menuitem-\' + child.guioptions.id"\n                :aria-selected="(this.activetab === child.guioptions.id) ? \'true\' : \'false\'"\n                @click="activetab = child.guioptions.id">\n                {{ child.guioptions.title }}\n                <span\n                    v-if="(getErrorsCount(child) > 0)" \n                    class="position-absolute top-50 end-0 translate-middle badge rounded-pill bg-danger">\n                  {{ getErrorsCount(child) }}\n                </span>\n              </a>\n          </li>\n        </ul>\n      </div>\n      <div class="col-10 h-100">\n        <div class="tab-content w-100 h-100 d-flex flex-column position-relative" id="v-menuitem-tabContent">\n          <template v-for="(child, idx) in children">\n            <component ref="parts" v-if="child.type === \'tab\'" :is="child.type" :key="\'tab_\' + idx" :preset="child" :activetab="activetab"></component>\n            <div v-else="" class="px-3">\n              <component ref="parts" :is="child.type" :key="\'notab_\' + idx" :preset="child"></component>\n            </div>\n          </template>\n        </div>\n      </div>\n    </div>\n  ',components:{dv:Yt,tab:{name:"Tab",template:'\n  <div class="tab-pane h-100 overflow-hidden position-relative fade mt-2" :class="(activetab === preset.guioptions.id) ? \'active show\' : \'\'"\n       :id="\'v-pills-\' + preset.guioptions.id"\n       role="tabpanel"\n       :aria-labelledby="\'v-pills-\' + preset.guioptions.id + \'-tab\'"\n       tabindex="0">\n    <div class="container-fluid p-0 overflow-auto scrollbar-gutter-stable pe-3">\n      <component ref="parts" v-for="(child, idx) in children" :is="child.type" :key="idx" :preset="child"></component>\n    </div>\n  </div>\n  ',props:["activetab"],data:function(){return{payload:{type:"tab",guioptions:{title:"",id:""},children:[]}}},components:{dv:Yt,vertragsbestandteillist:Kt},mixins:[$t],methods:{getPayload:function(){var t=[];for(var e in this.$refs.parts)t.push(this.$refs.parts[e].getPayload());return{type:"tab",guioptions:JSON.parse(JSON.stringify(this.preset.guioptions)),children:t}}}}},mixins:[$t],created:function(){if(void 0!==this.preset?.guioptions?.activetab)this.activetab=this.preset.guioptions.activetab;else if(this.children.length>0){for(const t of this.children)if("tab"===t.type){this.activetab=t.guioptions.id;break}}else this.activetab="",this.errorcounts={}},data:function(){return{activetab:"",errorcounts:{},store:Tt}},methods:{getPayload:function(){var t=[];for(var e in this.$refs.parts)t.push(this.$refs.parts[e].getPayload());var n=JSON.parse(JSON.stringify(this.preset.guioptions));return n.activetab=this.activetab,{type:"tabs",guioptions:n,children:t}},getErrorsCount:function(t){return void 0===this.errorcounts[t.guioptions.id]&&(this.errorcounts[t.guioptions.id]=this.calcErrorCount(t)),this.errorcounts[t.guioptions.id]},calcErrorCount:function(t){var e=0;if(void 0!==t?.guioptions?.errors&&(e+=t.guioptions.errors.length),"vertragsbestandteillist"===t.type)for(var n of t.children){null!==(r=this.store.getVB(n))&&(e+=this.calcErrorCount(r))}else if(t.type.match(/^vertragsbestandteil.*$/)){if(void 0!==t?.gbs)for(var a of t.gbs)e+=this.calcErrorCount(a)}else if(void 0!==t?.children)for(var r of t.children)e+=this.calcErrorCount(r);return e}}},vblistgroup:{name:"VbListGroup",template:'\n  <div class="row h-100 overflow-hidden">\n    <div class="col-12 h-100">\n      <div class="container-fluid p-0 pe-3 h-100 overflow-auto scrollbar-gutter-stable pt-2" :id="preset.guioptions.id">\n        <component ref="parts" v-for="(child, idx) in children" :is="child.type" :key="idx" :preset="child"></component>\n      </div>\n    </div>\n  </div>\n  ',data:function(){return{payload:{type:"vblistgroup",guioptions:{title:"",id:""},children:[]}}},components:{vertragsbestandteillist:Kt},mixins:[$t],methods:{getPayload:function(){var t=[];for(var e in this.$refs.parts)t.push(this.$refs.parts[e].getPayload());return{type:"vblistgroup",guioptions:JSON.parse(JSON.stringify(this.preset.guioptions)),children:t}}}},dv:Yt,vertragsbestandteillist:Kt,infos:Ht,errors:Mt,tabsspacer:{name:"TabsSpacer",template:'\n  <div class="row mb-2">\n    <div class="col-2">\n        &nbsp;\n    </div>\n\n    <div class="col-10">\n      <div class="pe-3" style="margin-right: var(--scrollbar-width);">\n        <div class="card card-body border-white py-0">\n          <template v-for="(child, idx) in children" :key="idx">\n            <component ref="parts" :is="child.type" :preset="child"></component>\n          </template>\n        </div>\n      </div>\n    </div>\n  </div>\n  ',components:{dv:Yt},mixins:[$t],methods:{getPayload:function(){var t=[];for(var e in this.$refs.parts)t.push(this.$refs.parts[e].getPayload());return{type:"tabsspacer",guioptions:JSON.parse(JSON.stringify(this.preset.guioptions)),children:t}}}},vblistgroupspacer:{name:"VbListGroupSpacer",template:'\n    <div class="row mb-2">\n      <div class="col-12">\n        <div class="container-fluid p-0 pe-3" style="margin-right: var(--scrollbar-width);">\n          <div class="card card-body py-0">\n            <template v-for="(child, idx) in children" :key="idx">\n              <component ref="parts" :is="child.type" :preset="child"></component>\n            </template>\n          </div>\n        </div>\n      </div>\n    </div>\n  ',components:{dv:Yt},mixins:[$t],methods:{getPayload:function(){var t=[];for(var e in this.$refs.parts)t.push(this.$refs.parts[e].getPayload());return{type:"vblistgroupspacer",guioptions:JSON.parse(JSON.stringify(this.preset.guioptions)),children:t}}}}},mixins:[$t],inject:["$api","$fhcAlert"],data:function(){return{store:Tt,lists:{freitexttypen:[],gehaltstypen:[]}}},provide:function(){return{freitexttypen:Vue.computed(()=>this.lists.freitexttypen),gehaltstypen:Vue.computed(()=>this.lists.gehaltstypen)}},emits:["vbhjsonready"],created:function(){this.getFreitexttypen(),this.getGehaltstypen(),this.setScrollBarWidthCSSVar()},methods:{getPayload:function(){var t=[];for(var e in this.$refs.parts)t.push(this.$refs.parts[e].getPayload());return{type:"formdata",guioptions:JSON.parse(JSON.stringify(this.preset.guioptions)),children:t,dv:this.store.getDVPayload(),vbs:this.store.getVBsPayload()}},getJSON:function(){var t=this.getPayload();this.$emit("vbhjsonready",JSON.stringify(t,null,2))},getFreitexttypen:async function(){const t=(await this.$api.call(Xt.getFreitexttypen())).data;t.unshift({value:"",label:"Freitexttyp wählen",disabled:!0}),this.lists.freitexttypen=t},getGehaltstypen:async function(){const t=(await this.$api.call(Qt.getGehaltstypen())).data;t.unshift({value:"",label:"Gehaltstyp wählen",disabled:!0}),this.lists.gehaltstypen=t},setScrollBarWidthCSSVar:function(){const t=document.createElement("div");t.style.cssText="width: 99px; height: 99px; overflow: scroll; position: absolute; top: -9999px;",document.body.appendChild(t);const e=t.offsetWidth-t.clientWidth;document.body.removeChild(t),document.body.style.setProperty("--scrollbar-width",`${e}px`)}}},ee={name:"PresetsChooser",template:'\n  <div class="row g-2 py-2">\n    <div class="col-12">\n\n      <select v-model="store.mode" @change="selectmode" v-if="showselectmode" class="form-select form-select-sm">\n        <option value="neuanlage" selected>Neuanlage</option>\n        <option value="aenderung">Änderung</option>\n        <option value="korrektur">Korrektur</option>\n      </select>\n\n      <select v-model="selectedpresetidx" @change="selectpreset" class="form-select form-select-sm">\n        <option value="-1" disabled>Vorlage wählen</option>\n        <option v-for="(preset, idx) in usedpresets" :key="idx"\n                :value="idx">\n                  {{ preset.guioptions.label }}\n                </option>\n      </select>\n\n    </div>\n  </div>\n  ',props:["presets","showselectmode"],data:function(){return{store:Tt,selectedpresetidx:-1,usedpresets:[]}},emits:["presetselected"],mounted:function(){this.selectmode()},watch:{"store.mode":function(){this.$nextTick(()=>{this.selectmode()})}},methods:{resetSelectedPreset:function(){this.selectedpresetidx=-1},selectmode:function(){if(this.resetSelectedPreset(),"aenderung"===this.store.mode||"korrektur"===this.store.mode){this.usedpresets=[];const t=this.store.getDV().data.vertragsart_kurzbz;for(const e of this.presets[this.store.mode])(0===e.guioptions.for_vertragsart_kurzbz.length||e.guioptions.for_vertragsart_kurzbz.indexOf(t)>-1)&&(this.usedpresets.push(e),void 0!==e.guioptions?.default_for_vertragsart_kurzbz&&e.guioptions.default_for_vertragsart_kurzbz.indexOf(t)>-1&&(this.selectedpresetidx=this.usedpresets.length-1))}else this.usedpresets=void 0!==this.presets[this.store.mode]?this.presets[this.store.mode]:[];this.selectpreset()},selectpreset:function(){var t=void 0!==this.usedpresets[this.selectedpresetidx]?this.usedpresets[this.selectedpresetidx]:{type:"preset",guioptions:{},children:[],dv:{data:{dienstverhaeltnisid:null,gueltigkeit:{guioptions:{},data:{}}}},vbs:{}};this.store.reset(),this.$emit("presetselected",t)}}},ne={storeToTmpStore(t){var e="/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/DVAPI/storeToTmpStore";return void 0!==t?.tmpStoreId&&!isNaN(parseInt(t.tmpStoreId))&&parseInt(t.tmpStoreId)>0&&(e=e+"/"+t.tmpStoreId),{method:"post",url:e,params:t}},listTmpStoreForMA:t=>({method:"get",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/DVAPI/listTmpStoreForMA/"+t}),getTmpStoreById:t=>({method:"get",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/DVAPI/getTmpStoreById/"+t}),deleteFromTmpStore:t=>({method:"post",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/DVAPI/deleteFromTmpStore/"+t})},ae={name:"TmpStoreHelper",template:'\n  <div class="row g-2 py-2">\n    <div class="col-7">\n        \n      <select v-model="selectedtmpstoreidx" class="form-select form-select-sm">\n        <option value="-1" disabled>Zwischenspeicherung wählen</option>\n        <option v-for="(tmpstore, idx) in getTmpStoresForModeAndDV" :key="tmpstore.tmp_store_id"\n                :value="idx">\n                \x3c!-- TODO: statt uid von insertvon/updatevon bitte Nachnamen anzeigen (HR Wunsch) --\x3e\n                  {{ getTmpStoreLabel(tmpstore) }}\n                </option>\n      </select>\n\n    </div>\n    <div class="col-5">\n        <div class="btn-toolbar" role="toolbar" aria-label="TmpStore Toolbar">\n            <div class="btn-group me-2" role="group" aria-label="First group">\n                <button class="btn btn-outline-secondary btn-sm float-end" @click="selecttmpstore">Laden</button>\n            </div>\n            <div class="btn-group me-2" role="group" aria-label="Second group">\n                <button class="btn btn-outline-secondary btn-sm float-end" @click="saveToTmpStore">Zwischenspeichern</button>\n            </div>\n            <div class="btn-group" role="group" aria-label="Third group">\n                <button class="btn btn-outline-secondary btn-sm float-end" @click="deleteFromTmpStore">Löschen</button>\n            </div>\n        </div>        \n    </div>\n  </div>\n  ',data:function(){return{store:Tt,selectedtmpstoreidx:-1,tmpstores:{}}},emits:["loadedfromtmpstore","savetotmpstore"],created:function(){this.fetchTmpStoreList()},watch:{"store.mode":function(){this.fetchTmpStoreList()},"store.mitarbeiter_uid":function(){this.fetchTmpStoreList()}},inject:["$api"],methods:{fetchTmpStoreList:function(t){if(void 0===t)t=!0;this.$api.call(ne.listTmpStoreForMA(this.store.mitarbeiter_uid)).then(e=>{this.tmpstores=e.data,this.selectedtmpstoreidx=!0===t?-1:this.store.tmpstoreid})},deleteFromTmpStorePromise:function(){if(void 0!==this.tmpstores[this.store.mode][this.selectedtmpstoreidx]){const t=this.tmpstores[this.store.mode][this.selectedtmpstoreidx].tmp_store_id;return this.$api.call(ne.deleteFromTmpStore(t))}return Promise.resolve("noTmpStoreUsed")},deleteFromTmpStore:function(){if(void 0!==this.tmpstores[this.store.mode][this.selectedtmpstoreidx]){const t=this.tmpstores[this.store.mode][this.selectedtmpstoreidx].tmp_store_id;this.$api.call(ne.deleteFromTmpStore(t)).then(t=>{this.selectedtmpstoreidx=-1,this.store.setTmpStoreId(null),this.fetchTmpStoreList(),console.log("deleteFromTmpStore executed.")})}},saveToTmpStore:function(){this.$emit("savetotmpstore")},selecttmpstore:function(){if(void 0!==this.tmpstores[this.store.mode][this.selectedtmpstoreidx]){const t=this.tmpstores[this.store.mode][this.selectedtmpstoreidx].tmp_store_id;this.$api.call(ne.getTmpStoreById(t)).then(t=>{console.log("loadFromTmpStore executed."),this.store.setTmpStoreId(t.data.tmp_store_id),this.$emit("loadedfromtmpstore",t.data.formdata)})}},getTmpStoreLabel:function(t){var e=t.insertamum+" - "+t.ivorname+" "+t.inachname+" ("+t.insertvon+")";return null!==t.updatevon&&(e+=" "+t.updateamum+" - "+t.uvorname+" "+t.unachname+" ("+t.updatevon+")"),e}},computed:{getTmpStoresForModeAndDV:function(){var t={};if("neuanlage"!==this.store.mode)for(var e in this.tmpstores[this.store.mode]){var n=this.tmpstores[this.store.mode][e];this.store.dv.data.dienstverhaeltnisid===parseInt(n.dienstverhaeltnisid)&&(t[e]=n)}else t=this.tmpstores[this.store.mode];return t}}},re={today:null,store:Tt,vbout:{},vb2gui:function(t,e,n){switch(this.vbout={type:"",guioptions:{id:Rt(),infos:[],errors:[],deleteable:this.isDeleteable(t)},data:{},gbs:[]},t.vertragsbestandteiltyp_kurzbz){case"freitext":this.freitext2gui(t,e);break;case"funktion":this.funktion2gui(t,e);break;case"karenz":this.karenz2gui(t,e);break;case"kuendigungsfrist":this.kuendigungsfrist2gui(t,e);break;case"stunden":this.stunden2gui(t,e);break;case"urlaubsanspruch":this.urlaubsanspruch2gui(t,e);break;case"zeitaufzeichnung":this.zeitaufzeichnung2gui(t,e);break;default:console.log("unknown Vertragsbestandteil "+t.vertragsbestandteiltyp_kurzbz)}for(const n of t.gehaltsbestandteile)this.vbout.gbs.push(this.gehaltsbestandteil2gui(n,e));return void 0!==n?.guioptions?.childdefaults?.guioptions?.canhavegehaltsbestandteile&&(this.vbout.guioptions.canhavegehaltsbestandteile=n.guioptions.childdefaults.guioptions.canhavegehaltsbestandteile),this.vbout},getToday:function(){return null===this.today&&(this.today=new Date,this.today.setHours(23,59,59,999)),this.today},isFuture:function(t){var e=new Date(t.von);return e.setHours(0,0,0,0),e>this.getToday()},isEndable:function(t){return"aenderung"===this.store.mode&&(null!==t.von&&""!==t.von)},isDeleteable:function(t){if("korrektur"===this.store.mode)return!0;if("aenderung"===this.store.mode){if(null===t.von||""===t.von)return!1;if(this.isFuture(t))return!0}return!1},gueltigkeit2gui:function(t,e){var n=[],a="karenz"!==t.vertragsbestandteiltyp_kurzbz&&this.isEndable(t);return!a||"aenderung"===e&&this.isFuture(t)||(n=["gueltig_ab"]),{guioptions:{sharedstatemode:"ignore",disabled:n,endable:a},data:{gueltig_ab:t.von,gueltig_bis:t.bis}}},freitext2gui:function(t,e){this.vbout.type="vertragsbestandteilfreitext",this.vbout.data={id:t.vertragsbestandteil_id,freitexttyp:t.freitexttyp_kurzbz,titel:t.titel,freitext:t.freitext,gueltigkeit:this.gueltigkeit2gui(t,e)},this.isEndable(t)&&!this.isFuture(t)&&(this.vbout.guioptions.disabled=["freitexttyp","titel","freitext"]),["allin","befristung"].indexOf(t.freitexttyp_kurzbz)>-1&&(this.vbout.guioptions.hidden=["titel","freitext"],void 0===this.vbout.guioptions?.disabled?this.vbout.guioptions.disabled=["freitexttyp"]:-1===this.vbout.guioptions.disabled.indexOf("freitexttyp")&&this.vbout.guioptions.disabled.push("freitexttyp"))},funktion2gui:function(t,e){this.vbout.type="vertragsbestandteilfunktion",this.vbout.data={id:t.vertragsbestandteil_id,funktion:t.benutzerfunktiondata.funktion_kurzbz,orget:t.benutzerfunktiondata.oe_kurzbz,benutzerfunktionid:t.benutzerfunktion_id,mitarbeiter_uid:this.store.mitarbeiter_uid,mode:"bestehende",gueltigkeit:this.gueltigkeit2gui(t,e)},this.isEndable(t)&&!this.isFuture(t)&&(this.vbout.guioptions.disabled=["funktion","orget","benutzerfunktionid","mode"]),t.benutzerfunktiondata.funktion_kurzbz.match("zuordnung")?(this.vbout.guioptions.canhavegehaltsbestandteile=!1,this.vbout.guioptions.filter="zuordnung"):this.vbout.guioptions.filter="funktion"},karenz2gui:function(t,e){this.vbout.type="vertragsbestandteilkarenz",this.vbout.data={id:t.vertragsbestandteil_id,karenztyp_kurzbz:t.karenztyp_kurzbz,geplanter_geburtstermin:t.geplanter_geburtstermin,tatsaechlicher_geburtstermin:t.tatsaechlicher_geburtstermin,gueltigkeit:this.gueltigkeit2gui(t,e)},this.isEndable(t)&&!this.isFuture(t)&&(this.vbout.guioptions.disabled=["karenztyp_kurzbz"])},kuendigungsfrist2gui:function(t,e){this.vbout.type="vertragsbestandteilkuendigungsfrist",this.vbout.data={id:t.vertragsbestandteil_id,arbeitgeber_frist:t.arbeitgeber_frist,arbeitnehmer_frist:t.arbeitnehmer_frist,gueltigkeit:this.gueltigkeit2gui(t,e)},this.isEndable(t)&&!this.isFuture(t)&&(this.vbout.guioptions.disabled=["arbeitgeber_frist","arbeitnehmer_frist"])},stunden2gui:function(t,e){this.vbout.type="vertragsbestandteilstunden",this.vbout.data={id:t.vertragsbestandteil_id,stunden:t.wochenstunden,teilzeittyp_kurzbz:t.teilzeittyp_kurzbz,gueltigkeit:this.gueltigkeit2gui(t,e)},this.isEndable(t)&&!this.isFuture(t)&&(this.vbout.guioptions.disabled=["stunden","teilzeittyp_kurzbz"])},urlaubsanspruch2gui:function(t,e){this.vbout.type="vertragsbestandteilurlaubsanspruch",this.vbout.data={id:t.vertragsbestandteil_id,tage:t.tage,gueltigkeit:this.gueltigkeit2gui(t,e)},this.isEndable(t)&&!this.isFuture(t)&&(this.vbout.guioptions.disabled=["tage"])},zeitaufzeichnung2gui:function(t,e){this.vbout.type="vertragsbestandteilzeitaufzeichnung",this.vbout.data={id:t.vertragsbestandteil_id,zeitaufzeichnung:t.zeitaufzeichnung,azgrelevant:t.azgrelevant,homeoffice:t.homeoffice,gueltigkeit:this.gueltigkeit2gui(t,e)},this.isEndable(t)&&!this.isFuture(t)&&(this.vbout.guioptions.disabled=["zeitaufzeichnung","azgrelevant","homeoffice"])},gehaltsbestandteil2gui:function(t,e){var n=[];return this.isEndable(t)&&!this.isFuture(t)&&(n=["gehaltstyp","anmerkung","betrag","valorisierung","valorisierungssperre","auszahlungen"]),t={type:"gehaltsbestandteil",guioptions:{id:Rt(),infos:[],errors:[],disabled:n,deleteable:this.isDeleteable(t)},data:{id:t.gehaltsbestandteil_id,gehaltstyp:t.gehaltstyp_kurzbz,anmerkung:t.anmerkung,betrag:t.grundbetrag,betrag_valorisiert:t.betrag_valorisiert,valorisierung:t.valorisierung,valorisierungssperre:t.valorisierungssperre,auszahlungen:t.auszahlungen,gueltigkeit:this.gueltigkeit2gui(t,e)}}}},se={today:null,store:Tt,vbconfig:{btfields:{vertragsbestandteilfreitext:["freitexttyp","titel","freitext"],vertragsbestandteilfunktion:["funktion","orget","benutzerfunktionid","mode"],vertragsbestandteilkarenz:["karenztyp_kurzbz"],vertragsbestandteilkuendigungsfrist:["arbeitgeber_frist","arbeitnehmer_frist"],vertragsbestandteilstunden:["stunden","teilzeittyp_kurzbz"],vertragsbestandteilurlaubsanspruch:["tage"],vertragsbestandteilzeitaufzeichnung:["zeitaufzeichnung","azgrelevant","homeoffice"],gehaltsbestandteil:["gehaltstyp","anmerkung","betrag","valorisierung","valorisierungssperre","auszahlungen"]},getFieldsForBt:function(t){var e=[];return void 0!==this.btfields[t]&&(e=this.btfields[t]),e}},checkpayload:function(t){for(const e in t.vbs)this.checkvb(t.vbs[e])},checkvb:function(t){if(!(void 0===t.data?.id||null===t.data.id||t.data.id<1)){if(this.checkRemoveable(t),this.checkDeleteable(t),this.checkEndable(t),this.checkDisabled(t),void 0!==t?.gbs)for(const e of t.gbs)this.checkRemoveable(e),this.checkDeleteable(e),this.checkEndable(e),this.checkDisabled(e);console.log(JSON.stringify(t))}},checkDisabled:function(t){void 0!==t.data.gueltigkeit.guioptions?.endable&&!0===t.data.gueltigkeit.guioptions.endable&&("aenderung"===this.store.mode&&this.isFuture(t.data.gueltigkeit)||(t.guioptions.disabled=this.vbconfig.getFieldsForBt(t.type),t.data.gueltigkeit.guioptions.disabled=["gueltig_ab"]))},checkEndable:function(t){var e=this.isEndable(t);void 0!==t.data.gueltigkeit.guioptions?.endable&&t.data.gueltigkeit.guioptions.endable===e||(t.data.gueltigkeit.guioptions.endable=e,t.data.gueltigkeit.guioptions.sharedstatemode="ignore")},checkRemoveable:function(t){void 0!==t.guioptions?.removeable&&!0===t.guioptions.removeable&&(t.guioptions.removeable=!1)},checkDeleteable:function(t){var e=this.isDeleteable(t);void 0!==t.guioptions?.deleteable&&t.guioptions.deleteable===e||(t.guioptions.deleteable=e)},getToday:function(){return null===this.today&&(this.today=new Date,this.today.setHours(23,59,59,999)),this.today},isFuture:function(t){var e=void 0!==t.data?.gueltig_ab?t.data.gueltig_ab:null,n=new Date(e);return n.setHours(0,0,0,0),n>this.getToday()},isDeleteable:function(t){if("korrektur"===this.store.mode)return!0;if("aenderung"===this.store.mode){if(""===t.data.gueltigkeit.data.gueltig_ab)return!1;if(this.isFuture(t.data.gueltigkeit))return!0}return!1},isEndable:function(t){return"aenderung"===this.store.mode&&""!==t.data.gueltigkeit.data.gueltig_ab}},ie={saveForm(t,e,n){var a="/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/DVAPI/saveVertrag/"+t;return void 0!==n&&(a=a+"/"+n),{method:"post",url:a,params:e}},vertragByDV:(t,e)=>({method:"get",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/DVAPI/vertragByDV",params:{dv_id:t,d:e}})},le={name:"VbFormWrapper",template:'\n    <Modal :title="getTitle" ref="modalRef" \n           :class="\'vbformModal\'" id="vbformModal" :noscroll="true">\n        <template #body>\n    \n        <div class="vbformutilities flex-shrink-0 flex-grow-0">\n            <div class="row p-2 bg-light">\n              <div class="col-3">\n                <presets_chooser ref="presetchooserRef" :presets="presets" @presetselected="handlePresetSelected" :showselectmode="false"></presets_chooser>\n              </div>\n              <div class="col-1 text-center py-3">\n                <em>{{p.t(\'vbform\', \'oder\')}}</em>\n              </div>\n              <div class="col-8">\n                <tmpstorehelper ref="tmpstorehelper" @loadedfromtmpstore="handleLoadedFromTmpStore" @savetotmpstore="saveToTmpStore"></tmpstorehelper>\n              </div>\n            </div>\n        </div>\n        \n        <vbformhelper ref="vbformhelperRef" :preset="preset"></vbformhelper>\n\n        <div v-if="debug" class="row">\n          <div class="col-12">\n            <debug_viewer v-bind:text="vbhjson"></debug_viewer>\n          </div>\n        </div>\n        \n    </template>\n        <template #footer>\n         <div class="btn-toolbar" role="toolbar" aria-label="TmpStore Toolbar">\n              <div v-if="mode === \'aenderung\' || mode === \'korrektur\'" class="btn-group me-2" role="group" aria-label="Second group">\n                  <button class="btn btn-outline-secondary btn-sm float-end" @click="reload">Zurücksetzen</button>\n              </div>\n              <div class="btn-group me-2" role="group" aria-label="Second group">\n                  <button class="btn btn-secondary btn-sm float-end" @click="validate">\n                    <span v-show="spinners.validating" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>\n                    Eingaben prüfen\n                  </button>\n              </div>\n               <div class="btn-group" role="group" aria-label="First group">\n                  <button class="btn btn-primary btn-sm float-end" @click="save">\n                    <span v-show="spinners.saving" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>\n                    {{ getSaveButtonLabel }}\n                  </button>\n              </div>\n          </div>\n        </template>\n  </Modal>\n  ',props:["mode","title","mitarbeiter_uid","curdv","debug"],data:function(){return{vbhjson:n,presets:n,preset:null,store:Tt,spinners:{saving:!1,validating:!1}}},inject:["$api","$fhcAlert"],emits:["dvsaved"],mixins:[j],components:{presets_chooser:ee,debug_viewer:Et,vbformhelper:te,Modal:Q,tmpstorehelper:ae},created:function(){this.resetStoreDV(),this.store.setMode(this.mode),this.resetpreset(),this.store.mitarbeiter_uid=this.mitarbeiter_uid},watch:{changedModeOrCurDV:function(t,e){this.resetTmpStoreHelper(),this.resetStoreDV(),e[0]===t[0]?this.$nextTick(()=>{this.$refs.presetchooserRef.selectmode()}):this.store.setMode(this.mode)}},methods:{resetStoreDV:function(){"aenderung"!==this.mode&&"korrektur"!==this.mode||(this.store.dv.data={},this.store.dv.data.dienstverhaeltnisid=this.curdv.dienstverhaeltnis_id,this.store.dv.data.vertragsart_kurzbz=this.curdv.vertragsart_kurzbz)},resetpreset:function(){this.presetselected({type:"preset",guioptions:{},children:[],dv:{data:{dienstverhaeltnisid:null,gueltigkeit:{data:{},guioptions:{}}}},vbs:{}})},presetselected:function(t){if(("aenderung"===this.mode||"korrektur"===this.mode)&&(t.dv.data.dienstverhaeltnisid=t.dv.data.dienstverhaeltnisid??this.curdv.dienstverhaeltnis_id,t.dv.data.unternehmen=""!==t.dv.data.unternehmen?t.dv.data.unternehmen:this.curdv.oe_kurzbz,t.dv.data.vertragsart_kurzbz=t.dv.data.vertragsart_kurzbz??this.curdv.vertragsart_kurzbz,t.dv.data.dvendegrund_kurzbz=void 0===t.dv.data?.dvendegrund_kurzbz?this.curdv.dvendegrund_kurzbz:t.dv.data.dvendegrund_kurzbz,t.dv.data.dvendegrund_anmerkung=void 0===t.dv.data?.dvendegrund_anmerkung?this.curdv.dvendegrund_anmerkung:t.dv.data.dvendegrund_anmerkung,t.dv.data.gueltigkeit.data={gueltig_ab:void 0!==t.dv.data.gueltigkeit?.data?.gueltig_ab?t.dv.data.gueltigkeit.data.gueltig_ab:this.curdv.von,gueltig_bis:void 0!==t.dv.data.gueltigkeit?.data?.gueltig_bis?t.dv.data.gueltigkeit.data.gueltig_bis:this.curdv.bis},t.dv.data.gueltigkeit.guioptions.sharedstatemode="ignore","aenderung"===this.mode)){var e=["gueltig_ab","gueltig_bis"];re.isFuture(this.curdv)&&(e=[]),t.dv.data.gueltigkeit.guioptions.disabled=e}this.preset=t,this.presettostore()},presettostore:function(){this.store.reset();var t=JSON.parse(JSON.stringify(this.preset.vbs));for(var e in t)this.store.addVB(e,t[e]);var n=JSON.parse(JSON.stringify(this.preset.dv));this.store.setDV(n)},searchforvbs:function(t,e,n){for(const r of t)if(e.guioptions.vertragsbestandteiltyp==="vertragsbestandteil"+r.vertragsbestandteiltyp_kurzbz){if("freitext"===r.vertragsbestandteiltyp_kurzbz){if(void 0!==e?.guioptions?.filter&&-1===e.guioptions.filter.freitexttyp.indexOf(r.freitexttyp_kurzbz))continue}else if("funktion"===r.vertragsbestandteiltyp_kurzbz){if(void 0!==e?.guioptions?.filter&&r.benutzerfunktiondata.funktion_kurzbz.match(/zuordnung/)&&"zuordnung"!==e.guioptions.filter)continue;if(void 0!==e?.guioptions?.filter&&!r.benutzerfunktiondata.funktion_kurzbz.match(/zuordnung/)&&"funktion"!==e.guioptions.filter)continue}var a=re.vb2gui(r,this.store.mode,e);n.vbs[a.guioptions.id]=a,e.children.push(a.guioptions.id)}},iterateChilds:function(t,e,n){for(const a of t)"vertragsbestandteillist"===a.type&&this.searchforvbs(e,a,n),void 0!==a?.children&&this.iterateChilds(a.children,e,n)},save:function(){this.spinners.saving=!0,this.store.showmsgs=!1;const t=this.$refs.vbformhelperRef.getPayload(),e=this;this.$api.call(ie.saveForm(this.store.mitarbeiter_uid,t)).then(t=>{e.handleSaved(t.data)}).finally(()=>{e.spinners.saving=!1,e.store.showmsgs=!0})},validate:function(){this.spinners.validating=!0,this.store.showmsgs=!1;const t=this.$refs.vbformhelperRef.getPayload(),e=this;this.$api.call(ie.saveForm(this.store.mitarbeiter_uid,t,"dryrun")).then(t=>{e.handleValidated(t.data)}).finally(()=>{e.spinners.validating=!1,e.store.showmsgs=!0})},handlePresetSelected:function(t){if("aenderung"===this.mode){t=JSON.parse(JSON.stringify(t));this.$api.call(vt.getCurrentAndFutureVBs(this.curdv.dienstverhaeltnis_id)).then(e=>{this.iterateChilds(t.children,e.data,t),this.presetselected(t),this.resetTmpStoreHelper()})}else if("korrektur"===this.mode){t=JSON.parse(JSON.stringify(t));this.$api.call(vt.getAllVBs(this.curdv.dienstverhaeltnis_id)).then(e=>{this.iterateChilds(t.children,e.data,t),this.presetselected(t),this.resetTmpStoreHelper()})}else this.presetselected(t),this.resetTmpStoreHelper()},handleValidated:function(t){this.presetselected(t)},handleSaved:function(t){this.$refs.tmpstorehelper.deleteFromTmpStorePromise().then(()=>{this.$refs.tmpstorehelper.fetchTmpStoreList(),se.checkpayload(t),this.presetselected(t);const e=t.dv.data.dienstverhaeltnisid;this.$emit("dvsaved",e)})},handleLoadedFromTmpStore:function(t){this.presetselected(t),this.$refs.presetchooserRef.resetSelectedPreset()},showModal:function(){this.store.setMode(this.mode),this.$refs.modalRef.show()},resetTmpStoreHelper:function(){this.$refs.tmpstorehelper.fetchTmpStoreList(!0),this.store.setTmpStoreId(null)},saveToTmpStore:function(){const t=this.$refs.vbformhelperRef.getPayload(),e={tmpStoreId:this.store.getTmpStoreId(),typ:this.store.getMode(),mitarbeiter_uid:this.store.mitarbeiter_uid,formdata:t};this.$api.call(ne.storeToTmpStore(e)).then(t=>{this.store.setTmpStoreId(t.meta.tmpstoreid),this.$refs.tmpstorehelper.fetchTmpStoreList(!1),this.$refs.presetchooserRef.resetSelectedPreset(),console.log("storeToTmpStore executed.")})},reload:function(){this.$refs.presetchooserRef.selectpreset()}},expose:["showModal"],computed:{getTitle:function(){var t="";switch(this.mode){case"korrektur":t="korrigieren";break;case"aenderung":t="bearbeiten";break;default:t="anlegen"}return this.title+" "+t},getSaveButtonLabel:function(){return"aenderung"===this.store.mode?"Änderung speichern":"korrektur"===this.store.mode?"Korrektur speichern":"Dienstverhältnis anlegen"},changedModeOrCurDV:function(){return[this.mode,this.curdv]}}},oe={name:"EndDvModal",template:'\n    <Modal :title="\'Dienstverhältnis beenden\'" :noscroll="true" ref="modalRef" \n           :class="\'vbformModal\'" id="endDvModal">\n        <template #body>\n            <infos v-show="store.showmsgs" :infos="(infos !== undefined) ? infos : []"></infos>\n            <errors v-show="store.showmsgs" :errors="(errors !== undefined) ? errors : []"></errors>\n            <div class="row g-2 py-2 border-bottom mb-3">\n                <dienstverhaeltnis ref="dienstverhaeltnisRef" :config="curdv" :showdvcheckoverlap="false"></dienstverhaeltnis>\n            </div>\n\n            <input type="checkbox" v-model="unrulyInternal" id="unruly" :disabled="spinners.saving" ref="unrulyCheckbox">\n\t\t\t<label for="unruly" style="margin-left: 12px;" >{{ $p.t(\'studierendenantrag\', \'mark_person_as_unruly\') }}</label>\n\n            \n        </template>\n        <template #footer>\n         <div class="btn-toolbar" role="toolbar" aria-label="TmpStore Toolbar">\n              <div class="btn-group me-2" role="group" aria-label="Second group">\n                  <button class="btn btn-secondary btn-sm float-end" @click="cancel">Abbrechen</button>\n              </div>\n               <div class="btn-group" role="group" aria-label="First group">\n                <button class="btn btn-primary btn-sm float-end" @click="enddv">\n                  <span v-show="spinners.saving" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>\n                  Dienstverhältnis beenden\n                </button>\n              </div>\n          </div>\n        </template>\n  </Modal>\n  ',props:["curdv"],data:function(){return{store:Tt,infos:[],errors:[],spinners:{saving:!1},unrulyInternal:!1}},emits:["dvended","updateunruly"],inject:["$api","$fhcAlert"],components:{Modal:Q,dienstverhaeltnis:Zt,infos:Ht,errors:Mt},methods:{enddv:function(){this.spinners.saving=!0,this.store.showmsgs=!1;const t=this.$refs.dienstverhaeltnisRef.getPayload();this.$api.call(Wt.endDV(t)).then(t=>{this.handleDVEnded(t)}).then(()=>{this.unrulyInternal&&this.$api.call(Z.updatePersonUnruly({person_id:this.curdv.person_id,unruly:this.unrulyInternal})).then(t=>{this.$emit("updateunruly",this.unrulyInternal)})}).finally(()=>{this.spinners.saving=!1,this.store.showmsgs=!0})},cancel:function(){this.$refs.modalRef.hide()},handleDVEnded:function(t){t.error>0?(this.errors=[t.retval],this.infos=[]):(this.infos=[t.retval],this.errors=[]),this.$emit("dvended",this.curdv)},showModal:function(){this.store.mode="korrektur",this.$refs.modalRef.show()},saveUnrulyPerson:function(){this.spinners.saving=!0,this.store.showmsgs=!1,this.$api.call(Z.updatePersonUnruly({person_id:this.curdv.person_id,unruly:this.unrulyInternal})).then(t=>{this.$emit("updateunruly",this.unrulyInternal)}).finally(()=>{this.spinners.saving=!1,this.store.showmsgs=!0})}},watch:{curdv(t){this.unrulyInternal=t.unruly}},expose:["showModal"]},de={name:"DeleteDvModal",template:'\n    <Modal :title="\'Dienstverhältnis löschen\'" :noscroll="true" ref="modalRef" \n           id="deleteDvModal">\n        <template #body>\n            <div class="row g-2 py-2 border-bottom mb-3">\n                <em>{{ dvlabel }} - Wirklich löschen?</em>\n            </div>\n        </template>\n        <template #footer>\n         <div class="btn-toolbar" role="toolbar" aria-label="TmpStore Toolbar">\n              <div class="btn-group me-2" role="group" aria-label="Second group">\n                  <button class="btn btn-secondary btn-sm float-end" @click="cancel">Abbrechen</button>\n              </div>\n               <div class="btn-group" role="group" aria-label="First group">\n                  <button class="btn btn-primary btn-sm float-end" @click="deletedv">Dienstverhältnis löschen</button>\n              </div>\n          </div>\n        </template>\n  </Modal>\n  ',props:["curdv"],emits:["dvdeleted"],components:{Modal:Q},inject:["$api","$fhcAlert"],methods:{deletedv:async function(){try{await this.$api.call(mt.deleteDV(this.curdv.dienstverhaeltnisid));this.$emit("dvdeleted"),this.$refs.modalRef.hide()}catch(t){console.log(t)}},cancel:function(){this.$refs.modalRef.hide()},showModal:function(){this.$refs.modalRef.show()}},computed:{dvlabel:function(){return void 0!==this.curdv?.label?this.curdv.label:""}},expose:["showModal"]},ue={name:"KarenzModal",template:'\n    <Modal :title="\'Karenz verwalten\'" :noscroll="true" ref="modalRef" \n           :class="\'vbformModal\'" id="karenzModal">\n        <template #body>\n            <infos :infos="(infos !== undefined) ? infos : []"></infos>\n            <errors :errors="(errors !== undefined) ? errors : []"></errors>\n            <vertragsbestandteil_karenz ref="vertragsbestandteil_karenzRef" :config="curkarenz"></vertragsbestandteil_karenz>\n        </template>\n        <template #footer>\n         <div class="btn-toolbar" role="toolbar" aria-label="TmpStore Toolbar">\n              <div class="btn-group me-2" role="group" aria-label="Second group">\n                  <button class="btn btn-secondary btn-sm float-end" @click="cancel">Abbrechen</button>\n              </div>\n               <div class="btn-group" role="group" aria-label="First group">\n                  <button class="btn btn-primary btn-sm float-end" @click="enddv">Karenz speichern</button>\n              </div>\n          </div>\n        </template>\n  </Modal>\n  ',props:["curkarenz"],data:function(){return{store:Tt,infos:[],errors:[]}},emits:["karenzsaved"],components:{Modal:Q,vertragsbestandteil_karenz:qt,infos:Ht,errors:Mt},inject:["$api","$fhcAlert"],methods:{enddv:function(){const t=this.$refs.vertragsbestandteil_karenzRef.getPayload();this.$api.call(Ut.saveKarenz(t)).then(t=>{this.handleKarenzSaved(t)})},cancel:function(){this.$refs.modalRef.hide()},handleKarenzSaved:function(t){t.error>0?(this.errors=[t.retval],this.infos=[]):(this.infos=[t.retval],this.errors=[]),this.$emit("karenzsaved",this.curkarenz)},showModal:function(){this.$refs.modalRef.show()}},expose:["showModal"]};const ce={name:"DropDownButton",props:{links:{type:Array,required:!0}},expose:["show","toggle","hide"],setup(){let t,e=Vue.ref(null);Vue.onMounted(()=>{t=new bootstrap.Dropdown(e.value)});return{show:()=>{t.show()},toggle:()=>{t.toggle()},hide:()=>{t.hide()},buttonEle:e}},template:'\n        <div class="btn-group" role="group" ref="buttonEle">\n            <button  type="button" class="btn btn-sm btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">\n                <slot></slot>\n            </button>\n            <ul class="dropdown-menu" >\n                <li v-for="link in links">\n                    <a v-if="typeof(link?.action) === \'function\'"  class="dropdown-item" href="#" @click="link?.action">{{ link?.text }}</a>\n                    <a v-else-if="typeof(link?.action) === \'string\'"  class="dropdown-item" :href="link?.action" >{{ link?.text }}</a>                   \n                </li>\n            </ul>\n        </div>'},pe={name:"OffCanvasTimeline",components:{"p-timeline":primevue.timeline,"p-multiselect":primevue.multiselect},props:{uid:String,curdv:Object,alldv:Array},emits:["dateSelected"],setup(t,{expose:e,emit:n}){const a=Vue.inject("$api"),r=Vue.ref(),s=Vue.ref(!1),i=Vue.ref("Timeline"),l=Vue.ref(!1),o=Vue.toRefs(t).uid,d=Vue.ref(),u=Vue.ref([]),c=Vue.ref(!0);let p,h=Vue.ref(null);const f=new Intl.NumberFormat,v=Vue.ref([]),m=Vue.ref([]),g=Vue.inject("vertragsarten"),b=Vue.inject("vertragsbestandteiltypen"),y=Vue.inject("gehaltstypen"),_=Vue.computed(()=>{const t=new Date;let e=t.getFullYear(),n="SS";return t.getMonth<8&&t.getMonth>1||(t.getMonth<2&&e--,n="WS"),n+e}),k=()=>{c.value=!0},A=()=>{c.value=!1};async function x(){d.value=[];for(const e of t.alldv){const t=await a.call(vt.getAllVBs(e.dienstverhaeltnis_id));d.value.push(t.data)}u.value=D(d.value),p.show()}function w(){p.hide()}function z(){p.toggle()}function S(t){let e="";switch(t.vertragsbestandteiltyp_kurzbz){case"stunden":e="Zeit";break;case"zeitaufzeichnung":e="Zeitaufzeichnung";break;case"urlaubsanspruch":e="Urlaubsanspruch";break;case"kuendigungsfrist":e="Kündigungsfrist";break;case"karenz":e="Karenz";break;case"freitext":e=function(t){const e={allin:"All-In",ersatzarbeitskraft:"Ersatzarbeitskraft",zusatzvereinbarung:"Zusatzvereinbarung",befristung:"Befristung",sonstiges:"Sonstiges"};return void 0!==e[t]?e[t]:t}(t.freitexttyp_kurzbz);break;case"funktion":e=t.benutzerfunktiondata.funktion_kurzbz.match(/.*zuordnung/)?"Zuordnung":"Tätigkeit";break;default:e=t.vertragsbestandteiltyp_kurzbz}return e}function C(t){const e={basisgehalt:"Basisgehalt",grundgehalt:"Grundgehalt",zulage:"Zulage",praemie:"Prämie",GRUNDGEHALT:"Grundgehalt",PRAEMIE:"Prämie",UEBERSTUNDEN:"Überstundenauszahlung",SONSTIGES:"Sonstiges"};return void 0!==e[t]?e[t]:t}function D(e){let n={};return e.forEach((e,a)=>function(e,n,a){let r=v.value.length>0||m.value.length>0||!l,s=t=>v.value.find(e=>e.value==t.vertragsbestandteiltyp_kurzbz),i=t=>m.value.find(e=>e.value==t.gehaltstyp_kurzbz);e.forEach(e=>{(!r||r&&s(e))&&(l.value||!l.value&&e.dienstverhaeltnis_id==t.curdv.dienstverhaeltnis_id)&&(n[e.von]||(n[e.von]={date:e.von,bestandteile:[]}),n[e.von].bestandteile.push({dienstverhaeltnis_id:e.dienstverhaeltnis_id,index:a,typ:"vbs",start:!0,status:S(e),vbs:e,kurzbz:e.vertragsbestandteiltyp_kurzbz}),null!=e.bis&&(n[e.bis]||(n[e.bis]={date:e.bis,bestandteile:[]}),n[e.bis].bestandteile.push({dienstverhaeltnis_id:e.dienstverhaeltnis_id,index:a,typ:"vbs",start:!1,status:S(e),vbs:e,kurzbz:e.vertragsbestandteiltyp_kurzbz}))),e.gehaltsbestandteile.forEach(s=>{(!r||r&&i(s))&&(l.value||!l.value&&e.dienstverhaeltnis_id==t.curdv.dienstverhaeltnis_id)&&(n[s.von]||(n[s.von]={date:s.von,bestandteile:[]}),n[s.von].bestandteile.push({dienstverhaeltnis_id:s.dienstverhaeltnis_id,index:a,typ:"gbs",start:!0,status:C(s.gehaltstyp_kurzbz),gbs:s,kurzbz:s.gehaltstyp_kurzbz}),null!=s.bis&&(n[s.bis]||(n[s.bis]={date:s.bis,bestandteile:[]}),n[s.bis].bestandteile.push({dienstverhaeltnis_id:s.dienstverhaeltnis_id,index:a,typ:"gbs",start:!1,status:C(s.gehaltstyp_kurzbz),gbs:s,kurzbz:s.gehaltstyp_kurzbz})))})})}(e,n,a)),Object.values(n).sort((t,e)=>{const n=new Date(t.date);return new Date(e.date)-n})}Vue.onMounted(()=>{p=new bootstrap.Offcanvas(h.value),h.value.addEventListener("hidden.bs.offcanvas",k),h.value.addEventListener("shown.bs.offcanvas",A)}),Vue.onBeforeUnmount(()=>{h.value.removeEventListener("hidden.bs.offcanvas",k),h.value.removeEventListener("shown.bs.offcanvas",A)}),Vue.watch([v,m,l],([t,e])=>{u.value=D(d.value)});return e({show:x,hide:w,toggle:z}),{courseData:r,isFetching:s,formatDate:t=>{if(!t)return"";var e=new Date(t);return e.getDate()+"."+(e.getMonth()+1)+"."+e.getFullYear()},formatNumber:t=>f.format(parseFloat(t)),dateSelected:t=>{n("dateSelected",t),w()},currentSemester:_,title:i,currentUID:o,events:u,offCanvasEle:h,show:x,hide:w,toggle:z,isHidden:c,selectedVBSTypen:v,vertragsbestandteiltypen:b,selectedGBSTypen:m,gehaltstypen:y,showAllDVChecked:l,colorPalette:["#fd7f6f","#7eb0d5","#b2e061","#bd7ebe","#ffb55a","#ffee65","#beb9db","#fdcce5","#8bd3c7"],formatVertragsart:t=>{let e=g.value.find(e=>e.value==t);return null!=e?e.label:t}}},template:'\n     <div class="offcanvas offcanvas-end vertragshistorie"\n        ref="offCanvasEle"\n        tabindex="-1" id="offcanvasRight" aria-labelledby="offcanvasRightLabel">\n\n        <button type="button" id="btnContractHistory" class="offcanvas-btn btn btn-sm btn-secondary" @click="isHidden ? show() : hide()">Vertragshistorie</button>\n\n        <div class="offcanvas-header">\n            <h5 id="offcanvasRightLabel">Vertragshistorie</h5>\n            <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>\n        </div>\n        <div class="offcanvas-body">\n\n                <ul class="list-group mb-1">\n                    <li class="list-group-item py-1" v-for="(dv, index) in alldv"  :style="{ \'border-left\': \'5px solid \' + colorPalette[index] }" >\n                        {{ formatVertragsart(dv.vertragsart_kurzbz) }}/{{dv.oe_bezeichnung}}, {{ formatDate(dv.von) }} - {{ formatDate(dv.bis) }}\n                        <span v-if="dv.dienstverhaeltnis_id==curdv.dienstverhaeltnis_id"> (ausgewähltes DV)</span>\n                    </li>\n                </ul>\n\n                <div class="form-check form-switch mb-2">\n                            <input class="form-check-input" type="checkbox" role="switch" id="showAllDVChecked" v-model="showAllDVChecked">\n                            <label class="form-check-label" for="showAllDVChecked">alle DV anzeigen</label>\n                </div>\n                \n                <div class="card flex justify-content-center mb-5" style="border:0">\n                    <p-multiselect v-model="selectedVBSTypen" \n                        :options="vertragsbestandteiltypen" optionLabel="label"                         \n                        display="chip" placeholder="Filter Vertragsbestandteile" \n                        appendTo="self" \n                        class="mb-1">\n                        <template #optiongroup="slotProps">\n                            <div class="flex align-items-center">                            \n                                <div>{{ slotProps.option.label }}</div>\n                            </div>\n                        </template>\n                    </p-multiselect>   \n                    <p-multiselect v-model="selectedGBSTypen" \n                        :options="gehaltstypen" optionLabel="label"                         \n                        display="chip" placeholder="Filter Gehaltsbestandteile" \n                        appendTo="self" \n                        class="mb-1">\n                        <template #optiongroup="slotProps">\n                            <div class="flex align-items-center">                            \n                                <div>{{ slotProps.option.label }}</div>\n                            </div>\n                        </template>\n                    </p-multiselect>   \n\n                    \n                \n\n                </div>             \n\n                <p-timeline :value="events">\n                    <template #content="slotProps">\n                        <div style="font-weight:bold; cursor: pointer" @click="dateSelected(slotProps.item.date)">{{formatDate(slotProps.item.date)}}\n                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" fill="currentColor" aria-hidden="true" class="calendar-icon"><path d="M29.333 8c0-2.208-1.792-4-4-4h-18.667c-2.208 0-4 1.792-4 4v18.667c0 2.208 1.792 4 4 4h18.667c2.208 0 4-1.792 4-4v-18.667zM26.667 8v18.667c0 0.736-0.597 1.333-1.333 1.333 0 0-18.667 0-18.667 0-0.736 0-1.333-0.597-1.333-1.333 0 0 0-18.667 0-18.667 0-0.736 0.597-1.333 1.333-1.333 0 0 18.667 0 18.667 0 0.736 0 1.333 0.597 1.333 1.333z"></path><path d="M20 2.667v5.333c0 0.736 0.597 1.333 1.333 1.333s1.333-0.597 1.333-1.333v-5.333c0-0.736-0.597-1.333-1.333-1.333s-1.333 0.597-1.333 1.333z"></path><path d="M9.333 2.667v5.333c0 0.736 0.597 1.333 1.333 1.333s1.333-0.597 1.333-1.333v-5.333c0-0.736-0.597-1.333-1.333-1.333s-1.333 0.597-1.333 1.333z"></path><path d="M4 14.667h24c0.736 0 1.333-0.597 1.333-1.333s-0.597-1.333-1.333-1.333h-24c-0.736 0-1.333 0.597-1.333 1.333s0.597 1.333 1.333 1.333z"></path></svg>                        \n                        </div>\n\n                        <template v-for="bestandteil in slotProps.item.bestandteile">\n                            <div class="card mb-1" :style="{ \'border-left\': \'5px solid \' + colorPalette[bestandteil.index] }" >\n                                <div class="row g-0">\n                                    <div class="col-md-4" style="background-color:#eee">\n                                        <div class="card-body rounded-start pt-1 pb-1">\n                                        {{bestandteil.status}}<br/>\n                                        <span v-if="!bestandteil.start">(beendet)</span>\n                                        </div>\n                                    </div>\n                                    <div class="col-md-8">\n                                        <div class="card-body pt-1 pb-1">\n                                            <div v-if="bestandteil.typ == \'vbs\'">\n                                                <template v-if="bestandteil.vbs.vertragsbestandteiltyp_kurzbz==\'stunden\'">\n                                                    {{ formatNumber(bestandteil.vbs.wochenstunden) }}h\n                                                </template>\n                                                <template v-if="bestandteil.vbs.vertragsbestandteiltyp_kurzbz==\'funktion\'">\n                                                    {{ bestandteil.vbs.benutzerfunktiondata.funktion_bezeichnung}}<br/>\n                                                    {{ bestandteil.vbs.benutzerfunktiondata.oe_bezeichnung }}<br/>\n                                                    <template v-if="bestandteil.vbs.benutzerfunktiondata.funktion_kurzbz==\'kstzuordnung\'">\n                                                        {{ bestandteil.vbs.benutzerfunktiondata.oe_kurzbz_sap }}\n                                                    </template>\n                                                </template>\n                                                <template v-if="bestandteil.vbs.vertragsbestandteiltyp_kurzbz==\'zeitaufzeichnung\'">\n                                                    <i class="fa" :class="bestandteil.vbs.zeitaufzeichnung ? \'fa-check\':\'fa-times\' "></i> Zeitaufzeichnung<br/>\n                                                    <i class="fa" :class="bestandteil.vbs.azgrelevant ? \'fa-check\':\'fa-times\' "></i> AZG-Relevant<br/>\n                                                    <i class="fa" :class="bestandteil.vbs.homeoffice ? \'fa-check\':\'fa-times\' "></i> Home-Office\n                                                </template>\n                                                <template v-if="bestandteil.vbs.vertragsbestandteiltyp_kurzbz==\'freitext\'">\n                                                    {{ bestandteil.vbs.titel }}\n                                                </template>\n                                                <template v-if="bestandteil.vbs.vertragsbestandteiltyp_kurzbz==\'urlaubsanspruch\'">\n                                                    {{ bestandteil.vbs.tage }} Tage\n                                                </template>\n                                                <template v-if="bestandteil.vbs.vertragsbestandteiltyp_kurzbz==\'kuendigungsfrist\'">\n                                                    AG: {{ bestandteil.vbs.arbeitgeber_frist }} Wochen<br/>\n                                                    AN: {{ bestandteil.vbs.arbeitnehmer_frist }} Wochen\n                                                </template>\n                                                \n                                            </div>\n                                            <div v-if="bestandteil.typ == \'gbs\'">\n                                                € {{ formatNumber(bestandteil.gbs?.grundbetrag) }}\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </template>\n                        <br/>\n                    </template>\n                </p-timeline>\n\n\n        </div>\n     </div>\n\n     '};var he={getDvData:t=>({method:"get",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/ValorisierungCheck/getDvData",params:{dienstverhaeltnis_id:t}}),getValorisierungCheckData:t=>({method:"get",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/ValorisierungCheck/getValorisierungCheckData",params:{dienstverhaeltnis_id:t}}),checkValorisationValidityOfDv:t=>({method:"get",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/ValorisierungCheck/checkValorisationValidityOfDv",params:{dienstverhaeltnis_id:t}}),redoValorisation:t=>({method:"post",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/ValorisierungCheck/redoValorisation",params:{dienstverhaeltnis_id:t}})};const fe={name:"EmployeeContract",components:{vbform_wrapper:le,enddvmodal:oe,deletedvmodal:de,karenzmodal:ue,DropDownButton:ce,"p-skeleton":primevue.skeleton,datepicker:VueDatePicker,ModalDialog:W,OffCanvasTimeline:pe,Toast:it},props:{id:Number,uid:String,dienstverhaeltnis_id:{type:Number,required:!1},openhistory:{type:Boolean,required:!1}},emits:["updateHeader"],setup(t,{emit:e}){const{watch:n,ref:a,reactive:r,computed:s,inject:i,onMounted:l}=Vue,o=VueRouter.useRoute(),d=VueRouter.useRouter(),{t:u}=J(),c=a([]),p=a([]),h=a([]),f=a([]),v=a(!1),m=a(null),g=a(null);a(null);const b=a(1),y=r({funktion:{zuordnung:[],taetigkeit:[]},zeitaufzeichnung:[],kuendigungsfrist:[],stunden:[],allIn:[],befristung:[],urlaubsanspruch:[],zusatzvereinbarung:[],karenz:[]}),_=a(),k=a("neuanlage"),A=a(null),x=a(),w=a(null),z=a(),S=a(null),C=a(),D=a(null),F=a(t.openhistory),V=t=>new Date(t.getFullYear(),t.getMonth(),t.getDate(),12),P=new Intl.NumberFormat,E=a(V(new Date)),T=a(E.value),$=a(),B=a(),O=Vue.inject("karenztypen"),M=i("vertragsarten"),H=i("freitexttypen"),I=i("beendigungsgruende"),R=i("teilzeittypen"),L=a(!1),j=a(!0),G=Vue.inject("$api");i("$fhcAlert");const N=t=>{let e=new Date(t);return Math.round(e.getTime()/1e3)};a([]),a([]);const U=r({lang:{thousandsSep:"."},chart:{type:"line"},title:{text:"Gehalt"},series:[{name:"Gehalt",data:[],color:"#6fcd98",step:"left"},{name:"Gehalt (ohne Val.)",data:[],color:"#d6af02",step:"left",visible:!1},{name:"Abgerechnet",data:[],color:"#cd6fca",step:"left"}],xAxis:{type:"datetime",currentDateIndicator:{width:2,dashStyle:"dot",color:"red",label:{format:"%d.%m.%Y"}},labels:{formatter:function(){return Highcharts.dateFormat("%d.%m.%Y",this.value)},rotation:90}},tooltip:{pointFormat:"<b>€ {point.y:,.2f}</b>",xDateFormat:"%d.%m.%Y"},yAxis:{title:{text:"€"}},credits:{enabled:!1}}),q=async e=>{if(null==e)return c.value=[],void(p.value=[]);v.value=!0;try{const n=await G.call(mt.dvByPerson(e));c.value=n.data||[],c.value.length>0?null!=t.dienstverhaeltnis_id?(m.value=t.dienstverhaeltnis_id,g.value=c.value.find(e=>e.dienstverhaeltnis_id==t.dienstverhaeltnis_id)):(m.value=c.value[0].dienstverhaeltnis_id,g.value=c.value[0]):(m.value=null,g.value=null)}catch(t){console.log(t)}finally{v.value=!1}},K=async(t,e)=>{v.value=!0;try{const n=await G.call(ie.vertragByDV(t,N(e)));p.value=n.data,nt()}catch(t){console.log(t)}finally{v.value=!1}},W=async(t,e)=>{v.value=!0;try{const n=await G.call(Qt.gbtByDV(t,N(e)));h.value=n.data}catch(t){console.log(t)}finally{v.value=!1}},Z=async(t,e)=>{v.value=!0;let n=[],a=[],r=[];try{if(null!=t){const e=await G.call(Qt.gbtChartDataByDV(t));f.value=e.data,Object.keys(e.data.valorisiert).forEach(t=>{n.push([new Date(t).getTime(),parseFloat(e.data.valorisiert[t])])}),Object.keys(e.data.gesamt).forEach(t=>{a.push([new Date(t).getTime(),parseFloat(e.data.gesamt[t])])}),e.data.abgerechnet.forEach(t=>{r.push([new Date(t.datum).getTime(),parseFloat(t.sum)])})}}catch(t){console.log(t)}finally{U.series[0].data=n,U.series[1].data=a,U.series[2].data=r,v.value=!1}},Y=s(()=>c.value?.filter(t=>{let e=new Date(t.von),n=null!=t.bis?new Date(t.bis):null;return e<=T.value&&(null==n||n>=T.value)})),X=s(()=>{if(null==g.value)return!1;let t=V(new Date(g.value.von)),e=null!=g.value.bis?V(new Date(g.value.bis)):null;return t<=T.value&&(null==e||e>=T.value)}),Q=s(()=>T.value.getTime()==E.value.getTime());q(t.uid),n(()=>t.uid,t=>{q(t)}),n(m,t=>{null!=t&&(K(t,T.value),W(t,T.value),Z(t),st(),F.value&&(console.log("*** watch currentDVID ***"),Vue.nextTick().then(()=>{et(),F.value=!1})))}),n(()=>t.dienstverhaeltnis_id,e=>{m.value=t.dienstverhaeltnis_id,g.value=c.value.find(e=>e.dienstverhaeltnis_id==t.dienstverhaeltnis_id)}),n(T,t=>{console.log("watch newDate=",t),K(m.value,t),W(m.value,t),Z(m.value)});const tt=t=>null!=t&&""!=t?t.substring(8,10)+"."+t.substring(5,7)+"."+t.substring(0,4):"",et=()=>{B.value.show()},nt=()=>{let t=[],e=[],n=[],a=[],r=[],s=[],i=[],l=[],o=[],d=[];p.value.forEach(u=>{"funktion"==u.vertragsbestandteiltyp_kurzbz?u.benutzerfunktiondata.funktion_kurzbz.match(/.*zuordnung/)?t.push(u.benutzerfunktiondata):e.push(u.benutzerfunktiondata):"freitext"==u.vertragsbestandteiltyp_kurzbz?"allin"==u.freitexttyp_kurzbz?s.push(u):"befristung"==u.freitexttyp_kurzbz?i.push(u):o.push(u):"kuendigungsfrist"==u.vertragsbestandteiltyp_kurzbz?a.push(u):"stunden"==u.vertragsbestandteiltyp_kurzbz?r.push(u):"urlaubsanspruch"==u.vertragsbestandteiltyp_kurzbz?l.push(u):"zeitaufzeichnung"==u.vertragsbestandteiltyp_kurzbz?n.push(u):"karenz"==u.vertragsbestandteiltyp_kurzbz&&d.push(u)}),y.funktion.zuordnung=t,y.funktion.taetigkeit=e,y.zeitaufzeichnung=n,y.stunden=r,y.kuendigungsfrist=a,y.allIn=s,y.befristung=i,y.zusatzvereinbarung=o,y.urlaubsanspruch=l,y.karenz=d},at=t=>t.charAt(0).toUpperCase()+t.slice(1),rt=t=>{let e=M.value.find(e=>e.value==t);return null!=e?e.label:t},st=async()=>{if(null!=m&&m.value>0){v.value=!0;try{const t=await G.call(he.checkValorisationValidityOfDv(m.value));j.value=t.data}catch(t){console.log(t)}finally{v.value=!1}}};st();const it=s(()=>`/${FHC_JS_DATA_STORAGE_OBJECT.app_root.replace(/(https:|)(^|\/\/)(.*?\/)/g,"")+FHC_JS_DATA_STORAGE_OBJECT.ci_router}/extensions/FHC-Core-Personalverwaltung/Valorisation/Check/`+m.value);return{isFetching:v,dvList:c,vertragList:p,gbtList:h,currentDV:g,currentDVID:m,dvSelectedHandler:e=>{console.log("DV selected: ",e.target),b.value=e.target.selectedIndex+1,g.value=c.value[e.target.selectedIndex],m.value=g.value.dienstverhaeltnis_id;let n=FHC_JS_DATA_STORAGE_OBJECT.app_root.replace(/(https:|)(^|\/\/)(.*?\/)/g,"/")+FHC_JS_DATA_STORAGE_OBJECT.ci_router+"/extensions/FHC-Core-Personalverwaltung/Employees/"+t.id+"/"+t.uid+"/contract/"+g.value.dienstverhaeltnis_id;d.push(n)},confirmDeleteDVRef:$,offCanvasRef:B,VbformWrapperRef:_,route:o,vbformmode:k,vbformDV:A,formatNumber:t=>P.format(parseFloat(t)),activeDV:Y,isCurrentDVActive:X,isCurrentDate:Q,currentVBS:y,dropdownLink1:()=>{console.log("dropdown link clicked")},setDateHandler:t=>{console.log("date set: ",t),T.value=V(new Date(t))},dvDeleteHandler:()=>{console.log("dvDeleteHandler link clicked",m),(async t=>{v.value=!0;try{await G.call(mt.deleteDV(t)),e("updateHeader")}catch(t){console.log(t)}finally{v.value=!1}})(m.value).then(async()=>{q(t.uid);let e=FHC_JS_DATA_STORAGE_OBJECT.app_root.replace(/(https:|)(^|\/\/)(.*?\/)/g,"/")+FHC_JS_DATA_STORAGE_OBJECT.ci_router+"/extensions/FHC-Core-Personalverwaltung/Employees/"+t.id+"/"+t.uid+"/contract";await d.push(e)})},formatGBTGrund:t=>t?"funktion"==t.vertragsbestandteiltyp_kurzbz?t.fkt_beschreibung+"/"+(null!=t.fb_bezeichnung?t.fb_bezeichnung:"")+(null!=t.org_bezeichnung?t.org_bezeichnung:""):"freitext"==t.vertragsbestandteiltyp_kurzbz?at(t.freitexttyp_kurzbz)+"/"+t.freitext_titel:at(t.vertragsbestandteiltyp_kurzbz):"",truncate:t=>t?.length>8?`${t.substring(0,8)}...`:t,setDate2BisDatum:()=>{T.value=V(new Date(g.value.bis))},setDate2VonDatum:()=>{T.value=V(new Date(g.value.von))},createDVDialog:()=>{k.value="neuanlage",A.value=null,_.value.showModal()},updateDVDialog:()=>{k.value="aenderung",A.value=g.value,_.value.showModal()},korrekturDVDialog:()=>{k.value="korrektur",A.value=g.value,_.value.showModal()},handleDvSaved:async()=>{q(t.uid).then(()=>{null!=m&&m.value>0&&(K(m.value,T.value),W(m.value,T.value),Z(m.value),st(),e("updateHeader"))})},formatDate:tt,formatDateISO:t=>{let e=t=>t<10?"0"+t:t;if(null==t)return"";var n=new Date(t);return n.getFullYear()+"-"+e(n.getMonth()+1)+"-"+e(n.getDate())},dvSelectedIndex:b,currentDate:T,chartOptions:U,enddvmodalRef:x,endDVDialog:()=>{w.value={dienstverhaeltnisid:g.value.dienstverhaeltnis_id,unternehmen:g.value.oe_kurzbz,vertragsart_kurzbz:g.value.vertragsart_kurzbz,dvendegrund_kurzbz:g.value.dvendegrund_kurzbz,dvendegrund_anmerkung:g.value.dvendegrund_anmerkung,gueltigkeit:{guioptions:{sharedstatemode:"ignore",disabled:["gueltig_ab"]},data:{gueltig_ab:g.value.von,gueltig_bis:g.value.bis}},unruly:g.value.unruly,person_id:g.value.person_id},x.value.showModal()},endDV:w,handleDvEnded:async()=>{q(o.params.uid),e("updateHeader")},handleUpdateUnruly:async()=>{q(o.params.uid),e("updateHeader")},showOffCanvas:et,dateSelectedHandler:t=>{T.value=V(new Date(t))},karenzmodalRef:C,karenzDialog:()=>{D.value={type:"vertragsbestandteilkarenz",guioptions:{id:"test"},data:{id:null,karenztyp_kurzbz:"",geplanter_geburtstermin:"",tatsaechlicher_geburtstermin:"",gueltigkeit:{guioptions:{sharedstatemode:"ignore",disabled:[]},data:{gueltig_ab:"",gueltig_bis:""}}}},C.value.showModal()},curKarenz:D,handleKarenzSaved:async()=>{console.log("Karenz saved")},formatKarenztyp:t=>{let e=O.value.find(e=>e.value==t);return null!=e?e.label:t},formatVertragsart:rt,formatFreitexttyp:t=>{let e=H.value.find(e=>e.value==t);return null!=e?e.label:t},readonly:L,t:u,linkToLehrtaetigkeitsbestaetigungODT:()=>{window.location.href=FHC_JS_DATA_STORAGE_OBJECT.app_root+"content/mitarbeiter/lehrtaetigkeit.pdf.php?output=odt&uid="+g.value.uid},linkToLehrtaetigkeitsbestaetigungPDF:()=>{window.location.href=FHC_JS_DATA_STORAGE_OBJECT.app_root+"content/mitarbeiter/lehrtaetigkeit.pdf.php?output=pdf&uid="+g.value.uid},formatBeendigungsgrund:t=>{let e=I.value.find(e=>e.value==t);return null!=e?e.label:t},deletedvmodalRef:z,deleteDVDialog:()=>{S.value={dienstverhaeltnisid:g.value.dienstverhaeltnis_id,label:rt(g.value.vertragsart_kurzbz)+"/"+g.value.oe_bezeichnung+", "+tt(g.value.von)+" - "+tt(g.value.bis)},z.value.showModal()},delDV:S,handleDvDeleted:()=>{S.value=null;let e=FHC_JS_DATA_STORAGE_OBJECT.app_root.replace(/(https:|)(^|\/\/)(.*?\/)/g,"/")+FHC_JS_DATA_STORAGE_OBJECT.ci_router+"/extensions/FHC-Core-Personalverwaltung/Employees/"+t.id+"/"+t.uid+"/contract";d.push(e).then(()=>{d.go(0)})},formatTeilzeittyp:t=>{let e=R.value.find(e=>e.value==t);return null!=e?e.label:t},valorisationCheckPath:it,valorisationValid:j}},template:'\n\n\n\n    <div class="d-flex justify-content-between align-items-center ms-sm-auto col-lg-12 p-md-2">\n\n      <div class="container-fluid px-1">\n\n            <div class="row">\n\n                <div class="toast-container position-absolute top-0 end-0 pt-4 pe-2">\n                    <Toast ref="toastRef">\n                        <template #body><h4>Vertrag gespeichert.</h4></template>\n                    </Toast>\n                </div>\n\n                <div class="col-md-12">\n                    <div class="d-flex justify-content-end mb-2">\n                        <div class="me-2"><span style="font-size:0.5em;font-style:italic" v-if="dvList?.length>0">({{ dvSelectedIndex }} von {{ dvList.length }})  id={{currentDVID}}</span></div>\n                        <div v-if="!isCurrentDate"><span class="badge badge-sm bg-warning me-1">Anzeigedatum ist nicht aktueller Tag</span></div>\n                        <div><span class="badge badge-sm me-1" :class="{\'bg-success\': activeDV.length > 0, \'bg-danger\': activeDV.length == 0}" v-if="!isFetching">{{ activeDV.length }} aktiv zu gewähltem Datum</span></div>\n                        <div><span class="badge badge-sm bg-secondary">{{ dvList?.length }} <span v-if="dvList">gesamt</span></span></div>\n                    </div>\n                    <div class="d-flex">\n                        <div class="me-auto">\n                            <button v-if="!readonly" type="button" class="btn btn-sm btn-primary me-2" @click="createDVDialog()"><i class="fa fa-plus"></i> Dienstverhältnis</button>\n                            <button v-if="!readonly" type="button" class="btn btn-sm btn-outline-secondary me-2" @click="updateDVDialog()">DV bearbeiten</button>\n                            <DropDownButton class="me-2" :links="[{action:linkToLehrtaetigkeitsbestaetigungODT,text:\'Lehrtätigkeitsbestätigung (odt)\'},{action:linkToLehrtaetigkeitsbestaetigungPDF,text:\'Lehrtätigkeitsbestätigung (pdf)\'}]">\n                                Bestätigung drucken\n                            </DropDownButton>\n                            \x3c!-- Drop Down Button --\x3e\n                            <DropDownButton class="me-2" :links="[{action:korrekturDVDialog,text:\'DV korrigieren\'},{action:endDVDialog,text:\'DV beenden\'},{action:deleteDVDialog,text:\'DV löschen (nur in Ausnahmefällen)\'}]">\n                                Weitere Aktionen\n                            </DropDownButton>\n                            \x3c!--button v-if="!readonly" type="button" class="btn btn-sm btn-secondary" @click="showOffCanvas()">Vertragshistorie</button--\x3e\n                        </div>\n\n                        <div class="d-flex align-items-end flex-column">\n                            <div class="d-grid d-sm-flex gap-2 mb-2 flex-nowrap">\n                                <select  v-if="!isFetching && dvList?.length>0" class="form-select form-select-sm" v-model="currentDVID" @change="dvSelectedHandler" aria-label="DV auswählen">\n                                    <option v-for="(item, index) in dvList" :value="item.dienstverhaeltnis_id"  :key="item.dienstverhaeltnis_id">\n                                    {{ formatVertragsart(item.vertragsart_kurzbz) }}/{{item.oe_bezeichnung}}, {{ formatDate(item.von) }} - {{ formatDate(item.bis) }}\n                                    </option>\n                                </select>\n                                <div v-else-if="isFetching" style="width:150px"><p-skeleton style="width:100%;height:100%"></p-skeleton></div>\n\n                                <datepicker id="currentDateSelect" :modelValue="formatDateISO(currentDate)"\n                                    @update:model-value="setDateHandler"\n                                    v-bind:enable-time-picker="false"\n                                    :clearable="false"\n                                    six-weeks\n                                    auto-apply\n                                    locale="de"\n                                    format="dd.MM.yyyy"\n                                    model-type="yyyy-MM-dd"\n                                    input-class-name="dp-custom-input"\n\t\t\t\t\t\t\t\t\t:config="{ keepActionRow: true }"\n\t\t\t\t\t\t\t\t\t:action-row="{ showNow: true, showSelect: false, showCancel: false }"\n\t\t\t\t\t\t\t\t\tnow-button-label="Heute"\n                                    style="max-width:140px;min-width:140px" ></datepicker>\n                            </div>\n                        </div>\n                    </div>\n\n                </div>\n\n                <div class="row justify-content-center pt-md-2" v-if="!isCurrentDVActive && dvList?.length">\n                        <div class="alert alert-warning mt-3" role="alert">\n                            Dienstverhältnis ist zum ausgewählten Datum inaktiv.\n                            <span v-if="currentDV?.bis != null">\n                                Anzeigedatum auf letztgültiges Datum des Dienstverhältnisses setzen: &nbsp;\n                                <button type="button" class="btn btn-sm btn-outline-secondary" @click="setDate2BisDatum">\n                                    Datum setzen\n                                </button>\n\n                            </span>\n                            <span v-else-if="currentDV?.von != null">\n                                Anzeigedatum auf Von-Datum des Dienstverhältnisses setzen: &nbsp;\n                                <button type="button" class="btn btn-sm btn-outline-secondary" @click="setDate2VonDatum">\n                                    Datum setzen\n                                </button>\n\n                            </span>\n                        </div>\n                </div>\n                <div class="row pt-md-2" v-if="isCurrentDVActive && dvList?.length">\n                    <div class="col-6">\n                        \x3c!-- Allgemein --\x3e\n                        <div class="card">\n                            <div class="card-header">\n                                <h5 class="mb-0">Allgemein</h5>\n                            </div>\n                            <div class="card-body">\n                                <div ref="baseDataFrm" class="row g-3" v-if="currentDV != null">\n\n                                    <div class="col-md-4">\n                                        <label class="col-sm-6 form-label">Organisation</label>\n                                        <input type="text" readonly class="form-control-sm form-control-plaintext" :value="currentDV.oe_bezeichnung" >\n                                    </div>\n\n                                    <div class="col-md-4">\n                                        <label for="dvArt" class="col-sm-6 form-label">Vertragsart</label>\n                                        <div class="col-sm-12">\n                                            <input type="text" readonly class="form-control-sm form-control-plaintext" id="dvArt" :value="formatVertragsart(currentDV.vertragsart_kurzbz)">\n                                        </div>\n                                    </div>\n\n                                    <div class="col-md-4"></div>\n\n                                    \x3c!-- von bis --\x3e\n                                    <div class="col-md-4">\n                                        <label class="form-label" >Von</label>\n                                        <input type="text" readonly class="form-control-sm form-control-plaintext" :value="formatDate(currentDV.von)" >\n                                    </div>\n\n                                    <div class="col-md-4">\n                                        <label class="form-label" >Bis</label>\n                                        <input type="text" readonly class="form-control-sm form-control-plaintext" :value="formatDate(currentDV?.bis)" >\n                                    </div>\n\n                                    \x3c!--div class="col-md-4">\n                                        <label  class="form-label" >Befristet</label>\n                                        <div class="col-sm-8">\n                                            <input class="form-check-input mt-2" type="checkbox" id="befristetCheck" disabled >\n                                        </div>\n                                    </div--\x3e\n\n                                    \x3c!-- DV Beendigungsgrund --\x3e\n                                    <div class="col-md-4" v-if="currentDV?.dvendegrund_kurzbz != null">\n                                        <label  class="form-label" >Beendigungsgrund</label>\n                                        <input readonly class="form-control-sm form-control-plaintext" type="text" id="dvendegrundKurzbz" :value="formatBeendigungsgrund(currentDV?.dvendegrund_kurzbz)"  >\n                                    </div>\n                                    <div class="col-md-4"  v-else></div>\n\n                                    <div class="col-md-8" v-if="currentDV?.dvendegrund_kurzbz != null">\n                                        <label  class="form-label" >Anmerkung</label>\n                                        <textarea class="form-control-sm form-control-plaintext" readonly >{{ currentDV?.dvendegrund_anmerkung }} </textarea>\n                                    </div>\n                                    <div class="col-md-8"  v-else></div>\n\n                                    <div class="col-md-4"></div>\n\n                                    \x3c!-- Befristung --\x3e\n                                    <template v-for="(item, index) in currentVBS.befristung"  >\n                                        <div class="col-md-4">\n                                            <label for="befristet_von" class="form-label" >Befristung Von</label>\n                                            <input type="text" readonly class="form-control-sm form-control-plaintext" :value="formatDate(item.von)" >\n                                        </div>\n\n                                        <div class="col-md-4">\n                                            <label for="befristet_bis" class="form-label" >Befristung Bis</label>\n                                            <input type="text" readonly class="form-control-sm form-control-plaintext" :value="formatDate(item.bis)" >\n                                        </div>\n\n                                        <div class="col-md-4">\n                                            <label for="befristetCheck" class="form-label" >Befristet</label>\n                                            <div class="col-sm-8">\n                                                <input class="form-check-input mt-2" type="checkbox" id="befristetCheck" checked disabled>\n                                            </div>\n                                        </div>\n                                    </template>\n\n                                    \x3c!-- Kündigungsfrist --\x3e\n                                    <template v-for="(item, index) in currentVBS.kuendigungsfrist"  >\n                                        <div class="col-md-4">\n                                            <label for="dvKuendigungsfristAG" class="form-label">Kündigungsfrist AG</label>\n                                            <input type="text" readonly class="form-control-sm form-control-plaintext" id="dvKuendigungsfristAG" :value="item.arbeitgeber_frist">\n                                        </div>\n\n                                        <div class="col-md-4">\n                                            <label for="dvKuendigungsfristAN" class="form-label">Kündigungsfrist AN</label>\n                                            <input type="text" readonly class="form-control-sm form-control-plaintext" id="dvKuendigungsfristAN" :value="item.arbeitnehmer_frist">\n                                        </div>\n\n                                        <div class="col-md-4"></div>\n                                    </template>\n\n                                    \x3c!-- Urlaubsanspruch --\x3e\n                                    <template v-for="(item, index) in currentVBS.urlaubsanspruch"  >\n                                        <div class="col-md-3">\n                                            <label for="dvUrlaubsanspruch" class="form-label">Urlaubsanspruch</label>\n                                            <input type="text" readonly class="form-control-sm form-control-plaintext" id="dvUrlaubsanspruch" :value="item.tage">\n                                        </div>\n                                    </template>\n\n                                </div>\n                            </div>\x3c!-- card body --\x3e\n                        </div>\x3c!-- card --\x3e\n\n                        \x3c!-- Arbeitszeit --\x3e\n                        <div class="card mt-3">\n                            <div class="card-header">\n                                <h5 class="mb-0">Arbeitszeit</h5>\n                            </div>\n                            <div class="card-body">\n                                <div class="col-md-12 py-3" v-if="currentVBS.stunden.length == 0">\n                                    Kein aktiver Vertragsbestandteil vorhanden.\n                                </div>\n                                <template v-for="(item, index) in currentVBS.stunden"  >\n                                    <div class="row">\n                                        <div class="col-md-4">\n                                            <label for="dvStunden" class="form-label">Wochenstunden</label>\n                                            <div class="col-sm-12">\n                                                <input type="text" readonly class="form-control-sm form-control-plaintext" id="dvStunden"  :value="formatNumber(item.wochenstunden)">\n                                            </div>\n                                        </div>\n\n                                        <div class="col-md-4">\n                                            <label for="dvTeilzeittyp" class="form-label">Teilzeittyp</label>\n                                            <div class="col-sm-12">\n                                                <input type="text" readonly class="form-control-sm form-control-plaintext" id="dvTeilzeittyp" :value="formatTeilzeittyp(item.teilzeittyp_kurzbz)">\n                                            </div>\n                                        </div>\n\n                                        <div class="col-md-4">\n                                                <template v-for="(item, index) in currentVBS.allIn"  >\n                                                    <label  class="form-label" >AllIn</label>\n                                                    <div class="col-sm-8">\n                                                        <input class="form-check-input mt-2" type="checkbox" id="allInCheck" checked disabled>\n                                                    </div>\n                                                </template>\n                                            </div>\n                                    </div>\n                                </template>\n                            </div>\x3c!-- card-body --\x3e\n                        </div>\x3c!-- card --\x3e\n\n                        \x3c!-- Zeitaufzeichnung --\x3e\n                        <div class="card mt-3">\n                            <div class="card-header">\n                                <h5 class="mb-0">Zeitaufzeichnung</h5>\n                            </div>\n                            <div class="card-body">\n                                 <div class="col-md-12 py-3" v-if="currentVBS.zeitaufzeichnung.length == 0">\n                                    Kein aktiver Vertragsbestandteil vorhanden.\n                                </div>\n                                <div class="row">\n                                    <div class="col-md-4">\n                                        <template v-for="(item, index) in currentVBS.zeitaufzeichnung"  >\n                                            <div class="form-check">\n                                                <input class="form-check-input" type="checkbox" id="zapflichtigCheck" :checked="item.zeitaufzeichnung" disabled>\n                                                <label class="form-check-label" >Zeitaufzeichnungspflichtig</label>\n                                            </div>\n                                            <div class="form-check">\n                                                <input class="form-check-input" type="checkbox" id="azgCheck" :checked="item.azgrelevant" disabled>\n                                                <label class="form-check-label" >AZG relevant</label>\n                                            </div>\n                                            <div class="form-check">\n                                                <input class="form-check-input" type="checkbox" id="homeofficeCheck" :checked="item.homeoffice" disabled>\n                                                <label class="form-check-label" >Homeoffice</label>\n                                            </div>\n                                        </template>\n                                    </div>\n                                    <div class="col-md-8"></div>\n                                </div>\n                            </div>\x3c!-- card body --\x3e\n                        </div>\x3c!-- card --\x3e\n\n                        \x3c!-- Sonstige Vereinbarung --\x3e\n                        <div class="card mt-3">\n                            <div class="card-header">\n                                <h5 class="mb-0">Sonstige Vereinbarung</h5>\n                            </div>\n                            <div class="card-body">\n                                <div class="row g-3" v-if="currentDV != null">\n                                    <div class="col-md-12 py-3" v-if="currentVBS.zusatzvereinbarung.length == 0">\n                                        Kein aktiver Vertragsbestandteil vorhanden.\n                                    </div>\n                                    <template v-for="(item, index) in currentVBS.zusatzvereinbarung"  >\n                                        <div class="col-md-3">\n                                            <label class="form-label" >Freitexttyp</label>\n                                            <input type="text" readonly class="form-control-sm form-control-plaintext" :value="formatFreitexttyp(item.freitexttyp_kurzbz)" >\n                                        </div>\n\n                                        <div class="col-md-5">\n                                            <label class="form-label" >Titel</label>\n                                            <input type="text" readonly class="form-control-sm form-control-plaintext" :value="item.titel" >\n                                        </div>\n\n                                        <div class="col-md-2">\n                                            <label  class="form-label" >Von</label>\n                                            <input type="text" readonly class="form-control-sm form-control-plaintext"  :value="formatDate(item.von)">\n                                        </div>\n\n                                        <div class="col-md-2">\n                                            <label class="form-label" >Bis</label>\n                                            <input type="text" readonly class="form-control-sm form-control-plaintext"  :value="formatDate(item.bis)">\n                                        </div>\n\n                                        <div class="col-md-12">\n                                            <label class="form-label" >Text</label>\n                                            <input type="text" readonly class="form-control-sm form-control-plaintext"  :value="item.anmerkung">\n                                        </div>\n                                    </template>\n                                </div>\n                            </div>\x3c!-- card-body --\x3e\n                        </div>\x3c!-- card --\x3e\n\n                        \x3c!-- Karenz --\x3e\n                        <div class="card mt-3">\n                            <div class="card-header">\n                                <h5 class="mb-0">Karenz</h5>\n                            </div>\n                            <div class="card-body">\n                                <div class="row g-3" v-if="currentDV != null">\n                                    <div class="col-md-12 py-3" v-if="currentVBS.karenz.length == 0">\n                                        Kein aktiver Vertragsbestandteil vorhanden.\n                                    </div>\n                                    <template v-for="(item, index) in currentVBS.karenz"  >\n                                        <div class="col-md-4">\n                                            <label class="form-label" v-if="index==0" >Karenztyp</label>\n                                            <input type="text" readonly class="form-control-sm form-control-plaintext"  :value="formatKarenztyp(item.karenztyp_kurzbz)">\n                                        </div>\n\n                                        <div class="col-md-2">\n                                            <label class="form-label" v-if="index==0" >Von</label>\n                                            <input type="text" readonly class="form-control-sm form-control-plaintext"  :value="formatDate(item.von)">\n                                        </div>\n\n                                        <div class="col-md-2">\n                                            <label class="form-label" v-if="index==0" >Bis</label>\n                                            <input type="text" readonly class="form-control-sm form-control-plaintext"  :value="formatDate(item.bis)">\n                                        </div>\n\n                                        <div class="col-md-2">\n                                            <label class="form-label" v-if="index==0" >Geplanter Geb.termin</label>\n                                            <input type="text" readonly class="form-control-sm form-control-plaintext"  :value="formatDate(item.geplanter_geburtstermin)">\n                                        </div>\n\n                                        <div class="col-md-2">\n                                            <label class="form-label" v-if="index==0" >Tats. Geb.termin</label>\n                                            <input  readonly class="form-control-sm form-control-plaintext" type="text" :value="formatDate(item.tatsaechlicher_geburtstermin)" >\n                                        </div>\n                                    </template>\n\n                                </div>\n                            </div>\n                        </div>\n\n                        \x3c!-- Dokumente --\x3e\n                        <div class="card mt-3">\n                            <div class="card-header">\n                                <h5 class="mb-0">Dokumente</h5>\n                            </div>\n                            <div class="card-body">\n                                <div class="col-md-12 py-3">\n                                    Keine Dokumente vorhanden.\n                                </div>\n                            </div>\n                        </div>\n\n                        \x3c!-- Notizen --\x3e\n                        <div class="card mt-3">\n                            <div class="card-header">\n                                <h5 class="mb-0">Notizen</h5>\n                            </div>\n                            <div class="card-body">\n                               <div class="col-md-12 py-3">\n                                    Keine Notizen vorhanden.\n\t\t\t\t\t\t\t   </div>\n                            </div>\n                        </div>\n\n                    </div>\x3c!-- col-6 --\x3e\n\n                    <div class="col-6">\n                        \x3c!-- Zuordnung und Tätigkeit --\x3e\n                        <div class="card">\n                            <div class="card-header">\n                                <h5 class="mb-0">Zuordnung &amp; Tätigkeit</h5>\n                            </div>\n                            <div class="card-body">\n                                <div class="row g-3" v-if="currentDV != null">\n                                    <template v-for="(item, index) in currentVBS.funktion.zuordnung"  >\n\n                                        <div class="col-md-4">\n                                            <label class="form-label" v-if="index == 0" >Zuordnung</label>\n                                            <input type="text" readonly class="form-control-sm form-control-plaintext" :value="item.funktion_bezeichnung" >\n                                        </div>\n\n                                        <div class="col-md-6">\n                                            <label class="form-label" v-if="index == 0">Organisationseinheit</label>\n                                            <input type="text" readonly class="form-control-sm form-control-plaintext"  :value="\'[\' + item.oe_typ_bezeichnung + \'] \' + item.oe_bezeichnung">\n                                        </div>\n\n                                        <div class="col-md-2">\n                                            <label class="form-label" v-if="index == 0">SAP Kostenstelle</label>\n                                            <input type="text" readonly class="form-control-sm form-control-plaintext" v-if="item.funktion_kurzbz == \'kstzuordnung\' && item.oe_kurzbz_sap != null" :value="item.oe_kurzbz_sap">\n                                        </div>\n\n                                    </template>\n\n                                    <div class="col-md-12 py-4" v-if="currentVBS.funktion.taetigkeit.length == 0">\n                                        Keine aktive Tätigkeit vorhanden.\n                                    </div>\n                                    <template v-for="(item, index) in currentVBS.funktion.taetigkeit"  >\n\n                                        <div class="col-md-4">\n                                            <label class="form-label" v-if="index == 0" >Tätigkeit</label>\n                                            <input type="text" readonly class="form-control-sm form-control-plaintext" :value="item.funktion_bezeichnung" >\n                                        </div>\n\n                                        <div class="col-md-6">\n                                            <label class="form-label" v-if="index == 0">Organisationseinheit</label>\n                                            <input type="text" readonly class="form-control-sm form-control-plaintext"  :value="\'[\' + item.oe_typ_bezeichnung + \'] \' + item.oe_bezeichnung">\n                                        </div>\n\n                                        <div class="col-md-2">\n                                        </div>\n\n                                    </template>\n                                </div>\n                            </div>\x3c!-- card-body --\x3e\n                        </div>\x3c!-- card --\x3e\n\n                        \x3c!-- Bruttomonatsgehalt  --\x3e\n                        <div class="card mt-3">\n                            <div class="card-header">\n\t\t\t\t\t\t\t\t<div class="d-flex justify-content-between align-items-center">\n\t\t\t\t\t\t\t\t\t<div><h5 class="mb-0">Bruttomonatsgehalt</h5></div>\n\t\t\t\t\t\t\t\t\t<div v-if="!valorisationValid">\n\t\t\t\t\t\t\t\t\t\t<router-link :to="valorisationCheckPath"\n\t\t\t\t\t\t\t\t\t\t\tclass="flex-sm-fill text-sm-start">\n\t\t\t\t\t\t\t\t\t\t\tZur Valorisierungsprüfung\n\t\t\t\t\t\t\t\t\t\t</router-link>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n                            </div>\n                            <div class="card-body">\n                                <div class="row g-3" v-if="currentDV != null">\n                                    <div class="col-md-12 py-3" v-if="gbtList.length == 0">\n                                        Kein aktiver Gehaltsbestandteil vorhanden.\n                                    </div>\n                                    <template v-for="(item, index) in gbtList"  >\n\n                                        <div class="col-md-3">\n                                            <label class="form-label" v-if="index==0" >Grund</label>\n                                            <input type="text" readonly class="form-control-sm form-control-plaintext"  :value="formatGBTGrund(item)">\n                                        </div>\n\n                                        <div class="col-md-2">\n                                            <label class="form-label" v-if="index==0" >Gehaltstyp</label>\n                                            <input type="text" readonly class="form-control-sm form-control-plaintext"  :value="item?.gehaltstyp_bezeichnung">\n                                        </div>\n\n                                        <div class="col-md-2">\n                                            <label class="form-label" v-if="index==0" >Betrag</label>\n                                            <input type="text" readonly class="form-control-sm form-control-plaintext"  :value="formatNumber(item.grund_betrag_decrypted)">\n                                        </div>\n\n                                        <div class="col-md-2">\n                                            <label class="form-label" v-if="index==0" >Betrag val.</label>\n                                            <input type="text" readonly class="form-control-sm form-control-plaintext"  :value="formatNumber(item.betrag_val_decrypted)">\n                                        </div>\n\n                                        <div class="col-md-1">\n                                            <label class="form-label" v-if="index==0" >Val.</label>\n                                            <div class="col-sm-8">\n                                                <input class="form-check-input" type="checkbox" :checked="item.valorisierung" disabled>\n                                            </div>\n                                        </div>\n\n                                        <div class="col-md-2">\n                                            <label class="form-label" v-if="index==0" >Anmerkung</label>\n                                            <input type="text" readonly class="form-control-sm form-control-plaintext"  :value="truncate(item.anmerkung)">\n                                        </div>\n\n                                    </template>\n                                </div>\n                            </div>\x3c!-- card-body --\x3e\n                        </div> \x3c!-- card --\x3e\n\n                        \x3c!-- Gehalt --\x3e\n                        <div class="card mt-3">\n                            <div class="card-header">\n                                <h5 class="mb-0">Gehalt</h5>\n                            </div>\n                            <div class="card-body" style="text-align:center">\n                                <div style="width:100%;height:100%;overflow:auto">\n                                    <figure>\n                                        <highcharts class="chart" :options="chartOptions"></highcharts>\n                                    </figure>\n                                </div>\n                            </div>\x3c!-- card-body --\x3e\n                        </div>\x3c!-- card --\x3e\n\n                    </div>  \x3c!-- col-6 --\x3e\n                </div>  \x3c!-- row --\x3e\n\n            </div>\n        </div>\n\n    </div>\n\n    <vbform_wrapper\n        id="vbFormWrapper"\n        ref="VbformWrapperRef"\n        :title="\'Dienstverhältnis\'"\n        :mode="vbformmode"\n        :curdv="vbformDV"\n        :mitarbeiter_uid="uid"\n        @dvsaved="handleDvSaved">\n    </vbform_wrapper>\n\n    <ModalDialog title="Warnung" ref="confirmDeleteDVRef">\n        <template #body>\n            Dienstverhältnis wirklich löschen?\n        </template>\n    </ModalDialog>\n\n    <enddvmodal\n        ref="enddvmodalRef"\n        :curdv="endDV"\n        @dvended="handleDvEnded"\n        @updateunruly="handleUpdateUnruly">\n    </enddvmodal>\n\n    <deletedvmodal\n        ref="deletedvmodalRef"\n        :curdv="delDV"\n        @dvdeleted="handleDvDeleted">\n    </deletedvmodal>\n\n    <OffCanvasTimeline\n        ref="offCanvasRef"\n        @dateSelected="dateSelectedHandler"\n        :curdv="currentDV"\n        :alldv="dvList">\n    </OffCanvasTimeline>\n\n    <karenzmodal\n        ref="karenzmodalRef"\n        :curkarenz="curKarenz"\n        @karenzsaved="handleKarenzSaved">\n    </karenzmodal>\n    '},ve={name:"DvCard",props:{uid:String,date:Date},setup(t){const{watch:e,ref:n,toRefs:a,onMounted:r,inject:s}=Vue,i=n(),l=n(null),o=n(!1),d=n("Dienstverhältnis"),u=a(t).uid,c=Vue.inject("$api"),p=async()=>{if(null!=u.value)try{let t=(t=>{let e=new Date(t);return Math.round(e.getTime()/1e3)})(l.value);o.value=!0;const e=await c.call(mt.getCurrentDV(u.value,t));o.value=!1,i.value="success"==e?.meta?.status&&e?.data?.length>0?e.data:null}catch(t){console.log(t)}finally{o.value=!1}};return r(()=>{l.value=t.date||new Date,p()}),e(u,()=>{p()}),e(()=>t.date,t=>{null!=t&&(l.value=t,p())}),{dvData:i,isFetching:o,formatDate:t=>{if(null==t)return"";var e=new Date(t);return e.getDate()+"."+(e.getMonth()+1)+"."+e.getFullYear()},title:d,currentUID:u,currentDate:l}},template:'\n     <div class="card">\n        <div class="card-header d-flex justify-content-between align-items-baseline">\n            <h5 class="mb-0">{{ title }}</h5>\n                <span class="text-muted">{{ formatDate(currentDate) }}</span>\n            </div>\n            <div class="card-body" style="text-align:left">\n            <div v-if="isFetching" class="spinner-border" role="status">\n                 <span class="visually-hidden">Loading...</span>\n            </div>     \n            <div v-if="!isFetching && dvData!=null">\n                <div v-for="(item, index) in dvData" :key="item.dienstverhaeltnis_id">\n                    <table class="dvcard table table-bordered">\n                    <tbody>\n                        <tr><th scope="row">Zeitraum </th><td>{{ formatDate(item.von) }} - {{ formatDate(item.bis) }}</td></tr>\n                        <tr><th scope="row">Art</th><td>{{ item.vertragsart_kurzbz }}</td></tr>\n                        <tr v-if="false" v-for="(salaryItem, salaryIndex) in item.gehaltsbestandteile" :key="salaryItem.gehaltsbestandteil_id">\n                            <th scope="row">{{ salaryItem?.gehaltstyp_bezeichnung }}</th><td>€ {{ new Intl.NumberFormat().format(parseFloat(salaryItem.grund_betrag_decrypted)) }}</td>\n                        </tr>\n                    </tbody>\n                    </table>\n                </div>\n            </div>\n            \n            \n        </div>\n     </div>\n     \n     '},me={name:"LehreCard",props:{uid:String,date:Date},setup(t){const e=Vue.inject("$api"),n=Vue.ref(),a=Vue.ref(!1),r=Vue.ref("Lehre/Betreuung"),s=Vue.ref(null),i=Vue.toRefs(t).uid,l=Vue.ref((()=>{let t=new Date;null!=s.value&&(t=new Date(s.value));let e=t.getFullYear(),n="SS";return t.getMonth()<8&&t.getMonth()>1||(t.getMonth()<2&&e--,n="WS"),n+e})()),o=Vue.reactive({lang:{thousandsSep:"."},chart:{type:"column"},title:{text:""},series:[{name:"Lehre",data:[],color:"#6fcd98",step:"left"},{name:"Betreuung",data:[],color:"#cd6fca",step:"left"}],xAxis:{type:"category",labels:{rotation:90}},tooltip:{pointFormat:"<b>{point.y:,.2f}</b>"},yAxis:{title:{text:"Semesterstunden"}},credits:{enabled:!1}}),d=async()=>{if(null!=i.value&&null!=s.value)try{a.value=!0;const t=await e.call(et.getAllCourseHours(i.value));a.value=!1;let n=[];null!=t.data&&t.data.forEach(t=>{n.push([t.studiensemester_kurzbz,t.semesterstunden])}),o.series[0].data=n}catch(t){console.log(t),a.value=!1}},u=async()=>{if(null!=i.value&&null!=s.value)try{a.value=!0;const t=await e.call(et.getAllSupportHours(i.value));a.value=!1;let n=[];"success"==t?.meta?.status&&null!=t.data&&t.data.forEach(t=>{n.push([t.studiensemester_kurzbz,t.semesterstunden])}),o.series[1].data=n}catch(t){console.log(t),a.value=!1}};return Vue.onMounted(()=>{s.value=t.date||new Date,d()}),Vue.watch(i,()=>{d(),u()}),Vue.watch(l,()=>{d(),u()}),{courseData:n,isFetching:a,formatDate:t=>{if(null==t)return"";var e=new Date(t);return e.getDate()+"."+(e.getMonth()+1)+"."+e.getFullYear()},currentSemester:l,title:r,currentUID:i,currentDate:s,incSemester:()=>{l.value.startsWith("WS")?l.value="SS"+(parseInt(l.value.substring(2))+1):l.value="WS"+l.value.substring(2)},decSemester:()=>{l.value.startsWith("WS")?l.value="SS"+l.value.substring(2):l.value="WS"+(parseInt(l.value.substring(2))-1)},chartOptions:o}},template:'\n     <div class="card">\n        <div class="card-header d-flex align-items-baseline">\n            <h5 class="mb-0 flex-grow-1">{{ title }}</h5>               \n        </div>\n        <div class="card-body" style="text-align:center">\n                <div style="width:100%;height:100%;overflow:auto">\n                    <figure>\n                        <highcharts class="chart" :options="chartOptions"></highcharts>\n                    </figure>\n                </div>\n        </div>\x3c!-- card-body --\x3e\n     </div>\n     \n     '},ge={name:"IssuesCard",components:{},props:{},setup(t){const{watch:e,ref:n,toRefs:a,onMounted:r,inject:s}=Vue,i=VueRouter.useRoute(),l=Vue.ref(!1),o=Vue.ref("Issues"),d=n(null),u=Vue.ref(null),c=n([]),p=s("vertragsbestandteiltypen"),h=s("gehaltstypen"),f=s("vertragsarten"),v=s("$api"),m=async()=>{if(null!=d.value)try{l.value=!0;const t=await v.call(bt.byPerson(d.value));l.value=!1,"success"==t?.meta?.status&&t?.data?.length>0?(c.value=t.data,g(c.value)):c.value=null}catch(t){console.log(t)}finally{l.value=!1}};r(()=>{u.value=t.date||new Date,d.value=parseInt(i.params.id),m()});const g=t=>(t.forEach(t=>{let e=JSON.parse(t.behebung_parameter);if(null!=e){Object.keys(e).forEach((n,a)=>{switch(n){case"dienstverhaeltnis_id":case"erste_dienstverhaeltnis_id":case"zweite_dienstverhaeltnis_id":(async t=>{try{let e=await v.call(Wt.getDVByID(t));return console.log(e),e}catch(t){console.log(t)}return null})(e[n]).then(a=>{if(null===a.data)return;let r=e[n]+"";"behebung_data"in t||(t.behebung_data={dvs:{}}),"dvs"in t.behebung_data||(t.behebung_data.dvs={}),t.behebung_data.dvs[r]=a.data});break;case"vertragsbestandteil_id":case"erste_vertragsbestandteil_id":case"zweite_vertragsbestandteil_id":(async t=>{try{let e=await v.call(vt.getVB(t));return console.log(e),e}catch(t){console.log(t)}return null})(e[n]).then(a=>{if(null===a.data)return;let r=e[n]+"";"behebung_data"in t||(t.behebung_data={vbs:{}}),"vbs"in t.behebung_data||(t.behebung_data.vbs={}),t.behebung_data.vbs[r]=a.data});break;case"gehaltsbestandteil_id":(async t=>{try{let e=await v.call(Qt.getGB(t));return console.log(e),e}catch(t){console.log(t)}return null})(e[n]).then(a=>{if(null===a.data)return;let r=e[n]+"";"behebung_data"in t||(t.behebung_data={gbs:{}}),"gbs"in t.behebung_data||(t.behebung_data.gbs={}),t.behebung_data.gbs[r]=a.data});break;default:console.log("Behebungsparameter not supported",e)}})}}),66);e(()=>i.params,t=>{d.value=t.id,m()});const b=FHC_JS_DATA_STORAGE_OBJECT.app_root.replace(/(https:|)(^|\/\/)(.*?\/)/g,"")+FHC_JS_DATA_STORAGE_OBJECT.ci_router;return{currentDate:u,isFetching:l,formatDate:t=>{if(null==t)return"";var e=new Date(t);return e.getDate()+"."+(e.getMonth()+1)+"."+e.getFullYear()},title:o,currentPersonID:d,issues:c,fullPath:`/${b}/extensions/FHC-Core-Personalverwaltung/Employees/`,route:i,formatVertragsbestandteiltyp:t=>{let e=p.value.find(e=>e.value==t);return null!=e?e.label:t},formatGehaltstyp:t=>{let e=h.value.find(e=>e.value==t);return null!=e?e.label:t},formatVertragsart:t=>{let e=f.value.find(e=>e.value==t);return null!=e?e.label:t}}},template:'\n     <div class="card">\n        <div class="card-header d-flex justify-content-between align-items-baseline">\n            <h5 class="mb-0">{{ title }}</h5>\n                <span class="text-muted">{{ formatDate(currentDate) }}</span>\n        </div>\n        <div class="card-body" style="text-align:left">\n            <div v-if="isFetching" class="spinner-border" role="status">\n                <span class="visually-hidden">Loading...</span>\n            </div>     \n            <div v-if="!isFetching && issues!=null">\n                <table class="table table-bordered">\n                    <tbody>\n                        <tr><th>Datum</th><th>Inhalt</th></tr>                        \n                        <tr v-for="(item, index) in issues" :key="item.issue_id">\n\n                            <td>{{ formatDate(item.datum) }}</td>\n                            <td>{{ item.inhalt }} <br>\n                                <template v-if="item.behebung_data && item.behebung_data.vbs">\n                                     <span v-for="(vb, index) in item.behebung_data.vbs" > \n                                            <router-link :to="fullPath + route.params.id + \'/\' + route.params.uid + \'/contract/\' + vb.dienstverhaeltnis_id" \n                                                class="flex-sm-fill text-sm-start">\n                                                VB {{ formatVertragsbestandteiltyp(vb.vertragsbestandteiltyp_kurzbz) }} ({{ formatDate(vb.von) }} - {{ formatDate(vb.bis) }})\n                                            </router-link>\n                                        </span>\n                                </template>\n                                <template v-if="item.behebung_data && item.behebung_data.gbs">\n                                     <span v-for="(gb, index) in item.behebung_data.gbs" > \n                                            <router-link :to="fullPath + route.params.id + \'/\' + route.params.uid + \'/contract/\' + gb.dienstverhaeltnis_id" \n                                                class="flex-sm-fill text-sm-start">\n                                                GB {{ formatGehaltstyp(gb.gehaltstyp_kurzbz) }} ({{ formatDate(gb.von) }} - {{ formatDate(gb.bis) }})\n                                            </router-link>\n                                        </span>\n                                </template>\n                                <template v-if="item.behebung_data && item.behebung_data.dvs">\n                                     <span v-for="(dv, index) in item.behebung_data.dvs" > \n                                            <router-link :to="fullPath + route.params.id + \'/\' + route.params.uid + \'/contract/\' + dv.dienstverhaeltnis_id" \n                                                class="flex-sm-fill text-sm-start">\n                                                DV {{ formatVertragsart(dv.vertragsart_kurzbz) }}/{{ dv.unternehmen }} ({{ formatDate(dv.von) }} - {{ formatDate(dv.bis) }})\n                                            </router-link>\n                                        </span>\n                                </template>\n                            </td>\n                            \n                        </tr>\n                    </tbody>\n                </table>\n            </div>\n        </div>\n     </div>\n     \n     '};var be={personAbwesenheiten:t=>({method:"get",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/PersonAPI/offTimeByPerson",params:{uid:t}}),personAbwesenheitenByYear:(t,e)=>({method:"get",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/PersonAPI/offTimeByPerson",params:{uid:t,year:e}}),personZeiterfassungByWeek:(t,e,n)=>({method:"get",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/PersonAPI/timeRecordingByPerson",params:{uid:t,year:e,week:n}})};const ye={name:"OffTimeCard",components:{},props:{uid:String},setup(t){const{watch:e,ref:n,toRefs:a,onMounted:r,inject:s}=Vue,i=VueRouter.useRoute(),l=s("$api"),o=Vue.ref(!1),d=Vue.ref("Abwesenheiten"),u=n(null),c=Vue.ref(null),p=n([]),h=a(t).uid,f=async()=>{if(null!=h.value)try{o.value=!0;const t=await l.call(be.personAbwesenheiten(h.value));o.value=!1,p.value="success"==t?.meta?.status&&t?.data?.length>0?t.data:null}catch(t){console.log(t)}finally{o.value=!1}};r(()=>{f()}),e(h,()=>{f()});const v=FHC_JS_DATA_STORAGE_OBJECT.app_root.replace(/(https:|)(^|\/\/)(.*?\/)/g,"")+FHC_JS_DATA_STORAGE_OBJECT.ci_router;return{currentDate:c,isFetching:o,formatDate:t=>{if(null==t)return"";var e=new Date(t);return e.getDate()+"."+(e.getMonth()+1)+"."+e.getFullYear()},title:d,currentPersonID:u,offTimeList:p,fullPath:`/${v}/extensions/FHC-Core-Personalverwaltung/Employees/`,route:i}},template:'\n     <div class="card">\n        <div class="card-header d-flex justify-content-between align-items-baseline">\n            <h5 class="mb-0">{{ title }}</h5>\n                <span class="text-muted">{{ formatDate(currentDate) }}</span>\n        </div>\n        <div class="card-body" style="text-align:left">\n            <div v-if="isFetching" class="spinner-border" role="status">\n                <span class="visually-hidden">Loading...</span>\n            </div>     \n            <div v-if="!isFetching && offTimeList!=null">\n                <table class="table table-bordered">\n                    <tbody>\n                        <tr><th>Typ</th><th>Zeitraum</th></tr>                        \n                        <tr v-for="(item, index) in offTimeList" :key="item.zeitsperre_id">\n                            <td>{{ item.zeitsperretyp }}</td>\n                            <td>{{ formatDate(item.vondatum) }} - {{ formatDate(item.bisdatum) }}</td>                            \n                        </tr>\n                    </tbody>\n                </table>\n            </div>\n        </div>\n     </div>\n     \n     '};var _e={allByPerson:(t,e)=>({method:"get",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/FristenAPI/getPersonFristenListe/"+t+"?all="+e}),all:()=>({method:"get",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/FristenAPI/getFristenListe"}),updateFristenListe:()=>({method:"get",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/FristenAPI/updateFristenListe"}),updateFristStatus:(t,e)=>({method:"post",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/FristenAPI/updateFristStatus",params:{frist_id:t,status_kurzbz:e}}),batchUpdateFristStatus:(t,e)=>({method:"post",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/FristenAPI/batchUpdateFristStatus",params:{fristen:t,status_kurzbz:e}}),upsertFrist:t=>({method:"post",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/FristenAPI/upsertFrist",params:t}),deleteFrist:t=>({method:"post",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/FristenAPI/deleteFrist",params:{frist_id:t}}),getFristenStatus:()=>({method:"get",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/FristenAPI/getFristenStatus"}),getFristenEreignisse:()=>({method:"get",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/FristenAPI/getFristenEreignisse"}),getFristenEreignisseManuell:()=>({method:"get",url:"/extensions/FHC-Core-Personalverwaltung/api/frontend/v1/FristenAPI/getFristenEreignisse?manuell=1"})};const ke={name:"DeadlineIssueDialog",components:{Modal:Q,ModalDialog:W,datepicker:VueDatePicker},props:{},setup(t){const{watch:e,ref:n,toRefs:a,onMounted:r,defineExpose:s,toRaw:i,reactive:l,inject:o}=Vue,{t:d}=J(),u=n(),c=n([]),p=n([]),h=n(!1),f=o("$api"),v=o("$fhcAlert");let m,g=n();const b=()=>{g.value.hide()};r(async()=>{(async()=>{try{h.value=!0,f.call(_e.getFristenStatus()).then(t=>{c.value="success"==t.meta.status?t.data:[]}).catch(v.handleSystemError),h.value=!1}catch(t){console.log(t),h.value=!1}})(),(async()=>{try{h.value=!0,f.call(_e.getFristenEreignisseManuell()).then(t=>{p.value="success"==t.meta.status?t.data:[]}).catch(v.handleSystemError),h.value=!1}catch(t){console.log(t),h.value=!1}})()});const y=Vue.ref(),_=Vue.reactive({ereignisBlurred:!1,bezeichnungBlurred:!1,datumBlurred:!1,wasValidated:!1}),k=t=>!!t&&""!=t,A=t=>!!t&&""!=t.trim(),x=t=>!!t&&""!=t.trim();Vue.computed(()=>Object.keys(currentValue.value).some(t=>currentValue.value[t]!==preservedValue.value[t]));return{modalRef:g,fristDataFrm:y,frist:u,t:d,showModal:t=>(u.value=t,_.datumBlurred=!1,_.bezeichnungBlurred=!1,g.value.show(),new Promise((t,e)=>{m=t})),hideModal:b,fristStatus:c,fristEreignisse:p,validEreignis:k,validDatum:x,validBezeichnung:A,frmState:_,okHandler:async()=>{if(_.ereignisBlurred=!0,_.datumBlurred=!0,_.bezeichnungBlurred=!0,k(u.value?.ereignis_kurzbz)&&x(u.value?.datum)&&A(u.value?.bezeichnung))try{m({type:"OK",payload:u.value})}catch(t){console.log(t)}finally{h.value=!1,b()}else console.log("form invalid")}}},template:'\n    <Modal :title="t(\'fristenmanagement\',\'termin_frist\')" ref="modalRef">\n        <template #body>\n            <form class="row g-3" v-if="frist != null"  ref="fristDataFrm" >\n                         \n                <div class="col-md-6">\n                    <label for="ereignis_kurzbz" class="form-label required">Ereignis</label>\n                    <select  id="ereignis_kurzbz" class="form-select form-select-sm" aria-label=".form-select-sm " \n                        @blur="frmState.ereignisBlurred = true"   v-model="frist.ereignis_kurzbz" \n                        :class="{\'is-invalid\': !validEreignis(frist.ereignis_kurzbz) && frmState.ereignisBlurred}">\n                        <option v-for="(item, index) in fristEreignisse" :value="item.ereignis_kurzbz" >\n                            {{ item.bezeichnung }}\n                        </option>\n                    </select>\n\n                </div>    \n\n\n                <div class="col-md-6">\n                    <label for="bezeichnung" class="form-label required">{{ t(\'fristenmanagement\',\'todo\') }}</label>\n                    <input type="text" class="form-control form-control-sm" @blur="frmState.bezeichnungBlurred = true"  \n                        id="bezeichnung" \n                        v-model="frist.bezeichnung" \n                        maxlength="255"\n                        :class="{ \'is-invalid\': !validBezeichnung(frist.bezeichnung) && frmState.bezeichnungBlurred}"\n                        >\n                </div>\n\n                <div class="col-md-6">\n                    <label for="datum" class="required form-label">{{ t(\'fristenmanagement\',\'frist\') }}</label>\n                    <datepicker id="datum" \n                        :teleport="true" \n                        @blur="frmState.datumBlurred = true" \n                        :input-class-name="(!validDatum(frist.datum) && frmState.datumBlurred) ? \'dp-invalid-input\' : \'\'"  \n                        v-model="frist.datum"\n                        v-bind:enable-time-picker="false"\n                        text-input \n                        locale="de"\n                        format="dd.MM.yyyy"\n                        auto-apply \n                        model-type="yyyy-MM-dd"></datepicker>\n                </div>\n\n                <div class="col-md-6">\n                    <label for="status_kurzbz" class="form-label">Status</label>\n                    <select  id="status_kurzbz" class="form-select form-select-sm" aria-label=".form-select-sm "  v-model="frist.status_kurzbz" >\n                        <option v-for="(item, index) in fristStatus" :value="item.status_kurzbz" >\n                            {{ item.bezeichnung }}\n                        </option>\n                    </select>\n                    \n                </div>\n                                                \n                <div class="col-8" v-if="frist.frist_id != 0">\n                    <div class="modificationdate">{{ frist.insertamum }}/{{ frist.insertvon }}, {{ frist.updateamum }}/{{ frist.updatevon }}</div>\n                </div>\n            </form>        \n\n        </template>\n        <template #footer>\n            <button type="button" class="btn btn-primary" @click="okHandler()" >\n                {{ t(\'ui\',\'speichern\') }}\n            </button>\n        </template>\n    </Modal>\n    '},Ae={name:"DeadlineIssueTable",components:{ModalDialog:W,"p-skeleton":primevue.skeleton,DeadlineIssueDialog:ke,CoreFilterCmpt:b},props:{uid:String},setup(t,{emit:e}){const{watch:n,ref:a,toRefs:r,onMounted:s,inject:i}=Vue,{t:l}=J(),o=a(!1),d=a(!1),u=r(t).uid,c=a(null),p=a([]),h=a([]),f=a([]),v=a();a();const m=a(),g=i("$fhcAlert"),b=Vue.inject("$api"),y=async()=>{if(null!=u.value)try{null!==S.value?.tabulator&&S.value.tabulator.dataLoader.alertLoader(),d.value=!0,b.call(_e.allByPerson(u.value,F.value)).then(t=>{p.value="success"==t.meta.status?t.data:[]}).catch(g.handleSystemError)}catch(t){console.log(t)}finally{d.value=!1,null!==S.value?.tabulator&&S.value.tabulator.dataLoader.clearAlert()}},_=Vue.computed(()=>{let t=h.value.reduce((t,e)=>(t[e.status_kurzbz]=e.bezeichnung,t),{});return console.log(t),t}),k=t=>null==t?"":f.value.find(e=>e.ereignis_kurzbz==t).bezeichnung,A=async t=>{if(c.value=p.value.find(e=>e.frist_id==t),!1!==await g.confirm({message:l("fristenmanagement","frist")+" "+k(c?.ereignis_kurzbz)+" "+x(c?.datum)+" "+l("person","wirklichLoeschen"),acceptLabel:"Löschen",acceptClass:"p-button-danger"}))try{"success"==(await b.call(_e.deleteFrist(t))).meta.status&&(p.value=p.value.filter(e=>e.frist_id!=t),O())}catch(t){console.log(t)}finally{o.value=!1}};n(u,()=>{y()}),(async()=>{await(async()=>{try{o.value=!0,b.call(_e.getFristenStatus()).then(t=>{h.value="success"==t.meta.status?t.data:[]}).catch(g.handleSystemError)}catch(t){console.log(t)}finally{o.value=!1}})(),await(async()=>{try{o.value=!0;const t=await b.call(_e.getFristenEreignisse());f.value=t.data,o.value=!1}catch(t){console.log(t),o.value=!1}})()})();const x=t=>null!=t&&""!=t?t.substring(8,10)+"."+t.substring(5,7)+"."+t.substring(0,4):"",w=async()=>{const t=await v.value.showModal((e=u.value,{frist_id:0,ereignis_kurzbz:"manuell",bezeichnung:"",datum:null,status_kurzbz:"neu",mitarbeiter_uid:e}));var e;if("OK"==t.type){let e=t.payload;console.log("addDeadline",e);try{o.value=!0;await b.call(_e.upsertFrist(e));B(),y()}catch(t){console.log(t)}finally{o.value=!1}}},z=async t=>{let e={...t};const n=await v.value.showModal(e);if("OK"==n.type){let t=n.payload;delete t.status_bezeichnung,delete t.ma_name,delete t.ereignis_bezeichnung,delete t.person_id,delete t.manuell,console.log("editDeadline",t);try{o.value=!0;await b.call(_e.upsertFrist(t));B(),y()}catch(t){console.log(t)}finally{o.value=!1}}},S=a(null),C=a(""),D=a(""),F=a("false"),V=async t=>{console.log("onTableCellEdited",t.getValue(),t.getRow().getIndex());try{o.value=!0;await b.call(_e.updateFristStatus(t.getRow().getIndex(),t.getValue()));$()}catch(t){console.log(t)}finally{o.value=!1}},P=[{formatter:"rowSelection",titleFormatter:"rowSelection",titleFormatterParams:{rowRange:"active"},hozAlign:"center",headerHozAlign:"center",headerSort:!1,width:40,maxWidth:40,minWidth:40},{title:"Ereignis",field:"ereignis_bezeichnung",sorter:"string",width:140,headerFilter:"list",headerFilterParams:{valuesLookup:!0,autocomplete:!0,sort:"asc"}},{title:"Deadline",field:"datum",hozAlign:"center",width:140,headerFilter:!0,formatter:t=>t.getValue()?.replace(/(.*)-(.*)-(.*)/,"$3.$2.$1"),headerFilterFunc:(t,e,n,a)=>{const r=new Date(e);r.setHours(0,0,0,0);let[s,i,l]=t.split(".");if(l<1e3)return!0;const o=new Date(+l,+i-1,+s);return!(d=o,d instanceof Date&&isFinite(d)&&o-r!=0);var d}},{title:"To Do",field:"bezeichnung",hozAlign:"left",headerFilter:!0,headerFilterParams:{valuesLookup:!0,autocomplete:!0,sort:"asc"}},{title:"Status",field:"status_kurzbz",hozAlign:"center",width:140,sorter:"string",headerFilter:"list",headerFilterParams:{valuesLookup:()=>h.value.map(t=>({label:t.bezeichnung,value:t.status_kurzbz}))},editor:"list",editorParams:{values:_},formatter:t=>h.value.find(e=>e.status_kurzbz==t.getValue())?.bezeichnung},{title:"Aktionen",field:"actions",width:145,minWidth:105,maxWidth:145,formatter:(t,e,n)=>{let a=document.createElement("div");if(a.className="d-flex gap-2","t"===t.getRow().getData().manuell){let e=document.createElement("button");e.className="btn btn-sm btn-outline-secondary",e.innerHTML='<i class="fa fa-edit"></i>',e.addEventListener("click",e=>z(t.getRow().getData())),a.append(e),e=document.createElement("button"),e.className="btn btn-sm btn-outline-secondary",e.innerHTML='<i class="fa fa-xmark"></i>',e.addEventListener("click",()=>A(t.getRow().getIndex())),a.append(e)}return a},frozen:!0}],E=Vue.reactive({reactiveData:!0,data:p.value,index:"frist_id",layout:"fitColumns",columns:P,rowFormatter:t=>{let e=t.getData(),n=new Date((new Date).setHours(0,0,0,0));"erledigt"==e.status_kurzbz?t.getElement().childNodes[4].style.color="#198734":Date.parse(e.datum)<=n&&(t.getElement().childNodes[4].style.color="#871919",t.getElement().childNodes[4].style.fontWeight="bold")}}),T=Vue.computed(()=>[{event:"cellEdited",handler:V},{event:"tableBuilt",handler:()=>{y(),Vue.watch(p,(t,e)=>{null!==S.value?.tabulator&&S.value.tabulator.setData(p.value)},{deep:!0})}}]),$=()=>{g.alertSuccess(l("fristenmanagement","fristStatusGespeichert"))},B=()=>{g.alertSuccess(l("fristenmanagement","fristGespeichert"))},O=()=>{g.alertSuccess(l("fristenmanagement","fristGeloescht"))};return{t:l,currentFrist:c,getFristEreignisBezeichnung:k,showDeleteModal:A,onPersonSelect:(t,e)=>{let n=FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router;window.location.href=`${n}/extensions/FHC-Core-Personalverwaltung/Employees/${e}/${t}/summary`},onTableCellEdited:V,fristen:p,formatDate:x,updateDeadlines:async()=>{try{o.value=!0;await b.call(_e.updateFristenListe());o.value=!1,y()}catch(t){console.log(t),o.value=!1}},currentUID:u,fristStatus:h,fristEreignisse:f,statusChanged:async t=>{console.log(t);const e=p.value.filter(e=>e.frist_id==t)[0];try{o.value=!0;await b.call(_e.updateFristStatus(t,e.status_kurzbz));$()}catch(t){console.log(t)}finally{o.value=!1}},addDeadline:w,dialogRef:v,isFetching:o,isFristFetching:d,updateStatus:async()=>{let t=S.value.tabulator.getSelectedData().map(t=>parseInt(t.frist_id));console.log("fristen",t);try{o.value=!0;await b.call(_e.batchUpdateFristStatus(t,D.value));y(),$()}catch(t){g.handleSystemError(t)}finally{o.value=!1}},fristenTable:S,tabulatorOptions:E,tabulatorEvents:T,addData:()=>{w()},editDeadline:z,modalContainer:m,modalTitel:C,current_status_kurzbz:D,deadline_filter_all:F,handleDeadlineFilterAllChanged:()=>{y()}}},template:'\n    <div id="master" class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-5 pb-2 mb-3">\n                        \n      <div class="flex-fill align-self-center">\n        <h1 class="h2">Termine & Fristen</h1>       \n      </div>\n    </div>\n    \n\n    <DeadlineIssueDialog ref="dialogRef"></DeadlineIssueDialog>\n\n    <core-filter-cmpt \n\t\t\tref="fristenTable"\n\t\t\ttable-only\n\t\t\t:side-menu="false"\n\t\t\t:tabulator-options="tabulatorOptions"\n                        :tabulator-events="tabulatorEvents"\n\t\t\tnew-btn-label="Termin/Frist"\n\t\t\tnew-btn-show\n\t\t\tnew-btn-class="btn-primary"\n\t\t\t@click:new="addDeadline"\t\t\t\n\t\t\t>\n\t\t\t<template #actions>\t\t\t\t\n\t\t\t \t<div class="d-flex gap-2 align-items-baseline">\t\t\t\t\t\n          <select  id="status_kurzbz" class="form-select form-select-sm"  v-model="current_status_kurzbz" >\n              <option value="">- Status -</option>\n              <option v-for="(item, index) in fristStatus" :value="item.status_kurzbz" >\n                  {{ item.bezeichnung }}\n              </option>\n          </select>\n          <button type="button" class="btn  btn-primary btn-primary-sm me-2 text-nowrap" @click="updateStatus" :class="{\'disabled\':current_status_kurzbz==\'\'}">\n            <i class="fas fa-pencil"></i>\n            setzen\n          </button>\n\n          <label for="deadline_filter_all" class="ms-5">Filter: </label>\n          <select id="deadline_filter_all" class="form-select form-select-sm deadline_filter_all" \n                v-model="deadline_filter_all" @change="handleDeadlineFilterAllChanged">\n              <option value="false">vergangene erledigte ausblenden</option>\n              <option value="true">alle anzeigen</option>\n          </select>\n\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</core-filter-cmpt>\n\t\t\n  '},xe={name:"EmployeeSummary",components:{DvCard:ve,LehreCard:me,IssuesCard:ge,OffTimeCard:ye,DeadlineIssueTable:Ae},props:{date:Date},setup(){const t=VueRouter.useRoute(),{watch:e,ref:n,onMounted:a}=Vue,r=n(null),s=n(null),i=n(!1);return a(()=>{r.value=parseInt(t.params.id),s.value=t.params.uid}),e(()=>t.params.id,t=>{r.value=parseInt(t)}),e(()=>t.params.uid,t=>{s.value=t}),{currentPersonID:r,currentUID:s,isFetching:i}},template:'\n    <div class="d-flex justify-content-between align-items-center ms-sm-auto col-lg-12 p-md-2">\n      <div class="container-fluid px-1">\n\n            <div class="row">                \n\n                <div class="row pt-md-4">\n\n                    <div class="col">\n                        \n                        <dv-card :uid="currentUID" :date="date" ></dv-card>                        \n            \n                    </div>          \n\n                    <div class="col">\n                        \n                        \x3c!--covid-card :personID="currentPersonID" :date="date"></covid-card--\x3e\n\n                        <issues-card></issues-card>\n                       \n                    </div>\n\n                    <div class="col">\n                        \n                        <lehre-card :uid="currentUID" :date="date"></lehre-card>\n\n                        <br/>\n\n                        <off-time-card :uid="currentUID"></off-time-card> \n\n                    </div>\n\n                    <deadline-issue-table :uid="currentUID"></deadline-issue-table>\n\n                </div>            \n\n            </div>                      \n        </div>\n\n    </div>\n\n\n    '},we={name:"OffTime",components:{Modal:Q,ModalDialog:W,OrgChooser:ut,datepicker:VueDatePicker},props:{personID:{type:[Number,null],required:!0},personUID:{type:[String,null],required:!0}},emits:["updateHeader"],setup(t,{emit:e}){Vue.ref(!1);const{t:n}=J(),a=Vue.inject("$api"),{personID:r,personUID:s}=Vue.toRefs(t),i=Vue.ref(),l=Vue.ref(!1),o=Vue.ref(),d=Vue.ref([]),u=Vue.ref([]),c=Vue.ref([{value:"",label:"-"}]);let p=new Date;const h=Vue.ref(p.getFullYear()),f=Vue.ref(null),v=Vue.ref(null),m=VueRouter.useRoute(),g=Vue.ref();Vue.watch([r,s],([t,e])=>{k()}),Vue.watch(h,(t,e)=>{k()});const b=t=>t.getValue()?.replace(/(.*)-(.*)-(.*)/,"$3.$2.$1"),y=t=>b(t)+(null!=t.getRow().getData().vonstunde?" ("+t.getRow().getData().vonstunde+")":""),_=t=>b(t)+(null!=t.getRow().getData().bisstunde?" ("+t.getRow().getData().bisstunde+")":""),k=async()=>{if(null!=s.value)try{l.value=!0;const t=await a.call(be.personAbwesenheitenByYear(s.value,h.value));l.value=!1,console.log("abwesenheiten",t.data),d.value=t?.data?.length>0?t.data:[]}catch(t){console.log(t)}finally{l.value=!1}};Vue.onMounted(async()=>{console.log("Off time view mounted",t.personID),await k();let e={height:"100%",layout:"fitColumns",movableColumns:!0,reactiveData:!0,columns:[{title:n("ui","bezeichnung"),field:"bezeichnung",sorter:"string",headerFilter:"list",headerFilterParams:{valuesLookup:!0,autocomplete:!0,sort:"asc"}},{title:n("person","grund"),field:"zeitsperretyp",hozAlign:"left",headerFilter:"list",headerFilterParams:{valuesLookup:!0,autocomplete:!0,sort:"asc"}},{title:n("ui","from"),field:"vondatum",hozAlign:"center",formatter:y,width:140,sorter:"string",headerFilter:!0,headerFilterFunc:a},{title:n("global","bis"),field:"bisdatum",hozAlign:"center",formatter:_,width:140,sorter:"string",headerFilter:!0,headerFilterFunc:a},{title:n("person","vertretung"),field:"vertretung_uid",hozAlign:"left",headerFilter:"list",headerFilterParams:{valuesLookup:!0,autocomplete:!0,sort:"asc"}},{title:n("person","erreichbarkeit"),field:"erreichbarkeit",hozAlign:"left",headerFilter:"list",headerFilterParams:{valuesLookup:!0,autocomplete:!0,sort:"asc"}}],data:d.value};function a(t,e,n,a){const r=new Date(e);r.setHours(0,0,0,0);let[s,i,l]=t.split(".");if(l<1e3)return!0;const o=new Date(+l,+i-1,+s);return!(d=o,d instanceof Date&&isFinite(d)&&o-r!=0);var d}v.value=new Tabulator(f.value,e)}),Vue.watch(d,(t,e)=>{console.log("offTimeList changed"),v.value?.setData(d.value)},{deep:!0});return FHC_JS_DATA_STORAGE_OBJECT.app_root.replace(/(https:|)(^|\/\/)(.*?\/)/g,""),FHC_JS_DATA_STORAGE_OBJECT.ci_router,{offTimeList:d,orgUnitList:c,jobfunctionDefList:u,currentValue:g,currentYear:h,dialogRef:i,route:m,unternehmen:o,tabulator:v,offTimeTable:f,formatDate:t=>null!=t&&""!=t?t.substring(8,10)+"."+t.substring(5,7)+"."+t.substring(0,4):"",t:n}},template:'\n    <div class="row">\n       \n    </div>\n    <div class="row pt-md-4">      \n         <div class="col">\n             <div class="card">\n                <div class="card-header">\n                    <div class="h5"><h5>{{ t(\'person\',\'abwesenheiten\') }}</h5></div>        \n                </div>\n\n                <div class="card-body">\n                    <div class="d-grid d-md-flex justify-content-between pt-2 pb-3">\n                        \n                        <div class="mb-3 row">\n                            <div class="col-auto">\n                                <label for="yearFilter" class="col-form-label">Jahr</label>\n                            </div>\n                            <div class="col-auto w-50">\n                                <input type="number" class="form-control" id="yearFilter" placeholder="Jahr" v-model="currentYear">\n                            </div>\n                        </div>\n                    </div>\n\n                    \x3c!-- TABULATOR --\x3e\n                    <div ref="offTimeTable" class="fhc-tabulator"></div>\n                \n                </div>\n             </div>\n         </div>\n    </div>\n            \n\n    \n    '},ze={name:"TimeRecording",components:{Modal:Q,ModalDialog:W,OrgChooser:ut,datepicker:VueDatePicker},props:{personID:{type:[Number,null],required:!0},personUID:{type:[String,null],required:!0}},emits:["updateHeader"],setup(t,{emit:e}){const n=Vue.inject("$api");Vue.ref(!1);const{t:a}=J(),{personID:r,personUID:s}=Vue.toRefs(t),i=Vue.ref(),l=Vue.ref(!1),o=Vue.ref();Vue.ref([]);const d=Vue.ref([{value:"",label:"-"}]);let u=new Date;const c=Vue.ref(u.getFullYear()),p=Vue.ref((t=>{let e=new Date(t.getFullYear(),0,1),n=Math.floor((t-e)/864e5);return Math.ceil(n/7)})(u)),h=Vue.ref([]);FHC_JS_DATA_STORAGE_OBJECT.app_root,FHC_JS_DATA_STORAGE_OBJECT.ci_router;const f=VueRouter.useRoute(),v=Vue.ref();Vue.watch([r,s],([t,e])=>{m()}),Vue.watch([c,p],([t,e])=>{m()});const m=async()=>{if(null!=s.value)try{l.value=!0;const t=await n.call(be.personZeiterfassungByWeek(s.value,c.value,p.value));l.value=!1,t.data.length>0?h.value=t.data:h.value=[]}catch(t){console.log(t)}finally{l.value=!1}};Vue.onMounted(async()=>{console.log("Time Recording view mounted",t.personID),await m()});const g=FHC_JS_DATA_STORAGE_OBJECT.app_root.replace(/(https:|)(^|\/\/)(.*?\/)/g,"")+FHC_JS_DATA_STORAGE_OBJECT.ci_router;return{orgUnitList:d,currentValue:v,currentYear:c,currentWeek:p,timeRecordList:h,dialogRef:i,fullPath:`/${g}/extensions/FHC-Core-Personalverwaltung/Employees/`,route:f,unternehmen:o,formatDate:t=>null!=t&&""!=t?t.substring(8,10)+"."+t.substring(5,7)+"."+t.substring(0,4):"",t:a,extractTime:t=>{if(null!=t){const e=new Date(t);return(e.getHours()<9?"0":"")+e.getHours()+":"+(e.getMinutes()<9?"0":"")+e.getMinutes()}return""},getWeekday:t=>{if(null!=t){return new Date(t).toLocaleDateString("de-AT",{weekday:"long"})}return""}}},template:'\n    <div class="row">\n       \n    </div>\n    <div class="row pt-md-4">      \n         <div class="col">\n             <div class="card">\n                <div class="card-header">\n                    <div class="h5"><h5>{{ t(\'person\',\'zeiterfassung\') }}</h5></div>        \n                </div>\n\n                <div class="card-body">\n                    <div class="d-grid d-md-flex justify-content-between pt-2 pb-3">\n                        \n                        <div class="mb-3 row">\n                            <div class="col-auto">\n                                <label for="yearFilter" class="col-form-label">Jahr</label>\n                                <input type="number" class="form-control form-control-sm" id="yearFilter" style="max-width: 5rem" placeholder="Jahr" v-model="currentYear">\n                            </div>\n                            <div class="col-auto">\n                                <label for="weekFilter" class="col-form-label">Woche</label>   \n                                <input type="number" class="form-control form-control-sm" id="weekFilter" style="max-width: 5rem" min="1" max="53" placeholder="Woche" v-model="currentWeek">\n                            </div>\n                        </div>\n                    </div>\n\n                    \x3c!-- TODO --\x3e\n                    <table class="table">\n                        <thead>\n                        <tr>\n                            <th scope="col">Tag</th>\n                            <th scope="col">Datum</th>\n                            <th scope="col">Projekt</th>\n                            <th scope="col">AP</th>\n                            <th scope="col">OE</th>\n                            <th scope="col">Aktivität</th>\n                            <th scope="col">Start</th>\n                            <th scope="col">Ende</th>\n                            <th scope="col">Dauer</th>\n                            <th scope="col">Beschreibung</th>\n                        </tr>\n                        </thead>\n                        <tbody>\n                        <tr v-for="record in timeRecordList"  :key="record.dates + record.zeitaufzeichnung_id">\n                            <td>{{ getWeekday(record.dates) }}</td>\n                            <td>{{ formatDate(record.dates) }}</td>\n                            <td>{{ record.projekt_kurzbz }}</td>\n                            <td></td>\n                            <td>{{ record.oe_kurzbz }} </td>\n                            <td>{{ record.aktivitaet_kurzbz }} </td>\n                            <td>{{ extractTime(record.start) }} </td>\n                            <td>{{ extractTime(record.ende) }} </td>\n                            <td>{{ record.diff ? record.diff : \'00:00\' }} </td>\n                            <td>{{ record.beschreibung }}</td>\n                        </tr>\n                        </tbody>\n\n\n\n\n                    </table>\n                \n                </div>\n             </div>\n         </div>\n    </div>\n            \n\n    \n    '},Se={name:"EmployeeTime",components:{OffTime:we,TimeRecording:ze},props:{},setup(){const t=VueRouter.useRoute(),{watch:e,ref:n,onMounted:a}=Vue,r=n(null),s=n(null),i=n(!1),l=Vue.ref("offtime"),{t:o}=J();a(()=>{r.value=parseInt(t.params.id),s.value=t.params.uid}),e(()=>t.params.id,t=>{r.value=parseInt(t)}),e(()=>t.params.uid,t=>{s.value=t});return{currentPersonID:r,currentUID:s,isFetching:i,items:["offtime","timerecording"],isActive:t=>l.value===t,setActive:t=>{l.value=t,console.log("activeItem: ",t)},t:o}},template:'\n    <div class="d-flex justify-content-between align-items-center ms-sm-auto col-lg-12 p-md-2">\n        <div class="container-fluid px-1">\n\n            <div class="row pt-md-2">\n            \n                <nav class="nav flex-column col-md-2 subsubnav">\n                    <a\n                        class="nav-link"\n                        :class="{ active: isActive(items[0]) }"\n                        @click.prevent="setActive(items[0])"\n                        href="#base"\n                    >{{ t(\'person\', \'abwesenheiten\') }}</a\n                    >\n                    <a\n                        class="nav-link"\n                        :class="{ active: isActive(items[1]) }"\n                        @click.prevent="setActive(items[1])"\n                        href="#employee"\n                        >{{ t(\'person\', \'zeiterfassung\') }}</a\n                    >                   \n                </nav>\n                <div class="tab-content col-md-10" id="nav-tabContent">\n\n\n                    <div\n                    class="tab-pane"\n                    :class="{ active: isActive(items[0]) }"\n                    role="tabpanel"\n                    >\n                        <off-time :personID="currentPersonID" :personUID="currentUID" ></off-time>\n                    </div>\n                    <div\n                        class="tab-pane"\n                        :class="{ active: isActive(items[1]) }"\n                        role="tabpanel"\n                    >\n                        <time-recording :personID="currentPersonID" :personUID="currentUID" ></time-recording>\n                    </div>\n\n                </div>\n\n            </div>\n                               \n        </div>\n\n    </div>\n\n    '},Ce={name:"EmployeeLifeCycle",components:{},props:{},setup(){const t=VueRouter.useRoute(),{watch:e,ref:n,onMounted:a}=Vue,r=n(null),s=n(null),i=n(!1);return a(()=>{r.value=parseInt(t.params.id),s.value=t.params.uid}),e(()=>t.params.id,t=>{r.value=parseInt(t)}),e(()=>t.params.uid,t=>{s.value=t}),{currentPersonID:r,currentUID:s,isFetching:i}},template:'\n    <div class="d-flex justify-content-between align-items-center ms-sm-auto col-lg-12 p-md-2">\n      <div class="container-fluid px-1">\n\n            <div class="row">                \n\n                <div class="row pt-md-4">\n\n                    work in progress...\n                    \n                </div>            \n\n            </div>                      \n        </div>\n\n    </div>\n\n    '},De={name:"EmployeeDocument",components:{},props:{},setup(){const t=VueRouter.useRoute(),{watch:e,ref:n,onMounted:a}=Vue,r=n(null),s=n(null),i=n(!1);return a(()=>{r.value=parseInt(t.params.id),s.value=t.params.uid}),e(()=>t.params.id,t=>{r.value=parseInt(t)}),e(()=>t.params.uid,t=>{s.value=t}),{currentPersonID:r,currentUID:s,isFetching:i}},template:'\n    <div class="d-flex justify-content-between align-items-center ms-sm-auto col-lg-12 p-md-2">\n      <div class="container-fluid px-1">\n\n            <div class="row">                \n\n                <div class="row pt-md-4">\n\n                    work in progress...\n\n                    \n                </div>            \n\n            </div>                      \n        </div>\n\n    </div>\n\n    '};var Fe={search(t,e){return this.$fhcApi.post("/api/frontend/v1/searchbar/search",t,e)},searchAdvanced(t,e){return this.$fhcApi.post("/api/frontend/v1/searchbar/searchAdvanced",t,e)},searchdummy(t){return this.$fhcApi.post("public/js/apps/api/dummyapi.php/Search",t)}},Ve={loadCategory(t){return this.$fhcApi.get("/api/frontend/v1/phrasen/loadModule/"+t)},setLanguage(t,e){const n={categories:t,language:e};return this.$fhcApi.post("/api/frontend/v1/phrasen/setLanguage",n)},getLanguage(){return this.$fhcApi.get("/api/frontend/v1/phrasen/getLanguage",{})},getActiveDbLanguages(){return this.$fhcApi.get("/api/frontend/v1/phrasen/getAllLanguages",{})}},Pe={getHeader(t){return this.$fhcApi.get("/api/frontend/v1/navigation/header",{navigation_page:t})},getMenu:function(t){return this.$fhcApi.get("/api/frontend/v1/navigation/menu",{navigation_page:t})}},Ee={saveCustomFilter(t){return this.$fhcApi.post("/api/frontend/v1/filter/saveCustomFilter",{filterUniqueId:t.filterUniqueId,filterType:t.filterType,customFilterName:t.customFilterName})},removeCustomFilter(t){return this.$fhcApi.post("/api/frontend/v1/filter/removeCustomFilter",{filterUniqueId:t.filterUniqueId,filterType:t.filterType,filterId:t.filterId})},applyFilterFields(t){return this.$fhcApi.post("/api/frontend/v1/filter/applyFilterFields",{filterUniqueId:t.filterUniqueId,filterType:t.filterType,filterFields:t.filterFields})},addFilterField(t){return this.$fhcApi.post("/api/frontend/v1/filter/addFilterField",{filterUniqueId:t.filterUniqueId,filterType:t.filterType,filterField:t.filterField})},removeFilterField(t){return this.$fhcApi.post("/api/frontend/v1/filter/removeFilterField",{filterUniqueId:t.filterUniqueId,filterType:t.filterType,filterField:t.filterField})},getFilterById(t){return this.$fhcApi.get("/api/frontend/v1/filter/getFilter",{filterUniqueId:t.filterUniqueId,filterType:t.filterType,filterId:t.filterId})},getFilter(t){return this.$fhcApi.get("/api/frontend/v1/filter/getFilter",{filterUniqueId:t.filterUniqueId,filterType:t.filterType})}},Te={abmeldung:{getDetails(t,e){const n="/api/frontend/v1/studstatus/abmeldung/"+(void 0!==t?"getDetailsForAntrag/"+t:"getDetailsForNewAntrag/"+e);return this.$fhcApi.get(n)},create(t,e,n){return this.$fhcApi.post("/api/frontend/v1/studstatus/abmeldung/createAntrag",{studiensemester:t,prestudent_id:e,grund:n},{errorHandling:"strict"})},cancel(t){return Array.isArray(t)?Promise.allSettled(t.map(t=>this.$fhcApi.post("/api/frontend/v1/studstatus/abmeldung/cancelAntrag",{antrag_id:t.studierendenantrag_id},{errorHeader:"#"+t.studierendenantrag_id}))):this.$fhcApi.post("/api/frontend/v1/studstatus/abmeldung/cancelAntrag",{antrag_id:t})}},unterbrechung:{getDetails(t,e){const n="/api/frontend/v1/studstatus/unterbrechung/"+(void 0!==t?"getDetailsForAntrag/"+t:"getDetailsForNewAntrag/"+e);return this.$fhcApi.get(n)},create(t,e,n,a,r){return this.$fhcApi.post("/api/frontend/v1/studstatus/unterbrechung/createAntrag",{studiensemester:t,prestudent_id:e,grund:n,datum_wiedereinstieg:a,attachment:r},{errorHandling:"strict"})},cancel(t){return this.$fhcApi.post("/api/frontend/v1/studstatus/unterbrechung/cancelAntrag",{antrag_id:t},{errorHandling:"strict"})}},wiederholung:{getDetails(t){const e="/api/frontend/v1/studstatus/wiederholung/getDetailsForNewAntrag/"+t;return this.$fhcApi.get(e)},getLvs(t){const e="/api/frontend/v1/studstatus/wiederholung/getLvs/"+t;return this.$fhcApi.get(e)},create(t,e){return this.$fhcApi.post("/api/frontend/v1/studstatus/wiederholung/createAntrag",{prestudent_id:t,studiensemester:e},{errorHandling:"strict"})},cancel(t,e){return this.$fhcApi.post("/api/frontend/v1/studstatus/wiederholung/cancelAntrag",{prestudent_id:t,studiensemester:e},{errorHandling:"strict"})},saveLvs(t,e){return this.$fhcApi.post("/api/frontend/v1/studstatus/wiederholung/saveLvs",{forbiddenLvs:t,mandatoryLvs:e})}},leitung:{getStgs(){return this.$fhcApi.get("/api/frontend/v1/studstatus/leitung/getActiveStgs")},getAntraege(t,e,n){return this.$fhcApi.get("/api/frontend/v1/studstatus/leitung/getAntraege/"+t).then(t=>t.data)},getHistory(t){return this.$fhcApi.get("/api/frontend/v1/studstatus/leitung/getHistory/"+t)},getPrestudents(t,e){return this.$fhcApi.post("/api/frontend/v1/studstatus/leitung/getPrestudents",{query:t},{signal:e,timeout:3e4})},approve(t){return Array.isArray(t)?Promise.allSettled(t.map(t=>this.$fhcApi.post("/api/frontend/v1/studstatus/leitung/approveAntrag",t,{errorHeader:"#"+t.studierendenantrag_id}))):this.$fhcApi.post("/api/frontend/v1/studstatus/leitung/approveAntrag",t)},reject(t){return Array.isArray(t)?Promise.allSettled(t.map(t=>this.$fhcApi.post("/api/frontend/v1/studstatus/leitung/rejectAntrag",t,{errorHeader:"#"+t.studierendenantrag_id}))):this.$fhcApi.post("/api/frontend/v1/studstatus/leitung/rejectAntrag",t)},reopen(t){return Array.isArray(t)?Promise.allSettled(t.map(t=>this.$fhcApi.post("/api/frontend/v1/studstatus/leitung/reopenAntrag",t,{errorHeader:"#"+t.studierendenantrag_id}))):this.$fhcApi.post("/api/frontend/v1/studstatus/leitung/reopenAntrag",t)},pause(t){return Array.isArray(t)?Promise.allSettled(t.map(t=>this.$fhcApi.post("/api/frontend/v1/studstatus/leitung/pauseAntrag",t,{errorHeader:"#"+t.studierendenantrag_id}))):this.$fhcApi.post("/api/frontend/v1/studstatus/leitung/pauseAntrag",t)},unpause(t){return Array.isArray(t)?Promise.allSettled(t.map(t=>this.$fhcApi.post("/api/frontend/v1/studstatus/leitung/unpauseAntrag",t,{errorHeader:"#"+t.studierendenantrag_id}))):this.$fhcApi.post("/api/frontend/v1/studstatus/leitung/unpauseAntrag",t)},object(t){return Array.isArray(t)?Promise.allSettled(t.map(t=>this.$fhcApi.post("/api/frontend/v1/studstatus/leitung/objectAntrag",t,{errorHeader:"#"+t.studierendenantrag_id}))):this.$fhcApi.post("/api/frontend/v1/studstatus/leitung/objectAntrag",t)},approveObjection(t){return Array.isArray(t)?Promise.allSettled(t.map(t=>this.$fhcApi.post("/api/frontend/v1/studstatus/leitung/approveObjection",t,{errorHeader:"#"+t.studierendenantrag_id}))):this.$fhcApi.post("/api/frontend/v1/studstatus/leitung/approveObjection",t)},denyObjection(t){return Array.isArray(t)?Promise.allSettled(t.map(t=>this.$fhcApi.post("/api/frontend/v1/studstatus/leitung/denyObjection",t,{errorHeader:"#"+t.studierendenantrag_id}))):this.$fhcApi.post("/api/frontend/v1/studstatus/leitung/denyObjection",t)}}},$e={getView:function(t){return this.$fhcApi.get(FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+`/api/frontend/v1/Profil/getView/${t}`,{})},fotoSperre:function(t){return this.$fhcApi.get(FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+`/api/frontend/v1/Profil/fotoSperre/${t}`,{})},isStudent:function(t){return this.$fhcApi.get(FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+"/api/frontend/v1/Profil/isStudent",{uid:t})},isMitarbeiter:function(t){return this.$fhcApi.get(FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+`/api/frontend/v1/Profil/isMitarbeiter/${t}`,{})},getZustellAdresse:function(){return this.$fhcApi.get(FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+"/api/frontend/v1/Profil/getZustellAdresse",{})},getZustellKontakt:function(){return this.$fhcApi.get(FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+"/api/frontend/v1/Profil/getZustellKontakt",{})},getGemeinden:function(t,e){return this.$fhcApi.get(FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+`/api/frontend/v1/Profil/getGemeinden/${t}/${e}`,{})},getAllNationen:function(){return this.$fhcApi.get(FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+"/api/frontend/v1/Profil/getAllNationen",{})}},Be={
//! API calls for profil update requests
getStatus:function(){return this.$fhcApi.get(FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+"/api/frontend/v1/ProfilUpdate/getStatus",{})},getTopic:function(){return this.$fhcApi.get(FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+"/api/frontend/v1/ProfilUpdate/getTopic",{})},acceptProfilRequest:function({profil_update_id:t,uid:e,status_message:n,topic:a,requested_change:r}){return this.$fhcApi.post(FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+"/api/frontend/v1/ProfilUpdate/acceptProfilRequest",{profil_update_id:t,uid:e,status_message:n,topic:a,requested_change:r})},denyProfilRequest:function({profil_update_id:t,uid:e,topic:n,status_message:a}){return this.$fhcApi.post(FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+"/api/frontend/v1/ProfilUpdate/denyProfilRequest",{profil_update_id:t,uid:e,topic:n,status_message:a})},insertFile:function(t,e=null){return this.$fhcApi.post(FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+`/api/frontend/v1/ProfilUpdate/insertFile/${e}`,t)},getProfilRequestFiles:function(t){return this.$fhcApi.get(FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+`/api/frontend/v1/ProfilUpdate/getProfilRequestFiles/${t}`,{})},selectProfilRequest:function(t=null,e=null){return this.$fhcApi.get(FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+"/api/frontend/v1/ProfilUpdate/selectProfilRequest",{...t?{uid:t}:{},...e?{id:e}:{}})},insertProfilRequest:function(t,e,n=null){return this.$fhcApi.post(FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+"/api/frontend/v1/ProfilUpdate/insertProfilRequest",{topic:t,payload:e,...n?{fileID:n}:{}})},updateProfilRequest:function(t,e,n,a=null){return this.$fhcApi.post(FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+"/api/frontend/v1/ProfilUpdate/updateProfilRequest",{topic:t,payload:e,ID:n,...a?{fileID:a}:{}})},deleteProfilRequest:function(t){return this.$fhcApi.post(FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+"/api/frontend/v1/ProfilUpdate/deleteProfilRequest",{requestID:t})}},Oe={getRoomInfo(t,e,n){return this.$fhcApi.post("/api/frontend/v1/LvPlan/getRoomplan",{ort_kurzbz:t,start_date:e,end_date:n})},getStunden(){return this.$fhcApi.get("/api/frontend/v1/LvPlan/Stunden",{})},getOrtReservierungen(t,e,n){return this.$fhcApi.post(`/api/frontend/v1/LvPlan/getReservierungen/${t}`,{start_date:e,end_date:n})},getLvPlanReservierungen(t,e){return this.$fhcApi.post("/api/frontend/v1/LvPlan/getReservierungen",{start_date:t,end_date:e})},getLehreinheitStudiensemester(t){return this.$fhcApi.get(`/api/frontend/v1/LvPlan/getLehreinheitStudiensemester/${t}`,{})},studiensemesterDateInterval(t){return this.$fhcApi.get(`/api/frontend/v1/LvPlan/studiensemesterDateInterval/${t}`,{})},LvPlanEvents(t,e,n){return this.$fhcApi.get("/api/frontend/v1/LvPlan/LvPlanEvents",{start_date:t,end_date:e,lv_id:n})}},Me={verband:{get(){return this.$fhcApi.get("api/frontend/v1/stv/verband")},favorites:{get(){return this.$fhcApi.get("api/frontend/v1/stv/favorites")},set(t){return this.$fhcApi.post("api/frontend/v1/stv/favorites/set",{favorites:t})}}},students:{uid(t,e){let n="api/frontend/v1/stv/students/"+encodeURIComponent(e)+"/uid/"+encodeURIComponent(t);return this.$fhcApi.getUri(n)},prestudent(t,e){let n="api/frontend/v1/stv/students/"+encodeURIComponent(e)+"/prestudent/"+encodeURIComponent(t);return this.$fhcApi.getUri(n)},person(t,e){let n="api/frontend/v1/stv/students/"+encodeURIComponent(e)+"/person/"+encodeURIComponent(t);return this.$fhcApi.getUri(n)},verband(t){return this.$fhcApi.getUri("api/frontend/v1/stv/students/"+t)}},filter:{getStg(){return this.$fhcApi.get("api/frontend/v1/stv/filter/getStg")},setStg(t){return this.$fhcApi.post("api/frontend/v1/stv/filter/setStg",{studiengang_kz:t})}},konto:{tabulatorConfig(t,e){return t.ajaxURL="api/frontend/v1/stv/konto/get",t.ajaxParams=()=>({person_id:e.modelValue.person_id||e.modelValue.map(t=>t.person_id),only_open:e.filter,studiengang_kz:e.studiengang_kz_intern?e.stg_kz:""}),t.ajaxRequestFunc=(t,e,n)=>this.$fhcApi.post(t,n,e),t.ajaxResponse=(t,e,n)=>n.data,t},checkDoubles(t,e){return this.$fhcApi.post(t,"api/frontend/v1/stv/konto/checkDoubles",e,{confirmErrorHandler:t=>!0})},insert(t,e){return this.$fhcApi.post(t,"api/frontend/v1/stv/konto/insert",e)},counter(t){return this.$fhcApi.post("api/frontend/v1/stv/konto/counter",t)},edit(t,e){return this.$fhcApi.post(t,"api/frontend/v1/stv/konto/update",e)},delete(t){return this.$fhcApi.post("api/frontend/v1/stv/konto/delete",{buchungsnr:t})},getBuchungstypen(){return this.$fhcApi.get("api/frontend/v1/stv/konto/getBuchungstypen")}},group:{getGruppen(t,e,n){return this.$fhcApi.get("api/frontend/v1/stv/Gruppen/getGruppen/"+n.id)},deleteGroup(t){return this.$fhcApi.post("api/frontend/v1/stv/Gruppen/deleteGruppe/",t)}},kontakt:{getAdressen(t,e,n){return this.$fhcApi.get("api/frontend/v1/stv/kontakt/getAdressen/"+n.id)},addNewAddress(t,e,n){return this.$fhcApi.post(t,"api/frontend/v1/stv/kontakt/addNewAddress/"+e,n)},loadAddress(t){return this.$fhcApi.post("api/frontend/v1/stv/kontakt/loadAddress/",{address_id:t})},updateAddress(t,e,n){return this.$fhcApi.post(t,"api/frontend/v1/stv/kontakt/updateAddress/"+e,n)},deleteAddress(t){return this.$fhcApi.post("api/frontend/v1/stv/kontakt/deleteAddress/",{address_id:t})},getPlaces(t){return this.$fhcApi.get("api/frontend/v1/stv/address/getPlaces/"+t)},getFirmen(t){return this.$fhcApi.get("api/frontend/v1/stv/kontakt/getFirmen/"+t)},getNations(){return this.$fhcApi.get("api/frontend/v1/stv/address/getNations/")},getAdressentypen(){return this.$fhcApi.get("api/frontend/v1/stv/kontakt/getAdressentypen/")},getBankverbindung(t,e,n){return this.$fhcApi.get("api/frontend/v1/stv/kontakt/getBankverbindung/"+n.id)},addNewBankverbindung(t,e,n){return this.$fhcApi.post(t,"api/frontend/v1/stv/kontakt/addNewBankverbindung/"+e,n)},loadBankverbindung(t){return this.$fhcApi.post("api/frontend/v1/stv/kontakt/loadBankverbindung/",{bankverbindung_id:t})},updateBankverbindung(t,e,n){return this.$fhcApi.post(t,"api/frontend/v1/stv/kontakt/updateBankverbindung/"+e,n)},deleteBankverbindung(t){return this.$fhcApi.post("api/frontend/v1/stv/kontakt/deleteBankverbindung/",{bankverbindung_id:t})},getKontakte(t,e,n){return this.$fhcApi.get("api/frontend/v1/stv/kontakt/getKontakte/"+n.id)},addNewContact(t,e,n){return this.$fhcApi.post(t,"api/frontend/v1/stv/kontakt/addNewContact/"+e,n)},loadContact(t){return this.$fhcApi.post("api/frontend/v1/stv/kontakt/loadContact/",{kontakt_id:t})},updateContact(t,e,n){return this.$fhcApi.post(t,"api/frontend/v1/stv/kontakt/updateContact/"+e,n)},deleteContact(t){return this.$fhcApi.post("api/frontend/v1/stv/kontakt/deleteContact/",{kontakt_id:t})},getStandorteByFirma(t){return this.$fhcApi.get("api/frontend/v1/stv/kontakt/getStandorteByFirma/"+t)},getKontakttypen(){return this.$fhcApi.get("api/frontend/v1/stv/kontakt/getKontakttypen/")}},prestudent:{get(t,e){return this.$fhcApi.post("api/frontend/v1/stv/prestudent/get/"+encodeURIComponent(t)+"/"+encodeURIComponent(e))},updatePrestudent(t,e,n){return this.$fhcApi.post(t,"api/frontend/v1/stv/prestudent/updatePrestudent/"+e,n)},getBezeichnungZGV(){return this.$fhcApi.get("api/frontend/v1/stv/prestudent/getBezeichnungZGV/")},getBezeichnungMZgv(){return this.$fhcApi.get("api/frontend/v1/stv/prestudent/getBezeichnungMZgv/")},getBezeichnungDZgv(){return this.$fhcApi.get("api/frontend/v1/stv/prestudent/getBezeichnungDZgv/")},getStgs(){return this.$fhcApi.get("api/frontend/v1/stv/lists/getStgs/")},getAusbildung(){return this.$fhcApi.get("api/frontend/v1/stv/prestudent/getAusbildung/")},getAufmerksamdurch(){return this.$fhcApi.get("api/frontend/v1/stv/prestudent/getAufmerksamdurch/")},getBerufstaetigkeit(){return this.$fhcApi.get("api/frontend/v1/stv/prestudent/getBerufstaetigkeit/")},getTypenStg(){return this.$fhcApi.get("api/frontend/v1/stv/prestudent/getTypenStg/")},getBisstandort(){return this.$fhcApi.get("api/frontend/v1/stv/prestudent/getBisstandort/")},getHistoryPrestudent(t,e,n){return this.$fhcApi.get("api/frontend/v1/stv/status/getHistoryPrestudent/"+n.id)},getMaxSem(t){return this.$fhcApi.post("api/frontend/v1/stv/status/getMaxSemester/",{studiengang_kzs:t})},advanceStatus({prestudent_id:t,status_kurzbz:e,studiensemester_kurzbz:n,ausbildungssemester:a}){return this.$fhcApi.post("api/frontend/v1/stv/status/advanceStatus/"+t+"/"+e+"/"+n+"/"+a)},confirmStatus({prestudent_id:t,status_kurzbz:e,studiensemester_kurzbz:n,ausbildungssemester:a}){return this.$fhcApi.post("api/frontend/v1/stv/status/confirmStatus/"+t+"/"+e+"/"+n+"/"+a)},isLastStatus(t){return this.$fhcApi.get("api/frontend/v1/stv/status/isLastStatus/"+t)},deleteStatus({prestudent_id:t,status_kurzbz:e,studiensemester_kurzbz:n,ausbildungssemester:a}){return this.$fhcApi.post("api/frontend/v1/stv/status/deleteStatus/"+t+"/"+e+"/"+n+"/"+a)},getLastBismeldestichtag(){return this.$fhcApi.get("api/frontend/v1/stv/status/getLastBismeldestichtag/")},getHistoryPrestudents(t,e,n){return this.$fhcApi.get("api/frontend/v1/stv/prestudent/getHistoryPrestudents/"+n.id)}},status:{insertStatus(t,e,n){return this.$fhcApi.post(t,"api/frontend/v1/stv/status/insertStatus/"+e,n)},loadStatus({prestudent_id:t,status_kurzbz:e,studiensemester_kurzbz:n,ausbildungssemester:a}){return this.$fhcApi.post("api/frontend/v1/stv/status/loadStatus/"+t+"/"+e+"/"+n+"/"+a)},updateStatus(t,{prestudent_id:e,status_kurzbz:n,studiensemester_kurzbz:a,ausbildungssemester:r},s){return this.$fhcApi.post(t,"api/frontend/v1/stv/status/updateStatus/"+e+"/"+n+"/"+a+"/"+r,s)},getStudienplaene(t){return this.$fhcApi.get("api/frontend/v1/stv/prestudent/getStudienplaene/"+t)},getStudiengang(t){return this.$fhcApi.get("api/frontend/v1/stv/prestudent/getStudiengang/"+t)},getStatusgruende(){return this.$fhcApi.get("api/frontend/v1/stv/status/getStatusgruende/")},getStati(){return this.$fhcApi.get("api/frontend/v1/stv/lists/getStati/")},addStudent(t,e){return this.$fhcApi.post("api/frontend/v1/stv/status/addStudent/"+t,e,{errorHeader:t})},changeStatus(t,e){return this.$fhcApi.post("api/frontend/v1/stv/status/changeStatus/"+t,e,{errorHeader:t})},getStatusarray(){return this.$fhcApi.get("api/frontend/v1/stv/status/getStatusarray/")}},details:{get(t,e){let n="api/frontend/v1/stv/student/get/"+encodeURIComponent(t)+"/"+encodeURIComponent(e);return this.$fhcApi.post(n)},save(t,e,n,a){let r="api/frontend/v1/stv/student/save/"+encodeURIComponent(e)+"/"+encodeURIComponent(n);return this.$fhcApi.post(t,r,a)}},exam:{getPruefungen(t,e,n){return this.$fhcApi.get("api/frontend/v1/stv/pruefung/getPruefungen/"+n.id)},loadPruefung(t){return this.$fhcApi.get("api/frontend/v1/stv/pruefung/loadPruefung/"+t)},getTypenPruefungen(){return this.$fhcApi.get("api/frontend/v1/stv/pruefung/getTypenPruefungen")},getAllLehreinheiten(t){return this.$fhcApi.post("api/frontend/v1/stv/pruefung/getAllLehreinheiten/",t)},getLvsByStudent(t){return this.$fhcApi.get("api/frontend/v1/stv/pruefung/getLvsByStudent/"+t)},getLvsandLesByStudent(t,e){return this.$fhcApi.get("api/frontend/v1/stv/pruefung/getLvsandLesByStudent/"+t+"/"+e)},getLvsAndMas(t){return this.$fhcApi.get("api/frontend/v1/stv/pruefung/getLvsAndMas/"+t)},getMitarbeiterLv(t){return this.$fhcApi.get("api/frontend/v1/stv/pruefung/getMitarbeiterLv/"+t)},getNoten(){return this.$fhcApi.get("api/frontend/v1/stv/pruefung/getNoten")},checkZeugnisnoteLv(t){return this.$fhcApi.post("api/frontend/v1/stv/pruefung/checkZeugnisnoteLv/",t)},addPruefung(t,e){return this.$fhcApi.post(t,"api/frontend/v1/stv/pruefung/insertPruefung/",e)},updatePruefung(t,e,n){return this.$fhcApi.post(t,"api/frontend/v1/stv/pruefung/updatePruefung/"+e,n)},deletePruefung(t){return this.$fhcApi.post("api/frontend/v1/stv/pruefung/deletePruefung/"+t)}},abschlusspruefung:{getAbschlusspruefung(t,e,n){return this.$fhcApi.get("api/frontend/v1/stv/abschlusspruefung/getAbschlusspruefung/"+n.id)},addNewAbschlusspruefung(t,e){return this.$fhcApi.post(t,"api/frontend/v1/stv/abschlusspruefung/insertAbschlusspruefung/",e)},loadAbschlusspruefung(t){return this.$fhcApi.post("api/frontend/v1/stv/abschlusspruefung/loadAbschlusspruefung/",{id:t})},updateAbschlusspruefung(t,e){return this.$fhcApi.post(t,"api/frontend/v1/stv/abschlusspruefung/updateAbschlusspruefung/",e)},deleteAbschlusspruefung(t){return this.$fhcApi.post("api/frontend/v1/stv/abschlusspruefung/deleteAbschlusspruefung/",{id:t})},getTypenAbschlusspruefung(){return this.$fhcApi.get("api/frontend/v1/stv/abschlusspruefung/getTypenAbschlusspruefung/")},getTypenAntritte(){return this.$fhcApi.get("api/frontend/v1/stv/abschlusspruefung/getTypenAntritte/")},getBeurteilungen(){return this.$fhcApi.get("api/frontend/v1/stv/abschlusspruefung/getBeurteilungen/")},getAkadGrade(t){return this.$fhcApi.post("api/frontend/v1/stv/abschlusspruefung/getAkadGrade/",{studiengang_kz:t})},getTypStudiengang(t){return this.$fhcApi.post("api/frontend/v1/stv/abschlusspruefung/getTypStudiengang/",{studiengang_kz:t})},getMitarbeiter(t){return this.$fhcApi.get("api/frontend/v1/stv/abschlusspruefung/getMitarbeiter/"+t)},getPruefer(t){return this.$fhcApi.get("api/frontend/v1/stv/abschlusspruefung/getPruefer/"+t)},getNoten(){return this.$fhcApi.get("api/frontend/v1/stv/abschlusspruefung/getNoten/")},checkForExistingExams(t){return this.$fhcApi.post("api/frontend/v1/stv/abschlusspruefung/checkForExistingExams/",{uids:t})}},grades:{list(){return this.$fhcApi.get("api/frontend/v1/stv/grades/list")},getCertificate(t,e){let n="api/frontend/v1/stv/grades/getCertificate/"+encodeURIComponent(t);return e&&(n=n+"/"+encodeURIComponent(e)),this.$fhcApi.get(n)},getTeacherProposal(t,e){let n="api/frontend/v1/stv/grades/getTeacherProposal/"+encodeURIComponent(t);return e&&(n=n+"/"+encodeURIComponent(e)),this.$fhcApi.get(n)},getRepeaterGrades(t,e){let n="api/frontend/v1/stv/grades/getRepeaterGrades/"+encodeURIComponent(t);return e&&(n=n+"/"+encodeURIComponent(e)),this.$fhcApi.get(n)},updateCertificate({lehrveranstaltung_id:t,student_uid:e,studiensemester_kurzbz:n,note:a,lehrveranstaltung_bezeichnung:r}){return this.$fhcApi.post("api/frontend/v1/stv/grades/updateCertificate",{lehrveranstaltung_id:t,student_uid:e,studiensemester_kurzbz:n,note:a},{errorHeader:r})},deleteCertificate({lehrveranstaltung_id:t,student_uid:e,studiensemester_kurzbz:n,lehrveranstaltung_bezeichnung:a}){return this.$fhcApi.post("api/frontend/v1/stv/grades/deleteCertificate",{lehrveranstaltung_id:t,student_uid:e,studiensemester_kurzbz:n},{errorHeader:a})},copyTeacherProposalToCertificate({lehrveranstaltung_id:t,student_uid:e,studiensemester_kurzbz:n,lehrveranstaltung_bezeichnung:a}){return this.$fhcApi.post("api/frontend/v1/stv/grades/copyTeacherProposalToCertificate",{lehrveranstaltung_id:t,student_uid:e,studiensemester_kurzbz:n},{errorHeader:a})},copyRepeaterGradeToCertificate({studierendenantrag_lehrveranstaltung_id:t,lv_bezeichnung:e}){return this.$fhcApi.post("api/frontend/v1/stv/grades/copyRepeaterGradeToCertificate",{studierendenantrag_lehrveranstaltung_id:t},{errorHeader:e})},getGradeFromPoints(t,e,n,a){const r=a?{errorHandling:!1}:{};return this.$fhcApi.post("api/frontend/v1/stv/grades/getGradeFromPoints",{points:t,lehrveranstaltung_id:e,studiensemester_kurzbz:n},r)}},mobility:{getMobilitaeten(t,e,n){return this.$fhcApi.get("api/frontend/v1/stv/mobility/getMobilitaeten/"+n.id)},getProgramsMobility(){return this.$fhcApi.get("api/frontend/v1/stv/mobility/getProgramsMobility/")},addNewMobility(t,e){return this.$fhcApi.post(t,"api/frontend/v1/stv/mobility/insertMobility/",e)},loadMobility(t){return this.$fhcApi.get("api/frontend/v1/stv/mobility/loadMobility/"+t)},updateMobility(t,e){return this.$fhcApi.post(t,"api/frontend/v1/stv/mobility/updateMobility/",e)},deleteMobility(t){return this.$fhcApi.post("api/frontend/v1/stv/mobility/deleteMobility/"+t)},getLVList(t){return this.$fhcApi.get("api/frontend/v1/stv/mobility/getLVList/"+t)},getAllLehreinheiten(t){return this.$fhcApi.post("api/frontend/v1/stv/mobility/getAllLehreinheiten/",t)},getLvsandLesByStudent(t){return this.$fhcApi.get("api/frontend/v1/stv/mobility/getLvsandLesByStudent/"+t)},getPurposes(t,e,n){return this.$fhcApi.get("api/frontend/v1/stv/mobility/getPurposes/"+n.id)},getSupports(t,e,n){return this.$fhcApi.get("api/frontend/v1/stv/mobility/getSupports/"+n.id)},getListPurposes(){return this.$fhcApi.get("api/frontend/v1/stv/mobility/getListPurposes/")},getListSupports(){return this.$fhcApi.get("api/frontend/v1/stv/mobility/getListSupports/")},deleteMobilityPurpose(t){return this.$fhcApi.post("api/frontend/v1/stv/mobility/deleteMobilityPurpose/"+t.bisio_id,t)},addMobilityPurpose(t){return this.$fhcApi.post("api/frontend/v1/stv/mobility/addMobilityPurpose/"+t.bisio_id,t)},deleteMobilitySupport(t){return this.$fhcApi.post("api/frontend/v1/stv/mobility/deleteMobilitySupport/"+t.bisio_id,t)},addMobilitySupport(t){return this.$fhcApi.post("api/frontend/v1/stv/mobility/addMobilitySupport/"+t.bisio_id,t)}},archiv:{tabulatorConfig(t,e){return t.ajaxURL="api/frontend/v1/stv/archiv/get",t.ajaxParams=()=>({person_id:e.modelValue.person_id||e.modelValue.map(t=>t.person_id)}),t.ajaxRequestFunc=(t,e,n)=>this.$fhcApi.post(t,n,e),t.ajaxResponse=(t,e,n)=>n.data,t},getArchivVorlagen(){return this.$fhcApi.post("api/frontend/v1/stv/archiv/getArchivVorlagen")},archive(t){return this.$fhcApi.post("api/frontend/v1/documents/archive",t)},archiveSigned(t){return this.$fhcApi.post("api/frontend/v1/documents/archiveSigned",t)},update(t){return this.$fhcApi.post("api/frontend/v1/stv/archiv/update",t)},delete({akte_id:t,studiengang_kz:e}){return this.$fhcApi.post("api/frontend/v1/stv/archiv/delete",{akte_id:t,studiengang_kz:e})}},documents:{getDocumentsUnaccepted(t,e,n){return this.$fhcApi.get("api/frontend/v1/stv/dokumente/getDocumentsUnaccepted/"+n.id+"/"+n.studiengang_kz)},getDocumentsAccepted(t,e,n){return this.$fhcApi.get("api/frontend/v1/stv/dokumente/getDocumentsAccepted/"+n.id+"/"+n.studiengang_kz)},deleteZuordnung(t){return this.$fhcApi.post("api/frontend/v1/stv/dokumente/deleteZuordnung/"+t.prestudent_id+"/"+t.dokument_kurzbz)},createZuordnung(t){return this.$fhcApi.post("api/frontend/v1/stv/dokumente/createZuordnung/"+t.prestudent_id+"/"+t.dokument_kurzbz)},loadAkte(t){return this.$fhcApi.get("api/frontend/v1/stv/dokumente/loadAkte/"+t)},getDoktypen(){return this.$fhcApi.get("api/frontend/v1/stv/dokumente/getDoktypen/")},updateFile(t,e){return this.$fhcApi.post("api/frontend/v1/stv/dokumente/updateAkte/"+t,e)},deleteFile(t){return this.$fhcApi.post("api/frontend/v1/stv/dokumente/deleteAkte/"+t)},uploadFile(t,e){return this.$fhcApi.post("api/frontend/v1/stv/dokumente/uploadDokument/"+t,e)}},exemptions:{getAnrechnungen(t,e,n){return this.$fhcApi.get("api/frontend/v1/stv/anrechnungen/getAnrechnungen/"+n.id)},getLehrveranstaltungen(t){return this.$fhcApi.get("api/frontend/v1/stv/anrechnungen/getLehrveranstaltungen/"+t)},getBegruendungen(){return this.$fhcApi.get("api/frontend/v1/stv/anrechnungen/getBegruendungen/")},getLvsKompatibel(t){return this.$fhcApi.get("api/frontend/v1/stv/anrechnungen/getLvsKompatibel/"+t)},getLektoren(t){return this.$fhcApi.get("api/frontend/v1/stv/anrechnungen/getLektoren/"+t)},addNewAnrechnung(t,e){return this.$fhcApi.post(t,"api/frontend/v1/stv/anrechnungen/insertAnrechnung/",e)},loadAnrechnung(t){return this.$fhcApi.get("api/frontend/v1/stv/anrechnungen/loadAnrechnung/"+t)},editAnrechnung(t,e){return this.$fhcApi.post(t,"api/frontend/v1/stv/anrechnungen/updateAnrechnung/",e)},deleteAnrechnung(t){return this.$fhcApi.post("api/frontend/v1/stv/anrechnungen/deleteAnrechnung/"+t)}},jointstudies:{getStudies(t,e,n){return this.$fhcApi.get("api/frontend/v1/stv/GemeinsameStudien/getStudien/"+n.id)},getTypenMobility(){return this.$fhcApi.get("api/frontend/v1/stv/GemeinsameStudien/getTypenMobility/")},getStudiensemester(){return this.$fhcApi.get("api/frontend/v1/stv/GemeinsameStudien/getStudiensemester/")},getStudyprograms(){return this.$fhcApi.get("api/frontend/v1/stv/GemeinsameStudien/getStudienprogramme/")},getListPartner(){return this.$fhcApi.get("api/frontend/v1/stv/GemeinsameStudien/getPartnerfirmen/")},getStatiPrestudent(){return this.$fhcApi.get("api/frontend/v1/stv/GemeinsameStudien/getStatiPrestudent/")},loadStudy(t){return this.$fhcApi.get("api/frontend/v1/stv/GemeinsameStudien/loadStudie/"+t)},insertStudy(t,e){return this.$fhcApi.post(t,"api/frontend/v1/stv/GemeinsameStudien/insertStudie/",e)},updateStudy(t,e){return this.$fhcApi.post(t,"api/frontend/v1/stv/GemeinsameStudien/updateStudie/",e)},deleteStudy(t){return this.$fhcApi.post("api/frontend/v1/stv/GemeinsameStudien/deleteStudie/"+t)}},courselist:{getCourselist(t,e,n){return this.$fhcApi.get("api/frontend/v1/stv/LvTermine/getStundenplan/"+n.student_uid+"/"+n.start_date+"/"+n.end_date+"/"+n.group_consecutiveHours+"/"+n.dbStundenplanTable)},getStudiensemester(){return this.$fhcApi.get("api/frontend/v1/stv/LvTermine/getStudiensemester/")}},configStudent(){return this.$fhcApi.get("api/frontend/v1/stv/config/student")},configStudents(){return this.$fhcApi.get("api/frontend/v1/stv/config/students")}},He={person:{getNotizen(t,e,n){return this.$fhcApi.get("api/frontend/v1/notiz/notizPerson/getNotizen/"+n.id+"/"+n.type)},getUid(){return this.$fhcApi.get("api/frontend/v1/notiz/notizPerson/getUid/")},addNewNotiz(t,e,n){return this.$fhcApi.post(t,"api/frontend/v1/notiz/notizPerson/addNewNotiz/"+e,n)},loadNotiz(t){return this.$fhcApi.post("api/frontend/v1/notiz/notizPerson/loadNotiz/",{notiz_id:t})},loadDokumente(t){return this.$fhcApi.post("api/frontend/v1/notiz/notizPerson/loadDokumente/",{notiz_id:t})},deleteNotiz(t,e,n){return this.$fhcApi.post("api/frontend/v1/notiz/notizPerson/deleteNotiz/",{notiz_id:t,type_id:e,id:n})},updateNotiz(t,e,n){return this.$fhcApi.post(t,"api/frontend/v1/notiz/notizPerson/updateNotiz/"+e,n)},getMitarbeiter(t){return this.$fhcApi.get("api/frontend/v1/notiz/notizPerson/getMitarbeiter/"+t)},isBerechtigt(t,e){return this.$fhcApi.get("api/frontend/v1/notiz/notizPerson/isBerechtigt/")}}},Ie={person:{getAllBetriebsmittel(t,e,n){return this.$fhcApi.get("api/frontend/v1/betriebsmittel/betriebsmittelP/getAllBetriebsmittel/"+n.type+"/"+n.id)},addNewBetriebsmittel(t,e,n){return this.$fhcApi.post(t,"api/frontend/v1/betriebsmittel/betriebsmittelP/addNewBetriebsmittel/"+e,n)},loadBetriebsmittel(t){return this.$fhcApi.post("api/frontend/v1/betriebsmittel/betriebsmittelP/loadBetriebsmittel/"+t)},updateBetriebsmittel(t,e,n){return this.$fhcApi.post(t,"api/frontend/v1/betriebsmittel/betriebsmittelP/updateBetriebsmittel/"+e,n)},deleteBetriebsmittel(t){return this.$fhcApi.post("api/frontend/v1/betriebsmittel/betriebsmittelP/deleteBetriebsmittel/"+t)},getTypenBetriebsmittel(){return this.$fhcApi.get("api/frontend/v1/betriebsmittel/betriebsmittelP/getTypenBetriebsmittel/")},loadInventarliste(t){return this.$fhcApi.get("api/frontend/v1/betriebsmittel/betriebsmittelP/loadInventarliste/"+t)}}},Re={updatePersonUnrulyStatus(t,e){try{const n={person_id:t,unruly:e},a="/api/frontend/v1/checkperson/CheckPerson/updatePersonUnrulyStatus";return this.$fhcApi.post(a,n,null)}catch(t){throw t}},filterPerson(t,e=""){try{const n=e+"/api/frontend/v1/checkperson/CheckPerson/filterPerson";return axios.post(n,t)}catch(t){throw t}}},Le={getContentID(t){return this.$fhcApi.get(FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+"/api/frontend/v1/Ort/ContentID",{ort_kurzbz:t})},getRooms(t,e,n,a,r=0){return this.$fhcApi.get(FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+"/api/frontend/v1/Ort/getRooms",{datum:t,von:e,bis:n,typ:a,personenanzahl:r})},getRoomTypes(){return this.$fhcApi.get(FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+"/api/frontend/v1/Ort/getTypes")}},je={content(t,e=null,n=null,a=null){return this.$fhcApi.get("/api/frontend/v1/Cms/content",{content_id:t,...e?{version:e}:{},...n?{sprache:n}:{},...a?{sichtbar:a}:{}})},getNews(t=1,e=10,n){return this.$fhcApi.get("/api/frontend/v1/Cms/getNews",{page:t,page_size:e,sprache:n})},news(t){return this.$fhcApi.get("/api/frontend/v1/Cms/news",{limit:t})},getNewsRowCount:function(){return this.$fhcApi.get("/api/frontend/v1/Cms/getNewsRowCount",{})},getNewsExtra:function(){return this.$fhcApi.get("/api/frontend/v1/Cms/getStudiengangInfoForNews",{})}},Je={getStudentenMail(t){return this.$fhcApi.get(FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+"/api/frontend/v1/Lehre/lvStudentenMail",{lehreinheit_id:t})},getLvInfo(t,e){return this.$fhcApi.get(`/api/frontend/v1/Lehre/LV/${t}/${e}`,{})},getStudentPruefungen(t){return this.$fhcApi.get(`/api/frontend/v1/Lehre/Pruefungen/${t}`,{})},getStudentProjektarbeiten(t){return this.$fhcApi.get(`/api/frontend/v1/Lehre/getStudentProjektarbeiten/${t}`,{})},getStudentProjektabgaben(t){return this.$fhcApi.get("/api/frontend/v1/Lehre/getStudentProjektabgaben",{projektarbeit_id:t.projektarbeit_id,student_uid:t.student_uid})},postStudentProjektarbeitEndupload(t){return this.$fhcApi.post("/api/frontend/v1/Lehre/postStudentProjektarbeitEndupload",t,{Headers:{"Content-Type":"multipart/form-data"}})},postStudentProjektarbeitZwischenabgabe(t){return this.$fhcApi.post("/api/frontend/v1/Lehre/postStudentProjektarbeitZwischenabgabe",t,{Headers:{"Content-Type":"multipart/form-data"}})},getStudentProjektarbeitAbgabeFile(t,e){const n=`/Cis/Abgabetool/getStudentProjektarbeitAbgabeFile?paabgabe_id=${t}&student_uid=${e}`;window.location=FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+n},getMitarbeiterProjektarbeiten(t,e){return this.$fhcApi.get(`/api/frontend/v1/Lehre/getMitarbeiterProjektarbeiten?showall=${e}`,{})},postProjektarbeitAbgabe(t){const e={paabgabe_id:t.paabgabe_id,paabgabetyp_kurzbz:t.bezeichnung.paabgabetyp_kurzbz,datum:t.datum,fixtermin:t.fixtermin,insertvon:t.insertvon,kurzbz:t.kurzbz,projektarbeit_id:t.projektarbeit_id};return this.$fhcApi.post("/api/frontend/v1/Lehre/postProjektarbeitAbgabe",e,null)},deleteProjektarbeitAbgabe(t){const e={paabgabe_id:t};return this.$fhcApi.post("/api/frontend/v1/Lehre/deleteProjektarbeitAbgabe",e,null)},postSerientermin(t,e,n,a,r){const s={datum:t,paabgabetyp_kurzbz:e,bezeichnung:n,kurzbz:a,projektarbeit_ids:r};return this.$fhcApi.post("/api/frontend/v1/Lehre/postSerientermin",s,null)},fetchDeadlines(t){const e={person_id:t};return this.$fhcApi.post("/api/frontend/v1/Lehre/fetchDeadlines",e,null)}},Ge={getLvMenu(t,e){return this.$fhcApi.get(FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+`/api/frontend/v1/LvMenu/getLvMenu/${t}/${e}`,{})}},Ne={person:{getMessages(t,e,n){return this.$fhcApi.get("api/frontend/v1/messages/messages/getMessages/"+n.id+"/"+n.type+"/"+n.size+"/"+n.page)},getVorlagen(){return this.$fhcApi.get("api/frontend/v1/messages/messages/getVorlagen/")},getMsgVarsLoggedInUser(){return this.$fhcApi.get("api/frontend/v1/messages/messages/getMsgVarsLoggedInUser/")},getMessageVarsPerson(t){return this.$fhcApi.get("api/frontend/v1/messages/messages/getMessageVarsPerson/"+t.id+"/"+t.type_id)},getMsgVarsPrestudent(t){return this.$fhcApi.get("api/frontend/v1/messages/messages/getMsgVarsPrestudent/"+t.id+"/"+t.type_id)},getPersonId(t){return this.$fhcApi.get("api/frontend/v1/messages/messages/getPersonId/"+t.id+"/"+t.type_id)},getUid(t){return this.$fhcApi.get("api/frontend/v1/messages/messages/getUid/"+t.id+"/"+t.type_id)},getDataVorlage(t){return this.$fhcApi.get("api/frontend/v1/messages/messages/getDataVorlage/"+t)},getNameOfDefaultRecipient(t){return this.$fhcApi.get("api/frontend/v1/messages/messages/getNameOfDefaultRecipient/"+t.id+"/"+t.type_id)},getPreviewText(t,e){return this.$fhcApi.post("api/frontend/v1/messages/messages/getPreviewText/"+t.id+"/"+t.type_id,e)},getReplyData(t){return this.$fhcApi.get("api/frontend/v1/messages/messages/getReplyData/"+t)},sendMessageFromModalContext(t,e,n){return this.$fhcApi.post(t,"api/frontend/v1/messages/messages/sendMessage/"+e,n)},sendMessage(t,e){return this.$fhcApi.post("api/frontend/v1/messages/messages/sendMessage/"+t,e)},deleteMessage(t){return this.$fhcApi.post("api/frontend/v1/messages/messages/deleteMessage/"+t)}}},Ue={getVorlagen(){return this.$fhcApi.get("api/frontend/v1/vorlagen/vorlagen/getVorlagen/")},getVorlagenByLoggedInUser(){return this.$fhcApi.get("api/frontend/v1/vorlagen/vorlagen/getVorlagenByLoggedInUser/")}},qe={getStudiensemester:function(){return this.$fhcApi.get("/components/Cis/Mylv/Studiensemester",{})},getAllStudienSemester:function(t=void 0,e=void 0,n=void 0,a=void 0){return this.$fhcApi.get("/api/frontend/v1/Studium/getStudienAllSemester",{studiensemester:t,studiengang:e,semester:n,studienplan:a})},getStudiengaengeForStudienSemester:function(t){return this.$fhcApi.get(`/api/frontend/v1/Studium/getStudiengaengeForStudienSemester/${t}`,{})},getStudienplaeneBySemester:function(t,e){return this.$fhcApi.get("/api/frontend/v1/Studium/getStudienplaeneBySemester",{studiengang:t,studiensemester:e})},getLvPlanForStudiensemester:function(t,e){return this.$fhcApi.get(`/api/frontend/v1/LvPlan/getLvPlanForStudiensemester/${t}/${e}`,{})},getLvEvaluierungInfo:function(t,e){return this.$fhcApi.get(`/api/frontend/v1/Studium/getLvEvaluierungInfo/${t}/${e}`,{})}},Ke={search:Fe,phrasen:Ve,navigation:Pe,dashboard:{async getViewData(){return this.$fhcApi.get("/api/frontend/v1/Cis4FhcApi/getViewData",null,null)}},filter:Ee,studstatus:Te,profil:$e,profilUpdate:Be,lvPlan:Oe,bookmark:{getBookmarks:function(){return this.$fhcApi.get("/api/frontend/v1/Bookmark/getBookmarks",{})},delete:function(t){return this.$fhcApi.get(`/api/frontend/v1/Bookmark/delete/${t}`,{})},update:function({bookmark_id:t,url:e,title:n,tag:a=null}){return this.$fhcApi.post(`/api/frontend/v1/Bookmark/update/${t}`,{url:e,title:n})},insert:function({url:t,title:e,tag:n}){return this.$fhcApi.post("/api/frontend/v1/Bookmark/insert",{url:t,title:e,tag:n})}},stv:Me,notiz:He,betriebsmittel:Ie,checkperson:Re,ampeln:{open:function(){return this.$fhcApi.get("/api/frontend/v1/Ampeln/open",{})},all:function(){return this.$fhcApi.get("/api/frontend/v1/Ampeln/all",{})},confirm:function(t){return this.$fhcApi.get(`/api/frontend/v1/Ampeln/confirm/${t}`,{})}},ort:Le,cms:je,lehre:Je,addons:Ge,messages:Ne,vorlagen:Ue,addons:Ge,studiengang:{studiengangInformation:function(){return this.$fhcApi.get("/api/frontend/v1/Studgang/getStudiengangInfo",{})},getStudiengangByKz:function(t){return this.$fhcApi.get("/api/frontend/v1/organisation/StudiengangEP/getStudiengangByKz",{studiengang_kz:t})}},menu:{getMenu:function(){return this.$fhcApi.get("/api/frontend/v1/CisMenu/getMenu",{})}},authinfo:{getAuthUID(){return this.$fhcApi.get("/api/frontend/v1/AuthInfo/getAuthUID",{})},getAuthInfo(){return this.$fhcApi.get("/api/frontend/v1/AuthInfo/getAuthInfo",{})}},studium:qe,language:{getAll(){return this.$fhcApi.get("/api/frontend/v1/language/get")}}},We={install:(t,e)=>{if(t.config.globalProperties.$fhcApi)return void(e?.factory&&(console.warn("$fhcApi is DEPRECATED!"),t.config.globalProperties.$fhcApi.factory.addEndpoints(e.factory)));function n(t,e,n,a){if("string"==typeof t&&void 0===a)[e,n,a]=[t,e,n],t=void 0;else if(t){if("object"!=typeof t)throw new TypeError("Parameter 1 of _get_config must be an object or a string");void 0===e&&void 0===n&&void 0===a&&(a=t,t=void 0)}if(t){if(!t.clearValidation||!t.setFeedback)throw new TypeError("'form' is not a Form Component");t={clearValidation:t.clearValidation,setFeedback:t.setFeedback},a?a.form=t:a={form:t}}return[e,n,a]}function a(t){const e=t.data;return delete t.data,e.meta?e.meta.response=t:e.meta={response:t},e}FHC_JS_DATA_STORAGE_OBJECT.app_root,FHC_JS_DATA_STORAGE_OBJECT.ci_router;const r=axios.create({timeout:5e5,baseURL:FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+"/"});r.interceptors.request.use(t=>{if("post"!=t.method||!t.data)return t;if(t.data instanceof FormData)return t;if(!Object.values(t.data).every(t=>!(t instanceof FileList)&&(!Array.isArray(t)||t.every(t=>!(t instanceof File))))){const e=Object.entries(t.data).reduce((t,[e,n])=>{if(n instanceof FileList)for(const a of n)t.FormData.append(e+(n.length>1?"[]":""),a);else Array.isArray(n)?n.every(t=>!(t instanceof File))?t.jsondata[e]=n:n.forEach(a=>t.FormData.append(e+(n.length>1?"[]":""),a)):t.jsondata[e]=n;return t},{FormData:new FormData,jsondata:{}});e.FormData.append("_jsondata",JSON.stringify(e.jsondata)),t.data=e.FormData}return t}),r.interceptors.response.use(e=>("off"==e.config?.errorHandling||!1===e.config?.errorHandling||"fail"==e.config?.errorHandling||e.data.errors&&(e.data.errors=e.data.errors.filter(n=>(e.config[n.type+"ErrorHandler"]||t.config.globalProperties.$fhcApi._defaultErrorHandlers[n.type])(n,e.config))),a(e)),e=>"ERR_CANCELED"==e.code?Promise.reject({handled:!0,...e}):"off"==e.config?.errorHandling||!1===e.config?.errorHandling||"success"==e.config?.errorHandling?Promise.reject(e):e.response?404==e.response.status?(t.config.globalProperties.$fhcAlert.alertDefault("error",e.message,e.request.responseURL,!0),Promise.reject({handled:!0,...e})):(e.response.data.errors=e.response.data.errors.filter(n=>(e.config[n.type+"ErrorHandler"]||t.config.globalProperties.$fhcApi._defaultErrorHandlers[n.type])(n,e.config)),e.response.data.errors.length?Promise.reject(e):Promise.reject({handled:!0,...e})):e.request?(t.config.globalProperties.$fhcAlert.alertDefault("error",e.message,e.request.responseURL),Promise.reject({handled:!0,...e})):(t.config.globalProperties.$fhcAlert.alertError(e.message),Promise.reject({handled:!0,...e}))),t.config.globalProperties.$fhcApi={getUri:t=>(console.warn("$fhcApi.getUri is DEPRECATED! Use $api.getUri instead."),r.getUri({url:t})),get:(t,e,a,s)=>(console.warn("$fhcApi.get is DEPRECATED! Use $api.get instead."),[e,a,s]=n(t,e,a,s),a&&(s?s.params=a:s={params:a}),r.get(e,s)),post:(t,e,a,s)=>(console.warn("$fhcApi.post is DEPRECATED! Use $api.post instead."),[e,a,s]=n(t,e,a,s),r.post(e,a,s)),_defaultErrorHandlers:{validation(e,n){const a=t.config.globalProperties.$fhcAlert;return n?.form?(n.form.clearValidation(),n.form.setFeedback(!1,e.messages),!1):Array.isArray(e.messages)?(e.messages.forEach(a.alertError),!1):"object"!=typeof e.messages||(n?.errorHeader?Object.values(e.messages).forEach(e=>a.alertDefault("error",Array.isArray(n.errorHeader)?t.config.globalProperties.$p.t.apply(null,n.errorHeader):n.errorHeader,e,!0)):Object.entries(e.messages).forEach(([t,e])=>a.alertDefault("error",t,e,!0)),!1)},general(e,n){const a=t.config.globalProperties.$fhcAlert;n?.form?n.form.setFeedback(!1,e.message):n?.errorHeader?a.alertDefault("error",Array.isArray(n.errorHeader)?t.config.globalProperties.$p.t.apply(null,n.errorHeader):n.errorHeader,e.message,!0):a.alertError(e.message)},php(e){const n=t.config.globalProperties.$fhcAlert;var a="";switch(a+="Message: "+e.message+"\n\n",a+="Filename: "+e.filename+"\n",a+="Line Number: "+e.line+"\n",e.backtrace&&e.backtrace.length&&(a+="\nBacktrace: ",e.backtrace.forEach(t=>{a+="\n\tFile: "+t.file+"\n",a+="\tLine: "+t.line+"\n",a+="\tFunction: "+t.function+"\n"})),e.severity){case"Warning":case"Core Warning":case"Compile Warning":case"User Warning":n.alertDefault("warn","PHP "+e.severity,a,!0);break;case"Notice":case"User Notice":case"Runtime Notice":n.alertDefault("info","PHP "+e.severity,a,!0);break;default:a="Type: PHP "+e.severity+"\n\n"+a,n.alertSystemError(a)}},exception(e){const n=t.config.globalProperties.$fhcAlert;var a="";a+="Type: "+e.class+"\n\n",a+="Message: "+e.message+"\n\n",a+="Filename: "+e.filename+"\n",a+="Line Number: "+e.line+"\n",e.backtrace&&e.backtrace.length&&(a+="\nBacktrace: ",e.backtrace.forEach(t=>{a+="\n\tFile: "+t.file+"\n",a+="\tLine: "+t.line+"\n",a+="\tFunction: "+t.function+"\n"})),n.alertSystemError(a)},db(e){const n=t.config.globalProperties.$fhcAlert;var a="";void 0!==e.heading&&(a+=e.heading+"\n\n"),void 0!==e.code&&(a+="Code: "+e.code+"\n\n"),void 0!==e.sql&&(a+="SQL: "+e.sql+"\n\n"),void 0!==e.message?a+="Message: "+e.message+"\n\n":void 0!==e.messages&&(a+="Messages: "+e.messages.join("\n\t")+"\n\n"),void 0!==e.filename&&(a+="Filename: "+e.filename+"\n"),void 0!==e.line&&(a+="Line Number: "+e.line+"\n"),n.alertSystemError(a)},auth(e,n){const a=t.config.globalProperties.$fhcAlert;var r="";r+="Controller name: "+e.controller+"\n",r+="Method name: "+e.method+"\n",r+="Required permissions: "+e.required_permissions,n?.errorHeader?a.alertDefault("error",Array.isArray(n.errorHeader)?t.config.globalProperties.$p.t.apply(null,n.errorHeader):n.errorHeader,e.message,!0):a.alertDefault("error",e.message,r)}}};class s{constructor(e,n){void 0===n?(this.$fhcApi={getUri:e=>(console.warn("$fhcApi.factory is DEPRECATED!"),t.config.globalProperties.$fhcApi.getUri(e)),get:(e,n,a,r)=>(console.warn("$fhcApi.factory is DEPRECATED!"),t.config.globalProperties.$fhcApi.get(e,n,a,r)),post:(e,n,a,r)=>(console.warn("$fhcApi.factory is DEPRECATED!"),t.config.globalProperties.$fhcApi.post(e,n,a,r))},Object.defineProperty(this.$fhcApi,"factory",{get:()=>(console.warn("$fhcApi.factory is DEPRECATED!"),t.config.globalProperties.$fhcApi.factory)}),t.config.globalProperties.$fhcApi.factory=this):Object.defineProperty(this,"$fhcApi",{get(){return(n||this).$fhcApi}}),this.addEndpoints(e,!0)}addEndpoints(t,e){Object.keys(t).forEach(e=>{Object.defineProperty(this,e,{get(){return"function"==typeof t[e]?t[e].bind(this):new s(t[e],this.$fhcApi.factory)}})}),e||console.warn("$fhcApi.factory.addEndpoints() is DEPRECATED!")}}const i=new s(Ke);e?.factory&&(console.warn("$fhcApi is DEPRECATED!"),i.addEndpoints(e.factory)),t.config.globalProperties.$fhcApi.factory=i,t.provide("$fhcApi",t.config.globalProperties.$fhcApi)}};const Ze=document.createElement("div"),Ye=Vue.createApp({name:"FhcAlertApp",components:{PvToast:r,PvConfirm:s},methods:{mailToUrl:t=>"mailto:"+FHC_JS_DATA_STORAGE_OBJECT.systemerror_mailto+"?subject=Meldung%20Systemfehler&body="+("\n\t\t\t\tDanke, dass Sie uns den Fehler melden. %0D%0A %0D%0A\n\t\t\t\tBitte beschreiben Sie uns ausführlich das Problem.%0D%0A\n\t\t\t\tBsp: Ich habe X ausgewählt und Y angelegt. Beim Speichern erhielt ich die Fehlermeldung. [Optional: Ich habe den Browser Z verwendet.]%0D%0A\n\t\t\t\t-----------------------------------------------------------------------------------------------------------------------------------%0D%0A\n\t\t\t\tPROBLEM: ... %0D%0A %0D%0A %0D%0A\n\n\t\t\t\t-----------------------------------------------------------------------------------------------------------------------------------%0D%0A\n\t\t\t\tFehler URL: "+FHC_JS_DATA_STORAGE_OBJECT.called_path+"/"+FHC_JS_DATA_STORAGE_OBJECT.called_method+"%0D%0A\n\t\t\t\tFehler Meldung: "+t.message.detail+"%0D%0A\n\t\t\t\t-----------------------------------------------------------------------------------------------------------------------------------%0D%0A %0D%0A\n\t\t\t\tWir kümmern uns um eine rasche Behebung des Problems!"),openMessagecard(t){bootstrap.Collapse.getOrCreateInstance(t.target.getAttribute("href")).toggle()}},unmounted(){Ze.parentElement.removeChild(Ze)},computed:{showmaillink:function(){return""!==FHC_JS_DATA_STORAGE_OBJECT.systemerror_mailto}},template:'\n\t<pv-toast ref="toast" class="fhc-alert" :base-z-index="99999">\n\t\t<template #message="{ message }">\n\t\t\t\x3c!--span :class="slotProps.iconClass"></span--\x3e\n\t\t\t<div class="p-toast-message-text">\n\t\t\t\t<span class="p-toast-summary">{{ message.summary }}</span>\n\t\t\t\t<div v-if="message.detail && message.html" class="p-toast-detail" v-html="message.detail"></div>\n\t\t\t\t<div v-else-if="message.detail" class="p-toast-detail">{{ message.detail }}</div>\n\t\t\t</div>\n\t\t</template>\n\t</pv-toast>\n\t<pv-toast ref="alert" class="fhc-alert" :base-z-index="99999" position="center">\n\t\t<template #message="slotProps">\n\t\t\t<i class="fa fa-circle-exclamation fa-2xl mt-3"></i>\n\t\t\t<div class="p-toast-message-text">\n\t\t\t\t<span class="p-toast-summary">{{slotProps.message.summary}}</span>\n\t\t\t\t<div class="p-toast-detail my-3">Sorry! Ein interner technischer Fehler ist aufgetreten.</div>\n\t\t\t\t<div class="d-flex justify-content-between align-items-center">\n\t\t\t\t\t<a\n\t\t\t\t\t\tclass="align-bottom flex-fill me-2"\n\t\t\t\t\t\tdata-bs-toggle="collapse"\n\t\t\t\t\t\t:href="\'#fhcAlertCollapseMessageCard\' + slotProps.message.id"\n\t\t\t\t\t\trole="button"\n\t\t\t\t\t\taria-expanded="false"\n\t\t\t\t\t\t:aria-controls="\'fhcAlertCollapseMessageCard\' + slotProps.message.id"\n\t\t\t\t\t\t@click="openMessagecard"\n\t\t\t\t\t\t>\n\t\t\t\t\t\tFehler anzeigen\n\t\t\t\t\t</a>\n\t\t\t\t\t<a\n\t\t\t\t\t\tv-if="showmaillink"\n\t\t\t\t\t\tclass="btn btn-primary flex-fill"\n\t\t\t\t\t\ttarget="_blank"\n\t\t\t\t\t\t:href="mailToUrl(slotProps)"\n\t\t\t\t\t\t>\n\t\t\t\t\t\tFehler melden\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t\t<div ref="messageCard" :id="\'fhcAlertCollapseMessageCard\' + slotProps.message.id" class="collapse mt-3">\n\t\t\t\t\t<div class="card card-body text-body small alertCollapseText">\n\t\t\t\t\t\t{{slotProps.message.detail}}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</template>\n\t</pv-toast>\n\t<pv-confirm group="fhcAlertConfirm"></pv-confirm>'});Ye.use(a),Ye.use(i);const Xe=Ye.mount(Ze);document.body.appendChild(Ze);var Qe={install:(t,e)=>{t.config.globalProperties.$p||t.use(on);const n={alertSuccess(t){if(Array.isArray(t))return t.forEach(this.alertSuccess);Xe.$refs.toast.add({severity:"success",summary:"Info",detail:t,life:1e3})},alertInfo(t){if(Array.isArray(t))return t.forEach(this.alertInfo);Xe.$refs.toast.add({severity:"info",summary:"Info",detail:t,life:3e3})},alertWarning(t){if(Array.isArray(t))return t.forEach(this.alertWarning);Xe.$refs.toast.add({severity:"warn",summary:"Achtung",detail:t})},alertError(t){if(Array.isArray(t))return t.forEach(this.alertError);Xe.$refs.toast.add({severity:"error",summary:"Achtung",detail:t})},alertSystemError(e){if(Array.isArray(e))return e.forEach(this.alertSystemError);Xe.$refs.alert.add({severity:"error",summary:Vue.computed(()=>t.config.globalProperties.$p.t("alert/systemerror")),detail:e})},confirmDelete:()=>new Promise((e,n)=>{Xe.$confirm.require({group:"fhcAlertConfirm",header:Vue.computed(()=>t.config.globalProperties.$p.t("alert/attention")),message:Vue.computed(()=>t.config.globalProperties.$p.t("alert/confirm_delete")),acceptLabel:Vue.computed(()=>t.config.globalProperties.$p.t("ui/loeschen")),acceptClass:"p-button-danger",rejectLabel:Vue.computed(()=>t.config.globalProperties.$p.t("ui/abbrechen")),rejectClass:"p-button-secondary",accept(){e(!0)},reject(){e(!1)}})}),confirm:e=>new Promise((n,a)=>{Xe.$confirm.require({group:e?.group??"fhcAlertConfirm",header:e?.header??Vue.computed(()=>t.config.globalProperties.$p.t("alert/attention")),message:e?.message??"",acceptLabel:e?.acceptLabel??"Ok",acceptClass:e?.acceptClass??"btn btn-primary",rejectLabel:e?.rejectLabel??Vue.computed(()=>t.config.globalProperties.$p.t("ui/abbrechen")),rejectClass:e?.rejectClass??"btn btn-outline-secondary",accept(){n(!0)},reject(){n(!1)}})}),alertDefault(t,e,n,a=!1,r=!1){let s={severity:t,summary:e,detail:n,html:r};a||(s.life=3e3),Xe.$refs.toast.add(s)},alertMultiple(t,e="info",n="Info",a=!1,r=!1){return!!t.every(t=>"string"==typeof t)&&(t.forEach(t=>this.alertDefault(e,n,t,a,r)),!0)},handleSystemError(t){if(!t.hasOwnProperty("name")||t.name.toLowerCase()!=="AbortError".toLowerCase()){if("string"==typeof t)return n.alertSystemError(t);if(Array.isArray(t)&&t.every(t=>"string"==typeof t))return t.every(n.alertSystemError);if(!t.hasOwnProperty("handled")||!t.handled){if("object"==typeof t&&null!==t){let e="";return t.hasOwnProperty("response")&&t.response?.data?.retval?e+="Error Message: "+(t.response.data.retval.message||t.response.data.retval)+"\r\n":t.hasOwnProperty("message")&&(e+="Error Message: "+t.message.toUpperCase()+"\r\n"),t.hasOwnProperty("config")&&t.config.hasOwnProperty("url")&&(e+="Error ConfigURL: "+t.config.url+"\r\n"),t.hasOwnProperty("stack")&&(e+="Error Stack: "+t.stack+"\r\n"),""==e&&(e="Error Message: "+JSON.stringify(t)+"\r\n"),e+="Error Controller Path: "+FHC_JS_DATA_STORAGE_OBJECT.called_path+"/"+FHC_JS_DATA_STORAGE_OBJECT.called_method,n.alertSystemError(e)}n.alertSystemError("alertSystemError throws Generic Error\r\nError Controller Path: "+FHC_JS_DATA_STORAGE_OBJECT.called_path+"/"+FHC_JS_DATA_STORAGE_OBJECT.called_method)}}},handleSystemMessage(t){if("string"==typeof t)return n.alertWarning(t);if(Array.isArray(t)){if(t.every(t=>"string"==typeof t))return t.every(n.alertWarning);if(t.every(t=>"object"==typeof t)&&null!==msg)return t.every(t=>{t.hasOwnProperty("data")&&t.data.hasOwnProperty("retval")?n.alertWarning(JSON.stringify(t.data.retval)):n.alertSystemError(JSON.stringify(t))})}"object"!=typeof t||null===t?n.alertSystemError("alertSystemError throws Generic Error\r\nError Controller Path: "+FHC_JS_DATA_STORAGE_OBJECT.called_path+"/"+FHC_JS_DATA_STORAGE_OBJECT.called_method):t.hasOwnProperty("data")&&t.data.hasOwnProperty("retval")?n.alertWarning(JSON.stringify(t.data.retval)):n.alertSystemError(JSON.stringify(t))},resetFormValidation(t){const e=new Event("fhc-form-reset");t.querySelectorAll(["[data-fhc-form-validate],[data-fhc-form-error]"]).forEach(t=>t.dispatchEvent(e))},handleFormValidation(t,e){if(void 0===e){if(t&&t.nodeType===Node.ELEMENT_NODE)return e=>n.handleFormValidation(e,t)}else if(400==t?.response?.status){let a=U.getError(t.response.data);"object"!=typeof a&&(a=t.response.data),n.resetFormValidation(e);const r=Object.entries(a).filter(([t,n])=>{const a=e.querySelector('[data-fhc-form-validate="'+t+'"]');return!a||(a.dispatchEvent(new CustomEvent("fhc-form-invalidate",{detail:n})),!1)}).map(t=>t[1]),s=e.querySelector("[data-fhc-form-error]");return void(s&&r.length?s.dispatchEvent(new CustomEvent("fhc-form-error",{detail:r})):r.forEach(n.alertError))}if(400==t?.response?.status){let e=U.getError(t.response.data);n.alertError("object"==typeof e?Object.values(e):e)}else n.handleSystemError(t)}};t.config.globalProperties.$fhcAlert=n,t.provide("$fhcAlert",t.config.globalProperties.$fhcAlert)}},tn={install:(t,e)=>{if(t.config.globalProperties.$api)return;function n(t,e){Array.isArray(t)?t.forEach(e):Object.entries(t).forEach(([t,n])=>n.forEach(n=>e(n,t)))}t.config.globalProperties.$fhcAlert||t.use(Qe);let a={success:!0,fail:!0,combine:{form:["validation","general"],toast:["validation","general","not_found","site_failed"]},handler:{form(t,e){t.clearValidation(),e.forEach(e=>t.setFeedback(!1,e.messages||e.message))},async toast(e){const n=t.config.globalProperties.$p;if(!n)return Promise.reject("Phrasen plugin not loaded!");async function a(t){t=t.reduce((t,e)=>{switch(e.type){case"not_found":case"site_failed":e.message?t[e.message]=[e.url]:t._default=[e.url];break;case"general":t._default||(t._default=[]),t._default.push(e.message);break;case"validation":Object.entries(e.messages).forEach(([e,n])=>{t[e]||(t[e]=[]),Array.isArray(n)?t[e].push(...n):t[e].push(n)})}return t},{});let e=0;const a=await Promise.all(Object.entries(t).sort((t,e)=>["_default"].indexOf(e[0])-["_default"].indexOf(t[0])).map(async([t,a])=>{if("_default"==t){await n.loadCategory("dashboard");t='<dt class="d-none">'+n.t("dashboard/general")+"</dt>"}else t="<dt>"+t+"</dt>";return e+=a.length,t+"<dd>"+a.join("</dd><dd>")+"</dd>"}));return{counter:e,msgs:a}}let r,s;Array.isArray(e)?({counter:r,msgs:s}=await a(e)):({counter:r,msgs:s}=await Object.entries(e).reduce(async(t,[e,n])=>{const r=await t,{counter:s,msgs:i}=await a(n);return r.counter+=s,r.msgs.push("<dt>"+e+"</dt><dd><dl>"+i.join("")+"</dl></dd>"),r},Promise.resolve({counter:0,msgs:[]}))),await n.loadCategory("ui");const i=n.t("ui/n_errors",{n:r});t.config.globalProperties.$fhcAlert.alertDefault("error",i,"<dl>"+s.join("")+"</dl>",!0,!0)},php(e){n(e,(e,n)=>{var a="";switch(a+="Message: "+e.message+"\n\n",a+="Filename: "+e.filename+"\n",a+="Line Number: "+e.line+"\n",e.backtrace&&e.backtrace.length&&(a+="\nBacktrace: ",e.backtrace.forEach(t=>{a+="\n\tFile: "+t.file+"\n",a+="\tLine: "+t.line+"\n",a+="\tFunction: "+t.function+"\n"})),e.severity){case"Warning":case"Core Warning":case"Compile Warning":case"User Warning":n?n+=": PHP "+e.severity:n="PHP "+e.severity,t.config.globalProperties.$fhcAlert.alertDefault("warn",n,a,!0);break;case"Notice":case"User Notice":case"Runtime Notice":n?n+=": PHP "+e.severity:n="PHP "+e.severity,t.config.globalProperties.$fhcAlert.alertDefault("info",n,a,!0);break;default:a="Type: PHP "+e.severity+"\n\n"+a,n&&(a=n+"\n\n"+a),t.config.globalProperties.$fhcAlert.alertSystemError(a)}})},exception(e){n(e,(e,n)=>{var a="";n&&(a+=n+"\n\n"),a+="Type: "+e.class+"\n\n",a+="Message: "+e.message+"\n\n",a+="Filename: "+e.filename+"\n",a+="Line Number: "+e.line+"\n",e.backtrace&&e.backtrace.length&&(a+="\nBacktrace: ",e.backtrace.forEach(t=>{a+="\n\tFile: "+t.file+"\n",a+="\tLine: "+t.line+"\n",a+="\tFunction: "+t.function+"\n"})),t.config.globalProperties.$fhcAlert.alertSystemError(a)})},db(e){n(e,(e,n)=>{var a="";n&&(a+=n+"\n\n"),void 0!==e.heading&&(a+=e.heading+"\n\n"),void 0!==e.code&&(a+="Code: "+e.code+"\n\n"),void 0!==e.sql&&(a+="SQL: "+e.sql+"\n\n"),void 0!==e.message?a+="Message: "+e.message+"\n\n":void 0!==e.messages&&(a+="Messages: "+e.messages.join("\n\t")+"\n\n"),void 0!==e.filename&&(a+="Filename: "+e.filename+"\n"),void 0!==e.line&&(a+="Line Number: "+e.line+"\n"),t.config.globalProperties.$fhcAlert.alertSystemError(a)})},auth(e){n(e,(e,n)=>{n?n+=": "+e.message:n=e.message;var a="";a+="Controller name: "+e.controller+"\n",a+="Method name: "+e.method+"\n",a+="Required permissions: "+e.required_permissions,t.config.globalProperties.$fhcAlert.alertDefault("error",n,a,!0)})}}};function r(t,e,n,a){if("string"==typeof t&&void 0===a)[e,n,a]=[t,e,n],t=void 0;else if(t){if("object"!=typeof t)throw new TypeError("Parameter 1 of _get_config must be an object or a string");void 0===e&&void 0===n&&void 0===a&&(a=t,t=void 0)}if(t){if(!t.clearValidation||!t.setFeedback)throw new TypeError("'form' is not a Form Component");t={clearValidation:t.clearValidation,setFeedback:t.setFeedback},a?a.form=t:a={form:t}}return[e,n,a]}function s(t){if("string"==typeof t.data||t.data instanceof String)return s({data:t});const e=t.data;return delete t.data,e?(e.meta?e.meta.response=t:e.meta={response:t},e):{meta:{response:t},data:null}}function i(t){if(!1===t||"off"===t)return{...a,success:!1,fail:!1};if(!t||!0===t)return{...a};if("success"===t)return{...a,fail:!1};if("fail"===t)return{...a,success:!1};const{success:e,fail:n,handler:r,combine:s}=t;return t={...a},Object.entries({fail:n,success:e}).forEach(([e,n])=>{void 0!==n&&(t[e]=n)}),Object.entries({handler:r,combine:s}).forEach(([e,n])=>{void 0!==n&&(t[e]={...t[e],...n})}),t}function l(t){const e=i(t?.errorHandling);if(t?.form){const n=e.handler.form;e.handler={...e.handler,form:e=>n(t.form,e)}}else e.combine={...e.combine,form:[]};return e}function o(t){return t.response?404==t.response.status?[{type:"not_found",message:t.message,url:t.request.responseURL}]:null==t.response.data.errors?[]:t.response.data.errors:t.request?[{type:"site_failed",message:t.message,url:t.request.responseURL}]:[{type:"script",message:t.message}]}function d(t,e){const n={},a=[];if(null==e)return{};for(;e.length;)a.push(e.pop());for(var r of a){let a=r.type,i=null;for(var s in t.combine){let e=t.combine[s].includes(a),n=t.handler[s];if(e&&n&&(i=s,"form"==i))break}i&&(a=i);t.handler[a]?(n[a]||(n[a]=[]),Array.isArray(r)?n[a].push(...r):n[a].push(r)):e.push(r)}return n}void 0!==e?.errorHandling&&(a=i(e.errorHandling));const u=axios.create({timeout:5e5,baseURL:FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router+"/"});u.interceptors.request.use(t=>{if("post"!=t.method||!t.data)return t;if(t.data instanceof FormData)return t;if(!Object.values(t.data).every(t=>!(t instanceof FileList)&&(!Array.isArray(t)||t.every(t=>!(t instanceof File))))){const e=Object.entries(t.data).reduce((t,[e,n])=>{if(n instanceof FileList)for(const a of n)t.FormData.append(e+(n.length>1?"[]":""),a);else Array.isArray(n)?n.every(t=>!(t instanceof File))?t.jsondata[e]=n:n.forEach(a=>t.FormData.append(e+(n.length>1?"[]":""),a)):t.jsondata[e]=n;return t},{FormData:new FormData,jsondata:{}});e.FormData.append("_jsondata",JSON.stringify(e.jsondata)),t.data=e.FormData}return t}),u.interceptors.response.use(e=>("off"==e.config?.errorHandling||!1===e.config?.errorHandling||"fail"==e.config?.errorHandling||e.data.errors&&(e.data.errors=e.data.errors.filter(n=>(e.config[n.type+"ErrorHandler"]||t.config.globalProperties.$api._defaultErrorHandlers[n.type])(n,e.config))),s(e)),t=>{if("ERR_CANCELED"==t.code)return Promise.reject({handled:!0,...t});const e=l(t.config);if(!e.fail)return Promise.reject(t);const n=o(t),a=d(e,n);for(var r in a)e.handler[r](a[r]);return n.length?Promise.reject(t):Promise.reject({handled:!0,...t})}),t.config.globalProperties.$api={getUri:t=>u.getUri({url:t}),get:(t,e,n,a)=>([e,n,a]=r(t,e,n,a),n&&(a?a.params=n:a={params:n}),u.get(e,a)),post:(t,e,n,a)=>([e,n,a]=r(t,e,n,a),u.post(e,n,a)),call(e,n,a){if(Array.isArray(e)){const s=t.config.globalProperties.$api;return Promise.allSettled(e.map((t,e)=>(Array.isArray(t)||(t=["#"+e,t]),s.call(t[1],{errorHeader:t[0],errorHandling:!1})))).then(t=>{const[,,e]=r(a,void 0,void 0,n||{}),s=l(e);if(!s.success&&!s.fail)return t;const i={};for(var u of t){const[t,e]="fulfilled"===u.status?[s.success,u.value]:[s.fail,u.reason];if(!t)return;const n=d(s,o(e));for(var c in n)i[c]?i[c][e.config.errorHeader]=n[c]:i[c]={[e.config.errorHeader]:n[c]}}for(var p in i)s.handler[p](i[p]);return t})}let{method:s,url:i,params:u,config:c}=e;return void 0!==n&&(c=n),s||(s="get"),s.toLowerCase&&(s=s.toLowerCase()),"get"==s?this.get(a,i,u,c):"post"==s?this.post(a,i,u,c):void console.error("FhcApi: method not allowed:",s)},getErrorHandler:t=>l(t)},t.provide("$api",t.config.globalProperties.$api)}},en={loadCategory:t=>({method:"get",url:"/api/frontend/v1/phrasen/loadModule/"+t}),setLanguage:(t,e)=>({method:"post",url:"/api/frontend/v1/phrasen/setLanguage",params:{categories:t,language:e}}),getLanguage:()=>({method:"get",url:"/api/frontend/v1/phrasen/getLanguage"}),getActiveDbLanguages:()=>({method:"get",url:"/api/frontend/v1/phrasen/getAllLanguages"})};const nn=Vue.reactive({}),an={};let rn=Vue.ref(FHC_JS_DATA_STORAGE_OBJECT.user_language),sn=Vue.computed(()=>rn.value?FHC_JS_DATA_STORAGE_OBJECT.server_languages.find(t=>t.sprache==rn.value).LC_Time:null);const ln={user_language:rn,user_locale:sn,setLanguage(t){const e=Object.keys(nn);return this.config.globalProperties.$api.call(en.setLanguage(e,t)).then(e=>(e.data.forEach(t=>{nn[t.category][t.phrase]=t.text}),rn.value=t,e))},loadCategory(t){return Array.isArray(t)?Promise.all(t.map(this.config.globalProperties.$p.loadCategory)):(an[t]||(an[t]=this.config.globalProperties.$api.call(en.loadCategory(t)).then(e=>e?.data?function(t,e){return t.filter(t=>t.category==e).reduce((t,e)=>(t[e.phrase]||(t[e.phrase]=e.text),t),{})}(e.data,t):{}).then(e=>{nn[t]=e})),an[t])},t_ref(t,e,n){return console.warn("deprecated"),Vue.computed(()=>this.t(t,e,n))},t(t,e,n){if(void 0===n&&(Array.isArray(t)&&2==t.length||t.split&&2==t.split("/").length)&&(n=e,[t,e]=t.split?t.split("/"):t),void 0===e)return console.error("invalid input",t,e,n),"";let a=Vue.computed(()=>nn[t]?function(t,e,n){let a=nn[t][e];return a?(n&&(a=a.replace(/\{([^}]*)\}/g,(t,e)=>void 0===n[e]?t:n[e])),a):"<< PHRASE "+e+">>"}(t,e,n):"");return nn[t]||this.loadCategory(t),a.value}};var on={install(t,e){t.config.globalProperties.$fhcApi||t.use(We),t.config.globalProperties.$api||t.use(tn),t.config.globalProperties.$p={t:ln.t,loadCategory:e=>ln.loadCategory.call(t,e),setLanguage:e=>ln.setLanguage.call(t,e),user_language:rn,user_locale:sn,t_ref:ln.t_ref},t.provide("$p",t.config.globalProperties.$p)}};const dn={formatDateGerman:function(t){if(void 0===t)return"";var e=null;return null!==t&&null!==(e=t.match(/([0-9]{4})-([0-9]{2})-([0-9]{2})/))?e[3]+"."+e[2]+"."+e[1]:t},formatCurrencyGerman:function(t){return new Intl.NumberFormat("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2}).format(t)}},un={name:"ValorisationCheck",props:{dienstverhaeltnis_id:{type:Number,required:!0}},components:{searchbar:$,CoreNavigationCmpt:_,Modal:Q},inject:["$api","$fhcAlert"],data:()=>({searchbaroptions:K,appSideMenuEntries:{},valorisierungCheckData:{},dvData:{},viewedValorisierungMethod:{},formatter:dn}),created:function(){this.getAllData()},methods:{searchfunction:function(t){return this.$api.call(B.search(t))},getAllData:function(){this.getDvData(),this.getValorisierungCheckData()},getDvData:function(){this.$api.call(he.getDvData(this.dienstverhaeltnis_id)).then(t=>{this.dvData=t.data}).catch(this.handleErrors)},getValorisierungCheckData:function(){this.$api.call(he.getValorisierungCheckData(this.dienstverhaeltnis_id)).then(t=>{this.valorisierungCheckData=t.data}).catch(this.handleErrors)},redoValorisation:function(){this.$api.call(he.redoValorisation(this.dienstverhaeltnis_id)).then(t=>{this.getAllData()}).catch(this.handleErrors)},showMethodenInfo:function(t,e){this.viewedValorisierungMethod=e,this.$refs.infoModalRef.show()},newSideMenuEntryHandler:function(t){this.appSideMenuEntries=t},handleErrors:function(t){if(t.hasOwnProperty("response")&&t.response?.data?.errors)for(let e of t.response.data.errors)this.$fhcAlert.handleSystemError(e);else this.$fhcAlert.handleSystemError(t)}},computed:{getFHCUrl:function(){return FHC_JS_DATA_STORAGE_OBJECT.app_root+FHC_JS_DATA_STORAGE_OBJECT.ci_router},valorisierungCheckDataArr:function(){let t=[];for(let e in this.valorisierungCheckData){let n=this.valorisierungCheckData[e];n.gehaltsbestandteil_id=e,t.push(n)}return t.sort(function(t,e){return 1==t.valorisierung&&0==e.valorisierung||null==t.bis&&null!=e.bis?-1:null!=t.bis&&null==e.bis?1:e.von.localeCompare(t.von)}),t},finalCalculatedValorisations:function(){let t={};for(let e in this.valorisierungCheckData){let n=this.valorisierungCheckData[e].valorisation_methods;if(t[e]=parseFloat(this.valorisierungCheckData[e].grundbetrag),null==n)continue;let a=Object.keys(n).reduce((t,e)=>n[t]>n[e]?t:e),r=parseFloat(n[a].calculated_betrag_valorisiert);r&&(t[e]=r)}return t},dienstverhaeltnisInfo:function(){let t={};if(this.dvData.length>0){let e=this.dvData[0];t={von:e.von,vertragsart:e.vertragsart,vorname:e.vorname,nachname:e.nachname,unternehmen:e.unternehmen}}return t},dienstverhaeltnisSums:function(){let t={saved:0,calculated:0};for(let e in this.valorisierungCheckData)t.saved+=parseFloat(this.valorisierungCheckData[e].final_betrag_valorisiert);return Object.keys(this.finalCalculatedValorisations).length<=0||(t.calculated=Object.values(this.finalCalculatedValorisations).reduce((t,e)=>t+e)),t},valorisierungValid:function(){for(let t in this.valorisierungCheckData){let e=this.valorisierungCheckData[t];if(e.final_betrag_valorisiert!=this.finalCalculatedValorisations[t])return!1;for(let t in e.valorisation_methods){let n=e.valorisation_methods[t];if(n.historie_betrag_valorisiert!=n.calculated_betrag_valorisiert)return!1}}return!0}},template:'\n\n\t<header class="navbar navbar-expand-lg navbar-dark sticky-top bg-dark flex-md-nowrap p-0 border-bottom">\n\t<a class="navbar-brand col-md-3 col-lg-2 me-0 px-3" :href="getFHCUrl">FHComplete [PV21]</a>\n\t<button class="navbar-toggler position-absolute d-md-none collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#sidebarMenu" aria-controls="sidebarMenu" aria-expanded="false" aria-label="Toggle navigation">\n\t\t<span class="navbar-toggler-icon"></span>\n\t</button>\n\t<div id="chooser" class="w-100">\n\t\t<searchbar :searchoptions="searchbaroptions" :searchfunction="searchfunction"></searchbar>\n\t</div>\n\t<div class="navbar-nav">\n\t\t<div class="nav-item dropdown">\n\t\t<a class="nav-link dropdown-toggle px-3" data-bs-toggle="dropdown" href="#" id="navbarDropdownMenuLink">Häufige Funktionen</a>\n\t\t<ul class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">\n\t\t\t<li><a class="dropdown-item" href="#">Action</a></li>\n\t\t\t<li><a class="dropdown-item" href="#">Another action</a></li>\n\t\t\t<li><a class="dropdown-item" href="#">Something else here</a></li>\n\t\t</ul>\n\t\t</div>noheader\n\t</div>\n\t</header>\n\n\t<div class="container-fluid">\n\t<div class="row">\n\n\t<core-navigation-cmpt :add-side-menu-entries="appSideMenuEntries" hide-top-menu left-nav-css-classes="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse"></core-navigation-cmpt>\n\n\t<main class="col-md-9 ms-sm-auto col-lg-10 px-md-4" style="height:100%">\n\n\t\t<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3">\n\t\t\t<h1 class="h2">\n\t\t\t\tValorisierungscheck {{dienstverhaeltnisInfo.vorname+\' \'+dienstverhaeltnisInfo.nachname}},\n\t\t\t\t{{ dienstverhaeltnisInfo.unternehmen }}, {{ dienstverhaeltnisInfo.vertragsart }},\n\t\t\t\t{{ this.formatter.formatDateGerman(dienstverhaeltnisInfo.von) }}\n\t\t\t</h1>\n\t\t\t<div class="btn-toolbar mb-2 mb-md-0">\n\t\t\t<div class="btn-group me-2">\n\t\t\t\t\x3c!--button type="button" class="btn btn-sm btn-outline-secondary" @click="expandAllHandler">Expand</button>\n\t\t\t\t<button type="button" class="btn btn-sm btn-outline-secondary" @click="collapseAllHandler">Collapse</button--\x3e\n\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="row">\n\n\t\t\t<div class="col-6">\n\t\t\t\t<div class="d-flex mb-3 align-items-center" v-if="valorisierungValid">\n\t\t\t\t\t<label class="text-success"><i class="fa fa-check"></i>&nbsp;Valorisierung korrekt gespeichert</label>&nbsp;\n\t\t\t\t</div>\n\n\t\t\t\t<div class="d-flex mb-3 align-items-center" v-else>\n\t\t\t\t\t<label class="text-danger"><i class="fa fa-x"></i>&nbsp;Gespeicherte Valorisierung weicht von berechneter Valorisierung ab!</label>&nbsp;\n\t\t\t\t\t<button type="button" class="btn btn-primary ml-auto" @click="redoValorisation">Valorisierung neu berechnen und speichern</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="col-6 mb-3 text-end fw-bold fs-5">\n\t\t\t\t&sum; Historie: {{ this.formatter.formatCurrencyGerman(dienstverhaeltnisSums.saved) }};\n\t\t\t\t&sum; berechnet: {{ this.formatter.formatCurrencyGerman(dienstverhaeltnisSums.calculated) }}\n\t\t\t</div>\n\n\t\t</div>\n\n\t\t<div class="mh-100 pb-5">\n\t\t\t<div class="row" v-for="method in valorisierungCheckDataArr">\n\t\t\t\t<h1 class="h3">\n\t\t\t\t\tGehaltsbestandteil {{ method.gehaltstyp }},\n\t\t\t\t\t{{ this.formatter.formatDateGerman(method.von) }}<span v-if="method.bis != null"> - {{ this.formatter.formatDateGerman(method.bis) }}</span>, Betrag valorisiert:\n\t\t\t\t\t<span\n\t\t\t\t\t\tv-bind:class="finalCalculatedValorisations[method.gehaltsbestandteil_id] != method.final_betrag_valorisiert ? \'text-danger\' : \'\'">\n\t\t\t\t\t\t{{ this.formatter.formatCurrencyGerman(method.final_betrag_valorisiert) }}\n\t\t\t\t\t</span>,\n\t\t\t\t\tValorisierung:\n\t\t\t\t\t{{ method.valorisierung ? \'Ja\' : \'Nein\' }}\n\t\t\t\t</h1>\n\t\t\t\t<div class="col-6">\n\t\t\t\t\t<table class="table table-condensed table-bordered">\n\t\t\t\t\t\t<thead>\n\t\t\t\t\t\t\t<tr class="text-center">\n\t\t\t\t\t\t\t\t<th colspan="3">Historie</th>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<th>Valorisierungsdatum</th>\n\t\t\t\t\t\t\t\t<th>Bezeichnung</th>\n\t\t\t\t\t\t\t\t<th>Betrag valorisiert</th>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t</thead>\n\t\t\t\t\t\t<tbody>\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<td></td>\n\t\t\t\t\t\t\t\t<td>Grundbetrag</td>\n\t\t\t\t\t\t\t\t<td>{{ this.formatter.formatCurrencyGerman(method.grundbetrag) }}</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t<tr v-for="(valorisierung, valorisierungsdatum) in method.valorisation_methods"\n\t\t\t\t\t\t\t\tv-bind:class="valorisierung.calculated_betrag_valorisiert != valorisierung.historie_betrag_valorisiert ? \'table-danger\' : \'\'">\n\t\t\t\t\t\t\t\t<td>{{ this.formatter.formatDateGerman(valorisierungsdatum) }}</td>\n\t\t\t\t\t\t\t\t<td>{{ valorisierung.valorisierung_kurzbz }}</td>\n\t\t\t\t\t\t\t\t<td>{{ this.formatter.formatCurrencyGerman(valorisierung.historie_betrag_valorisiert) }}</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t</tbody>\n\t\t\t\t\t</table>\n\t\t\t\t</div>\n\t\t\t\t<div class="col-6">\n\t\t\t\t\t<table class="table table-condensed table-bordered">\n\t\t\t\t\t\t<thead>\n\t\t\t\t\t\t\t<tr class="text-center">\n\t\t\t\t\t\t\t\t<th colspan="4">Berechnet</th>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<th>Valorisierungsdatum</th>\n\t\t\t\t\t\t\t\t<th>Bezeichnung</th>\n\t\t\t\t\t\t\t\t<th>Methode</th>\n\t\t\t\t\t\t\t\t<th>Betrag valorisiert</th>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t</thead>\n\t\t\t\t\t\t<tbody>\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<td></td>\n\t\t\t\t\t\t\t\t<td>Grundbetrag</td>\n\t\t\t\t\t\t\t\t<td>-</td>\n\t\t\t\t\t\t\t\t<td>{{ this.formatter.formatCurrencyGerman(method.grundbetrag) }}</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t<tr v-for="(valorisierung, valorisierungsdatum) in method.valorisation_methods"\n\t\t\t\t\t\t\t\tv-bind:class="valorisierung.calculated_betrag_valorisiert != valorisierung.historie_betrag_valorisiert ? \'table-danger\' : \'\'">\n\t\t\t\t\t\t\t\t<td>{{ this.formatter.formatDateGerman(valorisierungsdatum) }}</td>\n\t\t\t\t\t\t\t\t<td>{{ valorisierung.valorisierung_kurzbz }}</td>\n\t\t\t\t\t\t\t\t<td>{{ valorisierung.valorisierung_methode_kurzbz }}&nbsp;\n\t\t\t\t\t\t\t\t\t<i class="fa fa-info-circle fa-lg" role="button" @click="showMethodenInfo($event, valorisierung)"></i>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t<td>{{ this.formatter.formatCurrencyGerman(valorisierung.calculated_betrag_valorisiert) }}</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t</tbody>\n\t\t\t\t\t</table>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\n\t</main>\n\n\t</div>\n\t</div>\n\t\x3c!-- detail modal --\x3e\n\t<Modal :title="\'Valorisierungsmethode Information\'" ref="infoModalRef" v-model="viewedValorisierungMethod">\n\t\t<template #body>\n\t\t\t<table class="table table-bordered">\n\t\t\t\t<tbody>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<th>Bezeichnung</th>\n\t\t\t\t\t\t<td>{{viewedValorisierungMethod.valorisierung_methode_kurzbz}}</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<th>Beschreibung</th>\n\t\t\t\t\t\t<td>{{viewedValorisierungMethod.valorisierung_methode_beschreibung}}</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<th>Parameter</th>\n\t\t\t\t\t\t<td><pre>{{JSON.stringify(this.viewedValorisierungMethod.valorisierung_methode_parameter, null, 2)}}</pre></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody>\n\t\t\t</table>\n\t\t</template>\n\t</Modal>\n\t'},cn=FHC_JS_DATA_STORAGE_OBJECT.app_root.replace(/(https:|)(^|\/\/)(.*?\/)/g,"")+FHC_JS_DATA_STORAGE_OBJECT.ci_router,pn=VueRouter.createRouter({history:VueRouter.createWebHistory(),routes:[{path:`/${cn}/extensions/FHC-Core-Personalverwaltung/Employees`,component:Pt},{path:`/${cn}/extensions/FHC-Core-Personalverwaltung/Employees/:id/:uid`,component:Pt,name:"Employee",children:[{path:"",component:ft,name:"person",props:t=>({id:parseInt(t.params.id),uid:t.params.uid})},{path:"contract",component:fe,props:t=>({id:parseInt(t.params.id),uid:t.params.uid,openhistory:-1!=location.href.indexOf("#dvhistory")})},{path:"contract/:dienstverhaeltnis_id",component:fe,props:t=>({id:parseInt(t.params.id),uid:t.params.uid,dienstverhaeltnis_id:parseInt(t.params.dienstverhaeltnis_id)})},{path:"time",component:Se,name:"time"},{path:"lifecycle",component:Ce,name:"lifecycle"},{path:"document",component:De,name:"document"},{path:"summary",component:xe,name:"summary",props:t=>({date:t.query.d})}]},{path:`/${cn}/extensions/FHC-Core-Personalverwaltung/Valorisation/Check/:dienstverhaeltnis_id`,component:un,props:t=>({dienstverhaeltnis_id:parseInt(t.params.dienstverhaeltnis_id)})}]});Highcharts.setOptions({lang:{thousandsSep:".",decimalPoint:",",dateFormat:"dd.mm.YYYY"}});const hn=Vue.ref([]),fn=Vue.ref([]),vn=Vue.ref([]),mn=Vue.ref([]),gn=Vue.ref([]),bn=Vue.ref([]),yn=Vue.ref([]),_n=Vue.ref([]),kn=Vue.ref([]),An=Vue.ref([]),xn=Vue.ref([]),wn=Vue.ref([]),zn=Vue.ref([]),Sn=Vue.ref([]),Cn=Vue.ref([]),Dn=Vue.ref([]),Fn=Vue.ref([]),Vn=Vue.createApp({name:"PV21Employee",setup(){Vue.provide("sprache",hn),Vue.provide("nations",fn),Vue.provide("standorte",vn),Vue.provide("orte",mn),Vue.provide("ausbildung",gn),Vue.provide("kontakttyp",bn),Vue.provide("adressentyp",yn),Vue.provide("sachaufwandtyp",_n),Vue.provide("karenztypen",kn),Vue.provide("teilzeittypen",An),Vue.provide("vertragsarten",xn),Vue.provide("vertragsbestandteiltypen",wn),Vue.provide("gehaltstypen",Sn),Vue.provide("freitexttypen",zn),Vue.provide("hourlyratetypes",Cn),Vue.provide("unternehmen",Dn),Vue.provide("beendigungsgruende",Fn)}}).use(pn);Vn.use(primevue.config.default),Vn.use(highchartsPlugin,{tagName:"highcharts"}),Vn.use(on),Vn.use(Qe),Vn.mount("#wrapper"),Vn.config.globalProperties.$api.call(et.getSprache()).then(t=>{hn.value=t.data}),Vn.config.globalProperties.$api.call(et.getNations()).then(t=>{fn.value=t.data}),Vn.config.globalProperties.$api.call(et.getAusbildung()).then(t=>{gn.value=t.data}),Vn.config.globalProperties.$api.call(et.getOrte()).then(t=>{mn.value=t.data}),Vn.config.globalProperties.$api.call(et.getStandorteIntern()).then(t=>{vn.value=t.data}),Vn.config.globalProperties.$api.call(et.getKontakttyp()).then(t=>{bn.value=t.data}),Vn.config.globalProperties.$api.call(et.getAdressentyp()).then(t=>{yn.value=t.data}),Vn.config.globalProperties.$api.call(et.getSachaufwandTyp()).then(t=>{_n.value=t.data}),Vn.config.globalProperties.$api.call(et.getKarenztypen()).then(t=>{kn.value=t.data}),Vn.config.globalProperties.$api.call(et.getTeilzeittypen()).then(t=>{An.value=t.data}),Vn.config.globalProperties.$api.call(et.getVertragsarten()).then(t=>{xn.value=t.data}),Vn.config.globalProperties.$api.call(et.getGehaltstypen()).then(t=>{Sn.value=t.data}),Vn.config.globalProperties.$api.call(et.getVertragsbestandteiltypen()).then(t=>{wn.value=t.data}),Vn.config.globalProperties.$api.call(et.getFreitexttypen()).then(t=>{zn.value=t.data}),Vn.config.globalProperties.$api.call(et.getStundensatztypen()).then(t=>{Cn.value=t.data}),Vn.config.globalProperties.$api.call(Wt.getUnternehmen()).then(t=>{Dn.value=t.data}),Vn.config.globalProperties.$api.call(Wt.getDvEndeGruende()).then(t=>{Fn.value=t.data});
//# sourceMappingURL=Employee.js.map
